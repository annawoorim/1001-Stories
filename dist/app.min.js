function Details(t,i){Record.call(this,t),this._media=[];var n=this;$.each(t.media,function(t,e){$.getJSON(e,function(t){n._media.push(new Media(t)),n._media.length===n._json.media.length&&i(n)})})}function DetailsContentDisplay(){}function Media(t){Record.call(this,t)}function Milestone(t){Record.call(this,t)}function PanoMatic(i){var n,r,o=!1;$(i).mousedown(function(t){t.preventDefault(),o=!0,$(i).addClass("active"),n=t.pageX-$(i).offset().left,r=$(i).scrollLeft()}),$(i).mouseleave(function(){o=!1,$(i).removeClass("active")}),$(i).mouseup(function(){o=!1,$(i).removeClass("active")}),$(i).mousemove(function(t){if(o){t.preventDefault();var e=t.pageX-$(i).offset().left-n;$(i).scrollLeft(r-e)}})}function Record(t){this._json=t}function Table(n){var r="active",o=this,a=0;this.load=function(t,e){var i;$(n).css("flex-direction",0===a?"column":"column-reverse"),$(n).empty(),$.each(t,function(t,e){var i=$.map(e.getTitle().split(":"),function(t){return t.trim()});$(n).append($("<li>").append($("<div>").addClass("thumb").css("background-image","url('"+e.getPreviewImage()+"')")).append($("<div>").addClass("info").append($("<div>").html(i.shift())).append($("<div>").html(i.shift())).append($("<div>")).append($("<div>").html(e.getDate().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))).append($("<div>").html(e.getDisplayName()))).append($("<a>").addClass("goto").append($("<img>").attr("src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMS41NCAzOS41NCI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOm5vbmU7c3Ryb2tlOiNmZmY7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS13aWR0aDoyLjVweDt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkFzc2V0IDk8L3RpdGxlPjxnIGlkPSJMYXllcl8yIiBkYXRhLW5hbWU9IkxheWVyIDIiPjxnIGlkPSJMYXllcl8xLTIiIGRhdGEtbmFtZT0iTGF5ZXIgMSI+PHBvbHlsaW5lIGNsYXNzPSJjbHMtMSIgcG9pbnRzPSIxLjc3IDM3Ljc3IDE5Ljc3IDE5Ljc3IDEuNzcgMS43NyIvPjwvZz48L2c+PC9zdmc+"))).attr("storymaps-id",e.getID()))}),e&&(i=$.grep($(n).find("li"),function(t){return $(t).attr("storymaps-id")===e.getID()}).shift()),i?($(i).addClass(r),$(n).animate({scrollTop:$(i).offset().top-$(n).offset().top+$(n).scrollTop()},"slow")):$(n).animate({scrollTop:0},"slow"),$(n).find("li").click(function(t){$(t.currentTarget).hasClass(r)?$(o).trigger("itemDetails",[$(t.currentTarget).attr("storymaps-id")]):(o.clearActive(),$(t.currentTarget).addClass(r),$(o).trigger("itemActivate",[$(t.currentTarget).attr("storymaps-id")]))}).hover(function(t){$(o).trigger("itemHoverIn",[$(t.currentTarget).attr("storymaps-id")])},function(t){$(o).trigger("itemHoverOut",[$(t.currentTarget).attr("storymaps-id")])})},this.setSortOrder=function(t){a=t,$(n).css("flex-direction",0===a?"column":"column-reverse");var e=$.grep($(n).find("li"),function(t){return $(t).hasClass(r)}).shift();e?$(n).animate({scrollTop:$(e).offset().top-$(n).offset().top+$(n).scrollTop()},"slow"):$(n).animate({scrollTop:0},"slow")},this.activateItem=function(e){$(n).find("li").removeClass(r);var t=$.grep($(n).find("li"),function(t){return $(t).attr("storymaps-id")===e}).shift();t&&($(t).addClass(r),$(n).animate({scrollTop:$(t).offset().top-$(n).offset().top+$(n).scrollTop()},"slow"))},this.clearActive=function(){$(n).find("li").removeClass(r)}}!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.L={})}(this,function(t){"use strict";function l(t){var e,i,n,r;for(i=1,n=arguments.length;i<n;i++)for(e in r=arguments[i])t[e]=r[e];return t}function d(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}}function c(t){return t._leaflet_id=t._leaflet_id||++Gt,t._leaflet_id}function e(t,e,i){var n,r,o,a;return a=function(){n=!1,r&&(o.apply(i,r),r=!1)},o=function(){n?r=arguments:(t.apply(i,arguments),setTimeout(a,e),n=!0)}}function i(t,e,i){var n=e[1],r=e[0],o=n-r;return t===n&&i?t:((t-r)%o+o)%o+r}function s(){return!1}function n(t,e){var i=Math.pow(10,void 0===e?6:e);return Math.round(t*i)/i}function r(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function u(t){return r(t).split(/\s+/)}function a(t,e){for(var i in t.hasOwnProperty("options")||(t.options=t.options?qt(t.options):{}),e)t.options[i]=e[i];return t.options}function h(t,e,i){var n=[];for(var r in t)n.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}function o(t,n){return t.replace(Wt,function(t,e){var i=n[e];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(n)),i})}function p(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function f(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}function m(t){var e=+new Date,i=Math.max(0,16-(e-Yt));return Yt=e+i,window.setTimeout(t,i)}function x(t,e,i){if(!i||Jt!==m)return Jt.call(window,d(t,e));t.call(e)}function y(t){t&&Kt.call(window,t)}function _(){}function g(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}function v(t,e,i){return t instanceof g?t:Xt(t)?new g(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new g(t.x,t.y):new g(t,e,i)}function b(t,e){if(t)for(var i=e?[t,e]:t,n=0,r=i.length;n<r;n++)this.extend(i[n])}function w(t,e){return!t||t instanceof b?t:new b(t,e)}function T(t,e){if(t)for(var i=e?[t,e]:t,n=0,r=i.length;n<r;n++)this.extend(i[n])}function S(t,e){return t instanceof T?t:new T(t,e)}function A(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)}function M(t,e,i){return t instanceof A?t:Xt(t)&&"object"!=typeof t[0]?3===t.length?new A(t[0],t[1],t[2]):2===t.length?new A(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new A(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new A(t,e,i)}function E(t,e,i,n){if(Xt(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=i,this._d=n}function z(t,e,i,n){return new E(t,e,i,n)}function P(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function C(t,e){var i,n,r,o,a,s,l="";for(i=0,r=t.length;i<r;i++){for(n=0,o=(a=t[i]).length;n<o;n++)l+=(n?"L":"M")+(s=a[n]).x+" "+s.y;l+=e?Ze?"z":"x":""}return l||"M0 0"}function I(t){return 0<=navigator.userAgent.toLowerCase().indexOf(t)}function k(t,e,i,n){return"touchstart"===e?(c=t,h=i,p=n,f=d(function(t){if("mouse"!==t.pointerType&&t.MSPOINTER_TYPE_MOUSE&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(Ye.indexOf(t.target.tagName)<0))return;yt(t)}O(t,h)}),c["_leaflet_touchstart"+p]=f,c.addEventListener(Ge,f,!1),Ke||(document.documentElement.addEventListener(Ge,R,!0),document.documentElement.addEventListener(We,D,!0),document.documentElement.addEventListener(Xe,B,!0),document.documentElement.addEventListener(He,B,!0),Ke=!0)):"touchmove"===e?(l=i,u=function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&O(t,l)},(s=t)["_leaflet_touchmove"+n]=u,s.addEventListener(We,u,!1)):"touchend"===e&&(o=i,a=function(t){O(t,o)},(r=t)["_leaflet_touchend"+n]=a,r.addEventListener(Xe,a,!1),r.addEventListener(He,a,!1)),this;var r,o,a,s,l,u,c,h,p,f}function R(t){Je[t.pointerId]=t,Qe++}function D(t){Je[t.pointerId]&&(Je[t.pointerId]=t)}function B(t){delete Je[t.pointerId],Qe--}function O(t,e){for(var i in t.touches=[],Je)t.touches.push(Je[i]);t.changedTouches=[t],e(t)}function F(t,r,e){function i(t){var e;if(Be){if(!me||"mouse"===t.pointerType)return;e=Qe}else e=t.touches.length;if(!(1<e)){var i=Date.now(),n=i-(o||i);a=t.touches?t.touches[0]:t,s=0<n&&n<=250,o=i}}function n(t){if(s&&!a.cancelBubble){if(Be){if(!me||"mouse"===t.pointerType)return;var e,i,n={};for(i in a)e=a[i],n[i]=e&&e.bind?e.bind(a):e;a=n}a.type="dblclick",r(a),o=null}}var o,a,s=!1;return t[ei+$e+e]=i,t[ei+ti+e]=n,t[ei+"dblclick"+e]=r,t.addEventListener($e,i,!1),t.addEventListener(ti,n,!1),t.addEventListener("dblclick",r,!1),this}function N(t,e){var i=t[ei+$e+e],n=t[ei+ti+e],r=t[ei+"dblclick"+e];return t.removeEventListener($e,i,!1),t.removeEventListener(ti,n,!1),me||t.removeEventListener("dblclick",r,!1),this}function j(t){return"string"==typeof t?document.getElementById(t):t}function U(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||"auto"===i)&&document.defaultView){var n=document.defaultView.getComputedStyle(t,null);i=n?n[e]:null}return"auto"===i?null:i}function Z(t,e,i){var n=document.createElement(t);return n.className=e||"",i&&i.appendChild(n),n}function V(t){var e=t.parentNode;e&&e.removeChild(t)}function q(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function G(t){var e=t.parentNode;e.lastChild!==t&&e.appendChild(t)}function W(t){var e=t.parentNode;e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function X(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=K(t);return 0<i.length&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function H(t,e){if(void 0!==t.classList)for(var i=u(e),n=0,r=i.length;n<r;n++)t.classList.add(i[n]);else if(!X(t,e)){var o=K(t);J(t,(o?o+" ":"")+e)}}function Y(t,e){void 0!==t.classList?t.classList.remove(e):J(t,r((" "+K(t)+" ").replace(" "+e+" "," ")))}function J(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function K(t){return void 0===t.className.baseVal?t.className:t.className.baseVal}function Q(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}(t,e)}function $(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function tt(t,e,i){var n=e||new g(0,0);t.style[ii]=(Le?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")}function et(t,e){t._leaflet_pos=e,Ce?tt(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function it(t){return t._leaflet_pos||new g(0,0)}function nt(){ut(window,"dragstart",yt)}function rt(){ct(window,"dragstart",yt)}function ot(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(at(),si=(ai=t).style.outline,t.style.outline="none",ut(window,"keydown",at))}function at(){ai&&(ai.style.outline=si,si=ai=void 0,ct(window,"keydown",at))}function st(t){for(;!((t=t.parentNode).offsetWidth&&t.offsetHeight||t===document.body););return t}function lt(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}function ut(t,e,i,n){if("object"==typeof e)for(var r in e)ht(t,r,e[r],i);else for(var o=0,a=(e=u(e)).length;o<a;o++)ht(t,e[o],i,n);return this}function ct(t,e,i,n){if("object"==typeof e)for(var r in e)pt(t,r,e[r],i);else if(e)for(var o=0,a=(e=u(e)).length;o<a;o++)pt(t,e[o],i,n);else{for(var s in t[ci])pt(t,s,t[ci][s]);delete t[ci]}return this}function ht(e,t,i,n){var r=t+c(i)+(n?"_"+c(n):"");if(e[ci]&&e[ci][r])return this;var o=function(t){return i.call(n||e,t||window.event)},a=o;Be&&0===t.indexOf("touch")?k(e,t,o,r):!Oe||"dblclick"!==t||Be&&we?"addEventListener"in e?"mousewheel"===t?e.addEventListener("onwheel"in e?"wheel":"mousewheel",o,!1):"mouseenter"===t||"mouseleave"===t?(o=function(t){t=t||window.event,wt(e,t)&&a(t)},e.addEventListener("mouseenter"===t?"mouseover":"mouseout",o,!1)):("click"===t&&_e&&(o=function(t){var e,i,n,r;i=a,n=(e=t).timeStamp||e.originalEvent&&e.originalEvent.timeStamp,(r=li&&n-li)&&100<r&&r<500||e.target._simulatedClick&&!e._simulated?_t(e):(li=n,i(e))}),e.addEventListener(t,o,!1)):"attachEvent"in e&&e.attachEvent("on"+t,o):F(e,o,r),e[ci]=e[ci]||{},e[ci][r]=o}function pt(t,e,i,n){var r=e+c(i)+(n?"_"+c(n):""),o=t[ci]&&t[ci][r];if(!o)return this;Be&&0===e.indexOf("touch")?(a=t,s=e,l=r,u=a["_leaflet_"+s+l],"touchstart"===s?a.removeEventListener(Ge,u,!1):"touchmove"===s?a.removeEventListener(We,u,!1):"touchend"===s&&(a.removeEventListener(Xe,u,!1),a.removeEventListener(He,u,!1))):!Oe||"dblclick"!==e||Be&&we?"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",o,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,o,!1):"detachEvent"in t&&t.detachEvent("on"+e,o):N(t,r),t[ci][r]=null;var a,s,l,u}function ft(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,bt(t),this}function dt(t){return ht(t,"mousewheel",ft),this}function mt(t){return ut(t,"mousedown touchstart dblclick",ft),ht(t,"click",xt),this}function yt(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function _t(t){return yt(t),ft(t),this}function gt(t,e){if(!e)return new g(t.clientX,t.clientY);var i=lt(e),n=i.boundingClientRect;return new g((t.clientX-n.left)/i.x-e.clientLeft,(t.clientY-n.top)/i.y-e.clientTop)}function vt(t){return me?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/hi:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function xt(t){pi[t.type]=!0}function bt(t){var e=pi[t.type];return pi[t.type]=!1,e}function wt(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t}function Tt(t,e){if(!e||!t.length)return t.slice();var i=e*e;return function(t,e){var i=t.length,n=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(i);n[0]=n[i-1]=1,function t(e,i,n,r,o){var a,s,l,u=0;for(s=r+1;s<=o-1;s++)(l=Lt(e[s],e[r],e[o],!0))>u&&(a=s,u=l);n<u&&(i[a]=1,t(e,i,n,r,a),t(e,i,n,a,o))}(t,n,e,0,i-1);var r,o=[];for(r=0;r<i;r++)n[r]&&o.push(t[r]);return o}(t=function(t,e){for(var i=[t[0]],n=1,r=0,o=t.length;n<o;n++)a=t[n],s=t[r],void 0,void 0,l=s.x-a.x,u=s.y-a.y,e<l*l+u*u&&(i.push(t[n]),r=n);var a,s,l,u;return r<o-1&&i.push(t[o-1]),i}(t,i),i)}function St(t,e,i){return Math.sqrt(Lt(t,e,i,!0))}function At(t,e,i,n,r){var o,a,s,l=n?Ti:Et(t,i),u=Et(e,i);for(Ti=u;;){if(!(l|u))return[t,e];if(l&u)return!1;s=Et(a=Mt(t,e,o=l||u,i,r),i),o===l?(t=a,l=s):(e=a,u=s)}}function Mt(t,e,i,n,r){var o,a,s=e.x-t.x,l=e.y-t.y,u=n.min,c=n.max;return 8&i?(o=t.x+s*(c.y-t.y)/l,a=c.y):4&i?(o=t.x+s*(u.y-t.y)/l,a=u.y):2&i?(o=c.x,a=t.y+l*(c.x-t.x)/s):1&i&&(o=u.x,a=t.y+l*(u.x-t.x)/s),new g(o,a,r)}function Et(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function Lt(t,e,i,n){var r,o=e.x,a=e.y,s=i.x-o,l=i.y-a,u=s*s+l*l;return 0<u&&(1<(r=((t.x-o)*s+(t.y-a)*l)/u)?(o=i.x,a=i.y):0<r&&(o+=s*r,a+=l*r)),s=t.x-o,l=t.y-a,n?s*s+l*l:new g(o,a)}function zt(t){return!Xt(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function Pt(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),zt(t)}function Ct(t,e,i){var n,r,o,a,s,l,u,c,h,p=[1,4,2,8];for(r=0,u=t.length;r<u;r++)t[r]._code=Et(t[r],e);for(a=0;a<4;a++){for(c=p[a],n=[],r=0,o=(u=t.length)-1;r<u;o=r++)s=t[r],l=t[o],s._code&c?l._code&c||((h=Mt(l,s,c,e,i))._code=Et(h,e),n.push(h)):(l._code&c&&((h=Mt(l,s,c,e,i))._code=Et(h,e),n.push(h)),n.push(s));t=n}return t}function It(t,e){var i,n,r,o,a="Feature"===t.type?t.geometry:t,s=a?a.coordinates:null,l=[],u=e&&e.pointToLayer,c=e&&e.coordsToLatLng||kt;if(!s&&!a)return null;switch(a.type){case"Point":return i=c(s),u?u(t,i):new qi(i);case"MultiPoint":for(r=0,o=s.length;r<o;r++)i=c(s[r]),l.push(u?u(t,i):new qi(i));return new ji(l);case"LineString":case"MultiLineString":return n=Rt(s,"LineString"===a.type?0:1,c),new Hi(n,e);case"Polygon":case"MultiPolygon":return n=Rt(s,"Polygon"===a.type?1:2,c),new Yi(n,e);case"GeometryCollection":for(r=0,o=a.geometries.length;r<o;r++){var h=It({geometry:a.geometries[r],type:"Feature",properties:t.properties},e);h&&l.push(h)}return new ji(l);default:throw new Error("Invalid GeoJSON object.")}}function kt(t){return new A(t[1],t[0],t[2])}function Rt(t,e,i){for(var n,r=[],o=0,a=t.length;o<a;o++)n=e?Rt(t[o],e-1,i):(i||kt)(t[o]),r.push(n);return r}function Dt(t,e){return e="number"==typeof e?e:6,void 0!==t.alt?[n(t.lng,e),n(t.lat,e),n(t.alt,e)]:[n(t.lng,e),n(t.lat,e)]}function Bt(t,e,i,n){for(var r=[],o=0,a=t.length;o<a;o++)r.push(e?Bt(t[o],e-1,i,n):Dt(t[o],n));return!e&&i&&r.push(r[0]),r}function Ot(t,e){return t.feature?l({},t.feature,{geometry:e}):Ft(e)}function Ft(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}function Nt(t,e){return new Ji(t,e)}function jt(t,e){return new sn(t,e)}function Ut(t){return Ue?new cn(t):null}function Zt(t){return Ze||Ve?new dn(t):null}var Vt=Object.freeze;Object.freeze=function(t){return t};var qt=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),Gt=0,Wt=/\{ *([\w_-]+) *\}/g,Xt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Ht="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",Yt=0,Jt=window.requestAnimationFrame||f("RequestAnimationFrame")||m,Kt=window.cancelAnimationFrame||f("CancelAnimationFrame")||f("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)},Qt=(Object.freeze||Object)({freeze:Vt,extend:l,create:qt,bind:d,lastId:Gt,stamp:c,throttle:e,wrapNum:i,falseFn:s,formatNum:n,trim:r,splitWords:u,setOptions:a,getParamString:h,template:o,isArray:Xt,indexOf:p,emptyImageUrl:Ht,requestFn:Jt,cancelFn:Kt,requestAnimFrame:x,cancelAnimFrame:y});_.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,n=qt(i);for(var r in(n.constructor=e).prototype=n,this)this.hasOwnProperty(r)&&"prototype"!==r&&"__super__"!==r&&(e[r]=this[r]);return t.statics&&(l(e,t.statics),delete t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=Xt(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),l.apply(null,[n].concat(t.includes)),delete t.includes),n.options&&(t.options=l(qt(n.options),t.options)),l(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;t<e;t++)n._initHooks[t].call(this)}},e},_.include=function(t){return l(this.prototype,t),this},_.mergeOptions=function(t){return l(this.prototype.options,t),this},_.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var $t={on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else for(var r=0,o=(t=u(t)).length;r<o;r++)this._on(t[r],e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else for(var r=0,o=(t=u(t)).length;r<o;r++)this._off(t[r],e,i);else delete this._events;return this},_on:function(t,e,i){this._events=this._events||{};var n=this._events[t];n||(n=[],this._events[t]=n),i===this&&(i=void 0);for(var r={fn:e,ctx:i},o=n,a=0,s=o.length;a<s;a++)if(o[a].fn===e&&o[a].ctx===i)return;o.push(r)},_off:function(t,e,i){var n,r,o;if(this._events&&(n=this._events[t]))if(e){if(i===this&&(i=void 0),n)for(r=0,o=n.length;r<o;r++){var a=n[r];if(a.ctx===i&&a.fn===e)return a.fn=s,this._firingCount&&(this._events[t]=n=n.slice()),void n.splice(r,1)}}else{for(r=0,o=n.length;r<o;r++)n[r].fn=s;delete this._events[t]}},fire:function(t,e,i){if(!this.listens(t,i))return this;var n=l({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var r=this._events[t];if(r){this._firingCount=this._firingCount+1||1;for(var o=0,a=r.length;o<a;o++){var s=r[o];s.fn.call(s.ctx||this,n)}this._firingCount--}}return i&&this._propagateEvent(n),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var n in t)this.once(n,t[n],e);return this}var r=d(function(){this.off(t,e,i).off(t,r,i)},this);return this.on(t,e,i).on(t,r,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[c(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[c(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,l({layer:t.target,propagatedFrom:t.target},t),!0)}};$t.addEventListener=$t.on,$t.removeEventListener=$t.clearAllEventListeners=$t.off,$t.addOneTimeEventListener=$t.once,$t.fireEvent=$t.fire,$t.hasEventListeners=$t.listens;var te=_.extend($t),ee=Math.trunc||function(t){return 0<t?Math.floor(t):Math.ceil(t)};g.prototype={clone:function(){return new g(this.x,this.y)},add:function(t){return this.clone()._add(v(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(v(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new g(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new g(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ee(this.x),this.y=ee(this.y),this},distanceTo:function(t){var e=(t=v(t)).x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return(t=v(t)).x===this.x&&t.y===this.y},contains:function(t){return t=v(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+n(this.x)+", "+n(this.y)+")"}},b.prototype={extend:function(t){return t=v(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new g((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new g(this.min.x,this.max.y)},getTopRight:function(){return new g(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return(t="number"==typeof t[0]||t instanceof g?v(t):w(t))instanceof b?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=w(t);var e=this.min,i=this.max,n=t.min,r=t.max,o=r.x>=e.x&&n.x<=i.x,a=r.y>=e.y&&n.y<=i.y;return o&&a},overlaps:function(t){t=w(t);var e=this.min,i=this.max,n=t.min,r=t.max,o=r.x>e.x&&n.x<i.x,a=r.y>e.y&&n.y<i.y;return o&&a},isValid:function(){return!(!this.min||!this.max)}},T.prototype={extend:function(t){var e,i,n=this._southWest,r=this._northEast;if(t instanceof A)i=e=t;else{if(!(t instanceof T))return t?this.extend(M(t)||S(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||r?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),r.lat=Math.max(i.lat,r.lat),r.lng=Math.max(i.lng,r.lng)):(this._southWest=new A(e.lat,e.lng),this._northEast=new A(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,r=Math.abs(e.lng-i.lng)*t;return new T(new A(e.lat-n,e.lng-r),new A(i.lat+n,i.lng+r))},getCenter:function(){return new A((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new A(this.getNorth(),this.getWest())},getSouthEast:function(){return new A(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof A||"lat"in t?M(t):S(t);var e,i,n=this._southWest,r=this._northEast;return t instanceof T?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=r.lat&&e.lng>=n.lng&&i.lng<=r.lng},intersects:function(t){t=S(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),r=t.getNorthEast(),o=r.lat>=e.lat&&n.lat<=i.lat,a=r.lng>=e.lng&&n.lng<=i.lng;return o&&a},overlaps:function(t){t=S(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),r=t.getNorthEast(),o=r.lat>e.lat&&n.lat<i.lat,a=r.lng>e.lng&&n.lng<i.lng;return o&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=S(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}};var ie,ne={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t);return new b(this.transformation.transform(e.min,i),this.transformation.transform(e.max,i))},infinite:!(A.prototype={equals:function(t,e){return!!t&&(t=M(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+n(this.lat,t)+", "+n(this.lng,t)+")"},distanceTo:function(t){return re.distance(this,M(t))},wrap:function(){return re.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return S([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new A(this.lat,this.lng,this.alt)}}),wrapLatLng:function(t){var e=this.wrapLng?i(t.lng,this.wrapLng,!0):t.lng;return new A(this.wrapLat?i(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,r=e.lng-i.lng;if(0===n&&0===r)return t;var o=t.getSouthWest(),a=t.getNorthEast();return new T(new A(o.lat-n,o.lng-r),new A(a.lat-n,a.lng-r))}},re=l({},ne,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,r=e.lat*i,o=Math.sin((e.lat-t.lat)*i/2),a=Math.sin((e.lng-t.lng)*i/2),s=o*o+Math.cos(n)*Math.cos(r)*a*a,l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*l}}),oe={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),r=Math.sin(n*e);return new g(this.R*t.lng*e,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(t){var e=180/Math.PI;return new A((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(ie=6378137*Math.PI,new b([-ie,-ie],[ie,ie]))};E.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new g((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var ae,se,le,ue,ce=l({},re,{code:"EPSG:3857",projection:oe,transformation:(ue=.5/(Math.PI*oe.R),z(ue,.5,-ue,.5))}),he=l({},ce,{code:"EPSG:900913"}),pe=document.documentElement.style,fe="ActiveXObject"in window,de=fe&&!document.addEventListener,me="msLaunchUri"in navigator&&!("documentMode"in document),ye=I("webkit"),_e=I("android"),ge=I("android 2")||I("android 3"),ve=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),xe=_e&&I("Google")&&ve<537&&!("AudioNode"in window),be=!!window.opera,we=I("chrome"),Te=I("gecko")&&!ye&&!be&&!fe,Se=!we&&I("safari"),Ae=I("phantom"),Me="OTransition"in pe,Ee=0===navigator.platform.indexOf("Win"),Le=fe&&"transition"in pe,ze="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ge,Pe="MozPerspective"in pe,Ce=!window.L_DISABLE_3D&&(Le||ze||Pe)&&!Me&&!Ae,Ie="undefined"!=typeof orientation||I("mobile"),ke=Ie&&ye,Re=Ie&&ze,De=!window.PointerEvent&&window.MSPointerEvent,Be=!(!window.PointerEvent&&!De),Oe=!window.L_NO_TOUCH&&(Be||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),Fe=Ie&&be,Ne=Ie&&Te,je=1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI),Ue=!!document.createElement("canvas").getContext,Ze=!(!document.createElementNS||!P("svg").createSVGRect),Ve=!Ze&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}(),qe=(Object.freeze||Object)({ie:fe,ielt9:de,edge:me,webkit:ye,android:_e,android23:ge,androidStock:xe,opera:be,chrome:we,gecko:Te,safari:Se,phantom:Ae,opera12:Me,win:Ee,ie3d:Le,webkit3d:ze,gecko3d:Pe,any3d:Ce,mobile:Ie,mobileWebkit:ke,mobileWebkit3d:Re,msPointer:De,pointer:Be,touch:Oe,mobileOpera:Fe,mobileGecko:Ne,retina:je,canvas:Ue,svg:Ze,vml:Ve}),Ge=De?"MSPointerDown":"pointerdown",We=De?"MSPointerMove":"pointermove",Xe=De?"MSPointerUp":"pointerup",He=De?"MSPointerCancel":"pointercancel",Ye=["INPUT","SELECT","OPTION"],Je={},Ke=!1,Qe=0,$e=De?"MSPointerDown":Be?"pointerdown":"touchstart",ti=De?"MSPointerUp":Be?"pointerup":"touchend",ei="_leaflet_",ii=$(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ni=$(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ri="webkitTransition"===ni||"OTransition"===ni?ni+"End":"transitionend";if("onselectstart"in document)ae=function(){ut(window,"selectstart",yt)},se=function(){ct(window,"selectstart",yt)};else{var oi=$(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ae=function(){if(oi){var t=document.documentElement.style;le=t[oi],t[oi]="none"}},se=function(){oi&&(document.documentElement.style[oi]=le,le=void 0)}}var ai,si,li,ui=(Object.freeze||Object)({TRANSFORM:ii,TRANSITION:ni,TRANSITION_END:ri,get:j,getStyle:U,create:Z,remove:V,empty:q,toFront:G,toBack:W,hasClass:X,addClass:H,removeClass:Y,setClass:J,getClass:K,setOpacity:Q,testProp:$,setTransform:tt,setPosition:et,getPosition:it,disableTextSelection:ae,enableTextSelection:se,disableImageDrag:nt,enableImageDrag:rt,preventOutline:ot,restoreOutline:at,getSizedParentNode:st,getScale:lt}),ci="_leaflet_events",hi=Ee&&we?2*window.devicePixelRatio:Te?window.devicePixelRatio:1,pi={},fi=(Object.freeze||Object)({on:ut,off:ct,stopPropagation:ft,disableScrollPropagation:dt,disableClickPropagation:mt,preventDefault:yt,stop:_t,getMousePosition:gt,getWheelDelta:vt,fakeStop:xt,skipped:bt,isExternalTarget:wt,addListener:ut,removeListener:ct}),di=te.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=it(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=x(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),et(this._el,i),this.fire("step")},_complete:function(){y(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),mi=te.extend({options:{crs:ce,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=a(this,e),this._initContainer(t),this._initLayout(),this._onResize=d(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(M(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=ni&&Ce&&!Fe&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ut(this._proxy,ri,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,i){return e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(M(t),e,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=l({animate:i.animate},i.zoom),i.pan=l({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,i.zoom):this._tryAnimatedPan(t,i.pan))?clearTimeout(this._sizeTimer):this._resetView(t,e),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Ce?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Ce?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),r=this.getSize().divideBy(2),o=(t instanceof g?t:this.latLngToContainerPoint(t)).subtract(r).multiplyBy(1-1/n),a=this.containerPointToLatLng(r.add(o));return this.setView(a,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():S(t);var i=v(e.paddingTopLeft||e.padding||[0,0]),n=v(e.paddingBottomRight||e.padding||[0,0]),r=this.getBoundsZoom(t,!1,i.add(n));if((r="number"==typeof e.maxZoom?Math.min(e.maxZoom,r):r)===1/0)return{center:t.getCenter(),zoom:r};var o=n.subtract(i).divideBy(2),a=this.project(t.getSouthWest(),r),s=this.project(t.getNorthEast(),r);return{center:this.unproject(a.add(s).divideBy(2).add(o),r),zoom:r}},fitBounds:function(t,e){if(!(t=S(t)).isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=v(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new di,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){H(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(o,a,t){function e(t){var e=(r*r-p*p+(t?-1:1)*m*m*f*f)/(2*(t?r:p)*m*f),i=Math.sqrt(e*e+1)-e;return i<1e-9?-18:Math.log(i)}function i(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}function l(t){return p*(s(y)*(i(e=y+d*t)/s(e))-i(y))/m;var e}if(!1===(t=t||{}).animate||!Ce)return this.setView(o,a,t);this._stop();var u=this.project(this.getCenter()),c=this.project(o),n=this.getSize(),h=this._zoom;o=M(o),a=void 0===a?h:a;var p=Math.max(n.x,n.y),r=p*this.getZoomScale(h,a),f=c.distanceTo(u)||1,d=1.42,m=d*d,y=e(0),_=Date.now(),g=(e(1)-y)/d,v=t.duration?1e3*t.duration:1e3*g*.8;return this._moveStart(!0,t.noMoveStart),function t(){var e,i,n=(Date.now()-_)/v,r=(e=n,(1-Math.pow(1-e,1.5))*g);n<=1?(this._flyToFrame=x(t,this),this._move(this.unproject(u.add(c.subtract(u).multiplyBy(l(r)/f)),h),this.getScaleZoom(p/(i=r,p*(s(y)/s(y+d*i))),h),{flyTo:!0})):this._move(o,a)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return(t=S(t)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,S(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},invalidateSize:function(t){if(!this._loaded)return this;t=l({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),r=i.divideBy(2).round(),o=n.subtract(r);return o.x||o.y?(t.animate&&t.pan?this.panBy(o):(t.pan&&this._rawPanBy(o),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(d(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=l({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=d(this._handleGeolocationResponse,this),i=d(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=new A(t.coords.latitude,t.coords.longitude),i=e.toBounds(2*t.coords.accuracy),n=this._locateOptions;if(n.setView){var r=this.getBoundsZoom(i);this.setView(e,n.maxZoom?Math.min(r,n.maxZoom):r)}var o={latlng:e,bounds:i,timestamp:t.timestamp};for(var a in t.coords)"number"==typeof t.coords[a]&&(o[a]=t.coords[a]);this.fire("locationfound",o)},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),V(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(y(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)V(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i=Z("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new T(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=S(t),i=v(i||[0,0]);var n=this.getZoom()||0,r=this.getMinZoom(),o=this.getMaxZoom(),a=t.getNorthWest(),s=t.getSouthEast(),l=this.getSize().subtract(i),u=w(this.project(s,n),this.project(a,n)).getSize(),c=Ce?this.options.zoomSnap:1,h=l.x/u.x,p=l.y/u.y,f=e?Math.max(h,p):Math.min(h,p);return n=this.getScaleZoom(f,n),c&&(n=Math.round(n/(c/100))*(c/100),n=e?Math.ceil(n/c)*c:Math.floor(n/c)*c),Math.max(r,Math.min(o,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new g(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new b(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=void 0===e?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=void 0===e?this._zoom:e;var n=i.zoom(t*i.scale(e));return isNaN(n)?1/0:n},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(M(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(v(t),e)},layerPointToLatLng:function(t){var e=v(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(M(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(M(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(S(t))},distance:function(t,e){return this.options.crs.distance(M(t),M(e))},containerPointToLayerPoint:function(t){return v(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return v(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(v(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(M(t)))},mouseEventToContainerPoint:function(t){return gt(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=j(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");ut(e,"scroll",this._onScroll,this),this._containerId=c(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ce,H(t,"leaflet-container"+(Oe?" leaflet-touch":"")+(je?" leaflet-retina":"")+(de?" leaflet-oldie":"")+(Se?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=U(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),et(this._mapPane,new g(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(H(t.markerPane,"leaflet-zoom-hide"),H(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){et(this._mapPane,new g(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,!1)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(n||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return y(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){et(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={};var e=t?ct:ut;e((this._targets[c(this._container)]=this)._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Ce&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){y(this._resizeRequest),this._resizeRequest=x(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],r="mouseout"===e||"mouseover"===e,o=t.target||t.srcElement,a=!1;o;){if((i=this._targets[c(o)])&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(r&&!wt(o,t))break;if(n.push(i),r)break}if(o===this._container)break;o=o.parentNode}return n.length||a||r||!wt(o,t)||(n=[this]),n},_handleDOMEvent:function(t){if(this._loaded&&!bt(t)){var e=t.type;"mousedown"!==e&&"keypress"!==e||ot(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,i){if("click"===t.type){var n=l({},t);n.type="preclick",this._fireDOMEvent(n,n.type,i)}if(!t._stopped&&(i=(i||[]).concat(this._findEventTargets(t,e))).length){var r=i[0];"contextmenu"===e&&r.listens(e,!0)&&yt(t);var o={originalEvent:t};if("keypress"!==t.type){var a=r.getLatLng&&(!r._radius||r._radius<=10);o.containerPoint=a?this.latLngToContainerPoint(r.getLatLng()):this.mouseEventToContainerPoint(t),o.layerPoint=this.containerPointToLayerPoint(o.containerPoint),o.latlng=a?r.getLatLng():this.layerPointToLatLng(o.layerPoint)}for(var s=0;s<i.length;s++)if(i[s].fire(e,o,!0),o.originalEvent._stopped||!1===i[s].options.bubblingMouseEvents&&-1!==p(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return it(this._mapPane)||new g(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return w([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),r=this.getSize().divideBy(2),o=new b(n.subtract(r),n.add(r)),a=this._getBoundsOffset(o,i,e);return a.round().equals([0,0])?t:this.unproject(n.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new b(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=w(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),r=n.min.subtract(t.min),o=n.max.subtract(t.max);return new g(this._rebound(r.x,-o.x),this._rebound(r.y,-o.y))},_rebound:function(t,e){return 0<t+e?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=Ce?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Y(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(i)||(this.panBy(i,e),0))},_createAnimProxy:function(){var t=this._proxy=Z("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=ii,i=this._proxy.style[e];tt(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),i===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var t=this.getCenter(),e=this.getZoom();tt(this._proxy,this.project(t,e),this.getZoomScale(e,1))},this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){V(this._proxy),delete this._proxy},_catchTransitionEnd:function(t){this._animatingZoom&&0<=t.propertyName.indexOf("transform")&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||!1===i.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),r=this._getCenterOffset(t)._divideBy(1-1/n);return!(!0!==i.animate&&!this.getSize().contains(r)||(x(function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)},this),0))},_animateZoom:function(t,e,i,n){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,H(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),setTimeout(d(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Y(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),x(function(){this._moveEnd(!0)},this))}}),yi=_.extend({options:{position:"topright"},initialize:function(t){a(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return H(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},remove:function(){return this._map&&(V(this._container),this.onRemove&&this.onRemove(this._map),this._map=null),this},_refocusOnMap:function(t){this._map&&t&&0<t.screenX&&0<t.screenY&&this._map.getContainer().focus()}}),_i=function(t){return new yi(t)};mi.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,e){var i=r+t+" "+r+e;n[t+e]=Z("div",i,o)}var n=this._controlCorners={},r="leaflet-",o=this._controlContainer=Z("div",r+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)V(this._controlCorners[t]);V(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var gi=yi.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){for(var n in a(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){this._initLayout(),this._update(),(this._map=t).on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return yi.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(c(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){H(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(H(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=t+"px"):Y(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Y(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=Z("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),mt(e),dt(e);var n=this._form=Z("form",t+"-list");i&&(this._map.on("click",this.collapse,this),_e||ut(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var r=this._layersLink=Z("a",t+"-toggle",e);r.href="#",r.title="Layers",Oe?(ut(r,"click",_t),ut(r,"click",this.expand,this)):ut(r,"focus",this.expand,this),i||this.expand(),this._baseLayersList=Z("div",t+"-base",n),this._separator=Z("div",t+"-separator",n),this._overlaysList=Z("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&c(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(d(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;q(this._baseLayersList),q(this._overlaysList),this._layerControlInputs=[];var t,e,i,n,r=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,r+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&1<r,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(c(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",n=document.createElement("div");return n.innerHTML=i,n.firstChild},_addItem:function(t){var e,i=document.createElement("label"),n=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=n):e=this._createRadioElement("leaflet-base-layers",n),this._layerControlInputs.push(e),e.layerId=c(t.layer),ut(e,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+t.name;var o=document.createElement("div");return i.appendChild(o),o.appendChild(e),o.appendChild(r),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){var t,e,i=this._layerControlInputs,n=[],r=[];this._handlingClick=!0;for(var o=i.length-1;0<=o;o--)t=i[o],e=this._getLayer(t.layerId).layer,t.checked?n.push(e):t.checked||r.push(e);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])&&this._map.removeLayer(r[o]);for(o=0;o<n.length;o++)this._map.hasLayer(n[o])||this._map.addLayer(n[o]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,i=this._layerControlInputs,n=this._map.getZoom(),r=i.length-1;0<=r;r--)t=i[r],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&n<e.options.minZoom||void 0!==e.options.maxZoom&&n>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),vi=yi.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=Z("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,r){var o=Z("a",i,n);return o.innerHTML=t,o.href="#",o.title=e,o.setAttribute("role","button"),o.setAttribute("aria-label",e),mt(o),ut(o,"click",_t),ut(o,"click",r,this),ut(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";Y(this._zoomInButton,e),Y(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&H(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&H(this._zoomInButton,e)}});mi.mergeOptions({zoomControl:!0}),mi.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new vi,this.addControl(this.zoomControl))});var xi=yi.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e=Z("div","leaflet-control-scale"),i=this.options;return this._addScales(i,"leaflet-control-scale-line",e),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),e},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=Z("div",e,i)),t.imperial&&(this._iScale=Z("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,r=3.2808399*t;5280<r?(e=r/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(r),this._updateScale(this._iScale,n+" ft",n/r))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i=10<=i?10:5<=i?5:3<=i?3:2<=i?2:1)}}),bi=yi.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){a(this,t),this._attributions={}},onAdd:function(t){for(var e in(t.attributionControl=this)._container=Z("div","leaflet-control-attribution"),mt(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t&&(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update()),this},removeAttribution:function(t){return t&&this._attributions[t]&&(this._attributions[t]--,this._update()),this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}}});mi.mergeOptions({attributionControl:!0}),mi.addInitHook(function(){this.options.attributionControl&&(new bi).addTo(this)}),yi.Layers=gi,yi.Zoom=vi,yi.Scale=xi,yi.Attribution=bi,_i.layers=function(t,e,i){return new gi(t,e,i)},_i.zoom=function(t){return new vi(t)},_i.scale=function(t){return new xi(t)},_i.attribution=function(t){return new bi(t)};var wi=_.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled&&(this._enabled=!1,this.removeHooks()),this},enabled:function(){return!!this._enabled}});wi.addTo=function(t,e){return t.addHandler(e,this),this};var Ti,Si,Ai={Events:$t},Mi=Oe?"touchstart mousedown":"mousedown",Ei={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},Li={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},zi=te.extend({options:{clickTolerance:3},initialize:function(t,e,i,n){a(this,n),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(ut(this._dragStartTarget,Mi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(zi._dragging===this&&this.finishDrag(),ct(this._dragStartTarget,Mi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!X(this._element,"leaflet-zoom-anim")&&!(zi._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||((zi._dragging=this)._preventOutline&&ot(this._element),nt(),ae(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t,i=st(this._element);this._startPoint=new g(e.clientX,e.clientY),this._parentScale=lt(i),ut(document,Li[t.type],this._onMove,this),ut(document,Ei[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled)if(t.touches&&1<t.touches.length)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,i=new g(e.clientX,e.clientY)._subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,yt(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=it(this._element).subtract(i),H(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),H(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,y(this._animRequest),this._lastEvent=t,this._animRequest=x(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),et(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){for(var t in Y(document.body,"leaflet-dragging"),this._lastTarget&&(Y(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Li)ct(document,Li[t],this._onMove,this),ct(document,Ei[t],this._onUp,this);rt(),se(),this._moved&&this._moving&&(y(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,zi._dragging=!1}}),Pi=(Object.freeze||Object)({simplify:Tt,pointToSegmentDistance:St,closestPointOnSegment:function(t,e,i){return Lt(t,e,i)},clipSegment:At,_getEdgeIntersection:Mt,_getBitCode:Et,_sqClosestPointOnSegment:Lt,isFlat:zt,_flat:Pt}),Ci=(Object.freeze||Object)({clipPolygon:Ct}),Ii={project:function(t){return new g(t.lng,t.lat)},unproject:function(t){return new A(t.y,t.x)},bounds:new b([-180,-90],[180,90])},ki={R:6378137,R_MINOR:6356752.314245179,bounds:new b([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,r=this.R_MINOR/i,o=Math.sqrt(1-r*r),a=o*Math.sin(n),s=Math.tan(Math.PI/4-n/2)/Math.pow((1-a)/(1+a),o/2);return n=-i*Math.log(Math.max(s,1e-10)),new g(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,r=this.R_MINOR/n,o=Math.sqrt(1-r*r),a=Math.exp(-t.y/n),s=Math.PI/2-2*Math.atan(a),l=0,u=.1;l<15&&1e-7<Math.abs(u);l++)e=o*Math.sin(s),e=Math.pow((1-e)/(1+e),o/2),s+=u=Math.PI/2-2*Math.atan(a*e)-s;return new A(s*i,t.x*i/n)}},Ri=(Object.freeze||Object)({LonLat:Ii,Mercator:ki,SphericalMercator:oe}),Di=l({},re,{code:"EPSG:3395",projection:ki,transformation:(Si=.5/(Math.PI*ki.R),z(Si,.5,-Si,.5))}),Bi=l({},re,{code:"EPSG:4326",projection:Ii,transformation:z(1/180,1,-1/180,.5)}),Oi=l({},ne,{projection:Ii,transformation:z(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0});ne.Earth=re,ne.EPSG3395=Di,ne.EPSG3857=ce,ne.EPSG900913=he,ne.EPSG4326=Bi,ne.Simple=Oi;var Fi=te.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[c(t)]=this},removeInteractiveTarget:function(t){return delete this._map._targets[c(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.getAttribution&&e.attributionControl&&e.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}});mi.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=c(t);return this._layers[e]||((this._layers[e]=t)._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=c(t);return this._layers[e]&&(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null),this},hasLayer:function(t){return!!t&&c(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){for(var e=0,i=(t=t?Xt(t)?t:[t]:[]).length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[c(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=c(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,i=this._getZoomSpan();for(var n in this._zoomBoundLayers){var r=this._zoomBoundLayers[n].options;t=void 0===r.minZoom?t:Math.min(t,r.minZoom),e=void 0===r.maxZoom?e:Math.max(e,r.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ni=Fi.extend({initialize:function(t,e){var i,n;if(a(this,e),this._layers={},t)for(i=0,n=t.length;i<n;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)(i=this._layers[e])[t]&&i[t].apply(i,n);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return c(t)}}),ji=Ni.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ni.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ni.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new T;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),Ui=_.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){a(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&&(n=[n,n]);var r=v(n),o=v("shadow"===e&&i.shadowAnchor||i.iconAnchor||r&&r.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),r&&(t.style.width=r.x+"px",t.style.height=r.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return je&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),Zi=Ui.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return Zi.imagePath||(Zi.imagePath=this._detectIconPath()),(this.options.imagePath||Zi.imagePath)+Ui.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=Z("div","leaflet-default-icon-path",document.body),e=U(t,"background-image")||U(t,"backgroundImage");return document.body.removeChild(t),null===e||0!==e.indexOf("url")?"":e.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),Vi=wi.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new zi(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),H(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Y(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,n=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,o=it(e._icon),a=i.getPixelBounds(),s=i.getPixelOrigin(),l=w(a.min._subtract(s).add(r),a.max._subtract(s).subtract(r));if(!l.contains(o)){var u=v((Math.max(l.max.x,o.x)-l.max.x)/(a.max.x-l.max.x)-(Math.min(l.min.x,o.x)-l.min.x)/(a.min.x-l.min.x),(Math.max(l.max.y,o.y)-l.max.y)/(a.max.y-l.max.y)-(Math.min(l.min.y,o.y)-l.min.y)/(a.min.y-l.min.y)).multiplyBy(n);i.panBy(u,{animate:!1}),this._draggable._newPos._add(u),this._draggable._startPos._add(u),et(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=x(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(y(this._panRequest),this._panRequest=x(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,n=it(e._icon),r=e._map.layerPointToLatLng(n);i&&et(i,n),e._latlng=r,t.latlng=r,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){y(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),qi=Fi.extend({options:{icon:new Zi,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){a(this,e),this._latlng=M(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=M(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),"IMG"===i.tagName&&(i.alt=t.alt||"")),H(i,e),t.keyboard&&(i.tabIndex="0"),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var r=t.icon.createShadow(this._shadow),o=!1;r!==this._shadow&&(this._removeShadow(),o=!0),r&&(H(r,e),r.alt=""),this._shadow=r,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&o&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),V(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&V(this._shadow),this._shadow=null},_setPos:function(t){et(this._icon,t),this._shadow&&et(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(H(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Vi)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Vi(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;Q(this._icon,t),this._shadow&&Q(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Gi=Fi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return a(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),Wi=Gi.extend({options:{fill:!0,radius:10},initialize:function(t,e){a(this,e),this._latlng=M(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=M(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Gi.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new b(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Xi=Wi.extend({initialize:function(t,e,i){if("number"==typeof e&&(e=l({},i,{radius:e})),a(this,e),this._latlng=M(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new T(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Gi.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===re.distance){var r=Math.PI/180,o=this._mRadius/re.R/r,a=i.project([e+o,t]),s=i.project([e-o,t]),l=a.add(s).divideBy(2),u=i.unproject(l).lat,c=Math.acos((Math.cos(o*r)-Math.sin(e*r)*Math.sin(u*r))/(Math.cos(e*r)*Math.cos(u*r)))/r;(isNaN(c)||0===c)&&(c=o/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(c)?0:l.x-i.project([u,t-c]).x,this._radiusY=l.y-a.y}else{var h=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(h).x}this._updateBounds()}}),Hi=Gi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){a(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,r=null,o=Lt,a=0,s=this._parts.length;a<s;a++)for(var l=this._parts[a],u=1,c=l.length;u<c;u++){var h=o(t,e=l[u-1],i=l[u],!0);h<n&&(n=h,r=o(t,e,i))}return r&&(r.distance=Math.sqrt(n)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,r,o,a,s=this._rings[0],l=s.length;if(!l)return null;for(e=t=0;t<l-1;t++)e+=s[t].distanceTo(s[t+1])/2;if(0===e)return this._map.layerPointToLatLng(s[0]);for(n=t=0;t<l-1;t++)if(r=s[t],o=s[t+1],(n+=i=r.distanceTo(o))>e)return a=(n-e)/i,this._map.layerPointToLatLng([o.x-a*(o.x-r.x),o.y-a*(o.y-r.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=M(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new T,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return zt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=zt(t),n=0,r=t.length;n<r;n++)i?(e[n]=M(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new b;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),i=new g(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(i),t.max._add(i),this._pxBounds=t)},_projectLatlngs:function(t,e,i){var n,r,o=t[0]instanceof A,a=t.length;if(o){for(r=[],n=0;n<a;n++)r[n]=this._map.latLngToLayerPoint(t[n]),i.extend(r[n]);e.push(r)}else for(n=0;n<a;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,i,n,r,o,a,s,l=this._parts;for(n=e=0,r=this._rings.length;e<r;e++)for(i=0,o=(s=this._rings[e]).length;i<o-1;i++)(a=At(s[i],s[i+1],t,i,!0))&&(l[n]=l[n]||[],l[n].push(a[0]),a[1]===s[i+1]&&i!==o-2||(l[n].push(a[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=Tt(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,n,r,o,a,s,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,o=this._parts.length;i<o;i++)for(n=0,r=(a=(s=this._parts[i]).length)-1;n<a;r=n++)if((e||0!==n)&&St(t,s[r],s[n])<=l)return!0;return!1}});Hi._flat=Pt;var Yi=Hi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,r,o,a,s,l,u=this._rings[0],c=u.length;if(!c)return null;for(o=a=s=0,t=0,e=c-1;t<c;e=t++)i=u[t],n=u[e],r=i.y*n.x-n.y*i.x,a+=(i.x+n.x)*r,s+=(i.y+n.y)*r,o+=3*r;return l=0===o?u[0]:[a/o,s/o],this._map.layerPointToLatLng(l)},_convertLatLngs:function(t){var e=Hi.prototype._convertLatLngs.call(this,t),i=e.length;return 2<=i&&e[0]instanceof A&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){Hi.prototype._setLatLngs.call(this,t),zt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return zt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new g(e,e);if(t=new b(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var n,r=0,o=this._rings.length;r<o;r++)(n=Ct(this._rings[r],t,!0)).length&&this._parts.push(n)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,i,n,r,o,a,s,l,u=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(r=0,s=this._parts.length;r<s;r++)for(o=0,a=(l=(e=this._parts[r]).length)-1;o<l;a=o++)i=e[o],n=e[a],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u||Hi.prototype._containsPoint.call(this,t,!0)}}),Ji=ji.extend({initialize:function(t,e){a(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,r=Xt(t)?t:t.features;if(r){for(e=0,i=r.length;e<i;e++)((n=r[e]).geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var a=It(t,o);return a?(a.feature=Ft(t),a.defaultOptions=a.options,this.resetStyle(a),o.onEachFeature&&o.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return t.options=l({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),Ki={toGeoJSON:function(t){return Ot(this,{type:"Point",coordinates:Dt(this.getLatLng(),t)})}};qi.include(Ki),Xi.include(Ki),Wi.include(Ki),Hi.include({toGeoJSON:function(t){var e=!zt(this._latlngs);return Ot(this,{type:(e?"Multi":"")+"LineString",coordinates:Bt(this._latlngs,e?1:0,!1,t)})}}),Yi.include({toGeoJSON:function(t){var e=!zt(this._latlngs),i=e&&!zt(this._latlngs[0]),n=Bt(this._latlngs,i?2:e?1:0,!0,t);return e||(n=[n]),Ot(this,{type:(i?"Multi":"")+"Polygon",coordinates:n})}}),Ni.include({toMultiPoint:function(e){var i=[];return this.eachLayer(function(t){i.push(t.toGeoJSON(e).geometry.coordinates)}),Ot(this,{type:"MultiPoint",coordinates:i})},toGeoJSON:function(n){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(n);var r="GeometryCollection"===t,o=[];return this.eachLayer(function(t){if(t.toGeoJSON){var e=t.toGeoJSON(n);if(r)o.push(e.geometry);else{var i=Ft(e);"FeatureCollection"===i.type?o.push.apply(o,i.features):o.push(i)}}}),r?Ot(this,{geometries:o,type:"GeometryCollection"}):{type:"FeatureCollection",features:o}}});var Qi=Nt,$i=Fi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=S(e),a(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(H(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){V(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&G(this._image),this},bringToBack:function(){return this._map&&W(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=S(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:Z("img");H(e,"leaflet-image-layer"),this._zoomAnimated&&H(e,"leaflet-zoom-animated"),this.options.className&&H(e,this.options.className),e.onselectstart=s,e.onmousemove=s,e.onload=d(this.fire,this,"load"),e.onerror=d(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;tt(this._image,i,e)},_reset:function(){var t=this._image,e=new b(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();et(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){Q(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),tn=$i.extend({options:{autoplay:!0,loop:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:Z("video");if(H(e,"leaflet-image-layer"),this._zoomAnimated&&H(e,"leaflet-zoom-animated"),e.onselectstart=s,e.onmousemove=s,e.onloadeddata=d(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),n=[],r=0;r<i.length;r++)n.push(i[r].src);this._url=0<i.length?n:[e.src]}else{Xt(this._url)||(this._url=[this._url]),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop;for(var o=0;o<this._url.length;o++){var a=Z("source");a.src=this._url[o],e.appendChild(a)}}}}),en=Fi.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){a(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&Q(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&Q(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(Q(this._container,0),this._removeTimeout=setTimeout(d(V,void 0,this._container),200)):V(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=M(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&G(this._container),this},bringToBack:function(){return this._map&&W(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=v(this.options.offset),i=this._getAnchor();this._zoomAnimated?et(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}}),nn=en.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){en.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Gi||this._source.on("preclick",ft))},onRemove:function(t){en.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Gi||this._source.off("preclick",ft))},getEvents:function(){var t=en.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=Z("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=Z("div",t+"-content-wrapper",e);if(this._contentNode=Z("div",t+"-content",i),mt(i),dt(this._contentNode),ut(i,"contextmenu",ft),this._tipContainer=Z("div",t+"-tip-container",e),this._tip=Z("div",t+"-tip",this._tipContainer),this.options.closeButton){var n=this._closeButton=Z("a",t+"-close-button",e);n.href="#close",n.innerHTML="&#215;",ut(n,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,r=this.options.maxHeight;r&&r<n?(e.height=r+"px",H(t,"leaflet-popup-scrolled")):Y(t,"leaflet-popup-scrolled"),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();et(this._container,e.add(i))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var t=this._map,e=parseInt(U(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,r=new g(this._containerLeft,-i-this._containerBottom);r._add(it(this._container));var o=t.layerPointToContainerPoint(r),a=v(this.options.autoPanPadding),s=v(this.options.autoPanPaddingTopLeft||a),l=v(this.options.autoPanPaddingBottomRight||a),u=t.getSize(),c=0,h=0;o.x+n+l.x>u.x&&(c=o.x+n-u.x+l.x),o.x-c-s.x<0&&(c=o.x-s.x),o.y+i+l.y>u.y&&(h=o.y+i-u.y+l.y),o.y-h-s.y<0&&(h=o.y-s.y),(c||h)&&t.fire("autopanstart").panBy([c,h])}},_onCloseButtonClick:function(t){this._close(),_t(t)},_getAnchor:function(){return v(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});mi.mergeOptions({closePopupOnClick:!0}),mi.include({openPopup:function(t,e,i){return t instanceof nn||(t=new nn(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),Fi.include({bindPopup:function(t,e){return t instanceof nn?(a(t,e),(this._popup=t)._source=this):(this._popup&&!e||(this._popup=new nn(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof Fi||(e=t,t=this),t instanceof ji)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;this._popup&&this._map&&(_t(t),e instanceof Gi?this.openPopup(t.layer||t.target,t.latlng):this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var rn=en.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){en.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){en.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=en.prototype.getEvents.call(this);return Oe&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Z("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),r=e.layerPointToContainerPoint(t),o=this.options.direction,a=i.offsetWidth,s=i.offsetHeight,l=v(this.options.offset),u=this._getAnchor();t="top"===o?t.add(v(-a/2+l.x,-s+l.y+u.y,!0)):"bottom"===o?t.subtract(v(a/2-l.x,-l.y,!0)):"center"===o?t.subtract(v(a/2+l.x,s/2-u.y+l.y,!0)):"right"===o||"auto"===o&&r.x<n.x?(o="right",t.add(v(l.x+u.x,u.y-s/2+l.y,!0))):(o="left",t.subtract(v(a+u.x-l.x,s/2-u.y-l.y,!0))),Y(i,"leaflet-tooltip-right"),Y(i,"leaflet-tooltip-left"),Y(i,"leaflet-tooltip-top"),Y(i,"leaflet-tooltip-bottom"),H(i,"leaflet-tooltip-"+o),et(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&Q(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return v(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});mi.include({openTooltip:function(t,e,i){return t instanceof rn||(t=new rn(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),Fi.include({bindTooltip:function(t,e){return t instanceof rn?(a(t,e),(this._tooltip=t)._source=this):(this._tooltip&&!e||(this._tooltip=new rn(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),Oe&&(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){if(t instanceof Fi||(e=t,t=this),t instanceof ji)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(H(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(Y(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}});var on=Ui.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),i=this.options;if(e.innerHTML=!1!==i.html?i.html:"",i.bgPos){var n=v(i.bgPos);e.style.backgroundPosition=-n.x+"px "+-n.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});Ui.Default=Zi;var an=Fi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ie,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){a(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),V(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(G(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(W(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=e(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof g?t:new g(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-1/0,1/0),r=0,o=i.length;r<o;r++)e=i[r].style.zIndex,i[r]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!de){Q(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var r=this._tiles[n];if(r.current&&r.loaded){var o=Math.min(1,(t-r.loaded)/200);Q(r.el,o),o<1?e=!0:(r.active?i=!0:this._onOpaqueTile(r),r.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(y(this._fadeFrame),this._fadeFrame=x(this._updateOpacity,this))}},_onOpaqueTile:s,_initContainer:function(){this._container||(this._container=Z("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(V(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var n=this._levels[t],r=this._map;return n||((n=this._levels[t]={}).el=Z("div","leaflet-tile-container leaflet-zoom-animated",this._container),n.el.style.zIndex=e,n.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),n.zoom=t,this._setZoomTransform(n,r.getCenter(),r.getZoom()),n.el.offsetWidth,this._onCreateLevel(n)),this._level=n}},_onUpdateLevel:s,_onRemoveLevel:s,_onCreateLevel:s,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)V(this._levels[t].el),this._onRemoveLevel(t),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,n){var r=Math.floor(t/2),o=Math.floor(e/2),a=i-1,s=new g(+r,+o);s.z=+a;var l=this._tileCoordsToKey(s),u=this._tiles[l];return u&&u.active?u.retain=!0:(u&&u.loaded&&(u.retain=!0),n<a&&this._retainParent(r,o,a,n))},_retainChildren:function(t,e,i,n){for(var r=2*t;r<2*t+2;r++)for(var o=2*e;o<2*e+2;o++){var a=new g(r,o);a.z=i+1;var s=this._tileCoordsToKey(a),l=this._tiles[s];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<n&&this._retainChildren(r,o,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,n){var r=this._clampZoom(Math.round(e));(void 0!==this.options.maxZoom&&r>this.options.maxZoom||void 0!==this.options.minZoom&&r<this.options.minZoom)&&(r=void 0);var o=this.options.updateWhenZooming&&r!==this._tileZoom;n&&!o||(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==r&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),r=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();Ce?tt(t.el,r,n):et(t.el,r)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),r=e.project(t,this._tileZoom).floor(),o=e.getSize().divideBy(2*n);return new b(r.subtract(o),r.add(o))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var n=this._getTiledPixelBounds(t),r=this._pxBoundsToTileRange(n),o=r.getCenter(),a=[],s=this.options.keepBuffer,l=new b(r.getBottomLeft().subtract([s,-s]),r.getTopRight().add([s,-s]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var u in this._tiles){var c=this._tiles[u].coords;c.z===this._tileZoom&&l.contains(new g(c.x,c.y))||(this._tiles[u].current=!1)}if(1<Math.abs(i-this._tileZoom))this._setView(t,i);else{for(var h=r.min.y;h<=r.max.y;h++)for(var p=r.min.x;p<=r.max.x;p++){var f=new g(p,h);if(f.z=this._tileZoom,this._isValidTile(f)){var d=this._tiles[this._tileCoordsToKey(f)];d?d.current=!0:a.push(f)}}if(a.sort(function(t,e){return t.distanceTo(o)-e.distanceTo(o)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(p=0;p<a.length;p++)this._addTile(a[p],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return S(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),r=n.add(i);return[e.unproject(n,t.z),e.unproject(r,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new T(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new g(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(V(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){H(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=s,t.onmousemove=s,de&&this.options.opacity<1&&Q(t,this.options.opacity),_e&&!ge&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),r=this.createTile(this._wrapCoords(t),d(this._tileReady,this,t));this._initTile(r),this.createTile.length<2&&x(d(this._tileReady,this,t,null,r)),et(r,i),this._tiles[n]={el:r,coords:t,current:!0},e.appendChild(r),this.fire("tileloadstart",{tile:r,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);(i=this._tiles[n])&&(i.loaded=+new Date,this._map._fadeAnimated?(Q(i.el,0),y(this._fadeFrame),this._fadeFrame=x(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(H(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),de||!this._map._fadeAnimated?x(this._pruneTiles,this):setTimeout(d(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new g(this._wrapX?i(t.x,this._wrapX):t.x,this._wrapY?i(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new b(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),sn=an.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,(e=a(this,e)).detectRetina&&je&&0<e.maxZoom&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),_e||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return ut(i,"load",d(this._tileOnLoad,this,e,i)),ut(i,"error",d(this._tileOnError,this,e,i)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i.alt="",i.setAttribute("role","presentation"),i.src=this.getTileUrl(t),i},getTileUrl:function(t){var e={r:je?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}return o(this._url,l(e,this.options))},_tileOnLoad:function(t,e){de?setTimeout(d(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&e.getAttribute("src")!==n&&(e.src=n),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=s,e.onerror=s,e.complete||(e.src=Ht,V(e),delete this._tiles[t]))},_removeTile:function(t){var e=this._tiles[t];if(e)return xe||e.el.setAttribute("src",Ht),an.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(this._map&&(!i||i.getAttribute("src")!==Ht))return an.prototype._tileReady.call(this,t,e,i)}}),ln=sn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=l({},this.defaultWmsParams);for(var n in e)n in this.options||(i[n]=e[n]);var r=(e=a(this,e)).detectRetina&&je?2:1,o=this.getTileSize();i.width=o.x*r,i.height=o.y*r,this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=1.3<=this._wmsVersion?"crs":"srs";this.wmsParams[e]=this._crs.code,sn.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,n=w(i.project(e[0]),i.project(e[1])),r=n.min,o=n.max,a=(1.3<=this._wmsVersion&&this._crs===Bi?[r.y,r.x,o.y,o.x]:[r.x,r.y,o.x,o.y]).join(","),s=sn.prototype.getTileUrl.call(this,t);return s+h(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(t,e){return l(this.wmsParams,t),e||this.redraw(),this}});sn.WMS=ln,jt.wms=function(t,e){return new ln(t,e)};var un=Fi.extend({options:{padding:.1,tolerance:0},initialize:function(t){a(this,t),c(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&H(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=it(this._container),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,e),a=this._map.project(t,e).subtract(o),s=r.multiplyBy(-i).add(n).add(r).subtract(a);Ce?tt(this._container,s,i):et(this._container,s)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new b(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),cn=un.extend({getEvents:function(){var t=un.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){un.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");ut(t,"mousemove",e(this._onMouseMove,32,this),this),ut(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ut(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){y(this._redrawRequest),delete this._ctx,V(this._container),ct(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},un.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=je?2:1;et(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",je&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){un.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t);var e=(this._layers[c(t)]=t)._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,n=e.prev;i?i.prev=n:this._drawLast=n,n?n.next=i:this._drawFirst=i,delete this._drawnLayers[t._leaflet_id],delete t._order,delete this._layers[c(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i=t.options.dashArray.split(/[, ]+/),n=[];for(e=0;e<i.length;e++)n.push(Number(i[e]));t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||x(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new b,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,r,o,a=t._parts,s=a.length,l=this._ctx;if(s){for(this._drawnLayers[t._leaflet_id]=t,l.beginPath(),i=0;i<s;i++){for(n=0,r=a[i].length;n<r;n++)o=a[i][n],l[n?"lineTo":"moveTo"](o.x,o.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,n=Math.max(Math.round(t._radius),1),r=(Math.max(Math.round(t._radiusY),1)||n)/n;this._drawnLayers[t._leaflet_id]=t,1!==r&&(i.save(),i.scale(1,r)),i.beginPath(),i.arc(e.x,e.y/r,n,0,2*Math.PI,!1),1!==r&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),r=this._drawFirst;r;r=r.next)(e=r.layer).options.interactive&&e._containsPoint(n)&&!this._map._draggableMoved(e)&&(i=e);i&&(xt(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(Y(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var i,n,r=this._drawFirst;r;r=r.next)(i=r.layer).options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(H(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order,i=e.next,n=e.prev;i&&((i.prev=n)?n.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,(this._drawLast.next=e).next=null,this._drawLast=e,this._requestRedraw(t))},_bringToBack:function(t){var e=t._order,i=e.next,n=e.prev;n&&((n.next=i)?i.prev=n:n&&(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}),hn=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),pn={_initContainer:function(){this._container=Z("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(un.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=hn("shape");H(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=hn("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[c(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;V(e),t.removeInteractiveTarget(e),delete this._layers[c(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,r=t._container;r.stroked=!!n.stroke,r.filled=!!n.fill,n.stroke?(e||(e=t._stroke=hn("stroke")),r.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=Xt(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(r.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=hn("fill")),r.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(r.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){G(t._container)},_bringToBack:function(t){W(t._container)}},fn=Ve?hn:P,dn=un.extend({getEvents:function(){var t=un.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=fn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=fn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){V(this._container),ct(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){un.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),et(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=fn("path");t.options.className&&H(e,t.options.className),t.options.interactive&&H(e,"leaflet-interactive"),this._updateStyle(t),this._layers[c(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){V(t._path),t.removeInteractiveTarget(t._path),delete this._layers[c(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,C(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),n="a"+i+","+(Math.max(Math.round(t._radiusY),1)||i)+" 0 1,0 ",r=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+n+2*i+",0 "+n+2*-i+",0 ";this._setPath(t,r)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){G(t._path)},_bringToBack:function(t){W(t._path)}});Ve&&dn.include(pn),mi.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&Ut(t)||Zt(t)}});var mn=Yi.extend({initialize:function(t,e){Yi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=S(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});dn.create=fn,dn.pointsToPath=C,Ji.geometryToLayer=It,Ji.coordsToLatLng=kt,Ji.coordsToLatLngs=Rt,Ji.latLngToCoords=Dt,Ji.latLngsToCoords=Bt,Ji.getFeature=Ot,Ji.asFeature=Ft,mi.mergeOptions({boxZoom:!0});var yn=wi.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){ut(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ct(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){V(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),ae(),nt(),this._startPoint=this._map.mouseEventToContainerPoint(t),ut(document,{contextmenu:_t,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Z("div","leaflet-zoom-box",this._container),H(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new b(this._point,this._startPoint),i=e.getSize();et(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(V(this._box),Y(this._container,"leaflet-crosshair")),se(),rt(),ct(document,{contextmenu:_t,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(d(this._resetState,this),0);var e=new T(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});mi.addInitHook("addHandler","boxZoom",yn),mi.mergeOptions({doubleClickZoom:!0});var _n=wi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,r=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(r):e.setZoomAround(t.containerPoint,r)}});mi.addInitHook("addHandler","doubleClickZoom",_n),mi.mergeOptions({dragging:!0,inertia:!ge,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var gn=wi.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new zi(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}H(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Y(this._map._container,"leaflet-grab"),Y(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=S(this._map.options.maxBounds);this._offsetLimit=w(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;1<this._positions.length&&50<t-this._times[0];)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,r=(n-e+i)%t+e-i,o=(n+e+i)%t-e-i,a=Math.abs(r+i)<Math.abs(o+i)?r:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,a=i.easeLinearity,s=r.multiplyBy(a/o),l=s.distanceTo([0,0]),u=Math.min(i.inertiaMaxSpeed,l),c=s.multiplyBy(u/l),h=u/(i.inertiaDeceleration*a),p=c.multiplyBy(-h/2).round();p.x||p.y?(p=e._limitOffset(p,e.options.maxBounds),x(function(){e.panBy(p,{duration:h,easeLinearity:a,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});mi.addInitHook("addHandler","dragging",gn),mi.mergeOptions({keyboard:!0,keyboardPanDelta:80});var vn=wi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),ut(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ct(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,n=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(n,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},r=this.keyCodes;for(e=0,i=r.left.length;e<i;e++)n[r.left[e]]=[-1*t,0];for(e=0,i=r.right.length;e<i;e++)n[r.right[e]]=[t,0];for(e=0,i=r.down.length;e<i;e++)n[r.down[e]]=[0,t];for(e=0,i=r.up.length;e<i;e++)n[r.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},r=this.keyCodes;for(e=0,i=r.zoomIn.length;e<i;e++)n[r.zoomIn[e]]=t;for(e=0,i=r.zoomOut.length;e<i;e++)n[r.zoomOut[e]]=-t},_addHooks:function(){ut(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ct(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys)n._panAnim&&n._panAnim._inProgress||(e=this._panKeys[i],t.shiftKey&&(e=v(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds));else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!n._popup||!n._popup.options.closeOnEscapeKey)return;n.closePopup()}_t(t)}}});mi.addInitHook("addHandler","keyboard",vn),mi.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var xn=wi.extend({addHooks:function(){ut(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ct(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=vt(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(d(this._performZoom,this),n),_t(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,o=i?Math.ceil(r/i)*i:r,a=t._limitZoom(e+(0<this._delta?o:-o))-e;this._delta=0,this._startTime=null,a&&("center"===t.options.scrollWheelZoom?t.setZoom(e+a):t.setZoomAround(this._lastMousePos,e+a))}});mi.addInitHook("addHandler","scrollWheelZoom",xn),mi.mergeOptions({tap:!0,tapTolerance:15});var bn=wi.extend({addHooks:function(){ut(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ct(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(yt(t),this._fireClick=!0,1<t.touches.length)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],i=e.target;this._startPos=this._newPos=new g(e.clientX,e.clientY),i.tagName&&"a"===i.tagName.toLowerCase()&&H(i,"leaflet-active"),this._holdTimeout=setTimeout(d(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),this._simulateEvent("mousedown",e),ut(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),ct(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],i=e.target;i&&i.tagName&&"a"===i.tagName.toLowerCase()&&Y(i,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new g(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(t,e){var i=document.createEvent("MouseEvents");i._simulated=!0,e.target._simulatedClick=!0,i.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}});Oe&&!Be&&mi.addInitHook("addHandler","tap",bn),mi.mergeOptions({touchZoom:Oe&&!ge,bounceAtZoomLimits:!0});var wn=wi.extend({addHooks:function(){H(this._map._container,"leaflet-touch-zoom"),ut(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Y(this._map._container,"leaflet-touch-zoom"),ct(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(n)._divideBy(2))),this._startDist=i.distanceTo(n),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),ut(document,"touchmove",this._onTouchMove,this),ut(document,"touchend",this._onTouchEnd,this),yt(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),r=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(r,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&r<1||this._zoom>e.getMaxZoom()&&1<r)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===r)return}else{var o=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===r&&0===o.x&&0===o.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),y(this._animRequest);var a=d(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=x(a,this,!0),yt(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,y(this._animRequest),ct(document,"touchmove",this._onTouchMove),ct(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});mi.addInitHook("addHandler","touchZoom",wn),mi.BoxZoom=yn,mi.DoubleClickZoom=_n,mi.Drag=gn,mi.Keyboard=vn,mi.ScrollWheelZoom=xn,mi.Tap=bn,mi.TouchZoom=wn,Object.freeze=Vt,t.version="1.3.4",t.Control=yi,t.control=_i,t.Browser=qe,t.Evented=te,t.Mixin=Ai,t.Util=Qt,t.Class=_,t.Handler=wi,t.extend=l,t.bind=d,t.stamp=c,t.setOptions=a,t.DomEvent=fi,t.DomUtil=ui,t.PosAnimation=di,t.Draggable=zi,t.LineUtil=Pi,t.PolyUtil=Ci,t.Point=g,t.point=v,t.Bounds=b,t.bounds=w,t.Transformation=E,t.transformation=z,t.Projection=Ri,t.LatLng=A,t.latLng=M,t.LatLngBounds=T,t.latLngBounds=S,t.CRS=ne,t.GeoJSON=Ji,t.geoJSON=Nt,t.geoJson=Qi,t.Layer=Fi,t.LayerGroup=Ni,t.layerGroup=function(t,e){return new Ni(t,e)},t.FeatureGroup=ji,t.featureGroup=function(t){return new ji(t)},t.ImageOverlay=$i,t.imageOverlay=function(t,e,i){return new $i(t,e,i)},t.VideoOverlay=tn,t.videoOverlay=function(t,e,i){return new tn(t,e,i)},t.DivOverlay=en,t.Popup=nn,t.popup=function(t,e){return new nn(t,e)},t.Tooltip=rn,t.tooltip=function(t,e){return new rn(t,e)},t.Icon=Ui,t.icon=function(t){return new Ui(t)},t.DivIcon=on,t.divIcon=function(t){return new on(t)},t.Marker=qi,t.marker=function(t,e){return new qi(t,e)},t.TileLayer=sn,t.tileLayer=jt,t.GridLayer=an,t.gridLayer=function(t){return new an(t)},t.SVG=dn,t.svg=Zt,t.Renderer=un,t.Canvas=cn,t.canvas=Ut,t.Path=Gi,t.CircleMarker=Wi,t.circleMarker=function(t,e){return new Wi(t,e)},t.Circle=Xi,t.circle=function(t,e,i){return new Xi(t,e,i)},t.Polyline=Hi,t.polyline=function(t,e){return new Hi(t,e)},t.Polygon=Yi,t.polygon=function(t,e){return new Yi(t,e)},t.Rectangle=mn,t.rectangle=function(t,e){return new mn(t,e)},t.Map=mi,t.map=function(t,e){return new mi(t,e)};var Tn=window.L;t.noConflict=function(){return window.L=Tn,this},window.L=t}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],e):e((t.L=t.L||{},t.L.esri={}),t.L)}(this,function(t,p){"use strict";var e=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,i=""===document.documentElement.style.pointerEvents,s={cors:e,pointerEvents:i},n={attributionWidthOffset:55},a=0;function l(t){var e="";for(var i in t.f=t.f||"json",t)if(t.hasOwnProperty(i)){var n,r=t[i],o=Object.prototype.toString.call(r);e.length&&(e+="&"),n="[object Array]"===o?"[object Object]"===Object.prototype.toString.call(r[0])?JSON.stringify(r):r.join(","):"[object Object]"===o?JSON.stringify(r):"[object Date]"===o?r.valueOf():r,e+=encodeURIComponent(i)+"="+encodeURIComponent(n)}return e}function u(n,r){var o=new window.XMLHttpRequest;return o.onerror=function(t){o.onreadystatechange=p.Util.falseFn,n.call(r,{error:{code:500,message:"XMLHttpRequest error"}},null)},o.onreadystatechange=function(){var e,i;if(4===o.readyState){try{e=JSON.parse(o.responseText)}catch(t){e=null,i={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!i&&e.error&&(i=e.error,e=null),o.onerror=p.Util.falseFn,n.call(r,i,e)}},o.ontimeout=function(){this.onerror()},o}function r(t,e,i,n){var r=u(i,n);return r.open("POST",t),null!=n&&void 0!==n.options&&(r.timeout=n.options.timeout),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(l(e)),r}function o(t,e,i,n){var r=u(i,n);return r.open("GET",t+"?"+l(e),!0),null!=n&&void 0!==n.options&&(r.timeout=n.options.timeout),r.send(null),r}function c(t,e,i,n){var r=l(e),o=u(i,n),a=(t+"?"+r).length;if(a<=2e3&&s.cors?o.open("GET",t+"?"+r):2e3<a&&s.cors&&(o.open("POST",t),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),null!=n&&void 0!==n.options&&(o.timeout=n.options.timeout),a<=2e3&&s.cors)o.send(null);else{if(!(2e3<a&&s.cors))return a<=2e3&&!s.cors?h(t,e,i,n):void k("a request to "+t+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");o.send(r)}return o}function h(t,e,n,r){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var o="c"+a;e.callback="window._EsriLeafletCallbacks."+o,window._EsriLeafletCallbacks[o]=function(t){if(!0!==window._EsriLeafletCallbacks[o]){var e,i=Object.prototype.toString.call(t);"[object Object]"!==i&&"[object Array]"!==i&&(e={error:{code:500,message:"Expected array or object as JSONP response"}},t=null),!e&&t.error&&(e=t,t=null),n.call(r,e,t),window._EsriLeafletCallbacks[o]=!0}};var i=p.DomUtil.create("script",null,document.body);return i.type="text/javascript",i.src=t+"?"+l(e),i.id=o,i.onerror=function(t){t&&!0!==window._EsriLeafletCallbacks[o]&&(n.call(r,{error:{code:500,message:"An unknown error occurred"}}),window._EsriLeafletCallbacks[o]=!0)},p.DomUtil.addClass(i,"esri-leaflet-jsonp"),a++,{id:o,url:i.src,abort:function(){window._EsriLeafletCallbacks._callback[o]({code:0,message:"Request aborted."})}}}var f=s.cors?o:h;f.CORS=o,f.JSONP=h;var d={request:c,get:f,post:r};function m(t){return function(t,e){for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}(t[0],t[t.length-1])||t.push(t[0]),t}function y(t){for(var e,i=0,n=0,r=t.length,o=t[n];n<r-1;n++)i+=((e=t[n+1])[0]-o[0])*(e[1]+o[1]),o=e;return 0<=i}function _(t,e,i,n){var r=(n[0]-i[0])*(t[1]-i[1])-(n[1]-i[1])*(t[0]-i[0]),o=(e[0]-t[0])*(t[1]-i[1])-(e[1]-t[1])*(t[0]-i[0]),a=(n[1]-i[1])*(e[0]-t[0])-(n[0]-i[0])*(e[1]-t[1]);if(0!==a){var s=r/a,l=o/a;if(0<=s&&s<=1&&0<=l&&l<=1)return!0}return!1}function g(t,e){for(var i=0;i<t.length-1;i++)for(var n=0;n<e.length-1;n++)if(_(t[i],t[i+1],e[n],e[n+1]))return!0;return!1}function v(t){var e=[],i=t.slice(0),n=m(i.shift().slice(0));if(4<=n.length){y(n)||n.reverse(),e.push(n);for(var r=0;r<i.length;r++){var o=m(i[r].slice(0));4<=o.length&&(y(o)&&o.reverse(),e.push(o))}}return e}function x(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function b(t,e){return function t(e,i){i=i||"OBJECTID";var n,r={wkid:4326},o={};switch(e.type){case"Point":o.x=e.coordinates[0],o.y=e.coordinates[1],o.spatialReference=r;break;case"MultiPoint":o.points=e.coordinates.slice(0),o.spatialReference=r;break;case"LineString":o.paths=[e.coordinates.slice(0)],o.spatialReference=r;break;case"MultiLineString":o.paths=e.coordinates.slice(0),o.spatialReference=r;break;case"Polygon":o.rings=v(e.coordinates.slice(0)),o.spatialReference=r;break;case"MultiPolygon":o.rings=function(t){for(var e=[],i=0;i<t.length;i++)for(var n=v(t[i]),r=n.length-1;0<=r;r--){var o=n[r].slice(0);e.push(o)}return e}(e.coordinates.slice(0)),o.spatialReference=r;break;case"Feature":e.geometry&&(o.geometry=t(e.geometry,i)),o.attributes=e.properties?x(e.properties):{},e.id&&(o.attributes[i]=e.id);break;case"FeatureCollection":for(o=[],n=0;n<e.features.length;n++)o.push(t(e.features[n],i));break;case"GeometryCollection":for(o=[],n=0;n<e.geometries.length;n++)o.push(t(e.geometries[n],i))}return o}(t,e)}function w(t,e){return function t(e,o){var i={};if(e.features){i.type="FeatureCollection",i.features=[];for(var n=0;n<e.features.length;n++)i.features.push(t(e.features[n],o))}if("number"==typeof e.x&&"number"==typeof e.y&&(i.type="Point",i.coordinates=[e.x,e.y],"number"==typeof e.z&&i.coordinates.push(e.z)),e.points&&(i.type="MultiPoint",i.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(i.type="LineString",i.coordinates=e.paths[0].slice(0)):(i.type="MultiLineString",i.coordinates=e.paths.slice(0))),e.rings&&(i=function(t){for(var e,i,n=[],r=[],o=0;o<t.length;o++){var a=m(t[o].slice(0));if(!(a.length<4))if(y(a)){var s=[a.slice().reverse()];n.push(s)}else r.push(a.slice().reverse())}for(var l=[];r.length;){i=r.pop();var u=!1;for(e=n.length-1;0<=e;e--)if(c=n[e][0],p=g(c,h=i),f=function(t,e){for(var i=!1,n=-1,r=t.length,o=r-1;++n<r;o=n)(t[n][1]<=e[1]&&e[1]<t[o][1]||t[o][1]<=e[1]&&e[1]<t[n][1])&&e[0]<(t[o][0]-t[n][0])*(e[1]-t[n][1])/(t[o][1]-t[n][1])+t[n][0]&&(i=!i);return i}(c,h[0]),!p&&f){n[e].push(i),u=!0;break}u||l.push(i)}for(var c,h,p,f;l.length;){i=l.pop();var d=!1;for(e=n.length-1;0<=e;e--)if(g(n[e][0],i)){n[e].push(i),d=!0;break}d||n.push([i.reverse()])}return 1===n.length?{type:"Polygon",coordinates:n[0]}:{type:"MultiPolygon",coordinates:n}}(e.rings.slice(0))),(e.geometry||e.attributes)&&(i.type="Feature",i.geometry=e.geometry?t(e.geometry):null,i.properties=e.attributes?x(e.attributes):null,e.attributes))try{i.id=function(t,e){for(var i=o?[o,"OBJECTID","FID"]:["OBJECTID","FID"],n=0;n<i.length;n++){var r=i[n];if(r in t&&("string"==typeof t[r]||"number"==typeof t[r]))return t[r]}throw Error("No valid id attribute found")}(e.attributes)}catch(e){}return JSON.stringify(i.geometry)===JSON.stringify({})&&(i.geometry=null),e.spatialReference&&e.spatialReference.wkid&&4326!==e.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),i}(t,e)}function T(t){if("NaN"===t.xmin||"NaN"===t.ymin||"NaN"===t.xmax||"NaN"===t.ymax)return null;var e=p.latLng(t.ymin,t.xmin),i=p.latLng(t.ymax,t.xmax);return p.latLngBounds(e,i)}function S(t){return{xmin:(t=p.latLngBounds(t)).getSouthWest().lng,ymin:t.getSouthWest().lat,xmax:t.getNorthEast().lng,ymax:t.getNorthEast().lat,spatialReference:{wkid:4326}}}var A=/^(OBJECTID|FID|OID|ID)$/i;function M(t){var e;if(t.objectIdFieldName)e=t.objectIdFieldName;else if(t.fields){for(var i=0;i<=t.fields.length-1;i++)if("esriFieldTypeOID"===t.fields[i].type){e=t.fields[i].name;break}if(!e)for(i=0;i<=t.fields.length-1;i++)if(t.fields[i].name.match(A)){e=t.fields[i].name;break}}return e}function E(t){for(var e in t.attributes)if(e.match(A))return e}function L(t,e){var i,n=t.features||t.results,r=n.length;i=e||M(t);var o={type:"FeatureCollection",features:[]};if(r)for(var a=n.length-1;0<=a;a--){var s=w(n[a],i||E(n[a]));o.features.push(s)}return o}function z(t){return"/"!==(t=p.Util.trim(t))[t.length-1]&&(t+="/"),t}function P(t){if(-1!==t.url.indexOf("?")){t.requestParams=t.requestParams||{};var e=t.url.substring(t.url.indexOf("?")+1);t.url=t.url.split("?")[0],t.requestParams=JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return t.url=z(t.url.split("?")[0]),t}function C(t){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(t)}function I(t){var e;switch(t){case"Point":e="esriGeometryPoint";break;case"MultiPoint":e="esriGeometryMultipoint";break;case"LineString":case"MultiLineString":e="esriGeometryPolyline";break;case"Polygon":case"MultiPolygon":e="esriGeometryPolygon"}return e}function k(){console&&console.warn&&console.warn.apply(console,arguments)}function R(t){return t.getSize().x-n.attributionWidthOffset+"px"}function D(e){if(e.attributionControl&&!e.attributionControl._esriAttributionAdded){e.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | Powered by <a href="https://www.esri.com">Esri</a>');var i=document.createElement("style");i.type="text/css",i.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(i),p.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution:hover");var n=document.createElement("style");n.type="text/css",n.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+R(e)+";}",document.getElementsByTagName("head")[0].appendChild(n),p.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution"),e.on("resize",function(t){e.attributionControl._container.style.maxWidth=R(t.target)}),e.on("unload",function(){i.parentNode.removeChild(i),n.parentNode.removeChild(n);for(var t=document.querySelectorAll(".esri-leaflet-jsonp"),e=0;e<t.length;e++)t.item(e).parentNode.removeChild(t.item(e))}),e.attributionControl._esriAttributionAdded=!0}}function B(t){var e={geometry:null,geometryType:null};return t instanceof p.LatLngBounds?(e.geometry=S(t),e.geometryType="esriGeometryEnvelope",e):(t.getLatLng&&(t=t.getLatLng()),t instanceof p.LatLng&&(t={type:"Point",coordinates:[t.lng,t.lat]}),t instanceof p.GeoJSON&&(t=t.getLayers()[0].feature.geometry,e.geometry=b(t),e.geometryType=I(t.type)),t.toGeoJSON&&(t=t.toGeoJSON()),"Feature"===t.type&&(t=t.geometry),"Point"===t.type||"LineString"===t.type||"Polygon"===t.type||"MultiPolygon"===t.type?(e.geometry=b(t),e.geometryType=I(t.type),e):void k("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object"))}function O(t,l){h(t,{},p.Util.bind(function(t,e){if(!t){l._esriAttributions=[];for(var i=0;i<e.contributors.length;i++)for(var n=e.contributors[i],r=0;r<n.coverageAreas.length;r++){var o=n.coverageAreas[r],a=p.latLng(o.bbox[0],o.bbox[1]),s=p.latLng(o.bbox[2],o.bbox[3]);l._esriAttributions.push({attribution:n.attribution,score:o.score,bounds:p.latLngBounds(a,s),minZoom:o.zoomMin,maxZoom:o.zoomMax})}l._esriAttributions.sort(function(t,e){return e.score-t.score}),F({target:l})}},this))}function F(t){var e=t.target,i=e._esriAttributions;if(e&&e.attributionControl){var n=e.attributionControl._container.querySelector(".esri-dynamic-attribution");if(n&&i){for(var r="",o=e.getBounds(),a=p.latLngBounds(o.getSouthWest().wrap(),o.getNorthEast().wrap()),s=e.getZoom(),l=0;l<i.length;l++){var u=i[l],c=u.attribution;!r.match(c)&&u.bounds.intersects(a)&&s>=u.minZoom&&s<=u.maxZoom&&(r+=", "+c)}r=r.substr(2),n.innerHTML=r,n.style.maxWidth=R(e),e.fire("attributionupdated",{attribution:r})}}}var N={warn:k,cleanUrl:z,getUrlParams:P,isArcgisOnline:C,geojsonTypeToArcGIS:I,responseToFeatureCollection:L,geojsonToArcGIS:b,arcgisToGeoJSON:w,boundsToExtent:S,extentToBounds:T,calcAttributionWidth:R,setEsriAttribution:D,_setGeometry:B,_getAttributionData:O,_updateMapAttribution:F,_findIdAttributeFromFeature:E,_findIdAttributeFromResponse:M},j=p.Class.extend({options:{proxy:!1,useCors:e},generateSetter:function(e,t){return p.Util.bind(function(t){return this.params[e]=t,this},t)},initialize:function(t){if(t.request&&t.options?(this._service=t,p.Util.setOptions(this,t.options)):(p.Util.setOptions(this,t),this.options.url=z(t.url)),this.params=p.Util.extend({},this.params||{}),this.setters)for(var e in this.setters){var i=this.setters[e];this[e]=this.generateSetter(i,this)}},token:function(t){return this._service?this._service.authenticate(t):this.params.token=t,this},format:function(t){return this.params.returnUnformattedValues=!t,this},request:function(t,e){return this.options.requestParams&&p.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,t,e):this._request("request",this.path,this.params,t,e)},_request:function(t,e,i,n,r){var o=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return"get"!==t&&"request"!==t||this.options.useCors?d[t](o,i,n,r):d.get.JSONP(o,i,n,r)}}),U=j.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSr:4326,outFields:"*"},within:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(t,e){return t=p.latLng(t),this.params.geometry=[t.lng,t.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=e,this.params.inSr=4326,this},where:function(t){return this.params.where=t,this},between:function(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},orderBy:function(t,e){return e=e||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[t,e].join(" "),this},run:function(i,n){return this._cleanParams(),this.options.isModern||C(this.options.url)?(this.params.f="geojson",this.request(function(t,e){this._trapSQLerrors(t),i.call(n,t,e,e)},this)):this.request(function(t,e){this._trapSQLerrors(t),i.call(n,t,e&&L(e),e)},this)},count:function(i,t){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(t,e){i.call(this,t,e&&e.count,e)},t)},ids:function(i,t){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(t,e){i.call(this,t,e&&e.objectIds,e)},t)},bounds:function(i,n){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(t,e){e&&e.extent&&T(e.extent)?i.call(n,t,T(e.extent),e):(t={message:"Invalid Bounds"},i.call(n,t,null,e))},n)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(t){var e=p.point(t);return this.params.pixelSize=[e.x,e.y],this},layer:function(t){return this.path=t+"/query",this},_trapSQLerrors:function(t){t&&"400"===t.code&&k("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(t){this.params.inSr=4326;var e=B(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function Z(t){return new U(t)}var V=j.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(t,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[t,e].join(":"),this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run:function(i,n){return this.request(function(t,e){i.call(n,t,e&&L(e),e)},n)}});function q(t){return new V(t)}var G=j.extend({path:"identify",between:function(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this}}),W=G.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(t){var e=S(t.getBounds()),i=t.getSize();return this.params.imageDisplay=[i.x,i.y,96],this.params.mapExtent=[e.xmin,e.ymin,e.xmax,e.ymax],this},at:function(t){return 2===t.length&&(t=p.latLng(t)),this._setGeometryParams(t),this},layerDef:function(t,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[t,e].join(":"),this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run:function(r,o){return this.request(function(t,e){if(t)r.call(o,t,void 0,e);else{var i=L(e);e.results=e.results.reverse();for(var n=0;n<i.features.length;n++)i.features[n].layerId=e.results[n].layerId;r.call(o,void 0,i,e)}})},_setGeometryParams:function(t){var e=B(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function X(t){return new W(t)}var H=G.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(t){return t=p.latLng(t),this.params.geometry=JSON.stringify({x:t.lng,y:t.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(i,n){return this.request(function(t,e){i.call(n,t,e&&this._responseToGeoJSON(e),e)},this)},_responseToGeoJSON:function(t){var e=t.location,i=t.catalogItems,n=t.catalogItemVisibilities,r={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[e.x,e.y]},crs:{type:"EPSG",properties:{code:e.spatialReference.wkid}},properties:{OBJECTID:t.objectId,name:t.name,value:t.value},id:t.objectId}};if(t.properties&&t.properties.Values&&(r.pixel.properties.values=t.properties.Values),i&&i.features&&(r.catalogItems=L(i),n&&n.length===r.catalogItems.features.length))for(var o=n.length-1;0<=o;o--)r.catalogItems.features[o].properties.catalogItemVisibility=n[o];return r}});function Y(t){return new H(t)}var J=p.Evented.extend({options:{proxy:!1,useCors:e,timeout:0},initialize:function(t){t=t||{},this._requestQueue=[],this._authenticating=!1,p.Util.setOptions(this,t),this.options.url=z(this.options.url)},get:function(t,e,i,n){return this._request("get",t,e,i,n)},post:function(t,e,i,n){return this._request("post",t,e,i,n)},request:function(t,e,i,n){return this._request("request",t,e,i,n)},metadata:function(t,e){return this._request("get","",{},t,e)},authenticate:function(t){return this._authenticating=!1,this.options.token=t,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(t){this.options.timeout=t},_request:function(t,e,i,n,r){this.fire("requeststart",{url:this.options.url+e,params:i,method:t},!0);var o=this._createServiceCallback(t,e,i,n,r);if(this.options.token&&(i.token=this.options.token),this.options.requestParams&&p.Util.extend(i,this.options.requestParams),!this._authenticating){var a=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return"get"!==t&&"request"!==t||this.options.useCors?d[t](a,i,o,r):d.get.JSONP(a,i,o,r)}this._requestQueue.push([t,e,i,n,r])},_createServiceCallback:function(i,n,r,o,a){return p.Util.bind(function(t,e){!t||499!==t.code&&498!==t.code||(this._authenticating=!0,this._requestQueue.push([i,n,r,o,a]),this.fire("authenticationrequired",{authenticate:p.Util.bind(this.authenticate,this)},!0),t.authenticate=p.Util.bind(this.authenticate,this)),o.call(a,t,e),t?this.fire("requesterror",{url:this.options.url+n,params:r,message:t.message,code:t.code,method:i},!0):this.fire("requestsuccess",{url:this.options.url+n,params:r,response:e,method:i},!0),this.fire("requestend",{url:this.options.url+n,params:r,method:i},!0)},this)},_runQueue:function(){for(var t=this._requestQueue.length-1;0<=t;t--){var e=this._requestQueue[t];this[e.shift()].apply(this,e)}this._requestQueue=[]}}),K=J.extend({identify:function(){return X(this)},find:function(){return q(this)},query:function(){return Z(this)}});function Q(t){return new K(t)}var $=J.extend({query:function(){return Z(this)},identify:function(){return Y(this)}});function tt(t){return new $(t)}var et=J.extend({options:{idAttribute:"OBJECTID"},query:function(){return Z(this)},addFeature:function(t,e,i){this.addFeatures(t,e,i)},addFeatures:function(t,n,r){for(var e=t.features?t.features:[t],i=e.length-1;0<=i;i--)delete e[i].id;return t=b(t),t=1<e.length?t:[t],this.post("addFeatures",{features:t},function(t,e){var i=e&&e.addResults?1<e.addResults.length?e.addResults:e.addResults[0]:void 0;n&&n.call(r,t||e.addResults[0].error,i)},r)},updateFeature:function(t,e,i){this.updateFeatures(t,e,i)},updateFeatures:function(t,n,r){var e=t.features?t.features:[t];return t=b(t,this.options.idAttribute),t=1<e.length?t:[t],this.post("updateFeatures",{features:t},function(t,e){var i=e&&e.updateResults?1<e.updateResults.length?e.updateResults:e.updateResults[0]:void 0;n&&n.call(r,t||e.updateResults[0].error,i)},r)},deleteFeature:function(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures:function(t,n,r){return this.post("deleteFeatures",{objectIds:t},function(t,e){var i=e&&e.deleteResults?1<e.deleteResults.length?e.deleteResults:e.deleteResults[0]:void 0;n&&n.call(r,t||e.deleteResults[0].error,i)},r)}});function it(t){return new et(t)}var nt="https:"!==window.location.protocol?"http:":"https:",rt=p.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:nt+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:nt+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:i?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:i?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:i?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:i?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:i?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:i?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:i?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:nt+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:nt+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:nt+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:nt+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(t,e){var i;if("object"==typeof t&&t.urlTemplate&&t.options)i=t;else{if("string"!=typeof t||!rt.TILES[t])throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');i=rt.TILES[t]}var n=p.Util.extend(i.options,e);p.Util.setOptions(this,n),this.options.token&&-1===i.urlTemplate.indexOf("token=")&&(i.urlTemplate+="?token="+this.options.token),p.TileLayer.prototype.initialize.call(this,i.urlTemplate,n)},onAdd:function(t){D(t),"esri-labels"===this.options.pane&&this._initPane(),this.options.attributionUrl&&O(this.options.attributionUrl,t),t.on("moveend",F),p.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){t.off("moveend",F),p.TileLayer.prototype.onRemove.call(this,t)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var t=this._map.createPane(this.options.pane);t.style.pointerEvents="none",t.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var t='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return t}}),ot=p.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(t){t=P(t=p.Util.setOptions(this,t)),this.tileUrl=(t.proxy?t.proxy+"?":"")+t.url+"tile/{z}/{y}/{x}"+(t.requestParams&&0<Object.keys(t.requestParams).length?p.Util.getParamString(t.requestParams):""),-1!==t.url.indexOf("{s}")&&t.subdomains&&(t.url=t.url.replace("{s}",t.subdomains[0])),this.service=Q(t),this.service.addEventParent(this),new RegExp(/tiles.arcgis(online)?\.com/g).test(t.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),t.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),p.TileLayer.prototype.initialize.call(this,this.tileUrl,t)},getTileUrl:function(t){var e=this._getZoomForUrl();return p.Util.template(this.tileUrl,p.Util.extend({s:this._getSubdomain(t),x:t.x,y:t.y,z:this._lodMap&&this._lodMap[e]?this._lodMap[e]:e},this.options))},createTile:function(t,e){var i=document.createElement("img");return p.DomEvent.on(i,"load",p.Util.bind(this._tileOnLoad,this,e,i)),p.DomEvent.on(i,"error",p.Util.bind(this._tileOnError,this,e,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?i.src=this.getTileUrl(t):this.once("lodmap",function(){i.src=this.getTileUrl(t)},this),i},onAdd:function(u){D(u),this._lodMap||this.metadata(function(t,e){if(!t&&e.spatialReference){var i=e.spatialReference.latestWkid||e.spatialReference.wkid;if(!this.options.attribution&&u.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,u.attributionControl.addAttribution(this.getAttribution())),u.options.crs!==p.CRS.EPSG3857||102100!==i&&3857!==i)u.options.crs&&u.options.crs.code&&-1<u.options.crs.code.indexOf(i)||k("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html");else{this._lodMap={};for(var n=e.tileInfo.lods,r=ot.MercatorZoomLevels,o=0;o<n.length;o++){var a=n[o];for(var s in r){var l=r[s];if(this._withinPercentage(a.resolution,l,this.options.zoomOffsetAllowance)){this._lodMap[s]=a.level;break}}}this.fire("lodmap")}}},this),p.TileLayer.prototype.onAdd.call(this,u)},metadata:function(t,e){return this.service.metadata(t,e),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(t){var e="?token="+t;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,e):this.tileUrl+e,this.options.token=t,this.service.authenticate(t),this},_withinPercentage:function(t,e,i){return Math.abs(t/e-1)<i}}),at=p.ImageOverlay.extend({onAdd:function(t){this._topLeft=t.getPixelBounds().min,p.ImageOverlay.prototype.onAdd.call(this,t)},_reset:function(){this._map.options.crs===p.CRS.EPSG3857?p.ImageOverlay.prototype._reset.call(this):p.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),st=p.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:e,attribution:null,interactive:!1,alt:""},onAdd:function(i){D(i),this.options.zIndex&&(this.options.position=null),this._update=p.Util.throttle(this._update,this.options.updateInterval,this),i.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?i.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(t,e){!t&&!this.options.attribution&&i.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,i.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(t){this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(t,e){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=p.popup(e),this._popupFunction=t,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(t){return this.options.zIndex=t,this._currentImage&&this._currentImage.setZIndex(t),this},_setAutoZIndex:function(t){if(this._currentImage){for(var e,i=this._currentImage.getPane().children,n=-t(-1/0,1/0),r=0,o=i.length;r<o;r++)e=i[r].style.zIndex,i[r]!==this._currentImage._image&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(t){return this.options.opacity=t,this._currentImage&&this._currentImage.setOpacity(t),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(t,e){return this.options.from=t,this.options.to=e,this._update(),this},metadata:function(t,e){return this.service.metadata(t,e),this},authenticate:function(t){return this.service.authenticate(t),this},redraw:function(){this._update()},_renderImage:function(t,n,e){if(this._map){if(e&&(t="data:"+e+";base64,"+t),!t)return;var r=new at(t,n,{opacity:0,crossOrigin:this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),o=function(t){if(r.off("error",o,this),this._map){var e=t.target,i=this._currentImage;e._bounds.equals(n)&&e._bounds.equals(this._map.getBounds())?(this._currentImage=e,"front"===this.options.position?this.bringToFront():"back"===this.options.position&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),i&&this._map&&this._map.removeLayer(i),i&&i._map&&i._map.removeLayer(i)):this._map.removeLayer(e)}this.fire("load",{bounds:n})};r.once("error",function(){this._map.removeLayer(r),this.fire("error"),r.off("load",o,this)},this),r.once("load",o,this),this.fire("loading",{bounds:n})}},_update:function(){if(this._map){var t=this._map.getZoom(),e=this._map.getBounds();if(!(this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress))if(t>this.options.maxZoom||t<this.options.minZoom)this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);else{var i=this._buildExportParams();p.Util.extend(i,this.options.requestParams),i?this._requestExport(i,e):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(t,e,i,n){if(t=p.latLng(t),this._shouldRenderPopup&&this._lastClick.equals(t)){var r=this._popupFunction(e,i,n);r&&this._popup.setLatLng(t).setContent(r).openOn(this._map)}},_resetPopupState:function(t){this._shouldRenderPopup=!1,this._lastClick=t.latlng},_calculateBbox:function(){var t=this._map.getPixelBounds(),e=this._map.unproject(t.getBottomLeft()),i=this._map.unproject(t.getTopRight()),n=this._map.options.crs.project(i),r=this._map.options.crs.project(e),o=p.bounds(n,r);return[o.getBottomLeft().x,o.getBottomLeft().y,o.getTopRight().x,o.getTopRight().y].join(",")},_calculateImageSize:function(){var t=this._map.getPixelBounds(),e=this._map.getSize(),i=this._map.unproject(t.getBottomLeft()),n=this._map.unproject(t.getTopRight()),r=this._map.latLngToLayerPoint(n).y,o=this._map.latLngToLayerPoint(i).y;return(0<r||o<e.y)&&(e.y=o-r),e.x+","+e.y}}),lt=st.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(t){t=P(t),this.service=tt(t),this.service.addEventParent(this),p.Util.setOptions(this,t)},setPixelType:function(t){return this.options.pixelType=t,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(t){return p.Util.isArray(t)?this.options.bandIds=t.join(","):this.options.bandIds=t.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(t,e){return p.Util.isArray(t)?this.options.noData=t.join(","):this.options.noData=t.toString(),e&&(this.options.noDataInterpretation=e),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(t){this.options.renderingRule=t,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(t){this.options.mosaicRule=t,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(n){var t=p.Util.bind(function(t,e,i){t||setTimeout(p.Util.bind(function(){this._renderPopup(n.latlng,t,e,i)},this),300)},this),e=this.identify().at(n.latlng);this.options.mosaicRule&&e.setMosaicRule(this.options.mosaicRule),e.run(t),this._shouldRenderPopup=!0,this._lastClick=n.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};return this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(e.pixelType=this.options.pixelType),this.options.interpolation&&(e.interpolation=this.options.interpolation),this.options.compressionQuality&&(e.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(e.bandIds=this.options.bandIds),(0===this.options.noData||this.options.noData)&&(e.noData=this.options.noData),this.options.noDataInterpretation&&(e.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(e.token=this.service.options.token),this.options.renderingRule&&(e.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(e.mosaicRule=JSON.stringify(this.options.mosaicRule)),e},_requestExport:function(t,i){"json"===this.options.f?this.service.request("exportImage",t,function(t,e){t||(this.options.token&&(e.href+="?token="+this.options.token),this.options.proxy&&(e.href=this.options.proxy+"?"+e.href),this._renderImage(e.href,i))},this):(t.f="image",this._renderImage(this.options.url+"exportImage"+p.Util.getParamString(t),i))}}),ut=st.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png24",transparent:!0,f:"json"},initialize:function(t){t=P(t),this.service=Q(t),this.service.addEventParent(this),(t.proxy||t.token)&&"json"!==t.f&&(t.f="json"),p.Util.setOptions(this,t)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(t){return this.options.dynamicLayers=t,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(t){return this.options.layers=t,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(t){return this.options.layerDefs=t,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(t){return this.options.timeOptions=t,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(n){var t,e=p.Util.bind(function(t,e,i){t||setTimeout(p.Util.bind(function(){this._renderPopup(n.latlng,t,e,i)},this),300)},this);if((t=this.options.popup?this.options.popup.on(this._map).at(n.latlng):this.identify().on(this._map).at(n.latlng)).params.maxAllowableOffset||t.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?t.layers("visible:"+this.options.layers.join(",")):t.layers("visible")),this.options.layerDefs&&"string"!=typeof this.options.layerDefs&&!t.params.layerDefs)for(var i in this.options.layerDefs)this.options.layerDefs.hasOwnProperty(i)&&t.layerDef(i,this.options.layerDefs[i]);t.run(e),this._shouldRenderPopup=!0,this._lastClick=n.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};if(this.options.dynamicLayers&&(e.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(0===this.options.layers.length)return;e.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(e.layerDefs="string"==typeof this.options.layerDefs?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(e.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(e.token=this.service.options.token),this.options.proxy&&(e.proxy=this.options.proxy),this.options.disableCache&&(e._ts=Date.now()),e},_requestExport:function(t,i){"json"===this.options.f?this.service.request("export",t,function(t,e){t||(this.options.token&&(e.href+="?token="+this.options.token),this.options.proxy&&(e.href=this.options.proxy+"?"+e.href),e.href?this._renderImage(e.href,i):this._renderImage(e.imageData,i,e.contentType))},this):(t.f="image",this._renderImage(this.options.url+"export"+p.Util.getParamString(t),i))}}),ct=p.Layer.extend({options:{cellSize:512,updateInterval:150},initialize:function(t){t=p.setOptions(this,t),this._zooming=!1},onAdd:function(t){this._map=t,this._update=p.Util.throttle(this._update,this.options.updateInterval,this),this._reset(),this._update()},onRemove:function(){this._map.removeEventListener(this.getEvents(),this),this._removeCells()},getEvents:function(){return{moveend:this._update,zoomstart:this._zoomstart,zoomend:this._reset}},addTo:function(t){return t.addLayer(this),this},removeFrom:function(t){return t.removeLayer(this),this},_zoomstart:function(){this._zooming=!0},_reset:function(){this._removeCells(),this._cells={},this._activeCells={},this._cellsToLoad=0,this._cellsTotal=0,this._cellNumBounds=this._getCellNumBounds(),this._resetWrap(),this._zooming=!1},_resetWrap:function(){var t=this._map,e=t.options.crs;if(!e.infinite){var i=this._getCellSize();e.wrapLng&&(this._wrapLng=[Math.floor(t.project([0,e.wrapLng[0]]).x/i),Math.ceil(t.project([0,e.wrapLng[1]]).x/i)]),e.wrapLat&&(this._wrapLat=[Math.floor(t.project([e.wrapLat[0],0]).y/i),Math.ceil(t.project([e.wrapLat[1],0]).y/i)])}},_getCellSize:function(){return this.options.cellSize},_update:function(){if(this._map){var t=this._map.getPixelBounds(),e=this._getCellSize(),i=p.bounds(t.min.divideBy(e).floor(),t.max.divideBy(e).floor());this._removeOtherCells(i),this._addCells(i),this.fire("cellsupdated")}},_addCells:function(t){var e,i,n,r=[],o=t.getCenter(),a=this._map.getZoom();for(e=t.min.y;e<=t.max.y;e++)for(i=t.min.x;i<=t.max.x;i++)(n=p.point(i,e)).z=a,this._isValidCell(n)&&r.push(n);var s=r.length;if(0!==s)for(this._cellsToLoad+=s,this._cellsTotal+=s,r.sort(function(t,e){return t.distanceTo(o)-e.distanceTo(o)}),i=0;i<s;i++)this._addCell(r[i])},_isValidCell:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._cellNumBounds;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._cellCoordsToBounds(t);return p.latLngBounds(this.options.bounds).intersects(n)},_cellCoordsToBounds:function(t){var e=this._map,i=this.options.cellSize,n=t.multiplyBy(i),r=n.add([i,i]),o=e.wrapLatLng(e.unproject(n,t.z)),a=e.wrapLatLng(e.unproject(r,t.z));return p.latLngBounds(o,a)},_cellCoordsToKey:function(t){return t.x+":"+t.y},_keyToCellCoords:function(t){var e=t.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10);return p.point(i,n)},_removeOtherCells:function(t){for(var e in this._cells)t.contains(this._keyToCellCoords(e))||this._removeCell(e)},_removeCell:function(t){var e=this._activeCells[t];e&&(delete this._activeCells[t],this.cellLeave&&this.cellLeave(e.bounds,e.coords),this.fire("cellleave",{bounds:e.bounds,coords:e.coords}))},_removeCells:function(){for(var t in this._cells){var e=this._cells[t].bounds,i=this._cells[t].coords;this.cellLeave&&this.cellLeave(e,i),this.fire("cellleave",{bounds:e,coords:i})}},_addCell:function(t){this._wrapCoords(t);var e=this._cellCoordsToKey(t),i=this._cells[e];i&&!this._activeCells[e]&&(this.cellEnter&&this.cellEnter(i.bounds,t),this.fire("cellenter",{bounds:i.bounds,coords:t}),this._activeCells[e]=i),i||(i={coords:t,bounds:this._cellCoordsToBounds(t)},this._cells[e]=i,this._activeCells[e]=i,this.createCell&&this.createCell(i.bounds,t),this.fire("cellcreate",{bounds:i.bounds,coords:t}))},_wrapCoords:function(t){t.x=this._wrapLng?p.Util.wrapNum(t.x,this._wrapLng):t.x,t.y=this._wrapLat?p.Util.wrapNum(t.y,this._wrapLat):t.y},_getCellNumBounds:function(){var t=this._map.getPixelWorldBounds(),e=this._getCellSize();return t?p.bounds(t.min.divideBy(e).floor(),t.max.divideBy(e).ceil().subtract([1,1])):null}});function ht(t){this.values=[].concat(t||[])}ht.prototype.query=function(t){var e=this.getIndex(t);return this.values[e]},ht.prototype.getIndex=function(t){this.dirty&&this.sort();for(var e,i,n=0,r=this.values.length-1;n<=r;)if(e=(n+r)/2|0,+(i=this.values[Math.round(e)]).value<+t)n=e+1;else{if(!(+i.value>+t))return e;r=e-1}return Math.abs(~r)},ht.prototype.between=function(t,e){var i=this.getIndex(t),n=this.getIndex(e);if(0===i&&0===n)return[];for(;this.values[i-1]&&this.values[i-1].value===t;)i--;for(;this.values[n+1]&&this.values[n+1].value===e;)n++;return this.values[n]&&this.values[n].value===e&&this.values[n+1]&&n++,this.values.slice(i,n)},ht.prototype.insert=function(t){return this.values.splice(this.getIndex(t.value),0,t),this},ht.prototype.bulkAdd=function(t,e){return this.values=this.values.concat([].concat(t||[])),e?this.sort():this.dirty=!0,this},ht.prototype.sort=function(){return this.values.sort(function(t,e){return+e.value-+t.value}).reverse(),this.dirty=!1,this};var pt=ct.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6},initialize:function(t){if(ct.prototype.initialize.call(this,t),t=P(t),t=p.Util.setOptions(this,t),this.service=it(t),this.service.addEventParent(this),"*"!==this.options.fields[0]){for(var e=!1,i=0;i<this.options.fields.length;i++)this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)&&(e=!0);!1===e&&k("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new ht,this._endTimeIndex=new ht):this.options.timeField&&(this._timeIndex=new ht),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(r){return D(r),this.service.metadata(function(t,e){if(!t){var i=e.supportedQueryFormats,n=!1;!1===this.service.options.isModern&&(n=!0),!n&&i&&-1!==i.indexOf("geoJSON")&&(this.service.options.isModern=!0),e.objectIdField&&(this.service.options.idAttribute=e.objectIdField),!this.options.attribution&&r.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,r.attributionControl.addAttribution(this.getAttribution()))}},this),r.on("zoomend",this._handleZoomChange,this),ct.prototype.onAdd.call(this,r)},onRemove:function(t){return t.off("zoomend",this._handleZoomChange,this),ct.prototype.onRemove.call(this,t)},getAttribution:function(){return this.options.attribution},createCell:function(t,e){this._visibleZoom()&&this._requestFeatures(t,e)},_requestFeatures:function(n,r,o){return this._activeRequests++,1===this._activeRequests&&this.fire("loading",{bounds:n},!0),this._buildQuery(n).run(function(t,e,i){i&&i.exceededTransferLimit&&this.fire("drawlimitexceeded"),!t&&e&&e.features.length&&p.Util.requestAnimFrame(p.Util.bind(function(){this._addFeatures(e.features,r),this._postProcessFeatures(n)},this)),t||!e||e.features.length||this._postProcessFeatures(n),t&&this._postProcessFeatures(n),o&&o.call(this,t,e)},this)},_postProcessFeatures:function(t){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:t})},_cacheKey:function(t){return t.z+":"+t.x+":"+t.y},_addFeatures:function(t,e){var i=this._cacheKey(e);this._cache[i]=this._cache[i]||[];for(var n=t.length-1;0<=n;n--){var r=t[n].id;-1===this._currentSnapshot.indexOf(r)&&this._currentSnapshot.push(r),-1===this._cache[i].indexOf(r)&&this._cache[i].push(r)}this.options.timeField&&this._buildTimeIndexes(t),this.createLayers(t)},_buildQuery:function(t){var e=this.service.query().intersects(t).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.requestParams&&p.Util.extend(e.params,this.options.requestParams),this.options.simplifyFactor&&e.simplify(this._map,this.options.simplifyFactor),"server"===this.options.timeFilterMode&&this.options.from&&this.options.to&&e.between(this.options.from,this.options.to),e},setWhere:function(t,n,r){this.options.where=t&&t.length?t:"1=1";for(var o=[],a=[],s=0,l=null,e=p.Util.bind(function(t,e){if(t&&(l=t),e)for(var i=e.features.length-1;0<=i;i--)a.push(e.features[i].id);--s<=0&&this._visibleZoom()&&(this._currentSnapshot=a,p.Util.requestAnimFrame(p.Util.bind(function(){this.removeLayers(o),this.addLayers(a),n&&n.call(r,l)},this)))},this),i=this._currentSnapshot.length-1;0<=i;i--)o.push(this._currentSnapshot[i]);for(var u in this._activeCells){s++;var c=this._keyToCellCoords(u),h=this._cellCoordsToBounds(c);this._requestFeatures(h,u,e)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(e,i,n,r){var o=this.options.from,a=this.options.to,s=0,l=null,t=p.Util.bind(function(t){t&&(l=t),this._filterExistingFeatures(o,a,e,i),s--,n&&s<=0&&n.call(r,l)},this);if(this.options.from=e,this.options.to=i,this._filterExistingFeatures(o,a,e,i),"server"===this.options.timeFilterMode)for(var u in this._activeCells){s++;var c=this._keyToCellCoords(u),h=this._cellCoordsToBounds(c);this._requestFeatures(h,u,t)}return this},refresh:function(){for(var t in this._activeCells){var e=this._keyToCellCoords(t),i=this._cellCoordsToBounds(e);this._requestFeatures(i,t)}this.redraw&&this.once("load",function(){this.eachFeature(function(t){this._redraw(t.feature.id)},this)},this)},_filterExistingFeatures:function(t,e,i,n){var r=t&&e?this._getFeaturesInTimeRange(t,e):this._currentSnapshot,o=this._getFeaturesInTimeRange(i,n);if(o.indexOf)for(var a=0;a<o.length;a++){var s=r.indexOf(o[a]);0<=s&&r.splice(s,1)}p.Util.requestAnimFrame(p.Util.bind(function(){this.removeLayers(r),this.addLayers(o)},this))},_getFeaturesInTimeRange:function(t,e){var i,n=[];if(this.options.timeField.start&&this.options.timeField.end){var r=this._startTimeIndex.between(t,e),o=this._endTimeIndex.between(t,e);i=r.concat(o)}else i=this._timeIndex.between(t,e);for(var a=i.length-1;0<=a;a--)n.push(i[a].id);return n},_buildTimeIndexes:function(t){var e,i;if(this.options.timeField.start&&this.options.timeField.end){var n=[],r=[];for(e=t.length-1;0<=e;e--)i=t[e],n.push({id:i.id,value:new Date(i.properties[this.options.timeField.start])}),r.push({id:i.id,value:new Date(i.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(n),this._endTimeIndex.bulkAdd(r)}else{var o=[];for(e=t.length-1;0<=e;e--)i=t[e],o.push({id:i.id,value:new Date(i.properties[this.options.timeField])});this._timeIndex.bulkAdd(o)}},_featureWithinTimeRange:function(t){if(!this.options.from||!this.options.to)return!0;var e=+this.options.from.valueOf(),i=+this.options.to.valueOf();if("string"==typeof this.options.timeField){var n=+t.properties[this.options.timeField];return e<=n&&n<=i}if(this.options.timeField.start&&this.options.timeField.end){var r=+t.properties[this.options.timeField.start],o=+t.properties[this.options.timeField.end];return e<=r&&r<=i||e<=o&&o<=i}},_visibleZoom:function(){if(!this._map)return!1;var t=this._map.getZoom();return!(t>this.options.maxZoom||t<this.options.minZoom)},_handleZoomChange:function(){if(this._visibleZoom())for(var t in this._activeCells){var e=this._activeCells[t].coords,i=this._cacheKey(e);this._cache[i]&&this.addLayers(this._cache[i])}else this.removeLayers(this._currentSnapshot),this._currentSnapshot=[]},authenticate:function(t){return this.service.authenticate(t),this},metadata:function(t,e){return this.service.metadata(t,e),this},query:function(){return this.service.query()},_getMetadata:function(i){this._metadata?i(void 0,this._metadata):this.metadata(p.Util.bind(function(t,e){this._metadata=e,i(t,this._metadata)},this))},addFeature:function(t,e,i){this.addFeatures(t,e,i)},addFeatures:function(e,o,a){this._getMetadata(p.Util.bind(function(t,n){if(t)o&&o.call(this,t,null);else{var r=e.features?e.features:[e];this.service.addFeatures(e,p.Util.bind(function(t,e){if(!t){for(var i=r.length-1;0<=i;i--)r[i].properties[n.objectIdField]=1<r.length?e[i].objectId:e.objectId,r[i].id=1<r.length?e[i].objectId:e.objectId;this.createLayers(r)}o&&o.call(a,t,e)},this))}},this))},updateFeature:function(t,e,i){this.updateFeatures(t,e,i)},updateFeatures:function(t,n,r){var o=t.features?t.features:[t];this.service.updateFeatures(t,function(t,e){if(!t){for(var i=o.length-1;0<=i;i--)this.removeLayers([o[i].id],!0);this.createLayers(o)}n&&n.call(r,t,e)},this)},deleteFeature:function(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures:function(t,r,o){return this.service.deleteFeatures(t,function(t,e){var i=e.length?e:[e];if(!t&&0<i.length)for(var n=i.length-1;0<=n;n--)this.removeLayers([i[n].objectId],!0);r&&r.call(o,t,e)},this)}}),ft=pt.extend({options:{cacheLayers:!0},initialize:function(t){pt.prototype.initialize.call(this,t),this._originalStyle=this.options.style,this._layers={}},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e]),this.fire("removefeature",{feature:this._layers[e].feature,permanent:!1},!0);return pt.prototype.onRemove.call(this,t)},createNewLayer:function(t){var e=p.GeoJSON.geometryToLayer(t,this.options);return e&&(e.defaultOptions=e.options),e},_updateLayer:function(t,e){var i=[],n=this.options.coordsToLatLng||p.GeoJSON.coordsToLatLng;switch(e.properties&&(t.feature.properties=e.properties),e.geometry.type){case"Point":i=p.GeoJSON.coordsToLatLng(e.geometry.coordinates),t.setLatLng(i);break;case"LineString":i=p.GeoJSON.coordsToLatLngs(e.geometry.coordinates,0,n),t.setLatLngs(i);break;case"MultiLineString":case"Polygon":i=p.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,n),t.setLatLngs(i);break;case"MultiPolygon":i=p.GeoJSON.coordsToLatLngs(e.geometry.coordinates,2,n),t.setLatLngs(i)}},createLayers:function(t){for(var e=t.length-1;0<=e;e--){var i,n=t[e],r=this._layers[n.id];this._visibleZoom()&&r&&!this._map.hasLayer(r)&&(this._map.addLayer(r),this.fire("addfeature",{feature:r.feature},!0)),r&&0<this.options.simplifyFactor&&(r.setLatLngs||r.setLatLng)&&this._updateLayer(r,n),r||((i=this.createNewLayer(n))?(i.feature=n,i.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(i.feature,i),this._layers[i.feature.id]=i,this.setFeatureStyle(i.feature.id,this.options.style),this.fire("createfeature",{feature:i.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(n))&&this._map.addLayer(i)):k("invalid GeoJSON encountered"))}},addLayers:function(t){for(var e=t.length-1;0<=e;e--){var i=this._layers[t[e]];i&&this._map.addLayer(i)}},removeLayers:function(t,e){for(var i=t.length-1;0<=i;i--){var n=t[i],r=this._layers[n];r&&(this.fire("removefeature",{feature:r.feature,permanent:e},!0),this._map.removeLayer(r)),r&&e&&delete this._layers[n]}},cellEnter:function(t,n){this._visibleZoom()&&!this._zooming&&this._map&&p.Util.requestAnimFrame(p.Util.bind(function(){var t=this._cacheKey(n),e=this._cellCoordsToKey(n),i=this._cache[t];this._activeCells[e]&&i&&this.addLayers(i)},this))},cellLeave:function(t,s){this._zooming||p.Util.requestAnimFrame(p.Util.bind(function(){if(this._map){var t=this._cacheKey(s),e=this._cellCoordsToKey(s),i=this._cache[t],n=this._map.getBounds();if(!this._activeCells[e]&&i){for(var r=!0,o=0;o<i.length;o++){var a=this._layers[i[o]];a&&a.getBounds&&n.intersects(a.getBounds())&&(r=!1)}r&&this.removeLayers(i,!this.options.cacheLayers),!this.options.cacheLayers&&r&&(delete this._cache[t],delete this._cells[e],delete this._activeCells[e])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(t){this.resetFeatureStyle(t.feature.id)},this),this},setStyle:function(e){return this.options.style=e,this.eachFeature(function(t){this.setFeatureStyle(t.feature.id,e)},this),this},resetFeatureStyle:function(t){var e=this._layers[t],i=this._originalStyle||p.Path.prototype.options;return e&&(p.Util.extend(e.options,e.defaultOptions),this.setFeatureStyle(t,i)),this},setFeatureStyle:function(t,e){var i=this._layers[t];return"function"==typeof e&&(e=e(i.feature)),i.setStyle&&i.setStyle(e),this},eachActiveFeature:function(t,e){if(this._map){var i=this._map.getBounds();for(var n in this._layers)-1!==this._currentSnapshot.indexOf(this._layers[n].feature.id)&&("function"==typeof this._layers[n].getLatLng&&i.contains(this._layers[n].getLatLng())?t.call(e,this._layers[n]):"function"==typeof this._layers[n].getBounds&&i.intersects(this._layers[n].getBounds())&&t.call(e,this._layers[n]))}return this},eachFeature:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getFeature:function(t){return this._layers[t]},bringToBack:function(){this.eachFeature(function(t){t.bringToBack&&t.bringToBack()})},bringToFront:function(){this.eachFeature(function(t){t.bringToFront&&t.bringToFront()})},redraw:function(t){return t&&this._redraw(t),this},_redraw:function(t){var e=this._layers[t],i=e.feature;if(e&&e.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var n=this.options.pointToLayer(i,p.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])).options.icon;e.setIcon(n)}if(e&&e.setStyle&&this.options.pointToLayer){var r=this.options.pointToLayer(i,p.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])).options;this.setFeatureStyle(i.id,r)}e&&e.setStyle&&this.options.style&&this.resetStyle(i.id)}});t.VERSION="2.2.3",t.Support=s,t.options=n,t.Util=N,t.get=f,t.post=r,t.request=c,t.Task=j,t.task=function(t){return t=P(t),new j(t)},t.Query=U,t.query=Z,t.Find=V,t.find=q,t.Identify=G,t.identify=function(t){return new G(t)},t.IdentifyFeatures=W,t.identifyFeatures=X,t.IdentifyImage=H,t.identifyImage=Y,t.Service=J,t.service=function(t){return t=P(t),new J(t)},t.MapService=K,t.mapService=Q,t.ImageService=$,t.imageService=tt,t.FeatureLayerService=et,t.featureLayerService=it,t.BasemapLayer=rt,t.basemapLayer=function(t,e){return new rt(t,e)},t.TiledMapLayer=ot,t.tiledMapLayer=function(t,e){return new ot(t,e)},t.RasterLayer=st,t.ImageMapLayer=lt,t.imageMapLayer=function(t,e){return new lt(t,e)},t.DynamicMapLayer=ut,t.dynamicMapLayer=function(t,e){return new ut(t,e)},t.FeatureManager=pt,t.FeatureLayer=ft,t.featureLayer=function(t){return new ft(t)},Object.defineProperty(t,"__esModule",{value:!0})}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mapboxgl=t()}}(function(){return function o(a,s,l){function u(i,t){if(!s[i]){if(!a[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(c)return c(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var r=s[i]={exports:{}};a[i][0].call(r.exports,function(t){var e=a[i][1][t];return u(e||t)},r,r.exports,o,a,s,l)}return s[i].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)u(l[t]);return u}({1:[function(t,e,i){function r(t){var e=0;if(t&&0<t.length){e+=Math.abs(n(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(n(t[i]))}return e}function n(t){var e,i,n,r,o,a,s=0,l=t.length;if(2<l){for(a=0;a<l;a++)o=a===l-2?(n=l-2,r=l-1,0):a===l-1?(n=l-1,r=0,1):(r=(n=a)+1,a+2),e=t[n],i=t[r],s+=(u(t[o][0])-u(e[0]))*Math.sin(u(i[1]));s=s*c.RADIUS*c.RADIUS/2}return s}function u(t){return t*Math.PI/180}var c=t("wgs84");e.exports.geometry=function t(e){var i,n=0;switch(e.type){case"Polygon":return r(e.coordinates);case"MultiPolygon":for(i=0;i<e.coordinates.length;i++)n+=r(e.coordinates[i]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<e.geometries.length;i++)n+=t(e.geometries[i]);return n}},e.exports.ring=n},{wgs84:37}],2:[function(t,e,i){var n,r;n=this,r=function(){"use strict";var t,e;return(e=new Float32Array(3))[0]=0,e[1]=0,e[2]=0,(t=new Float32Array(4))[0]=0,t[1]=0,t[2]=0,t[3]=0,{vec3:{transformMat3:function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t}},vec4:{transformMat4:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*a,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*a,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*a,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*a,t}},mat2:{create:function(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},rotate:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*s,t[1]=r*l+a*s,t[2]=n*-s+o*l,t[3]=r*-s+a*l,t},scale:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[0],l=i[1];return t[0]=n*s,t[1]=r*s,t[2]=o*l,t[3]=a*l,t}},mat3:{create:function(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromRotation:function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}},mat4:{create:function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},translate:function(t,e,i){var n,r,o,a,s,l,u,c,h,p,f,d,m=i[0],y=i[1],_=i[2];return t[15]=e===t?(t[12]=e[0]*m+e[4]*y+e[8]*_+e[12],t[13]=e[1]*m+e[5]*y+e[9]*_+e[13],t[14]=e[2]*m+e[6]*y+e[10]*_+e[14],e[3]*m+e[7]*y+e[11]*_+e[15]):(n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+s*y+h*_+e[12],t[13]=r*m+l*y+p*_+e[13],t[14]=o*m+u*y+f*_+e[14],a*m+c*y+d*_+e[15]),t},scale:function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],_=e[14],g=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*n+x*s+b*h+w*m,t[1]=v*r+x*l+b*p+w*y,t[2]=v*o+x*u+b*f+w*_,t[3]=v*a+x*c+b*d+w*g,v=i[4],x=i[5],b=i[6],w=i[7],t[4]=v*n+x*s+b*h+w*m,t[5]=v*r+x*l+b*p+w*y,t[6]=v*o+x*u+b*f+w*_,t[7]=v*a+x*c+b*d+w*g,v=i[8],x=i[9],b=i[10],w=i[11],t[8]=v*n+x*s+b*h+w*m,t[9]=v*r+x*l+b*p+w*y,t[10]=v*o+x*u+b*f+w*_,t[11]=v*a+x*c+b*d+w*g,v=i[12],x=i[13],b=i[14],w=i[15],t[12]=v*n+x*s+b*h+w*m,t[13]=v*r+x*l+b*p+w*y,t[14]=v*o+x*u+b*f+w*_,t[15]=v*a+x*c+b*d+w*g,t},perspective:function(t,e,i,n,r){var o=1/Math.tan(e/2),a=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*a,t[15]=0,t},rotateX:function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*n,t[5]=a*r+c*n,t[6]=s*r+h*n,t[7]=l*r+p*n,t[8]=u*r-o*n,t[9]=c*r-a*n,t[10]=h*r-s*n,t[11]=p*r-l*n,t},rotateZ:function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*n,t[1]=a*r+c*n,t[2]=s*r+h*n,t[3]=l*r+p*n,t[4]=u*r-o*n,t[5]=c*r-a*n,t[6]=h*r-s*n,t[7]=p*r-l*n,t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=i*s-n*a,v=i*l-r*a,x=i*u-o*a,b=n*l-r*s,w=n*u-o*s,T=r*u-o*l,S=c*m-h*d,A=c*y-p*d,M=c*_-f*d,E=h*y-p*m,L=h*_-f*m,z=p*_-f*y,P=g*z-v*L+x*E+b*M-w*A+T*S;return P?(P=1/P,t[0]=(s*z-l*L+u*E)*P,t[1]=(r*L-n*z-o*E)*P,t[2]=(m*T-y*w+_*b)*P,t[3]=(p*w-h*T-f*b)*P,t[4]=(l*M-a*z-u*A)*P,t[5]=(i*z-r*M+o*A)*P,t[6]=(y*x-d*T-_*v)*P,t[7]=(c*T-p*x+f*v)*P,t[8]=(a*L-s*M+u*S)*P,t[9]=(n*M-i*L-o*S)*P,t[10]=(d*w-m*x+_*g)*P,t[11]=(h*x-c*w-f*g)*P,t[12]=(s*A-a*E-l*S)*P,t[13]=(i*E-n*A+r*S)*P,t[14]=(m*v-d*b-y*g)*P,t[15]=(c*b-h*v+p*g)*P,t):null},ortho:function(t,e,i,n,r,o,a){var s=1/(e-i),l=1/(n-r),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*l,t[14]=(a+o)*u,t[15]=1,t}}}},"object"==typeof i&&void 0!==e?e.exports=r():n.glMatrix=r()},{}],3:[function(t,e,i){"use strict";function o(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()&&"Uint8ClampedArray"in window&&(e=t&&t.failIfMajorPerformanceCaveat,void 0===a[e]&&(a[e]=(i=e,n=document.createElement("canvas"),(r=Object.create(o.webGLContextAttributes)).failIfMajorPerformanceCaveat=i,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r))),a[e]));var e,i,n,r}void 0!==e&&e.exports?e.exports=o:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=o);var a={};o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}},{}],4:[function(t,e,i){"use strict";function n(t,e){this.x=t,this.y=e}(e.exports=n).prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.x+i*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=r,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},{}],5:[function(t,e,i){var n,r;n=this,r=function(){function t(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function f(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i}function r(t,e,i,n,r,o,a){this.id=t,this.x=e,this.y=i,this.w=n,this.h=r,this.maxw=o||n,this.maxh=a||r,this.refcount=0}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,n,r,o,a=[],s=0;s<t.length;s++)if(i=t[s].w||t[s].width,n=t[s].h||t[s].height,r=t[s].id,i&&n){if(!(o=this.packOne(i,n,r)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),a.push(o)}return this.shrink(),a},t.prototype.packOne=function(t,e,i){var n,r,o,a,s,l,u,c,h={freebin:-1,shelf:-1,waste:1/0},p=0;if("string"==typeof i||"number"==typeof i){if(n=this.getBin(i))return this.ref(n),n;"number"==typeof i&&(this.maxId=Math.max(i,this.maxId))}else i=++this.maxId;for(a=0;a<this.freebins.length;a++){if(e===(n=this.freebins[a]).maxh&&t===n.maxw)return this.allocFreebin(a,t,e,i);e>n.maxh||t>n.maxw||e<=n.maxh&&t<=n.maxw&&(o=n.maxw*n.maxh-t*e)<h.waste&&(h.waste=o,h.freebin=a)}for(a=0;a<this.shelves.length;a++)if(p+=(r=this.shelves[a]).h,!(t>r.free)){if(e===r.h)return this.allocShelf(a,t,e,i);e>r.h||e<r.h&&(o=(r.h-e)*t)<h.waste&&(h.freebin=-1,h.waste=o,h.shelf=a)}return-1!==h.freebin?this.allocFreebin(h.freebin,t,e,i):-1!==h.shelf?this.allocShelf(h.shelf,t,e,i):e<=this.h-p&&t<=this.w?(r=new f(p,this.w,e),this.allocShelf(this.shelves.push(r)-1,t,e,i)):this.autoResize?(s=l=this.h,((u=c=this.w)<=s||u<t)&&(c=2*Math.max(t,u)),(s<u||s<e)&&(l=2*Math.max(e,s)),this.resize(c,l),this.packOne(t,e,i)):null},t.prototype.allocFreebin=function(t,e,i,n){var r=this.freebins.splice(t,1)[0];return r.id=n,r.w=e,r.h=i,r.refcount=0,this.bins[n]=r,this.ref(r),r},t.prototype.allocShelf=function(t,e,i,n){var r=this.shelves[t].alloc(e,i,n);return this.bins[n]=r,this.ref(r),r},t.prototype.shrink=function(){if(0<this.shelves.length){for(var t=0,e=0,i=0;i<this.shelves.length;i++){var n=this.shelves[i];e+=n.h,t=Math.max(n.w-n.free,t)}this.resize(t,e)}},t.prototype.getBin=function(t){return this.bins[t]},t.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},t.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},t.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},f.prototype.alloc=function(t,e,i){if(t>this.free||e>this.h)return null;var n=this.x;return this.x+=t,this.free-=t,new r(i,n,this.y,t,e,t,this.h)},f.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t},"object"==typeof i&&void 0!==e?e.exports=r():n.ShelfPack=r()},{}],6:[function(t,e,i){"use strict";function n(t,e,i,n,r,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=i||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(0<=navigator.userAgent.indexOf("Gecko/")?1.2:1))}function a(t,e,i,n,r,o,a){for(var s=0;s<e;s++){for(var l=0;l<i;l++)n[l]=t[l*e+s];for(u(n,r,o,a,i),l=0;l<i;l++)t[l*e+s]=r[l]}for(l=0;l<i;l++){for(s=0;s<e;s++)n[s]=t[l*e+s];for(u(n,r,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(r[s])}}function u(t,e,i,n,r){n[i[0]=0]=-l,n[1]=+l;for(var o=1,a=0;o<r;o++){for(var s=(t[o]+o*o-(t[i[a]]+i[a]*i[a]))/(2*o-2*i[a]);s<=n[a];)a--,s=(t[o]+o*o-(t[i[a]]+i[a]*i[a]))/(2*o-2*i[a]);i[++a]=o,n[a]=s,n[a+1]=+l}for(a=o=0;o<r;o++){for(;n[a+1]<o;)a++;e[o]=(o-i[a])*(o-i[a])+t[i[a]]}}e.exports=n;var l=1e20;n.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var r=e.data[4*n+3]/255;this.gridOuter[n]=1===r?0:0===r?l:Math.pow(Math.max(0,.5-r),2),this.gridInner[n]=1===r?l:0===r?0:Math.pow(Math.max(0,r-.5),2)}for(a(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),a(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++){var o=this.gridOuter[n]-this.gridInner[n];i[n]=Math.max(0,Math.min(255,Math.round(255-255*(o/this.radius+this.cutoff))))}return i}},{}],7:[function(t,e,i){function n(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}(e.exports=n).prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var i,n,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if((r=t)<(i=0))return i;if((n=1)<r)return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;o<t?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},{}],8:[function(t,e,i){e.exports.VectorTile=t("./lib/vectortile.js"),e.exports.VectorTileFeature=t("./lib/vectortilefeature.js"),e.exports.VectorTileLayer=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":9,"./lib/vectortilefeature.js":10,"./lib/vectortilelayer.js":11}],9:[function(t,e,i){"use strict";function n(t,e,i){if(3===t){var n=new r(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var r=t("./vectortilelayer");e.exports=function(t,e){this.layers=t.readFields(n,{},e)}},{"./vectortilelayer":11}],10:[function(t,e,i){"use strict";function f(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(o,this,e)}function o(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function d(t){for(var e,i,n=0,r=0,o=t.length,a=o-1;r<o;a=r++)e=t[r],n+=((i=t[a]).x-e.x)*(e.y+i.y);return n}var u=t("@mapbox/point-geometry");(e.exports=f).types=["Unknown","Point","LineString","Polygon"],f.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,r=0,o=0,a=0,s=[];t.pos<i;){if(!r){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)o+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&s.push(e),e=[]),e.push(new u(o,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&s.push(e),s},f.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!n){var c=t.readVarint();i=7&c,n=c>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<a&&(a=r),s<r&&(s=r),(o+=t.readSVarint())<l&&(l=o),u<o&&(u=o);else if(7!==i)throw new Error("unknown command "+i)}return[a,l,s,u]},f.prototype.toGeoJSON=function(t,e,i){function n(t){for(var e=0;e<t.length;e++){var i=t[e],n=180-360*(i.y+l)/a;t[e]=[360*(i.x+s)/a-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}var r,o,a=this.extent*Math.pow(2,i),s=this.extent*t,l=this.extent*e,u=this.loadGeometry(),c=f.types[this.type];switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];n(u=h);break;case 2:for(r=0;r<u.length;r++)n(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],o=0;o<e;o++){var a=d(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(i&&r.push(i),i=[t[o]]):i.push(t[o]))}return i&&r.push(i),r}(u),r=0;r<u.length;r++)for(o=0;o<u[r].length;o++)n(u[r][o])}1===u.length?u=u[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p}},{"@mapbox/point-geometry":4}],11:[function(t,e,i){"use strict";function n(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(r,this,e),this.length=this._features.length}function r(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}var o=t("./vectortilefeature.js");(e.exports=n).prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,e,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":10}],12:[function(t,e,i){var n;n=this,function(t){function a(t,e,i){var n=o(256*t,256*(e=Math.pow(2,i)-e-1),i),r=o(256*(t+1),256*(e+1),i);return n[0]+","+n[1]+","+r[0]+","+r[1]}function o(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}t.getURL=function(t,e,i,n,r,o){return o=o||{},t+"?"+["bbox="+a(i,n,r),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+e].join("&")},t.getTileBBox=a,t.getMercCoords=o,Object.defineProperty(t,"__esModule",{value:!0})}("object"==typeof i&&void 0!==e?i:n.WhooTS=n.WhooTS||{})},{}],13:[function(t,e,i){function f(t){return(t=Math.round(t))<0?0:255<t?255:t}function d(t){return f("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function m(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:1<e?1:e;var e}function y(t,e,i){return i<0?i+=1:1<i&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}var _={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{i.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in _)return _[i].slice();if("#"===i[0])return 4===i.length?0<=(e=parseInt(i.substr(1),16))&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7!==i.length?null:0<=(e=parseInt(i.substr(1),16))&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(-1!==n&&r+1===i.length){var o=i.substr(0,n),a=i.substr(n+1,r-(n+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=m(a.pop());case"rgb":return 3!==a.length?null:[d(a[0]),d(a[1]),d(a[2]),s];case"hsla":if(4!==a.length)return null;s=m(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=m(a[1]),c=m(a[2]),h=c<=.5?c*(u+1):c+u-c*u,p=2*c-h;return[f(255*y(p,h,l+1/3)),f(255*y(p,h,l)),f(255*y(p,h,l-1/3)),s];default:return null}}return null}}catch(t){}},{}],14:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,r,o,a,s,l,u,c=e&&e.length,h=c?e[0]*i:t.length,p=m(t,0,h,i,!0),f=[];if(!p)return f;if(c&&(p=function(t,e,i,n){var r,o,a,s,l,u=[];for(r=0,o=e.length;r<o;r++)a=e[r]*n,s=r<o-1?e[r+1]*n:t.length,(l=m(t,a,s,n,!1))===l.next&&(l.steiner=!0),u.push(b(l));for(u.sort(g),r=0;r<u.length;r++)v(u[r],i),i=y(i,i.next);return i}(t,e,p,i)),t.length>80*i){n=o=t[0],r=a=t[1];for(var d=i;d<h;d+=i)(s=t[d])<n&&(n=s),(l=t[d+1])<r&&(r=l),o<s&&(o=s),a<l&&(a=l);u=0!==(u=Math.max(o-n,a-r))?1/u:0}return _(p,f,i,n,r,u),f}function m(t,e,i,n,r){var o,a;if(r===0<E(t,e,i,n))for(o=e;o<i;o+=n)a=l(o,t[o],t[o+1],a);else for(o=i-n;e<=o;o-=n)a=l(o,t[o],t[o+1],a);return a&&s(a,a.next)&&(M(a),a=a.next),a}function y(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!s(n,n.next)&&0!==T(n.prev,n,n.next))n=n.next;else{if(M(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function _(t,e,i,n,r,o,a){if(t){!a&&o&&function(t,e,i,n){var r=t;for(;null===r.z&&(r.z=x(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,a,s,l,u=1;do{for(i=t,o=t=null,a=0;i;){for(a++,n=i,e=s=0;e<u&&(s++,n=n.nextZ);e++);for(l=u;0<s||0<l&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(i=(r=i).nextZ,s--):(n=(r=n).nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,u*=2}while(1<a)}(r)}(t,n,r,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?h(t,n,r,o):c(t))e.push(s.i/i),e.push(t.i/i),e.push(l.i/i),M(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?_(t=p(t,e,i),e,i,n,r,o,2):2===a&&f(t,e,i,n,r,o):_(y(t),e,i,n,r,o,1);break}}}function c(t){var e=t.prev,i=t,n=t.next;if(0<=T(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(w(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=T(r.prev,r,r.next))return!1;r=r.next}return!0}function h(t,e,i,n){var r=t.prev,o=t,a=t.next;if(0<=T(r,o,a))return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,u=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,h=x(s,l,e,i,n),p=x(u,c,e,i,n),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&w(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=T(f.prev,f,f.next))return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&w(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=T(d.prev,d,d.next))return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&w(r.x,r.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=T(f.prev,f,f.next))return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&w(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=T(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function p(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!s(r,o)&&d(r,n,n.next,o)&&S(r,o)&&S(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),M(n),M(n.next),n=t=o),n=n.next}while(n!==t);return n}function f(t,e,i,n,r,o){var a,s,l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&(s=u,(a=l).next.i!==s.i&&a.prev.i!==s.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&d(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(a,s)&&S(a,s)&&S(s,a)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;for(;i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n}(a,s))){var c=A(l,u);return l=y(l,l.next),c=y(c,c.next),_(l,e,i,n,r,o),void _(c,e,i,n,r,o)}u=u.next}l=l.next}while(l!==t)}function g(t,e){return t.x-e.x}function v(t,e){if(e=function(t,e){var i,n=e,r=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&a<s){if((a=s)===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i.prev;var l,u=i,c=i.x,h=i.y,p=1/0;for(n=i.next;n!==u;)r>=n.x&&n.x>=c&&r!==n.x&&w(o<h?r:a,o,c,h,o<h?a:r,o,n.x,n.y)&&((l=Math.abs(o-n.y)/(r-n.x))<p||l===p&&n.x>i.x)&&S(n,t)&&(i=n,p=l),n=n.next;return i}(t,e)){var i=A(e,t);y(i,i.next)}}function x(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function b(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i}function w(t,e,i,n,r,o,a,s){return 0<=(r-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(n-s)-(i-a)*(e-s)&&0<=(i-a)*(o-s)-(r-a)*(n-s)}function T(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function s(t,e){return t.x===e.x&&t.y===e.y}function d(t,e,i,n){return!!(s(t,e)&&s(i,n)||s(t,n)&&s(i,e))||0<T(t,e,i)!=0<T(t,e,n)&&0<T(i,n,t)!=0<T(i,n,e)}function S(t,e){return T(t.prev,t,t.next)<0?0<=T(t,e,t.next)&&0<=T(t,t.prev,e):T(t,e,t.prev)<0||T(t,t.next,e)<0}function A(t,e){var i=new a(t.i,t.x,t.y),n=new a(e.i,e.x,e.y),r=t.next,o=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(o.next=n).prev=o,n}function l(t,e,i,n){var r=new a(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r}function M(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function a(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,i,n){for(var r=0,o=e,a=i-n;o<i;o+=n)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}e.exports=n,(e.exports.default=n).deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,a=Math.abs(E(t,0,o,i));if(r)for(var s=0,l=e.length;s<l;s++){var u=e[s]*i,c=s<l-1?e[s+1]*i:t.length;a-=Math.abs(E(t,u,c,i))}var h=0;for(s=0;s<n.length;s+=3){var p=n[s]*i,f=n[s+1]*i,d=n[s+2]*i;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var a=0;a<e;a++)i.vertices.push(t[r][o][a]);0<r&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}],15:[function(t,e,i){function o(e,i){return function(t){return e(t,i)}}function a(t,e){e=!!e,t[0]=n(t[0],e);for(var i=1;i<t.length;i++)t[i]=n(t[i],!e);return t}function n(t,e){return i=t,0<=r.ring(i)===e?t:t.reverse();var i}var r=t("@mapbox/geojson-area");e.exports=function t(e,i){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(o(t,i)),e;case"Feature":return e.geometry=t(e.geometry,i),e;case"Polygon":case"MultiPolygon":return r=i,"Polygon"===(n=e).type?n.coordinates=a(n.coordinates,r):"MultiPolygon"===n.type&&(n.coordinates=n.coordinates.map(o(a,r))),n;default:return e}var n,r}},{"@mapbox/geojson-area":1}],16:[function(t,e,i){"use strict";function _(t,e,i,n,r){for(var o=0;o<t.length;o+=3){var a=t[o+r];i<=a&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function g(t,e,i,n,r,o){for(var a=[],s=0===r?b:w,l=0;l<t.length-3;l+=3){var u=t[l],c=t[l+1],h=t[l+2],p=t[l+3],f=t[l+4],d=0===r?u:c,m=0===r?p:f,y=!1;d<i?i<=m&&s(a,u,c,p,f,i):n<d?m<=n&&s(a,u,c,p,f,n):x(a,u,c,h),m<i&&i<=d&&(s(a,u,c,p,f,i),y=!0),n<m&&d<=n&&(s(a,u,c,p,f,n),y=!0),!o&&y&&(a.size=t.size,e.push(a),a=[])}var _=t.length-3;u=t[_],c=t[_+1],h=t[_+2],i<=(d=0===r?u:c)&&d<=n&&x(a,u,c,h),_=a.length-3,o&&3<=_&&(a[_]!==a[0]||a[_+1]!==a[1])&&x(a,a[0],a[1],a[2]),a.length&&(a.size=t.size,e.push(a))}function v(t,e,i,n,r,o){for(var a=0;a<t.length;a++)g(t[a],e,i,n,r,o)}function x(t,e,i,n){t.push(e),t.push(i),t.push(n)}function b(t,e,i,n,r,o){t.push(o),t.push(i+(o-e)*(r-i)/(n-e)),t.push(1)}function w(t,e,i,n,r,o){t.push(e+(o-i)*(n-e)/(r-i)),t.push(o),t.push(1)}e.exports=function(t,e,i,n,r,o,a){if(n/=e,(i/=e)<=o&&a<=n)return t;if(n<o||a<i)return null;for(var s=[],l=0;l<t.length;l++){var u=t[l],c=u.geometry,h=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(i<=p&&f<=n)s.push(u);else if(!(n<p||f<i)){var d=[];if("Point"===h||"MultiPoint"===h)_(c,d,i,n,r);else if("LineString"===h)g(c,d,i,n,r,!1);else if("MultiLineString"===h)v(c,d,i,n,r,!1);else if("Polygon"===h)v(c,d,i,n,r,!0);else if("MultiPolygon"===h)for(var m=0;m<c.length;m++){var y=[];v(c[m],y,i,n,r,!0),y.length&&d.push(y)}d.length&&("LineString"!==h&&"MultiLineString"!==h||(1===d.length?(h="LineString",d=d[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===d.length?"Point":"MultiPoint"),s.push(T(u.id,h,d,u.tags)))}}return s.length?s:null};var T=t("./feature")},{"./feature":18}],17:[function(t,e,i){"use strict";function u(t,e,i){if(e.geometry){var n=e.geometry.coordinates,r=e.geometry.type,o=i*i,a=[];if("Point"===r)c(n,a);else if("MultiPoint"===r)for(var s=0;s<n.length;s++)c(n[s],a);else if("LineString"===r)h(n,a,o,!1);else if("MultiLineString"===r)p(n,a,o,!1);else if("Polygon"===r)p(n,a,o,!0);else{if("MultiPolygon"!==r){if("GeometryCollection"!==r)throw new Error("Input data is not a valid GeoJSON object.");for(s=0;s<e.geometry.geometries.length;s++)u(t,{geometry:e.geometry.geometries[s],properties:e.properties},i);return}for(s=0;s<n.length;s++){var l=[];p(n[s],l,o,!0),a.push(l)}}t.push(y(e.id,r,a,e.properties))}}function c(t,e){e.push(f(t[0])),e.push(d(t[1])),e.push(0)}function h(t,e,i,n){for(var r,o,a=0,s=0;s<t.length;s++){var l=f(t[s][0]),u=d(t[s][1]);e.push(l),e.push(u),e.push(0),0<s&&(a+=n?(r*u-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(u-o,2))),r=l,o=u}var c=e.length-3;e[2]=1,m(e,0,c,i),e[c+2]=1,e.size=Math.abs(a)}function p(t,e,i,n){for(var r=0;r<t.length;r++){var o=[];h(t[r],o,i,n),e.push(o)}}function f(t){return t/360+.5}function d(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:1<i?1:i}e.exports=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)u(i,t.features[n],e);else"Feature"===t.type?u(i,t,e):u(i,{geometry:t},e);return i};var m=t("./simplify"),y=t("./feature")},{"./feature":18,"./simplify":20}],18:[function(t,e,i){"use strict";function o(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}e.exports=function(t,e,i,n){var r={id:t||null,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)o(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<e.length;n++)o(t,e[n]);else if("MultiPolygon"===i)for(n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)o(t,e[n][r])}(r),r}},{}],19:[function(t,e,i){"use strict";function n(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||24<e.maxZoom)throw new Error("maxZoom should be in the 0-24 range");var n=1<<e.maxZoom,r=o(t,e.tolerance/(n*e.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=a(r,e.buffer/e.extent)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function M(t,e,i){return 32*((1<<t)*i+e)+t}e.exports=function(t,e){return new n(t,e)};var o=t("./convert"),p=t("./transform"),E=t("./clip"),a=t("./wrap"),L=t("./tile");n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,debug:0},n.prototype.splitTile=function(t,e,i,n,r,o,a){for(var s=[t,e,i,n],l=this.options,u=l.debug;s.length;){n=s.pop(),i=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=M(e,i,n),p=this.tiles[h],f=e===l.maxZoom?0:l.tolerance/(c*l.extent);if(!p&&(1<u&&console.time("creation"),p=this.tiles[h]=L(t,c,i,n,f,e===l.maxZoom),this.tileCoords.push({z:e,x:i,y:n}),u)){1<u&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,r){if(e===l.maxZoom||e===r)continue;var m=1<<r-e;if(i!==Math.floor(o/m)||n!==Math.floor(a/m))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){1<u&&console.time("clipping");var y,_,g,v,x,b,w=.5*l.buffer/l.extent,T=.5-w,S=.5+w,A=1+w;y=_=g=v=null,x=E(t,c,i-w,i+S,0,p.minX,p.maxX),b=E(t,c,i+T,i+A,0,p.minX,p.maxX),t=null,x&&(y=E(x,c,n-w,n+S,1,p.minY,p.maxY),_=E(x,c,n+T,n+A,1,p.minY,p.maxY),x=null),b&&(g=E(b,c,n-w,n+S,1,p.minY,p.maxY),v=E(b,c,n+T,n+A,1,p.minY,p.maxY),b=null),1<u&&console.timeEnd("clipping"),s.push(y||[],e+1,2*i,2*n),s.push(_||[],e+1,2*i,2*n+1),s.push(g||[],e+1,2*i+1,2*n),s.push(v||[],e+1,2*i+1,2*n+1)}}},n.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,o=n.debug;if(t<0||24<t)return null;var a=1<<t,s=M(t,e=(e%a+a)%a,i);if(this.tiles[s])return p.tile(this.tiles[s],r);1<o&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,u=t,c=e,h=i;!l&&0<u;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[M(u,c,h)];return l&&l.source?(1<o&&console.log("found parent tile z%d-%d-%d",u,c,h),1<o&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,i),1<o&&console.timeEnd("drilling down"),this.tiles[s]?p.tile(this.tiles[s],r):null):null}},{"./clip":16,"./convert":17,"./tile":21,"./transform":22,"./wrap":23}],20:[function(t,e,i){"use strict";function f(t,e,i,n,r,o){var a=r-i,s=o-n;if(0!==a||0!==s){var l=((t-i)*a+(e-n)*s)/(a*a+s*s);1<l?(i=r,n=o):0<l&&(i+=a*l,n+=s*l)}return(a=t-i)*a+(s=e-n)*s}e.exports=function t(e,i,n,r){for(var o,a=r,s=e[i],l=e[i+1],u=e[n],c=e[n+1],h=i+3;h<n;h+=3){var p=f(e[h],e[h+1],s,l,u,c);a<p&&(o=h,a=p)}r<a&&(3<o-i&&t(e,i,o,r),e[o+2]=a,3<n-o&&t(e,o,n,r))}},{}],21:[function(t,e,i){"use strict";function p(t,e,i,n){var r=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<r.length;s+=3)a.push(r[s]),a.push(r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)h(a,r,t,i,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<r.length;s++)h(a,r[s],t,i,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var u=r[l];for(s=0;s<u.length;s++)h(a,u[s],t,i,n,!0,0===s)}if(a.length){var c={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:e.tags||null};null!==e.id&&(c.id=e.id),t.features.push(c)}}function h(t,e,i,n,r,o,a){var s=n*n;if(!r&&e.size<(o?s:n))i.numPoints+=e.length/3;else{for(var l=[],u=0;u<e.length;u+=3)(r||e[u+2]>s)&&(i.numSimplified++,l.push(e[u]),l.push(e[u+1])),i.numPoints++;o&&function(t,e){for(var i=0,n=0,r=t.length,o=r-2;n<r;o=n,n+=2)i+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(0<i===e)for(n=0,r=t.length;n<r/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[r-2-n],t[n+1]=t[r-1-n],t[r-2-n]=a,t[r-1-n]=s}}(l,a),t.push(l)}}e.exports=function(t,e,i,n,r,o){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z2:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,p(a,t[s],r,o);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}},{}],22:[function(t,e,i){"use strict";function p(t,e,i,n,r,o){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-o))]}i.tile=function(t,e){if(t.transformed)return t;var i,n,r,o=t.z2,a=t.x,s=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(p(u[n],u[n+1],e,o,a,s));else for(n=0;n<u.length;n++){var h=[];for(r=0;r<u[n].length;r+=2)h.push(p(u[n][r],u[n][r+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t},i.point=p},{}],23:[function(t,e,i){"use strict";function o(t,e){for(var i=[],n=0;n<t.length;n++){var r,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)r=c(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){r=[];for(var s=0;s<o.geometry.length;s++)r.push(c(o.geometry[s],e))}else if("MultiPolygon"===a)for(r=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(c(o.geometry[s][u],e));r.push(l)}i.push(h(o.id,a,r,o.tags))}return i}function c(t,e){var i=[];i.size=t.size;for(var n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}var a=t("./clip"),h=t("./feature");e.exports=function(t,e){var i=t,n=a(t,1,-1-e,e,0,-1,2),r=a(t,1,1-e,2+e,0,-1,2);return(n||r)&&(i=a(t,1,-e,1+e,0,-1,2)||[],n&&(i=o(n,1).concat(i)),r&&(i=i.concat(o(r,-1)))),i}},{"./clip":16,"./feature":18}],24:[function(t,e,i){"use strict";function n(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],e=r[1],i=r[2],this.d=e+2*i;for(var o=0;o<this.d*this.d;o++){var a=r[p+o],s=r[p+o+1];n.push(a===s?null:r.subarray(a,s))}var l=r[p+n.length],u=r[p+n.length+1];this.keys=r.subarray(l,u),this.bboxes=r.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var h=i/e*t;this.min=-h,this.max=t+h}e.exports=n;var p=3;n.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(t,e,i,n,r,o){this.cells[r].push(o)},n.prototype.query=function(t,e,i,n){var r=this.min,o=this.max;if(t<=r&&e<=r&&o<=i&&o<=n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{}),a},n.prototype._queryCell=function(t,e,i,n,r,o,a){var s=this.cells[r];if(null!==s)for(var l=this.keys,u=this.bboxes,c=0;c<s.length;c++){var h=s[c];if(void 0===a[h]){var p=4*h;t<=u[p+2]&&e<=u[p+3]&&i>=u[p+0]&&n>=u[p+1]?(a[h]=!0,o.push(l[h])):a[h]=!1}}},n.prototype._forEachCell=function(t,e,i,n,r,o,a){for(var s=this._convertToCellCoord(t),l=this._convertToCellCoord(e),u=this._convertToCellCoord(i),c=this._convertToCellCoord(n),h=s;h<=u;h++)for(var p=l;p<=c;p++){var f=this.d*p+h;if(r.call(this,t,e,i,n,f,o,a))return}},n.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=p+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];r[p+a]=o,r.set(s,o),o+=s.length}return r[p+t.length]=o,r.set(this.keys,o),o+=this.keys.length,r[p+t.length+1]=o,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer}},{}],25:[function(t,e,i){i.read=function(t,e,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?r-1:0,p=i?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;0<c;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;0<c;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=u}return(f?-1:1)*a*Math.pow(2,o-n)},i.write=function(t,e,i,n,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),2<=(e+=1<=a+h?p/l:p*Math.pow(2,1-h))*l&&(a++,l/=2),c<=a+h?(s=0,a=c):1<=a+h?(s=(e*l-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));8<=r;t[i+f]=255&s,f+=d,s/=256,r-=8);for(a=a<<r|s,u+=r;0<u;t[i+f]=255&a,f+=d,a/=256,u-=8);t[i+f-d]|=128*m}},{}],26:[function(t,e,i){"use strict";function o(t,e,i,n,r){e=e||a,i=i||s,r=r||Array,this.nodeSize=n||64,this.points=t,this.ids=new r(t.length),this.coords=new r(2*t.length);for(var o=0;o<t.length;o++)this.ids[o]=o,this.coords[2*o]=e(t[o]),this.coords[2*o+1]=i(t[o]);l(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function a(t){return t[0]}function s(t){return t[1]}var l=t("./sort"),r=t("./range"),n=t("./within");e.exports=function(t,e,i,n,r){return new o(t,e,i,n,r)},o.prototype={range:function(t,e,i,n){return r(this.ids,this.coords,t,e,i,n,this.nodeSize)},within:function(t,e,i){return n(this.ids,this.coords,t,e,i,this.nodeSize)}}},{"./range":27,"./sort":28,"./within":29}],27:[function(t,e,i){"use strict";e.exports=function(t,e,i,n,r,o,a){for(var s,l,u=[0,t.length-1,0],c=[];u.length;){var h=u.pop(),p=u.pop(),f=u.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=e[2*d],l=e[2*d+1],i<=s&&s<=r&&n<=l&&l<=o&&c.push(t[d]);else{var m=Math.floor((f+p)/2);s=e[2*m],l=e[2*m+1],i<=s&&s<=r&&n<=l&&l<=o&&c.push(t[m]);var y=(h+1)%2;(0===h?i<=s:n<=l)&&(u.push(f),u.push(m-1),u.push(y)),(0===h?s<=r:l<=o)&&(u.push(m+1),u.push(p),u.push(y))}}return c}},{}],28:[function(t,e,i){"use strict";function m(t,e,i,n){r(t,i,n),r(e,2*i,2*n),r(e,2*i+1,2*n+1)}function r(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}e.exports=function t(e,i,n,r,o,a){if(!(o-r<=n)){var s=Math.floor((r+o)/2);(function t(e,i,n,r,o,a){for(;r<o;){if(600<o-r){var s=o-r+1,l=n-r+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);t(e,i,n,Math.max(r,Math.floor(n-l*c/s+h)),Math.min(o,Math.floor(n+(s-l)*c/s+h)),a)}var p=i[2*n+a],f=r,d=o;for(m(e,i,r,n),i[2*o+a]>p&&m(e,i,r,o);f<d;){for(m(e,i,f,d),f++,d--;i[2*f+a]<p;)f++;for(;i[2*d+a]>p;)d--}i[2*r+a]===p?m(e,i,r,d):m(e,i,++d,o),d<=n&&(r=d+1),n<=d&&(o=d-1)}})(e,i,s,r,o,a%2),t(e,i,n,r,s-1,a+1),t(e,i,n,s+1,o,a+1)}}},{}],29:[function(t,e,i){"use strict";function _(t,e,i,n){var r=t-i,o=e-n;return r*r+o*o}e.exports=function(t,e,i,n,r,o){for(var a=[0,t.length-1,0],s=[],l=r*r;a.length;){var u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)_(e[2*p],e[2*p+1],i,n)<=l&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],m=e[2*f+1];_(d,m,i,n)<=l&&s.push(t[f]);var y=(u+1)%2;(0===u?i-r<=d:n-r<=m)&&(a.push(h),a.push(f-1),a.push(y)),(0===u?d<=i+r:m<=n+r)&&(a.push(f+1),a.push(c),a.push(y))}}return s}},{}],30:[function(t,e,i){"use strict";function n(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function r(t){return t.type===n.Bytes?t.readVarint()+t.pos:t.pos+1}function a(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function o(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;t<=r;r--)i.buf[r+n]=i.buf[r]}function s(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function y(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function _(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function g(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}e.exports=n;var v=t("ieee754");n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var x=4294967296,b=1/x;n.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=y(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=g(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=y(this.buf,this.pos)+y(this.buf,this.pos+4)*x;return this.pos+=8,t},readSFixed64:function(){var t=y(this.buf,this.pos)+g(this.buf,this.pos+4)*x;return this.pos+=8,t},readFloat:function(){var t=v.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=v.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return a(t,n,e);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return a(t,n,e);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return a(t,n,e);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return a(t,n,e);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return a(t,n,e);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return a(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){for(var n="",r=e;r<i;){var o,a,s,l=t[r],u=null,c=239<l?4:223<l?3:191<l?2:1;if(i<r+c)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[r+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=t[r+1],a=t[r+2],128==(192&o)&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||55296<=u&&u<=57343)&&(u=null)):4===c&&(o=t[r+1],a=t[r+2],s=t[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||1114112<=u)&&(u=null)),null===u?(u=65533,c=1):65535<u&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),r+=c}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=r(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===n.Varint)for(;127<this.buf[this.pos++];);else if(e===n.Bytes)this.pos=this.readVarint()+this.pos;else if(e===n.Fixed32)this.pos+=4;else{if(e!==n.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*b),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*b),this.pos+4),this.pos+=8},writeVarint:function(t){268435455<(t=+t||0)||t<0?function(t,e){var i,n,r,o,a,s,l;if(0<=t?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:n=n+1|(i=0)),0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),s=i,(l=e).buf[l.pos++]=127&s|128,s>>>=7,l.buf[l.pos++]=127&s|128,s>>>=7,l.buf[l.pos++]=127&s|128,s>>>=7,l.buf[l.pos++]=127&s|128,s>>>=7,l.buf[l.pos]=127&s,a=(7&(r=n))<<4,(o=e).buf[o.pos++]|=a|((r>>>=3)?128:0),r&&(o.buf[o.pos++]=127&r|((r>>>=7)?128:0),r&&(o.buf[o.pos++]=127&r|((r>>>=7)?128:0),r&&(o.buf[o.pos++]=127&r|((r>>>=7)?128:0),r&&(o.buf[o.pos++]=127&r|((r>>>=7)?128:0),r&&(o.buf[o.pos++]=127&r)))))}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if(55295<(n=e.charCodeAt(o))&&n<57344){if(!r){56319<n||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);t[i++]=n<128?n:(t[i++]=n<2048?n>>6|192:(t[i++]=n<65536?n>>12|224:(t[i++]=n>>18|240,n>>12&63|128),n>>6&63|128),63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;128<=i&&o(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),v.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),v.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;128<=n&&o(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,n.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,s,e)},writePackedSVarint:function(t,e){this.writeMessage(t,l,e)},writePackedBoolean:function(t,e){this.writeMessage(t,h,e)},writePackedFloat:function(t,e){this.writeMessage(t,u,e)},writePackedDouble:function(t,e){this.writeMessage(t,c,e)},writePackedFixed32:function(t,e){this.writeMessage(t,p,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,f,e)},writePackedFixed64:function(t,e){this.writeMessage(t,d,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,m,e)},writeBytesField:function(t,e){this.writeTag(t,n.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,n.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,n.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,n.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},{ieee754:25}],31:[function(t,e,i){"use strict";function d(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function m(t,e){return t<e?-1:e<t?1:0}e.exports=function t(e,i,n,r,o){for(n=n||0,r=r||e.length-1,o=o||m;n<r;){if(600<r-n){var a=r-n+1,s=i-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1);t(e,i,Math.max(n,Math.floor(i-s*u/a+c)),Math.min(r,Math.floor(i+(a-s)*u/a+c)),o)}var h=e[i],p=n,f=r;for(d(e,n,i),0<o(e[r],h)&&d(e,n,r);p<f;){for(d(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;0<o(e[f],h);)f--}0===o(e[n],h)?d(e,n,f):d(e,++f,r),f<=i&&(n=f+1),i<=f&&(r=f-1)}}},{}],32:[function(t,e,i){"use strict";function n(t){this.options=r(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function a(t,e){var i=t.geometry.coordinates;return{x:s(i[0]),y:c(i[1]),zoom:1/0,id:e,parentId:-1}}function l(t){return{type:"Feature",properties:u(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,i=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(i))/Math.PI-90)]}};var e,i,n}function u(t){var e=t.numPoints,i=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return r(r({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function s(t){return t/360+.5}function c(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:1<i?1:i}function r(t,e){for(var i in e)t[i]=e[i];return t}function h(t){return t.x}function p(t){return t.y}var f=t("kdbush");e.exports=function(t){return new n(t)},n.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var e=this.options.log;e&&console.time("total time");var i="prepare "+t.length+" points";e&&console.time(i);var n=(this.points=t).map(a);e&&console.timeEnd(i);for(var r=this.options.maxZoom;r>=this.options.minZoom;r--){var o=+Date.now();this.trees[r+1]=f(n,h,p,this.options.nodeSize,Float32Array),n=this._cluster(n,r),e&&console.log("z%d: %d clusters in %dms",r,n.length,+Date.now()-o)}return this.trees[this.options.minZoom]=f(n,h,p,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var i=this.trees[this._limitZoom(e)],n=i.range(s(t[0]),c(t[3]),s(t[2]),c(t[1])),r=[],o=0;o<n.length;o++){var a=i.points[n[o]];r.push(a.numPoints?l(a):this.points[a.id])}return r},getChildren:function(t,e){for(var i=this.trees[e+1].points[t],n=this.options.radius/(this.options.extent*Math.pow(2,e)),r=this.trees[e+1].within(i.x,i.y,n),o=[],a=0;a<r.length;a++){var s=this.trees[e+1].points[r[a]];s.parentId===t&&o.push(s.numPoints?l(s):this.points[s.id])}return o},getLeaves:function(t,e,i,n){i=i||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,i,n,0),r},getTile:function(t,e,i){var n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),o=this.options.extent,a=this.options.radius/o,s=(i-a)/r,l=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,s,(e+1+a)/r,l),n.points,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,s,1,l),n.points,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,s,a/r,l),n.points,-1,i,r,u),u.features.length?u:null},getClusterExpansionZoom:function(t,e){for(;e<this.options.maxZoom;){var i=this.getChildren(t,e);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e},_appendLeaves:function(t,e,i,n,r,o){for(var a=this.getChildren(e,i),s=0;s<a.length;s++){var l=a[s].properties;if(l.cluster?o+l.point_count<=r?o+=l.point_count:o=this._appendLeaves(t,l.cluster_id,i+1,n,r,o):o<r?o++:t.push(a[s]),t.length===n)break}return o},_addTileFeatures:function(t,e,i,n,r,o){for(var a=0;a<t.length;a++){var s=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*r-i)),Math.round(this.options.extent*(s.y*r-n))]],tags:s.numPoints?u(s):this.points[s.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var i=[],n=this.options.radius/(this.options.extent*Math.pow(2,e)),r=0;r<t.length;r++){var o=t[r];if(!(o.zoom<=e)){o.zoom=e;var a=this.trees[e+1],s=a.within(o.x,o.y,n),l=o.numPoints||1,u=o.x*l,c=o.y*l,h=null;this.options.reduce&&(h=this.options.initial(),this._accumulate(h,o));for(var p=0;p<s.length;p++){var f=a.points[s[p]];if(e<f.zoom){var d=f.numPoints||1;f.zoom=e,u+=f.x*d,c+=f.y*d,l+=d,f.parentId=r,this.options.reduce&&this._accumulate(h,f)}}1===l?i.push(o):(o.parentId=r,i.push({x:u/l,y:c/l,zoom:1/0,id:r,properties:h,parentId:-1,numPoints:l}))}}return i},_accumulate:function(t,e){var i=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,i)}}},{kdbush:26}],33:[function(t,e,i){"use strict";function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||r,0<this.length)for(var i=this.length>>1;0<=i;i--)this._down(i)}function r(t,e){return t<e?-1:e<t?1:0}(e.exports=n).prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];0<t;){var r=t-1>>1,o=e[r];if(0<=i(n,o))break;e[t]=o,t=r}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length,r=n>>1,o=e[t];t<r;){var a=1+(t<<1),s=a+1,l=e[a];if(s<n&&i(e[s],l)<0&&(l=e[a=s]),0<=i(l,o))break;e[t]=l,t=a}e[t]=o}}},{}],34:[function(t,e,i){function n(t){var e=new u;return function(t,e){for(var i in t.layers)e.writeMessage(3,r,t.layers[i])}(t,e),e.finish()}function r(t,e){e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i,n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,a,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)e.writeMessage(4,l,o[i])}function a(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,o,t),e.writeVarintField(3,i.type),e.writeMessage(4,s,i)}function o(t,e){var i=t.feature,n=t.keys,r=t.values,o=t.keycache,a=t.valuecache;for(var s in i.properties){var l=o[s];void 0===l&&(n.push(s),l=n.length-1,o[s]=l),e.writeVarint(l);var u=i.properties[s],c=typeof u;"string"!==c&&"boolean"!==c&&"number"!==c&&(u=JSON.stringify(u));var h=c+":"+u,p=a[h];void 0===p&&(r.push(u),p=r.length-1,a[h]=p),e.writeVarint(p)}}function f(t,e){return(e<<3)+(7&t)}function d(t){return t<<1^t>>31}function s(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,o=0,a=i.length,s=0;s<a;s++){var l=i[s],u=1;1===n&&(u=l.length),e.writeVarint(f(1,u));for(var c=0;c<l.length;c++){1===c&&1!==n&&e.writeVarint(f(2,l.length-1));var h=l[c].x-r,p=l[c].y-o;e.writeVarint(d(h)),e.writeVarint(d(p)),r+=h,o+=p}}}function l(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}var u=t("pbf"),c=t("./lib/geojson_wrapper");e.exports=n,e.exports.fromVectorTileJs=n,e.exports.fromGeojsonVt=function(t){var e={};for(var i in t)e[i]=new c(t[i].features),e[i].name=i;return n({layers:e})},e.exports.GeoJSONWrapper=c},{"./lib/geojson_wrapper":35,pbf:30}],35:[function(t,e,i){"use strict";function n(t){this.features=t,this.length=t.length}function r(t){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=4096}var o=t("@mapbox/point-geometry"),a=t("@mapbox/vector-tile").VectorTileFeature;(e.exports=n).prototype.feature=function(t){return new r(this.features[t])},r.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new o(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},r.prototype.toGeoJSON=a.prototype.toGeoJSON},{"@mapbox/point-geometry":4,"@mapbox/vector-tile":8}],36:[function(t,e,i){var _=arguments[3],g=arguments[4],v=arguments[5],x=JSON.stringify;e.exports=function(t,e){for(var i,n=Object.keys(v),r=0,o=n.length;r<o;r++){var a=n[r],s=v[a].exports;if(s===t||s&&s.default===t){i=a;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var l={};for(r=0,o=n.length;r<o;r++){l[a=n[r]]=a}g[i]=["function(require,module,exports){"+t+"(self); }",l]}var u=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[i]=i,g[u]=["function(require,module,exports){var f = require("+x(i)+");(f.default ? f.default : f)(self);}",c];var h={};!function t(e){for(var i in h[e]=!0,g[e][1]){var n=g[e][1][i];h[n]||t(n)}}(u);var p="("+_+")({"+Object.keys(h).map(function(t){return x(t)+":["+g[t][0]+","+x(g[t][1])+"]"}).join(",")+"},{},["+x(u)+"])",f=window.URL||window.webkitURL||window.mozURL||window.msURL,d=new Blob([p],{type:"text/javascript"});if(e&&e.bare)return d;var m=f.createObjectURL(d),y=new Worker(m);return y.objectURL=m,y}},{}],37:[function(t,e,i){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},{}],38:[function(t,e,i){e.exports={version:"0.44.1"}},{}],39:[function(t,e,i){"use strict";var n=t("../util/struct_array").StructArray,r=t("../util/struct_array").Struct,o=t("../util/web_worker_transfer").register,a=t("@mapbox/point-geometry"),s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=2*i;return this.int16[n+0]=t,this.int16[n+1]=e,i},e}(n);s.prototype.bytesPerElement=4,o("StructArrayLayout2i4",s);var l=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n){var r=this.length;this.resize(r+1);var o=4*r;return this.int16[o+0]=t,this.int16[o+1]=e,this.int16[o+2]=i,this.int16[o+3]=n,r},e}(n);l.prototype.bytesPerElement=8,o("StructArrayLayout4i8",l);var u=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=r,this.int16[s+5]=o,a},e}(n);u.prototype.bytesPerElement=12,o("StructArrayLayout2i4i12",u);var c=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s){var l=this.length;this.resize(l+1);var u=6*l,c=12*l;return this.int16[u+0]=t,this.int16[u+1]=e,this.int16[u+2]=i,this.int16[u+3]=n,this.uint8[c+8]=r,this.uint8[c+9]=o,this.uint8[c+10]=a,this.uint8[c+11]=s,l},e}(n);c.prototype.bytesPerElement=12,o("StructArrayLayout4i4ub12",c);var h=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s){var l=this.length;this.resize(l+1);var u=8*l;return this.int16[u+0]=t,this.int16[u+1]=e,this.int16[u+2]=i,this.int16[u+3]=n,this.uint16[u+4]=r,this.uint16[u+5]=o,this.uint16[u+6]=a,this.uint16[u+7]=s,l},e}(n);h.prototype.bytesPerElement=16,o("StructArrayLayout4i4ui16",h);var p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=3*n;return this.float32[r+0]=t,this.float32[r+1]=e,this.float32[r+2]=i,n},e}(n);p.prototype.bytesPerElement=12,o("StructArrayLayout3f12",p);var f=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var i=1*e;return this.uint32[i+0]=t,e},e}(n);f.prototype.bytesPerElement=4,o("StructArrayLayout1ul4",f);var d=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s,l,u,c){var h=this.length;this.resize(h+1);var p=12*h,f=6*h;return this.int16[p+0]=t,this.int16[p+1]=e,this.int16[p+2]=i,this.int16[p+3]=n,this.int16[p+4]=r,this.int16[p+5]=o,this.uint32[f+3]=a,this.uint16[p+8]=s,this.uint16[p+9]=l,this.int16[p+10]=u,this.int16[p+11]=c,h},e}(n);d.prototype.bytesPerElement=24,o("StructArrayLayout6i1ul2ui2i24",d);var m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o){var a=this.length;this.resize(a+1);var s=6*a;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=r,this.int16[s+5]=o,a},e}(n);m.prototype.bytesPerElement=12,o("StructArrayLayout2i2i2i12",m);var y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=4*i;return this.uint8[n+0]=t,this.uint8[n+1]=e,i},e}(n);y.prototype.bytesPerElement=4,o("StructArrayLayout2ub4",y);var _=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n,r,o,a,s,l,u,c,h,p,f){var d=this.length;this.resize(d+1);var m=20*d,y=10*d,_=40*d;return this.int16[m+0]=t,this.int16[m+1]=e,this.uint16[m+2]=i,this.uint16[m+3]=n,this.uint32[y+2]=r,this.uint32[y+3]=o,this.uint32[y+4]=a,this.uint16[m+10]=s,this.uint16[m+11]=l,this.uint16[m+12]=u,this.float32[y+7]=c,this.float32[y+8]=h,this.uint8[_+36]=p,this.uint8[_+37]=f,d},e}(n);_.prototype.bytesPerElement=40,o("StructArrayLayout2i2ui3ul3ui2f2ub40",_);var g=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var i=1*e;return this.float32[i+0]=t,e},e}(n);g.prototype.bytesPerElement=4,o("StructArrayLayout1f4",g);var v=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=3*n;return this.int16[r+0]=t,this.int16[r+1]=e,this.int16[r+2]=i,n},e}(n);v.prototype.bytesPerElement=6,o("StructArrayLayout3i6",v);var x=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=2*n,o=4*n;return this.uint32[r+0]=t,this.uint16[o+2]=e,this.uint16[o+3]=i,n},e}(n);x.prototype.bytesPerElement=8,o("StructArrayLayout1ul2ui8",x);var b=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i){var n=this.length;this.resize(n+1);var r=3*n;return this.uint16[r+0]=t,this.uint16[r+1]=e,this.uint16[r+2]=i,n},e}(n);b.prototype.bytesPerElement=6,o("StructArrayLayout3ui6",b);var w=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=2*i;return this.uint16[n+0]=t,this.uint16[n+1]=e,i},e}(n);w.prototype.bytesPerElement=4,o("StructArrayLayout2ui4",w);var T=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var n=2*i;return this.float32[n+0]=t,this.float32[n+1]=e,i},e}(n);T.prototype.bytesPerElement=8,o("StructArrayLayout2f8",T);var S=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,i,n){var r=this.length;this.resize(r+1);var o=4*r;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=i,this.float32[o+3]=n,r},e}(n);S.prototype.bytesPerElement=16,o("StructArrayLayout4f16",S);var A=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorPointX:{},anchorPointY:{},x1:{},y1:{},x2:{},y2:{},featureIndex:{},sourceLayerIndex:{},bucketIndex:{},radius:{},signedDistanceFromAnchor:{},anchorPoint:{}};return i.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},i.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},i.x1.get=function(){return this._structArray.int16[this._pos2+2]},i.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},i.y1.get=function(){return this._structArray.int16[this._pos2+3]},i.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},i.x2.get=function(){return this._structArray.int16[this._pos2+4]},i.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},i.y2.get=function(){return this._structArray.int16[this._pos2+5]},i.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},i.radius.get=function(){return this._structArray.int16[this._pos2+10]},i.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},i.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},i.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},i.anchorPoint.get=function(){return new a(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,i),e}(r);A.prototype.size=24;var M=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.get=function(t){return new A(this,t)},e}(d);o("CollisionBoxArray",M);var E=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={anchorX:{},anchorY:{},glyphStartIndex:{},numGlyphs:{},vertexStartIndex:{},lineStartIndex:{},lineLength:{},segment:{},lowerSize:{},upperSize:{},lineOffsetX:{},lineOffsetY:{},writingMode:{},hidden:{}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},i.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},i.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},i.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},i.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},i.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},i.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},i.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},i.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},i.segment.get=function(){return this._structArray.uint16[this._pos2+10]},i.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},i.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},i.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},i.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},i.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},i.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},i.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},i.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},i.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},i.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},i.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},i.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},i.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},Object.defineProperties(e.prototype,i),e}(r);E.prototype.size=40;var L=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.get=function(t){return new E(this,t)},e}(_);o("PlacedSymbolArray",L);var z=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={offsetX:{}};return i.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},i.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,i),e}(r);z.prototype.size=4;var P=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new z(this,t)},e}(g);o("GlyphOffsetArray",P);var C=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={x:{},y:{},tileUnitDistanceFromAnchor:{}};return i.x.get=function(){return this._structArray.int16[this._pos2+0]},i.x.set=function(t){this._structArray.int16[this._pos2+0]=t},i.y.get=function(){return this._structArray.int16[this._pos2+1]},i.y.set=function(t){this._structArray.int16[this._pos2+1]=t},i.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},i.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,i),e}(r);C.prototype.size=6;var I=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new C(this,t)},e}(v);o("SymbolLineVertexArray",I);var k=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={featureIndex:{},sourceLayerIndex:{},bucketIndex:{}};return i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,i),e}(r);k.prototype.size=8;var R=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.get=function(t){return new k(this,t)},e}(x);o("FeatureIndexArray",R),e.exports={StructArrayLayout2i4:s,StructArrayLayout4i8:l,StructArrayLayout2i4i12:u,StructArrayLayout4i4ub12:c,StructArrayLayout4i4ui16:h,StructArrayLayout3f12:p,StructArrayLayout1ul4:f,StructArrayLayout6i1ul2ui2i24:d,StructArrayLayout2i2i2i12:m,StructArrayLayout2ub4:y,StructArrayLayout2i2ui3ul3ui2f2ub40:_,StructArrayLayout1f4:g,StructArrayLayout3i6:v,StructArrayLayout1ul2ui8:x,StructArrayLayout3ui6:b,StructArrayLayout2ui4:w,StructArrayLayout2f8:T,StructArrayLayout4f16:S,PosArray:s,RasterBoundsArray:l,CircleLayoutArray:s,FillLayoutArray:s,FillExtrusionLayoutArray:u,HeatmapLayoutArray:s,LineLayoutArray:c,SymbolLayoutArray:h,SymbolDynamicLayoutArray:p,SymbolOpacityArray:f,CollisionBoxLayoutArray:m,CollisionCircleLayoutArray:m,CollisionVertexArray:y,TriangleIndexArray:b,LineIndexArray:w,CollisionBoxArray:M,PlacedSymbolArray:L,GlyphOffsetArray:P,SymbolLineVertexArray:I,FeatureIndexArray:R}},{"../util/struct_array":271,"../util/web_worker_transfer":278,"@mapbox/point-geometry":4}],40:[function(t,e,i){"use strict";e.exports={deserialize:function(t,e){var i={};if(!e)return i;for(var n=0,r=t;n<r.length;n+=1){var o=r[n],a=o.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==a.length)for(var s=0,l=o.layers=a;s<l.length;s+=1)i[l[s].id]=o}return i}}},{}],41:[function(t,e,i){"use strict";var n=t("../../util/struct_array").createLayout;e.exports=n([{name:"a_pos",components:2,type:"Int16"}],4)},{"../../util/struct_array":271}],42:[function(t,e,i){"use strict";function h(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}var n=t("../array_types").CircleLayoutArray,r=t("./circle_attributes").members,o=t("../segment").SegmentVector,a=t("../program_configuration").ProgramConfigurationSet,s=t("../index_array_type").TriangleIndexArray,u=t("../load_geometry"),p=t("../extent"),l=t("../../util/web_worker_transfer").register,c=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new n,this.indexArray=new s,this.segments=new o,this.programConfigurations=new a(r,t.layers,t.zoom)};c.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=u(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},c.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},c.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},c.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},c.prototype.addFeature=function(t,e){for(var i=0,n=e;i<n.length;i+=1)for(var r=0,o=n[i];r<o.length;r+=1){var a=o[r],s=a.x,l=a.y;if(!(s<0||p<=s||l<0||p<=l)){var u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),c=u.vertexLength;h(this.layoutVertexArray,s,l,-1,-1),h(this.layoutVertexArray,s,l,1,-1),h(this.layoutVertexArray,s,l,1,1),h(this.layoutVertexArray,s,l,-1,1),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),u.vertexLength+=4,u.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},l("CircleBucket",c,{omit:["layers"]}),e.exports=c},{"../../util/web_worker_transfer":278,"../array_types":39,"../extent":53,"../index_array_type":55,"../load_geometry":56,"../program_configuration":58,"../segment":60,"./circle_attributes":41}],43:[function(t,e,i){arguments[4][41][0].apply(i,arguments)},{"../../util/struct_array":271,dup:41}],44:[function(t,e,i){"use strict";var n=t("../array_types").FillLayoutArray,r=t("./fill_attributes").members,o=t("../segment").SegmentVector,a=t("../program_configuration").ProgramConfigurationSet,s=t("../index_array_type"),l=s.LineIndexArray,u=s.TriangleIndexArray,c=t("../load_geometry"),b=t("earcut"),w=t("../../util/classify_rings"),h=t("../../util/web_worker_transfer").register,p=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new n,this.indexArray=new u,this.indexArray2=new l,this.programConfigurations=new a(r,t.layers,t.zoom),this.segments=new o,this.segments2=new o};p.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=c(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},p.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},p.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2),this.programConfigurations.upload(t)},p.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},p.prototype.addFeature=function(t,e){for(var i=this,n=0,r=w(e,500);n<r.length;n+=1){for(var o=r[n],a=0,s=0,l=o;s<l.length;s+=1)a+=l[s].length;for(var u=i.segments.prepareSegment(a,i.layoutVertexArray,i.indexArray),c=u.vertexLength,h=[],p=[],f=0,d=o;f<d.length;f+=1){var m=d[f];if(0!==m.length){m!==o[0]&&p.push(h.length/2);var y=i.segments2.prepareSegment(m.length,i.layoutVertexArray,i.indexArray2),_=y.vertexLength;i.layoutVertexArray.emplaceBack(m[0].x,m[0].y),i.indexArray2.emplaceBack(_+m.length-1,_),h.push(m[0].x),h.push(m[0].y);for(var g=1;g<m.length;g++)i.layoutVertexArray.emplaceBack(m[g].x,m[g].y),i.indexArray2.emplaceBack(_+g-1,_+g),h.push(m[g].x),h.push(m[g].y);y.vertexLength+=m.length,y.primitiveLength+=m.length}}for(var v=b(h,p),x=0;x<v.length;x+=3)i.indexArray.emplaceBack(c+v[x],c+v[x+1],c+v[x+2]);u.vertexLength+=a,u.primitiveLength+=v.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},h("FillBucket",p,{omit:["layers"]}),e.exports=p},{"../../util/classify_rings":255,"../../util/web_worker_transfer":278,"../array_types":39,"../index_array_type":55,"../load_geometry":56,"../program_configuration":58,"../segment":60,"./fill_attributes":43,earcut:14}],45:[function(t,e,i){"use strict";var n=t("../../util/struct_array").createLayout;e.exports=n([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4)},{"../../util/struct_array":271}],46:[function(t,e,i){"use strict";function k(t,e,i,n,r,o,a,s){t.emplaceBack(e,i,2*Math.floor(n*h)+a,r*h*2,o*h*2,Math.round(s))}var n=t("../array_types").FillExtrusionLayoutArray,r=t("./fill_extrusion_attributes").members,o=t("../segment"),a=o.SegmentVector,R=o.MAX_VERTEX_ARRAY_LENGTH,s=t("../program_configuration").ProgramConfigurationSet,l=t("../index_array_type").TriangleIndexArray,u=t("../load_geometry"),D=t("../extent"),B=t("earcut"),O=t("../../util/classify_rings"),c=t("../../util/web_worker_transfer").register,h=Math.pow(2,13),p=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new n,this.indexArray=new l,this.programConfigurations=new s(r,t.layers,t.zoom),this.segments=new a};p.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=u(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},p.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},p.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},p.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},p.prototype.addFeature=function(t,e){for(var i=this,n=0,r=O(e,500);n<r.length;n+=1){for(var o=r[n],a=0,s=0,l=o;s<l.length;s+=1)a+=l[s].length;for(var u=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),c=0,h=o;c<h.length;c+=1){var p=h[c];if(0!==p.length&&!((I=p).every(function(t){return t.x<0})||I.every(function(t){return t.x>D})||I.every(function(t){return t.y<0})||I.every(function(t){return t.y>D})))for(var f=0,d=0;d<p.length;d++){var m=p[d];if(1<=d){var y=p[d-1];if(C=y,!((P=m).x===C.x&&(P.x<0||P.x>D)||P.y===C.y&&(P.y<0||P.y>D))){u.vertexLength+4>R&&(u=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray));var _=m.sub(y)._perp()._unit(),g=y.dist(m);32768<f+g&&(f=0),k(i.layoutVertexArray,m.x,m.y,_.x,_.y,0,0,f),k(i.layoutVertexArray,m.x,m.y,_.x,_.y,0,1,f),f+=g,k(i.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,f),k(i.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,f);var v=u.vertexLength;i.indexArray.emplaceBack(v,v+1,v+2),i.indexArray.emplaceBack(v+1,v+2,v+3),u.vertexLength+=4,u.primitiveLength+=2}}}}u.vertexLength+a>R&&(u=i.segments.prepareSegment(a,i.layoutVertexArray,i.indexArray));for(var x=[],b=[],w=u.vertexLength,T=0,S=o;T<S.length;T+=1){var A=S[T];if(0!==A.length){A!==o[0]&&b.push(x.length/2);for(var M=0;M<A.length;M++){var E=A[M];k(i.layoutVertexArray,E.x,E.y,0,0,1,1,0),x.push(E.x),x.push(E.y)}}}for(var L=B(x,b),z=0;z<L.length;z+=3)i.indexArray.emplaceBack(w+L[z],w+L[z+1],w+L[z+2]);u.primitiveLength+=L.length/3,u.vertexLength+=a}var P,C,I;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)},c("FillExtrusionBucket",p,{omit:["layers"]}),e.exports=p},{"../../util/classify_rings":255,"../../util/web_worker_transfer":278,"../array_types":39,"../extent":53,"../index_array_type":55,"../load_geometry":56,"../program_configuration":58,"../segment":60,"./fill_extrusion_attributes":45,earcut:14}],47:[function(t,e,i){"use strict";var n=t("./circle_bucket"),r=t("../../util/web_worker_transfer").register,o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e}(n);r("HeatmapBucket",o,{omit:["layers"]}),e.exports=o},{"../../util/web_worker_transfer":278,"./circle_bucket":42}],48:[function(t,e,i){"use strict";var n=t("../../util/struct_array").createLayout;e.exports=n([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4)},{"../../util/struct_array":271}],49:[function(t,e,i){"use strict";function c(t,e,i,n,r,o,a){t.emplaceBack(e.x,e.y,n?1:0,r?1:-1,Math.round(63*i.x)+128,Math.round(63*i.y)+128,1+(0===o?0:o<0?-1:1)|(.5*a&63)<<2,.5*a>>6)}var n=t("../array_types").LineLayoutArray,r=t("./line_attributes").members,o=t("../segment").SegmentVector,a=t("../program_configuration").ProgramConfigurationSet,s=t("../index_array_type").TriangleIndexArray,u=t("../load_geometry"),Z=t("../extent"),V=t("@mapbox/vector-tile").VectorTileFeature.types,l=t("../../util/web_worker_transfer").register,q=Math.cos(Math.PI/180*37.5),h=Math.pow(2,14)/.5,p=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new n,this.indexArray=new s,this.programConfigurations=new a(r,t.layers,t.zoom),this.segments=new o};p.prototype.populate=function(t,e){for(var i=0,n=t;i<n.length;i+=1){var r=n[i],o=r.feature,a=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter({zoom:this.zoom},o)){var l=u(o);this.addFeature(o,l),e.featureIndex.insert(o,l,a,s,this.index)}}},p.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},p.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.programConfigurations.upload(t)},p.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},p.prototype.addFeature=function(t,e){for(var i=this.layers[0].layout,n=i.get("line-join").evaluate(t),r=i.get("line-cap"),o=i.get("line-miter-limit"),a=i.get("line-round-limit"),s=0,l=e;s<l.length;s+=1){var u=l[s];this.addLine(u,t,n,r,o,a)}},p.prototype.addLine=function(t,e,i,n,r,o){for(var a=this,s="Polygon"===V[e.type],l=t.length;2<=l&&t[l-1].equals(t[l-2]);)l--;for(var u=0;u<l-1&&t[u].equals(t[u+1]);)u++;if(!(l<(s?3:2))){"bevel"===i&&(r=1.05);var c,h,p,f=Z/(512*this.overscaling)*15,d=t[u],m=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),y=n,_=s?"butt":n,g=!(this.distance=0),v=void 0,x=void 0,b=void 0,w=void 0;this.e1=this.e2=this.e3=-1,s&&(c=t[l-2],w=d.sub(c)._unit()._perp());for(var T=u;T<l;T++)if(!(x=s&&T===l-1?t[u+1]:t[T+1])||!t[T].equals(x)){w&&(b=w),c&&(v=c),c=t[T],w=x?x.sub(c)._unit()._perp():b;var S=(b=b||w).add(w);0===S.x&&0===S.y||S._unit();var A=S.x*w.x+S.y*w.y,M=0!==A?1/A:1/0,E=A<q&&v&&x;if(E&&u<T){var L=c.dist(v);if(2*f<L){var z=c.sub(c.sub(v)._mult(f/L)._round());a.distance+=z.dist(v),a.addCurrentVertex(z,a.distance,b.mult(1),0,0,!1,m),v=z}}var P=v&&x,C=P?i:x?y:_;if(P&&"round"===C&&(M<o?C="miter":M<=2&&(C="fakeround")),"miter"===C&&r<M&&(C="bevel"),"bevel"===C&&(2<M&&(C="flipbevel"),M<r&&(C="miter")),v&&(a.distance+=c.dist(v)),"miter"===C)S._mult(M),a.addCurrentVertex(c,a.distance,S,0,0,!1,m);else if("flipbevel"===C){if(100<M)S=w.clone().mult(-1);else{var I=0<b.x*w.y-b.y*w.x?-1:1,k=M*b.add(w).mag()/b.sub(w).mag();S._perp()._mult(k*I)}a.addCurrentVertex(c,a.distance,S,0,0,!1,m),a.addCurrentVertex(c,a.distance,S.mult(-1),0,0,!1,m)}else if("bevel"===C||"fakeround"===C){var R=0<b.x*w.y-b.y*w.x,D=-Math.sqrt(M*M-1);if(R?(p=0,h=D):(h=0,p=D),g||a.addCurrentVertex(c,a.distance,b,h,p,!1,m),"fakeround"===C){for(var B=Math.floor(8*(.5-(A-.5))),O=void 0,F=0;F<B;F++)O=w.mult((F+1)/(B+1))._add(b)._unit(),a.addPieSliceVertex(c,a.distance,O,R,m);a.addPieSliceVertex(c,a.distance,S,R,m);for(var N=B-1;0<=N;N--)O=b.mult((N+1)/(B+1))._add(w)._unit(),a.addPieSliceVertex(c,a.distance,O,R,m)}x&&a.addCurrentVertex(c,a.distance,w,-h,-p,!1,m)}else"butt"===C?(g||a.addCurrentVertex(c,a.distance,b,0,0,!1,m),x&&a.addCurrentVertex(c,a.distance,w,0,0,!1,m)):"square"===C?(g||(a.addCurrentVertex(c,a.distance,b,1,1,!1,m),a.e1=a.e2=-1),x&&a.addCurrentVertex(c,a.distance,w,-1,-1,!1,m)):"round"===C&&(g||(a.addCurrentVertex(c,a.distance,b,0,0,!1,m),a.addCurrentVertex(c,a.distance,b,1,1,!0,m),a.e1=a.e2=-1),x&&(a.addCurrentVertex(c,a.distance,w,-1,-1,!0,m),a.addCurrentVertex(c,a.distance,w,0,0,!1,m)));if(E&&T<l-1){var j=c.dist(x);if(2*f<j){var U=c.add(x.sub(c)._mult(f/j)._round());a.distance+=U.dist(c),a.addCurrentVertex(U,a.distance,w.mult(1),0,0,!1,m),c=U}}g=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)}},p.prototype.addCurrentVertex=function(t,e,i,n,r,o,a){var s,l=this.layoutVertexArray,u=this.indexArray;s=i.clone(),n&&s._sub(i.perp()._mult(n)),c(l,t,s,o,!1,n,e),this.e3=a.vertexLength++,0<=this.e1&&0<=this.e2&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=i.mult(-1),r&&s._sub(i.perp()._mult(r)),c(l,t,s,o,!0,-r,e),this.e3=a.vertexLength++,0<=this.e1&&0<=this.e2&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,h/2<e&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,n,r,o,a))},p.prototype.addPieSliceVertex=function(t,e,i,n,r){i=i.mult(n?-1:1);var o=this.layoutVertexArray,a=this.indexArray;c(o,t,i,!1,n,0,e),this.e3=r.vertexLength++,0<=this.e1&&0<=this.e2&&(a.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3},l("LineBucket",p,{omit:["layers"]}),e.exports=p},{"../../util/web_worker_transfer":278,"../array_types":39,"../extent":53,"../index_array_type":55,"../load_geometry":56,"../program_configuration":58,"../segment":60,"./line_attributes":48,"@mapbox/vector-tile":8}],50:[function(t,e,i){"use strict";var n=t("../../util/struct_array").createLayout,r={symbolLayoutAttributes:n([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),dynamicLayoutAttributes:n([{name:"a_projected_pos",components:3,type:"Float32"}],4),placementOpacityAttributes:n([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),collisionVertexAttributes:n([{name:"a_placed",components:2,type:"Uint8"}],4),collisionBox:n([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),collisionBoxLayout:n([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),collisionCircleLayout:n([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),placement:n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),glyphOffset:n([{type:"Float32",name:"offsetX"}]),lineVertex:n([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}])};e.exports=r},{"../../util/struct_array":271}],51:[function(t,e,i){"use strict";function M(t,e,i,n,r,o,a,s){t.emplaceBack(e,i,Math.round(64*n),Math.round(64*r),o,a,s?s[0]:0,s?s[1]:0)}function E(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}var n=t("./symbol_attributes"),r=n.symbolLayoutAttributes,o=n.collisionVertexAttributes,a=n.collisionBoxLayout,s=n.collisionCircleLayout,l=n.dynamicLayoutAttributes,u=t("../array_types"),c=u.SymbolLayoutArray,h=u.SymbolDynamicLayoutArray,p=u.SymbolOpacityArray,f=u.CollisionBoxLayoutArray,d=u.CollisionCircleLayoutArray,m=u.CollisionVertexArray,y=u.PlacedSymbolArray,_=u.GlyphOffsetArray,g=u.SymbolLineVertexArray,v=t("@mapbox/point-geometry"),x=t("../segment").SegmentVector,b=t("../program_configuration").ProgramConfigurationSet,w=t("../index_array_type"),T=w.TriangleIndexArray,S=w.LineIndexArray,L=t("../../symbol/transform_text"),z=t("../../symbol/mergelines"),P=t("../../util/script_detection"),C=t("../load_geometry"),I=t("@mapbox/vector-tile").VectorTileFeature.types,k=t("../../util/verticalize_punctuation"),A=(t("../../symbol/anchor"),t("../../symbol/symbol_size").getSizeData),R=t("../../util/web_worker_transfer").register,D=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}],B=function(t){this.layoutVertexArray=new c,this.indexArray=new T,this.programConfigurations=t,this.segments=new x,this.dynamicLayoutVertexArray=new h,this.opacityVertexArray=new p,this.placedSymbolArray=new y};B.prototype.upload=function(t,e){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.programConfigurations.upload(t),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,l.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,D,!0),this.opacityVertexBuffer.itemSize=1},B.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},R("SymbolBuffers",B);var O=function(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new x,this.collisionVertexArray=new m};O.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,o.members,!0)},O.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},R("CollisionBuffers",O);var F=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=A(this.zoom,e["text-size"]),this.iconSizeData=A(this.zoom,e["icon-size"]);var i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement")};F.prototype.createArrays=function(){this.text=new B(new b(r.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new B(new b(r.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new O(f,a.members,S),this.collisionCircle=new O(d,s.members,T),this.glyphOffsetArray=new _,this.lineVertexArray=new g},F.prototype.populate=function(t,e){var i=this.layers[0],n=i.layout,r=n.get("text-font"),o=n.get("text-field"),a=n.get("icon-image"),s=("constant"!==o.value.kind||0<o.value.value.length)&&("constant"!==r.value.kind||0<r.value.value.length),l="constant"!==a.value.kind||a.value.value&&0<a.value.value.length;if(this.features=[],s||l){for(var u=e.iconDependencies,c=e.glyphDependencies,h={zoom:this.zoom},p=0,f=t;p<f.length;p+=1){var d=f[p],m=d.feature,y=d.index,_=d.sourceLayerIndex;if(i._featureFilter(h,m)){var g=void 0;s&&(g=i.getValueAndResolveTokens("text-field",m),g=L(g,i,m));var v=void 0;if(l&&(v=i.getValueAndResolveTokens("icon-image",m)),g||v){var x={text:g,icon:v,index:y,sourceLayerIndex:_,geometry:C(m),properties:m.properties,type:I[m.type]};if(void 0!==m.id&&(x.id=m.id),this.features.push(x),v&&(u[v]=!0),g)for(var b=r.evaluate(m).join(","),w=c[b]=c[b]||{},T="map"===n.get("text-rotation-alignment")&&"line"===n.get("symbol-placement"),S=P.allowsVerticalWritingMode(g),A=0;A<g.length;A++)if(w[g.charCodeAt(A)]=!0,T&&S){var M=k.lookup[g.charAt(A)];M&&(w[M.charCodeAt(0)]=!0)}}}}"line"===n.get("symbol-placement")&&(this.features=z(this.features))}},F.prototype.isEmpty=function(){return 0===this.symbolInstances.length},F.prototype.upload=function(t){this.text.upload(t,this.sortFeaturesByY),this.icon.upload(t,this.sortFeaturesByY),this.collisionBox.upload(t),this.collisionCircle.upload(t)},F.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},F.prototype.addToLineVertexArray=function(t,e){var i=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(var s=t.segment||0;0<=s;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:r},0<s&&(r+=e[s-1].dist(e[s]));for(var l=0;l<e.length;l++){var u=o[l];this.lineVertexArray.emplaceBack(u.x,u.y,u.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},F.prototype.addSymbols=function(t,e,i,n,r,o,a,s,l,u){for(var c=t.indexArray,h=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),d=this.glyphOffsetArray.length,m=f.vertexLength,y=0,_=e;y<_.length;y+=1){var g=_[y],v=g.tl,x=g.tr,b=g.bl,w=g.br,T=g.tex,S=f.vertexLength,A=g.glyphOffset[1];M(h,s.x,s.y,v.x,A+v.y,T.x,T.y,i),M(h,s.x,s.y,x.x,A+x.y,T.x+T.w,T.y,i),M(h,s.x,s.y,b.x,A+b.y,T.x,T.y+T.h,i),M(h,s.x,s.y,w.x,A+w.y,T.x+T.w,T.y+T.h,i),E(p,s,0),c.emplaceBack(S,S+1,S+2),c.emplaceBack(S+1,S+2,S+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(g.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,d,this.glyphOffsetArray.length-d,m,l,u,s.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],a,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o)},F.prototype._addCollisionDebugVertex=function(t,e,i,n,r){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,n.x,n.y,Math.round(r.x),Math.round(r.y))},F.prototype.addCollisionDebugVertices=function(t,e,i,n,r,o,a,s){var l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=l.vertexLength,c=r.layoutVertexArray,h=r.collisionVertexArray;if(this._addCollisionDebugVertex(c,h,o,a.anchor,new v(t,e)),this._addCollisionDebugVertex(c,h,o,a.anchor,new v(i,e)),this._addCollisionDebugVertex(c,h,o,a.anchor,new v(i,n)),this._addCollisionDebugVertex(c,h,o,a.anchor,new v(t,n)),l.vertexLength+=4,s){var p=r.indexArray;p.emplaceBack(u,u+1,u+2),p.emplaceBack(u,u+2,u+3),l.primitiveLength+=2}else{var f=r.indexArray;f.emplaceBack(u,u+1),f.emplaceBack(u+1,u+2),f.emplaceBack(u+2,u+3),f.emplaceBack(u+3,u),l.primitiveLength+=4}},F.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var i=e[t];i.textCollisionFeature={boxStartIndex:i.textBoxStartIndex,boxEndIndex:i.textBoxEndIndex},i.iconCollisionFeature={boxStartIndex:i.iconBoxStartIndex,boxEndIndex:i.iconBoxEndIndex};for(var n=0;n<2;n++){var r=i[0===n?"textCollisionFeature":"iconCollisionFeature"];if(r)for(var o=r.boxStartIndex;o<r.boxEndIndex;o++){var a=this.collisionBoxArray.get(o),s=a.x1,l=a.y1,u=a.x2,c=a.y2,h=0<a.radius;this.addCollisionDebugVertices(s,l,u,c,h?this.collisionCircle:this.collisionBox,a.anchorPoint,i,h)}}}},F.prototype.deserializeCollisionBoxes=function(t,e,i,n,r){for(var o={},a=e;a<i;a++){var s=t.get(a);if(0===s.radius){o.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY};break}o.textCircles||(o.textCircles=[]),o.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var l=n;l<r;l++){var u=t.get(l);if(0===u.radius){o.iconBox={x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2,anchorPointX:u.anchorPointX,anchorPointY:u.anchorPointY};break}}return o},F.prototype.hasTextData=function(){return 0<this.text.segments.get().length},F.prototype.hasIconData=function(){return 0<this.icon.segments.get().length},F.prototype.hasCollisionBoxData=function(){return 0<this.collisionBox.segments.get().length},F.prototype.hasCollisionCircleData=function(){return 0<this.collisionCircle.segments.get().length},F.prototype.sortFeatures=function(t){var r=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(1<this.text.segments.get().length||1<this.icon.segments.get().length))){for(var e=[],i=0;i<this.symbolInstances.length;i++)e.push(i);var o=Math.sin(t),a=Math.cos(t);e.sort(function(t,e){var i=r.symbolInstances[t],n=r.symbolInstances[e];return(o*i.anchor.x+a*i.anchor.y|0)-(o*n.anchor.x+a*n.anchor.y|0)||n.featureIndex-i.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear();for(var n=0,s=e;n<s.length;n+=1){for(var l=s[n],u=0,c=r.symbolInstances[l].placedTextSymbolIndices;u<c.length;u+=1)for(var h=c[u],p=r.text.placedSymbolArray.get(h),f=p.vertexStartIndex+4*p.numGlyphs,d=p.vertexStartIndex;d<f;d+=4)r.text.indexArray.emplaceBack(d,d+1,d+2),r.text.indexArray.emplaceBack(d+1,d+2,d+3);var m=r.icon.placedSymbolArray.get(l);if(m.numGlyphs){var y=m.vertexStartIndex;r.icon.indexArray.emplaceBack(y,y+1,y+2),r.icon.indexArray.emplaceBack(y+1,y+2,y+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},R("SymbolBucket",F,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),F.MAX_GLYPHS=65535,F.addDynamicAttributes=E,e.exports=F},{"../../symbol/anchor":213,"../../symbol/mergelines":221,"../../symbol/symbol_size":228,"../../symbol/transform_text":229,"../../util/script_detection":269,"../../util/verticalize_punctuation":277,"../../util/web_worker_transfer":278,"../array_types":39,"../index_array_type":55,"../load_geometry":56,"../program_configuration":58,"../segment":60,"./symbol_attributes":50,"@mapbox/point-geometry":4,"@mapbox/vector-tile":8}],52:[function(t,e,i){"use strict";var n=t("../util/image").RGBAImage,_=t("../util/util"),r=t("../util/web_worker_transfer").register,s=function(t,e,i){if(t<=0)throw new RangeError("Level must have positive dimension");this.dim=t,this.border=e,this.stride=this.dim+2*this.border,this.data=i||new Int32Array((this.dim+2*this.border)*(this.dim+2*this.border))};s.prototype.set=function(t,e,i){this.data[this._idx(t,e)]=i+65536},s.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},s.prototype._idx=function(t,e){if(t<-this.border||t>=this.dim+this.border||e<-this.border||e>=this.dim+this.border)throw new RangeError("out of range source coordinates for DEM data");return(e+this.border)*this.stride+(t+this.border)},r("Level",s);var o=function(t,e,i){this.uid=t,this.scale=e||1,this.level=i||new s(256,512),this.loaded=!!i};o.prototype.loadFromImage=function(t){if(t.height!==t.width)throw new RangeError("DEM tiles must be square");for(var e=this.level=new s(t.width,t.width/2),i=t.data,n=0;n<e.dim;n++)for(var r=0;r<e.dim;r++){var o=4*(n*e.dim+r);e.set(r,n,this.scale*((256*i[o]*256+256*i[o+1]+i[o+2])/10-1e4))}for(var a=0;a<e.dim;a++)e.set(-1,a,e.get(0,a)),e.set(e.dim,a,e.get(e.dim-1,a)),e.set(a,-1,e.get(a,0)),e.set(a,e.dim,e.get(a,e.dim-1));e.set(-1,-1,e.get(0,0)),e.set(e.dim,-1,e.get(e.dim-1,0)),e.set(-1,e.dim,e.get(0,e.dim-1)),e.set(e.dim,e.dim,e.get(e.dim-1,e.dim-1)),this.loaded=!0},o.prototype.getPixels=function(){return new n({width:this.level.dim+2*this.level.border,height:this.level.dim+2*this.level.border},new Uint8Array(this.level.data.buffer))},o.prototype.backfillBorder=function(t,e,i){var n=this.level,r=t.level;if(n.dim!==r.dim)throw new Error("level mismatch (dem dimension)");var o=e*n.dim,a=e*n.dim+n.dim,s=i*n.dim,l=i*n.dim+n.dim;switch(e){case-1:o=a-1;break;case 1:a=o+1}switch(i){case-1:s=l-1;break;case 1:l=s+1}for(var u=_.clamp(o,-n.border,n.dim+n.border),c=_.clamp(a,-n.border,n.dim+n.border),h=_.clamp(s,-n.border,n.dim+n.border),p=_.clamp(l,-n.border,n.dim+n.border),f=-e*n.dim,d=-i*n.dim,m=h;m<p;m++)for(var y=u;y<c;y++)n.set(y,m,r.get(y+f,m+d))},r("DEMData",o),e.exports={DEMData:o,Level:s}},{"../util/image":263,"../util/util":275,"../util/web_worker_transfer":278}],53:[function(t,e,i){"use strict";e.exports=8192},{}],54:[function(t,e,i){"use strict";function g(t,e){return e-t}t("@mapbox/point-geometry");var w=t("./load_geometry"),v=t("./extent"),x=t("../style-spec/feature_filter"),r=t("grid-index"),b=t("../util/dictionary_coder"),T=t("@mapbox/vector-tile"),S=t("pbf"),A=t("../util/vectortile_to_geojson"),M=t("../util/util").arraysIntersect,n=(t("../source/tile_id").OverscaledTileID,t("../util/web_worker_transfer").register),o=t("./array_types").FeatureIndexArray,a=function(t,e,i,n){this.tileID=t,this.overscaling=e,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=i||new r(v,16,0),this.featureIndexArray=n||new o};a.prototype.insert=function(t,e,i,n,r){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r);for(var a=0;a<e.length;a++){for(var s=e[a],l=[1/0,1/0,-1/0,-1/0],u=0;u<s.length;u++){var c=s[u];l[0]=Math.min(l[0],c.x),l[1]=Math.min(l[1],c.y),l[2]=Math.max(l[2],c.x),l[3]=Math.max(l[3],c.y)}this.grid.insert(o,l[0],l[1],l[2],l[3])}},a.prototype.query=function(t,e){this.vtLayers||(this.vtLayers=new T.VectorTile(new S(this.rawTileData)).layers,this.sourceLayerCoder=new b(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));for(var i={},n=t.params||{},r=v/t.tileSize/t.scale,o=x(n.filter),a=t.queryGeometry,s=t.additionalRadius*r,l=1/0,u=1/0,c=-1/0,h=-1/0,p=0;p<a.length;p++)for(var f=a[p],d=0;d<f.length;d++){var m=f[d];l=Math.min(l,m.x),u=Math.min(u,m.y),c=Math.max(c,m.x),h=Math.max(h,m.y)}var y=this.grid.query(l-s,u-s,c+s,h+s);y.sort(g),this.filterMatching(i,y,this.featureIndexArray,a,o,n.layers,e,t.bearing,r);var _=t.collisionIndex?t.collisionIndex.queryRenderedSymbols(a,this.tileID,v/t.tileSize,t.collisionBoxArray,t.sourceID,t.bucketInstanceIds):[];return _.sort(),this.filterMatching(i,_,t.collisionBoxArray,a,o,n.layers,e,t.bearing,r),i},a.prototype.filterMatching=function(t,e,i,n,r,o,a,s,l){for(var u,c=0;c<e.length;c++){var h=e[c];if(h!==u){u=h;var p=i.get(h),f=this.bucketLayerIDs[p.bucketIndex];if(!o||M(o,f)){var d=this.sourceLayerCoder.decode(p.sourceLayerIndex),m=this.vtLayers[d].feature(p.featureIndex);if(r({zoom:this.tileID.overscaledZ},m))for(var y=null,_=0;_<f.length;_++){var g=f[_];if(!(o&&o.indexOf(g)<0)){var v=a[g];if(v&&("symbol"===v.type||(y||(y=w(m)),v.queryIntersectsFeature(n,m,y,this.z,s,l)))){var x=new A(m,this.z,this.x,this.y);x.layer=v.serialize();var b=t[g];void 0===b&&(b=t[g]=[]),b.push({featureIndex:h,feature:x})}}}}}}},a.prototype.hasLayer=function(t){for(var e=0,i=this.bucketLayerIDs;e<i.length;e+=1)for(var n=0,r=i[e];n<r.length;n+=1){if(t===r[n])return!0}return!1},n("FeatureIndex",a,{omit:["rawTileData","sourceLayerCoder"]}),e.exports=a},{"../source/tile_id":114,"../style-spec/feature_filter":148,"../util/dictionary_coder":257,"../util/util":275,"../util/vectortile_to_geojson":276,"../util/web_worker_transfer":278,"./array_types":39,"./extent":53,"./load_geometry":56,"@mapbox/point-geometry":4,"@mapbox/vector-tile":8,"grid-index":24,pbf:30}],55:[function(t,e,i){"use strict";e.exports={LineIndexArray:t("./array_types").LineIndexArray,TriangleIndexArray:t("./array_types").TriangleIndexArray}},{"./array_types":39}],56:[function(t,e,i){"use strict";var n,s=t("../util/util"),l=t("./extent"),u=(n=16,{min:-1*Math.pow(2,n-1),max:Math.pow(2,n-1)-1});e.exports=function(t){for(var e=l/t.extent,i=t.loadGeometry(),n=0;n<i.length;n++)for(var r=i[n],o=0;o<r.length;o++){var a=r[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<u.min||a.x>u.max||a.y<u.min||a.y>u.max)&&s.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return i}},{"../util/util":275,"./extent":53}],57:[function(t,e,i){"use strict";var n=t("../util/struct_array").createLayout;e.exports=n([{name:"a_pos",type:"Int16",components:2}])},{"../util/struct_array":271}],58:[function(t,e,i){"use strict";function c(t){return[n(255*t.r,255*t.g),n(255*t.b,255*t.a)]}var n=t("../shaders/encode_attribute").packUint8ToFloat,r=(t("../style-spec/util/color"),t("../util/web_worker_transfer").register),p=t("../style/properties").PossiblyEvaluatedPropertyValue,o=t("./array_types"),a=o.StructArrayLayout1f4,s=o.StructArrayLayout2f8,l=o.StructArrayLayout4f16,f=function(t,e,i){this.value=t,this.name=e,this.type=i,this.statistics={max:-1/0}};f.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},f.prototype.populatePaintArray=function(){},f.prototype.upload=function(){},f.prototype.destroy=function(){},f.prototype.setUniforms=function(t,e,i,n){var r=n.constantOr(this.value),o=t.gl;"color"===this.type?o.uniform4f(e.uniforms["u_"+this.name],r.r,r.g,r.b,r.a):o.uniform1f(e.uniforms["u_"+this.name],r)};var d=function(t,e,i){this.expression=t,this.name=e,this.type=i,this.statistics={max:-1/0};var n="color"===i?s:a;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===i?2:1,offset:0}],this.paintVertexArray=new n};d.prototype.defines=function(){return[]},d.prototype.populatePaintArray=function(t,e){var i=this.paintVertexArray,n=i.length;i.reserve(t);var r=this.expression.evaluate({zoom:0},e);if("color"===this.type)for(var o=c(r),a=n;a<t;a++)i.emplaceBack(o[0],o[1]);else{for(var s=n;s<t;s++)i.emplaceBack(r);this.statistics.max=Math.max(this.statistics.max,r)}},d.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},d.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},d.prototype.setUniforms=function(t,e){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],0)};var m=function(t,e,i,n,r){this.expression=t,this.name=e,this.type=i,this.useIntegerZoom=n,this.zoom=r,this.statistics={max:-1/0};var o="color"===i?l:s;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===i?4:2,offset:0}],this.paintVertexArray=new o};m.prototype.defines=function(){return[]},m.prototype.populatePaintArray=function(t,e){var i=this.paintVertexArray,n=i.length;i.reserve(t);var r=this.expression.evaluate({zoom:this.zoom},e),o=this.expression.evaluate({zoom:this.zoom+1},e);if("color"===this.type)for(var a=c(r),s=c(o),l=n;l<t;l++)i.emplaceBack(a[0],a[1],s[0],s[1]);else{for(var u=n;u<t;u++)i.emplaceBack(r,o);this.statistics.max=Math.max(this.statistics.max,r,o)}},m.prototype.upload=function(t){this.paintVertexArray&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},m.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},m.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},m.prototype.setUniforms=function(t,e,i){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],this.interpolationFactor(i.zoom))};var y=function(){this.binders={},this.cacheKey="",this._buffers=[]};y.createDynamic=function(t,e,i){var n,r,o=new y,a=[];for(var s in t.paint._values)if(i(s)){var l=t.paint.get(s);if(l instanceof p&&l.property.specification["property-function"]){var u=(n=s,r=t.type,{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth"}[n]||n.replace(r+"-","").replace(/-/g,"_")),c=l.property.specification.type,h=l.property.useIntegerZoom;"constant"===l.value.kind?(o.binders[s]=new f(l.value,u,c),a.push("/u_"+u)):"source"===l.value.kind?(o.binders[s]=new d(l.value,u,c),a.push("/a_"+u)):(o.binders[s]=new m(l.value,u,c,h,e),a.push("/z_"+u))}}return o.cacheKey=a.sort().join(""),o},y.prototype.populatePaintArrays=function(t,e){for(var i in this.binders)this.binders[i].populatePaintArray(t,e)},y.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},y.prototype.setUniforms=function(t,e,i,n){for(var r in this.binders)this.binders[r].setUniforms(t,e,n,i.get(r))},y.prototype.getPaintVertexBuffers=function(){return this._buffers},y.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var i=[];for(var n in this.binders){var r=this.binders[n];(r instanceof d||r instanceof m)&&r.paintVertexBuffer&&i.push(r.paintVertexBuffer)}this._buffers=i},y.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var u=function(t,e,i,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,o=e;r<o.length;r+=1){var a=o[r];this.programConfigurations[a.id]=y.createDynamic(a,i,n),this.programConfigurations[a.id].layoutAttributes=t}};u.prototype.populatePaintArrays=function(t,e){for(var i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e)},u.prototype.get=function(t){return this.programConfigurations[t]},u.prototype.upload=function(t){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t)},u.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},r("ConstantBinder",f),r("SourceExpressionBinder",d),r("CompositeExpressionBinder",m),r("ProgramConfiguration",y,{omit:["_buffers"]}),r("ProgramConfigurationSet",u),e.exports={ProgramConfiguration:y,ProgramConfigurationSet:u}},{"../shaders/encode_attribute":96,"../style-spec/util/color":153,"../style/properties":188,"../util/web_worker_transfer":278,"./array_types":39}],59:[function(t,e,i){"use strict";var n=t("../util/struct_array").createLayout;e.exports=n([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}])},{"../util/struct_array":271}],60:[function(t,r,e){"use strict";var o=t("../util/util").warnOnce,i=t("../util/web_worker_transfer").register,a=Math.pow(2,16)-1,n=function(t){void 0===t&&(t=[]),this.segments=t};n.prototype.prepareSegment=function(t,e,i){var n=this.segments[this.segments.length-1];return a<t&&o("Max vertices per segment is "+a+": bucket requested "+t),(!n||n.vertexLength+t>r.exports.MAX_VERTEX_ARRAY_LENGTH)&&(n={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},this.segments.push(n)),n},n.prototype.get=function(){return this.segments},n.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var i=e[t];for(var n in i.vaos)i.vaos[n].destroy()}},i("SegmentVector",n),r.exports={SegmentVector:n,MAX_VERTEX_ARRAY_LENGTH:a}},{"../util/util":275,"../util/web_worker_transfer":278}],61:[function(t,e,i){"use strict";var n=function(t,e,i){this.column=t,this.row=e,this.zoom=i};n.prototype.clone=function(){return new n(this.column,this.row,this.zoom)},n.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},n.prototype.sub=function(t){return this.clone()._sub(t)},n.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},n.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this},e.exports=n},{}],62:[function(n,t,e){"use strict";var i=n("../util/util").wrap,r=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};r.prototype.wrap=function(){return new r(i(this.lng,-180,180),this.lat)},r.prototype.toArray=function(){return[this.lng,this.lat]},r.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},r.prototype.toBounds=function(t){var e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new(n("./lng_lat_bounds"))(new r(this.lng-i,this.lat-e),new r(this.lng+i,this.lat+e))},r.convert=function(t){if(t instanceof r)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new r(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new r(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},t.exports=r},{"../util/util":275,"./lng_lat_bounds":63}],63:[function(t,e,i){"use strict";var o=t("./lng_lat"),a=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};a.prototype.setNorthEast=function(t){return this._ne=t instanceof o?new o(t.lng,t.lat):o.convert(t),this},a.prototype.setSouthWest=function(t){return this._sw=t instanceof o?new o(t.lng,t.lat):o.convert(t),this},a.prototype.extend=function(t){var e,i,n=this._sw,r=this._ne;if(t instanceof o)i=e=t;else{if(!(t instanceof a))return Array.isArray(t)?t.every(Array.isArray)?this.extend(a.convert(t)):this.extend(o.convert(t)):this;if(e=t._sw,i=t._ne,!e||!i)return this}return n||r?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new o(e.lng,e.lat),this._ne=new o(i.lng,i.lat)),this},a.prototype.getCenter=function(){return new o((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},a.prototype.getSouthWest=function(){return this._sw},a.prototype.getNorthEast=function(){return this._ne},a.prototype.getNorthWest=function(){return new o(this.getWest(),this.getNorth())},a.prototype.getSouthEast=function(){return new o(this.getEast(),this.getSouth())},a.prototype.getWest=function(){return this._sw.lng},a.prototype.getSouth=function(){return this._sw.lat},a.prototype.getEast=function(){return this._ne.lng},a.prototype.getNorth=function(){return this._ne.lat},a.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},a.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},a.prototype.isEmpty=function(){return!(this._sw&&this._ne)},a.convert=function(t){return!t||t instanceof a?t:new a(t)},e.exports=a},{"./lng_lat":62}],64:[function(t,e,i){"use strict";var n=t("./lng_lat"),_=t("@mapbox/point-geometry"),h=t("./coordinate"),r=t("../util/util"),p=t("../style-spec/util/interpolate").number,a=t("../util/tile_cover"),o=t("../source/tile_id"),s=(o.CanonicalTileID,o.UnwrappedTileID),l=t("../data/extent"),u=t("@mapbox/gl-matrix"),f=u.vec4,m=u.mat4,c=u.mat2,d=function(t,e,i){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new n(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},y={minZoom:{},maxZoom:{},renderWorldCopies:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};d.prototype.clone=function(){var t=new d(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},y.minZoom.get=function(){return this._minZoom},y.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},y.maxZoom.get=function(){return this._maxZoom},y.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},y.renderWorldCopies.get=function(){return this._renderWorldCopies},y.worldSize.get=function(){return this.tileSize*this.scale},y.centerPoint.get=function(){return this.size._div(2)},y.size.get=function(){return new _(this.width,this.height)},y.bearing.get=function(){return-this.angle/Math.PI*180},y.bearing.set=function(t){var e=-r.wrap(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=c.create(),c.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},y.pitch.get=function(){return this._pitch/Math.PI*180},y.pitch.set=function(t){var e=r.clamp(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},y.fov.get=function(){return this._fov/Math.PI*180},y.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},y.zoom.get=function(){return this._zoom},y.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},y.center.get=function(){return this._center},y.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},d.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},d.prototype.getVisibleUnwrappedCoordinates=function(t){var e=this.pointCoordinate(new _(0,0),0),i=this.pointCoordinate(new _(this.width,0),0),n=Math.floor(e.column),r=Math.floor(i.column),o=[new s(0,t)];if(this._renderWorldCopies)for(var a=n;a<=r;a++)0!==a&&o.push(new s(a,t));return o},d.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),i=e;if(void 0!==t.minzoom&&e<t.minzoom)return[];void 0!==t.maxzoom&&e>t.maxzoom&&(e=t.maxzoom);var n=this.pointCoordinate(this.centerPoint,e),r=new _(n.column-.5,n.row-.5),o=[this.pointCoordinate(new _(0,0),e),this.pointCoordinate(new _(this.width,0),e),this.pointCoordinate(new _(this.width,this.height),e),this.pointCoordinate(new _(0,this.height),e)];return a(e,o,t.reparseOverscaled?i:e,this._renderWorldCopies).sort(function(t,e){return r.dist(t.canonical)-r.dist(e.canonical)})},d.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},y.unmodified.get=function(){return this._unmodified},d.prototype.zoomScale=function(t){return Math.pow(2,t)},d.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},d.prototype.project=function(t){return new _(this.lngX(t.lng),this.latY(t.lat))},d.prototype.unproject=function(t){return new n(this.xLng(t.x),this.yLat(t.y))},y.x.get=function(){return this.lngX(this.center.lng)},y.y.get=function(){return this.latY(this.center.lat)},y.point.get=function(){return new _(this.x,this.y)},d.prototype.lngX=function(t){return(180+t)*this.worldSize/360},d.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},d.prototype.xLng=function(t){return 360*t/this.worldSize-180},d.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},d.prototype.setLocationAtPoint=function(t,e){var i=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(i)),this._renderWorldCopies&&(this.center=this.center.wrap())},d.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},d.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},d.prototype.locationCoordinate=function(t){return new h(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},d.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new n(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},d.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];f.transformMat4(i,i,this.pixelMatrixInverse),f.transformMat4(n,n,this.pixelMatrixInverse);var r=i[3],o=n[3],a=i[1]/r,s=n[1]/o,l=i[2]/r,u=n[2]/o,c=l===u?0:(0-l)/(u-l);return new h(p(i[0]/r,n[0]/o,c)/this.tileSize,p(a,s,c)/this.tileSize,this.zoom)._zoomTo(e)},d.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),i=[e.column*this.tileSize,e.row*this.tileSize,0,1];return f.transformMat4(i,i,this.pixelMatrix),new _(i[0]/i[3],i[1]/i[3])},d.prototype.calculatePosMatrix=function(t,e){void 0===e&&(e=!1);var i=t.key,n=e?this._alignedPosMatrixCache:this._posMatrixCache;if(n[i])return n[i];var r=t.canonical,o=this.worldSize/this.zoomScale(r.z),a=r.x+Math.pow(2,r.z)*t.wrap,s=m.identity(new Float64Array(16));return m.translate(s,s,[a*o,r.y*o,0]),m.scale(s,s,[o/l,o/l,1]),m.multiply(s,e?this.alignedProjMatrix:this.projMatrix,s),n[i]=new Float32Array(s),n[i]},d.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,i,n,r=-90,o=90,a=-180,s=180,l=this.size,u=this._unmodified;if(this.latRange){var c=this.latRange;r=this.latY(c[1]),t=(o=this.latY(c[0]))-r<l.y?l.y/(o-r):0}if(this.lngRange){var h=this.lngRange;a=this.lngX(h[0]),e=(s=this.lngX(h[1]))-a<l.x?l.x/(s-a):0}var p=Math.max(e||0,t||0);if(p)return this.center=this.unproject(new _(e?(s+a)/2:this.x,t?(o+r)/2:this.y)),this.zoom+=this.scaleZoom(p),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var f=this.y,d=l.y/2;f-d<r&&(n=r+d),o<f+d&&(n=o-d)}if(this.lngRange){var m=this.x,y=l.x/2;m-y<a&&(i=a+y),s<m+y&&(i=s-y)}void 0===i&&void 0===n||(this.center=this.unproject(new _(void 0!==i?i:this.x,void 0!==n?n:this.y))),this._unmodified=u,this._constraining=!1}},d.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,i=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),n=this.x,r=this.y,o=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),a=new Float64Array(16);m.perspective(a,this._fov,this.width/this.height,1,o),m.scale(a,a,[1,-1,1]),m.translate(a,a,[0,0,-this.cameraToCenterDistance]),m.rotateX(a,a,this._pitch),m.rotateZ(a,a,this.angle),m.translate(a,a,[-n,-r,0]);var s=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));m.scale(a,a,[1,1,s,1]),this.projMatrix=a;var l=this.width%2/2,u=this.height%2/2,c=Math.cos(this.angle),h=Math.sin(this.angle),p=n-Math.round(n)+c*l+h*u,f=r-Math.round(r)+c*u+h*l,d=new Float64Array(a);if(m.translate(d,d,[.5<p?p-1:p,.5<f?f-1:f,0]),this.alignedProjMatrix=d,a=m.create(),m.scale(a,a,[this.width/2,-this.height/2,1]),m.translate(a,a,[1,-1,0]),this.pixelMatrix=m.multiply(new Float64Array(16),a,this.projMatrix),!(a=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Object.defineProperties(d.prototype,y),e.exports=d},{"../data/extent":53,"../source/tile_id":114,"../style-spec/util/interpolate":158,"../util/tile_cover":273,"../util/util":275,"./coordinate":61,"./lng_lat":62,"@mapbox/gl-matrix":2,"@mapbox/point-geometry":4}],65:[function(t,e,i){"use strict";var n=t("../style-spec/util/color"),r=function(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i};r.disabled=new r(r.Replace=[1,0],n.transparent,[!1,!1,!1,!1]),r.unblended=new r(r.Replace,n.transparent,[!0,!0,!0,!0]),r.alphaBlended=new r([1,771],n.transparent,[!0,!0,!0,!0]),e.exports=r},{"../style-spec/util/color":153}],66:[function(t,e,i){"use strict";var n=t("./index_buffer"),r=t("./vertex_buffer"),o=t("./framebuffer"),a=(t("./depth_mode"),t("./stencil_mode"),t("./color_mode")),s=t("../util/util"),l=t("./value"),u=l.ClearColor,c=l.ClearDepth,h=l.ClearStencil,p=l.ColorMask,f=l.DepthMask,d=l.StencilMask,m=l.StencilFunc,y=l.StencilOp,_=l.StencilTest,g=l.DepthRange,v=l.DepthTest,x=l.DepthFunc,b=l.Blend,w=l.BlendFunc,T=l.BlendColor,S=l.Program,A=l.LineWidth,M=l.ActiveTextureUnit,E=l.Viewport,L=l.BindFramebuffer,z=l.BindRenderbuffer,P=l.BindTexture,C=l.BindVertexBuffer,I=l.BindElementBuffer,k=l.BindVertexArrayOES,R=l.PixelStoreUnpack,D=l.PixelStoreUnpackPremultiplyAlpha,B=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.clearColor=new u(this),this.clearDepth=new c(this),this.clearStencil=new h(this),this.colorMask=new p(this),this.depthMask=new f(this),this.stencilMask=new d(this),this.stencilFunc=new m(this),this.stencilOp=new y(this),this.stencilTest=new _(this),this.depthRange=new g(this),this.depthTest=new v(this),this.depthFunc=new x(this),this.blend=new b(this),this.blendFunc=new w(this),this.blendColor=new T(this),this.program=new S(this),this.lineWidth=new A(this),this.activeTexture=new M(this),this.viewport=new E(this),this.bindFramebuffer=new L(this),this.bindRenderbuffer=new z(this),this.bindTexture=new P(this),this.bindVertexBuffer=new C(this),this.bindElementBuffer=new I(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new k(this),this.pixelStoreUnpack=new R(this),this.pixelStoreUnpackPremultiplyAlpha=new D(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};B.prototype.createIndexBuffer=function(t,e){return new n(this,t,e)},B.prototype.createVertexBuffer=function(t,e,i){return new r(this,t,e,i)},B.prototype.createRenderbuffer=function(t,e,i){var n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r},B.prototype.createFramebuffer=function(t,e){return new o(this,t,e)},B.prototype.clear=function(t){var e=t.color,i=t.depth,n=this.gl,r=0;e&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(r|=n.DEPTH_BUFFER_BIT,this.clearDepth.set(i),this.depthMask.set(!0)),n.clear(r)},B.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},B.prototype.setStencilMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},B.prototype.setColorMode=function(t){s.deepEqual(t.blendFunction,a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)},e.exports=B},{"../util/util":275,"./color_mode":65,"./depth_mode":67,"./framebuffer":68,"./index_buffer":69,"./stencil_mode":70,"./value":71,"./vertex_buffer":72}],67:[function(t,e,i){"use strict";var n=function(t,e,i){this.func=t,this.mask=e,this.range=i};n.ReadOnly=!1,n.ReadWrite=!0,n.disabled=new n(519,n.ReadOnly,[0,1]),e.exports=n},{}],68:[function(t,e,i){"use strict";var n=t("./value"),o=n.ColorAttachment,a=n.DepthAttachment,r=function(t,e,i){this.context=t,this.width=e,this.height=i;var n=t.gl,r=this.framebuffer=n.createFramebuffer();this.colorAttachment=new o(t,r),this.depthAttachment=new a(t,r)};r.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i),t.deleteFramebuffer(this.framebuffer)},e.exports=r},{"./value":71}],69:[function(t,e,i){"use strict";var n=function(t,e,i){var n=(this.context=t).gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};n.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null)},n.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},n.prototype.updateData=function(t){var e=this.context.gl;this.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},n.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)},e.exports=n},{}],70:[function(t,e,i){"use strict";var n=function(t,e,i,n,r,o){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o};n.disabled=new n({func:519,mask:0},0,0,7680,7680,7680),e.exports=n},{}],71:[function(t,e,i){"use strict";var n=t("../style-spec/util/color"),r=t("../util/util"),o=function(t){this.context=t,this.current=n.transparent};o.prototype.get=function(){return this.current},o.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t)};var a=function(t){this.context=t,this.current=1};a.prototype.get=function(){return this.current},a.prototype.set=function(t){this.current!==t&&(this.context.gl.clearDepth(t),this.current=t)};var s=function(t){this.context=t,this.current=0};s.prototype.get=function(){return this.current},s.prototype.set=function(t){this.current!==t&&(this.context.gl.clearStencil(t),this.current=t)};var l=function(t){this.context=t,this.current=[!0,!0,!0,!0]};l.prototype.get=function(){return this.current},l.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t)};var u=function(t){this.context=t,this.current=!0};u.prototype.get=function(){return this.current},u.prototype.set=function(t){this.current!==t&&(this.context.gl.depthMask(t),this.current=t)};var c=function(t){this.context=t,this.current=255};c.prototype.get=function(){return this.current},c.prototype.set=function(t){this.current!==t&&(this.context.gl.stencilMask(t),this.current=t)};var h=function(t){this.context=t,this.current={func:t.gl.ALWAYS,ref:0,mask:255}};h.prototype.get=function(){return this.current},h.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask||(this.context.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t)};var p=function(t){this.context=t;var e=this.context.gl;this.current=[e.KEEP,e.KEEP,e.KEEP]};p.prototype.get=function(){return this.current},p.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(this.context.gl.stencilOp(t[0],t[1],t[2]),this.current=t)};var f=function(t){this.context=t,this.current=!1};f.prototype.get=function(){return this.current},f.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t}};var d=function(t){this.context=t,this.current=[0,1]};d.prototype.get=function(){return this.current},d.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.depthRange(t[0],t[1]),this.current=t)};var m=function(t){this.context=t,this.current=!1};m.prototype.get=function(){return this.current},m.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t}};var y=function(t){this.context=t,this.current=t.gl.LESS};y.prototype.get=function(){return this.current},y.prototype.set=function(t){this.current!==t&&(this.context.gl.depthFunc(t),this.current=t)};var _=function(t){this.context=t,this.current=!1};_.prototype.get=function(){return this.current},_.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t}};var g=function(t){this.context=t;var e=this.context.gl;this.current=[e.ONE,e.ZERO]};g.prototype.get=function(){return this.current},g.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.blendFunc(t[0],t[1]),this.current=t)};var v=function(t){this.context=t,this.current=n.transparent};v.prototype.get=function(){return this.current},v.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t)};var x=function(t){this.context=t,this.current=null};x.prototype.get=function(){return this.current},x.prototype.set=function(t){this.current!==t&&(this.context.gl.useProgram(t),this.current=t)};var b=function(t){this.context=t,this.current=1};b.prototype.get=function(){return this.current},b.prototype.set=function(t){var e=this.context.lineWidthRange,i=r.clamp(t,e[0],e[1]);this.current!==i&&(this.context.gl.lineWidth(i),this.current=t)};var w=function(t){this.context=t,this.current=t.gl.TEXTURE0};w.prototype.get=function(){return this.current},w.prototype.set=function(t){this.current!==t&&(this.context.gl.activeTexture(t),this.current=t)};var T=function(t){this.context=t;var e=this.context.gl;this.current=[0,0,e.drawingBufferWidth,e.drawingBufferHeight]};T.prototype.get=function(){return this.current},T.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t)};var S=function(t){this.context=t,this.current=null};S.prototype.get=function(){return this.current},S.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t}};var A=function(t){this.context=t,this.current=null};A.prototype.get=function(){return this.current},A.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t}};var M=function(t){this.context=t,this.current=null};M.prototype.get=function(){return this.current},M.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t}};var E=function(t){this.context=t,this.current=null};E.prototype.get=function(){return this.current},E.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t}};var L=function(t){this.context=t,this.current=null};L.prototype.get=function(){return this.current},L.prototype.set=function(t){var e=this.context.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t};var z=function(t){this.context=t,this.current=null};z.prototype.get=function(){return this.current},z.prototype.set=function(t){this.current!==t&&this.context.extVertexArrayObject&&(this.context.extVertexArrayObject.bindVertexArrayOES(t),this.current=t)};var P=function(t){this.context=t,this.current=4};P.prototype.get=function(){return this.current},P.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t}};var C=function(t){this.context=t,this.current=!1};C.prototype.get=function(){return this.current},C.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t}};var I=function(t,e){this.context=t,this.current=null,this.parent=e};I.prototype.get=function(){return this.current};var k=function(i){function t(t,e){i.call(this,t,e),this.dirty=!1}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.set=function(t){if(this.dirty||this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},t.prototype.setDirty=function(){this.dirty=!0},t}(I),R=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.set=function(t){if(this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t}},e}(I);e.exports={ClearColor:o,ClearDepth:a,ClearStencil:s,ColorMask:l,DepthMask:u,StencilMask:c,StencilFunc:h,StencilOp:p,StencilTest:f,DepthRange:d,DepthTest:m,DepthFunc:y,Blend:_,BlendFunc:g,BlendColor:v,Program:x,LineWidth:b,ActiveTextureUnit:w,Viewport:T,BindFramebuffer:S,BindRenderbuffer:A,BindTexture:M,BindVertexBuffer:E,BindElementBuffer:L,BindVertexArrayOES:z,PixelStoreUnpack:P,PixelStoreUnpackPremultiplyAlpha:C,ColorAttachment:k,DepthAttachment:R}},{"../style-spec/util/color":153,"../util/util":275}],72:[function(t,e,i){"use strict";var a={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},n=function(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n;var r=(this.context=t).gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};n.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},n.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},n.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var n=this.attributes[i],r=e.attributes[n.name];void 0!==r&&t.enableVertexAttribArray(r)}},n.prototype.setVertexAttribPointers=function(t,e,i){for(var n=0;n<this.attributes.length;n++){var r=this.attributes[n],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[a[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}},n.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)},e.exports=n},{}],73:[function(t,e,i){"use strict";var n=t("@mapbox/mapbox-gl-supported"),r=t("./util/browser"),o=t("../package.json").version,a=t("./ui/map"),s=t("./ui/control/navigation_control"),l=t("./ui/control/geolocate_control"),u=t("./ui/control/attribution_control"),c=t("./ui/control/scale_control"),h=t("./ui/control/fullscreen_control"),p=t("./ui/popup"),f=t("./ui/marker"),d=t("./style/style"),m=t("./geo/lng_lat"),y=t("./geo/lng_lat_bounds"),_=t("@mapbox/point-geometry"),g=t("./util/evented"),v=t("./util/config"),x=t("./source/rtl_text_plugin");e.exports={version:o,supported:n,workerCount:Math.max(Math.floor(r.hardwareConcurrency/2),1),setRTLTextPlugin:x.setRTLTextPlugin,Map:a,NavigationControl:s,GeolocateControl:l,AttributionControl:u,ScaleControl:c,FullscreenControl:h,Popup:p,Marker:f,Style:d,LngLat:m,LngLatBounds:y,Point:_,Evented:g,config:v,get accessToken(){return v.ACCESS_TOKEN},set accessToken(t){v.ACCESS_TOKEN=t}}},{"../package.json":38,"./geo/lng_lat":62,"./geo/lng_lat_bounds":63,"./source/rtl_text_plugin":109,"./style/style":190,"./ui/control/attribution_control":232,"./ui/control/fullscreen_control":233,"./ui/control/geolocate_control":234,"./ui/control/navigation_control":236,"./ui/control/scale_control":237,"./ui/map":247,"./ui/marker":248,"./ui/popup":249,"./util/browser":252,"./util/config":256,"./util/evented":260,"@mapbox/mapbox-gl-supported":3,"@mapbox/point-geometry":4}],74:[function(t,e,i){"use strict";var m=t("./pattern"),y=t("../gl/stencil_mode"),_=t("../gl/depth_mode");e.exports=function(t,e,i){var n=i.paint.get("background-color"),r=i.paint.get("background-opacity");if(0!==r){var o=t.context,a=o.gl,s=t.transform,l=s.tileSize,u=i.paint.get("background-pattern"),c=u||1!==n.a||1!==r?"translucent":"opaque";if(t.renderPass===c){var h;if(o.setStencilMode(y.disabled),o.setDepthMode(t.depthModeForSublayer(0,"opaque"===c?_.ReadWrite:_.ReadOnly)),o.setColorMode(t.colorModeForRenderPass()),u){if(m.isPatternMissing(u,t))return;h=t.useProgram("backgroundPattern"),m.prepare(u,t,h),t.tileExtentPatternVAO.bind(o,h,t.tileExtentBuffer,[])}else h=t.useProgram("background"),a.uniform4fv(h.uniforms.u_color,[n.r,n.g,n.b,n.a]),t.tileExtentVAO.bind(o,h,t.tileExtentBuffer,[]);a.uniform1f(h.uniforms.u_opacity,r);for(var p=0,f=s.coveringTiles({tileSize:l});p<f.length;p+=1){var d=f[p];u&&m.setTile({tileID:d,tileSize:l},t,h),a.uniformMatrix4fv(h.uniforms.u_matrix,!1,t.transform.calculatePosMatrix(d.toUnwrapped())),a.drawArrays(a.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}}},{"../gl/depth_mode":67,"../gl/stencil_mode":70,"./pattern":91}],75:[function(t,e,i){"use strict";var g=t("../source/pixels_to_tile_units"),v=t("../gl/stencil_mode"),x=t("../gl/depth_mode");e.exports=function(t,e,i,n){if("translucent"===t.renderPass){var r=i.paint.get("circle-opacity"),o=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity");if(0!==r.constantOr(1)||0!==o.constantOr(1)&&0!==a.constantOr(1)){var s=t.context,l=s.gl;s.setDepthMode(t.depthModeForSublayer(0,x.ReadOnly)),s.setStencilMode(v.disabled),s.setColorMode(t.colorModeForRenderPass());for(var u=!0,c=0;c<n.length;c++){var h=n[c],p=e.getTile(h),f=p.getBucket(i);if(f){var d=t.context.program.get(),m=f.programConfigurations.get(i.id),y=t.useProgram("circle",m);if((u||y.program!==d)&&(m.setUniforms(s,y,i.paint,{zoom:t.transform.zoom}),u=!1),l.uniform1f(y.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance),l.uniform1i(y.uniforms.u_scale_with_map,"map"===i.paint.get("circle-pitch-scale")?1:0),"map"===i.paint.get("circle-pitch-alignment")){l.uniform1i(y.uniforms.u_pitch_with_map,1);var _=g(p,1,t.transform.zoom);l.uniform2f(y.uniforms.u_extrude_scale,_,_)}else l.uniform1i(y.uniforms.u_pitch_with_map,0),l.uniform2fv(y.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits);l.uniformMatrix4fv(y.uniforms.u_matrix,!1,t.translatePosMatrix(h.posMatrix,p,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor"))),y.draw(s,l.TRIANGLES,i.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,m)}}}}}},{"../gl/depth_mode":67,"../gl/stencil_mode":70,"../source/pixels_to_tile_units":104}],76:[function(t,e,i){"use strict";function r(t,e,i,n,r){var o=t.context,a=o.gl,s=r?t.useProgram("collisionCircle"):t.useProgram("collisionBox");o.setDepthMode(y.disabled),o.setStencilMode(_.disabled),o.setColorMode(t.colorModeForRenderPass());for(var l=0;l<n.length;l++){var u=n[l],c=e.getTile(u),h=c.getBucket(i);if(h){var p=r?h.collisionCircle:h.collisionBox;if(p){a.uniformMatrix4fv(s.uniforms.u_matrix,!1,u.posMatrix),r||o.lineWidth.set(1),a.uniform1f(s.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance);var f=m(c,1,t.transform.zoom),d=Math.pow(2,t.transform.zoom-c.tileID.overscaledZ);a.uniform1f(s.uniforms.u_pixels_to_tile_units,f),a.uniform2f(s.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits[0]/(f*d),t.transform.pixelsToGLUnits[1]/(f*d)),s.draw(o,r?a.TRIANGLES:a.LINES,i.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,null,p.collisionVertexBuffer,null)}}}}var m=t("../source/pixels_to_tile_units"),y=t("../gl/depth_mode"),_=t("../gl/stencil_mode");e.exports=function(t,e,i,n){r(t,e,i,n,!1),r(t,e,i,n,!0)}},{"../gl/depth_mode":67,"../gl/stencil_mode":70,"../source/pixels_to_tile_units":104}],77:[function(t,e,i){"use strict";function r(t,e,i){var n=t.context,r=n.gl;n.lineWidth.set(1*y.devicePixelRatio);var o=i.posMatrix,a=t.useProgram("debug");n.setDepthMode(w.disabled),n.setStencilMode(T.disabled),n.setColorMode(t.colorModeForRenderPass()),r.uniformMatrix4fv(a.uniforms.u_matrix,!1,o),r.uniform4f(a.uniforms.u_color,1,0,0,1),t.debugVAO.bind(n,a,t.debugBuffer,[]),r.drawArrays(r.LINE_STRIP,0,t.debugBuffer.length);for(var s=function(t,e,i,n){n=n||1;var r,o,a,s,l,u,c,h,p=[];for(r=0,o=t.length;r<o;r++)if(l=S[t[r]]){for(h=null,a=0,s=l[1].length;a<s;a+=2)h=-1===l[1][a]&&-1===l[1][a+1]?null:(u=e+l[1][a]*n,c=i-l[1][a+1]*n,h&&p.push(h.x,h.y,u,c),{x:u,y:c});e+=l[0]*n}return p}(i.toString(),50,200,5),l=new x,u=0;u<s.length;u+=2)l.emplaceBack(s[u],s[u+1]);var c=n.createVertexBuffer(l,b.members);(new v).bind(n,a,c,[]),r.uniform4f(a.uniforms.u_color,1,1,1,1);for(var h=e.getTile(i).tileSize,p=g/(Math.pow(2,t.transform.zoom-i.overscaledZ)*h),f=[[-1,-1],[-1,1],[1,-1],[1,1]],d=0;d<f.length;d++){var m=f[d];r.uniformMatrix4fv(a.uniforms.u_matrix,!1,_.translate([],o,[p*m[0],p*m[1],0])),r.drawArrays(r.LINES,0,c.length)}r.uniform4f(a.uniforms.u_color,0,0,0,1),r.uniformMatrix4fv(a.uniforms.u_matrix,!1,o),r.drawArrays(r.LINES,0,c.length)}var y=t("../util/browser"),_=t("@mapbox/gl-matrix").mat4,g=t("../data/extent"),v=t("./vertex_array_object"),x=t("../data/array_types").PosArray,b=t("../data/pos_attributes"),w=t("../gl/depth_mode"),T=t("../gl/stencil_mode");e.exports=function(t,e,i){for(var n=0;n<i.length;n++)r(t,e,i[n])};var S={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]}},{"../data/array_types":39,"../data/extent":53,"../data/pos_attributes":57,"../gl/depth_mode":67,"../gl/stencil_mode":70,"../util/browser":252,"./vertex_array_object":95,"@mapbox/gl-matrix":2}],78:[function(t,e,i){"use strict";function l(t,e,i,n,r){if(!p.isPatternMissing(i.paint.get("fill-pattern"),t))for(var o=!0,a=0,s=n;a<s.length;a+=1){var l=s[a],u=e.getTile(l),c=u.getBucket(i);c&&(t.context.setStencilMode(t.stencilModeForClipping(l)),r(t,e,i,u,l,c,o),o=!1)}}function u(t,e,i,n,r,o,a){var s=t.context.gl,l=o.programConfigurations.get(i.id);h("fill",i.paint.get("fill-pattern"),t,l,i,n,r,a).draw(t.context,s.TRIANGLES,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,l)}function c(t,e,i,n,r,o,a){var s=t.context.gl,l=o.programConfigurations.get(i.id),u=h("fillOutline",i.getPaintProperty("fill-outline-color")?null:i.paint.get("fill-pattern"),t,l,i,n,r,a);s.uniform2f(u.uniforms.u_world,s.drawingBufferWidth,s.drawingBufferHeight),u.draw(t.context,s.LINES,i.id,o.layoutVertexBuffer,o.indexBuffer2,o.segments2,l)}function h(t,e,i,n,r,o,a,s){var l,u=i.context.program.get();return e?(l=i.useProgram(t+"Pattern",n),(s||l.program!==u)&&(n.setUniforms(i.context,l,r.paint,{zoom:i.transform.zoom}),p.prepare(e,i,l)),p.setTile(o,i,l)):(l=i.useProgram(t,n),(s||l.program!==u)&&n.setUniforms(i.context,l,r.paint,{zoom:i.transform.zoom})),i.context.gl.uniformMatrix4fv(l.uniforms.u_matrix,!1,i.translatePosMatrix(a.posMatrix,o,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"))),l}var p=t("./pattern"),f=t("../style-spec/util/color"),d=t("../gl/depth_mode");e.exports=function(t,e,i,n){var r=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0!==o.constantOr(1)){var a=t.context;a.setColorMode(t.colorModeForRenderPass());var s=i.paint.get("fill-pattern")||1!==r.constantOr(f.transparent).a||1!==o.constantOr(0)?"translucent":"opaque";t.renderPass===s&&(a.setDepthMode(t.depthModeForSublayer(1,"opaque"===t.renderPass?d.ReadWrite:d.ReadOnly)),l(t,e,i,n,u)),"translucent"===t.renderPass&&i.paint.get("fill-antialias")&&(a.lineWidth.set(2),a.setDepthMode(t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,d.ReadOnly)),l(t,e,i,n,c))}}},{"../gl/depth_mode":67,"../style-spec/util/color":153,"./pattern":91}],79:[function(t,e,i){"use strict";function c(t,e,i,n,r,o,a){var s=t.context,l=s.gl,u=i.paint.get("fill-extrusion-pattern"),c=t.context.program.get(),h=o.programConfigurations.get(i.id),p=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",h);if((a||p.program!==c)&&h.setUniforms(s,p,i.paint,{zoom:t.transform.zoom}),u){if(f.isPatternMissing(u,t))return;f.prepare(u,t,p),f.setTile(n,t,p),l.uniform1f(p.uniforms.u_height_factor,-Math.pow(2,r.overscaledZ)/n.tileSize/8)}t.context.gl.uniformMatrix4fv(p.uniforms.u_matrix,!1,t.translatePosMatrix(r.posMatrix,n,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor"))),function(t,e){var i=e.context.gl,n=e.style.light,r=n.properties.get("position"),o=[r.x,r.y,r.z],a=m.create();"viewport"===n.properties.get("anchor")&&m.fromRotation(a,-e.transform.angle),_.transformMat3(o,o,a);var s=n.properties.get("color");i.uniform3fv(t.uniforms.u_lightpos,o),i.uniform1f(t.uniforms.u_lightintensity,n.properties.get("intensity")),i.uniform3f(t.uniforms.u_lightcolor,s.r,s.g,s.b)}(p,t),p.draw(s,l.TRIANGLES,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,h)}var n=t("@mapbox/gl-matrix"),f=t("./pattern"),h=t("./texture"),p=t("../style-spec/util/color"),d=t("../gl/depth_mode"),m=n.mat3,y=n.mat4,_=n.vec3,g=t("../gl/stencil_mode");e.exports=function(t,e,i,n){if(0!==i.paint.get("fill-extrusion-opacity"))if("offscreen"===t.renderPass){!function(t,e){var i=t.context,n=i.gl,r=e.viewportFrame;if(t.depthRboNeedsClear&&t.setupOffscreenDepthRenderbuffer(),!r){var o=new h(i,{width:t.width,height:t.height,data:null},n.RGBA);o.bind(n.LINEAR,n.CLAMP_TO_EDGE),(r=e.viewportFrame=i.createFramebuffer(t.width,t.height)).colorAttachment.set(o.texture)}i.bindFramebuffer.set(r.framebuffer),r.depthAttachment.set(t.depthRbo),t.depthRboNeedsClear&&(i.clear({depth:1}),t.depthRboNeedsClear=!1),i.clear({color:p.transparent}),i.setStencilMode(g.disabled),i.setDepthMode(new d(n.LEQUAL,d.ReadWrite,[0,1])),i.setColorMode(t.colorModeForRenderPass())}(t,i);for(var r=!0,o=0,a=n;o<a.length;o+=1){var s=a[o],l=e.getTile(s),u=l.getBucket(i);u&&(c(t,0,i,l,s,u,r),r=!1)}}else"translucent"===t.renderPass&&function(t,e){var i=e.viewportFrame;if(i){var n=t.context,r=n.gl,o=t.useProgram("extrusionTexture");n.setStencilMode(g.disabled),n.setDepthMode(d.disabled),n.setColorMode(t.colorModeForRenderPass()),n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),r.uniform1f(o.uniforms.u_opacity,e.paint.get("fill-extrusion-opacity")),r.uniform1i(o.uniforms.u_image,0);var a=y.create();y.ortho(a,0,t.width,t.height,0,0,1),r.uniformMatrix4fv(o.uniforms.u_matrix,!1,a),r.uniform2f(o.uniforms.u_world,r.drawingBufferWidth,r.drawingBufferHeight),t.viewportVAO.bind(n,o,t.viewportBuffer,[]),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}(t,i)}},{"../gl/depth_mode":67,"../gl/stencil_mode":70,"../style-spec/util/color":153,"./pattern":91,"./texture":93,"@mapbox/gl-matrix":2}],80:[function(t,e,i){"use strict";var m=t("@mapbox/gl-matrix").mat4,y=t("./texture"),_=t("../source/pixels_to_tile_units"),g=t("../style-spec/util/color"),v=t("../gl/depth_mode"),x=t("../gl/stencil_mode"),b=t("../gl/color_mode");e.exports=function(t,e,i,n){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var r=t.context,o=r.gl;r.setDepthMode(t.depthModeForSublayer(0,v.ReadOnly)),r.setStencilMode(x.disabled),function(t,e,i){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=i.heatmapFbo;if(r)n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),r=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,i,n,r){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,i.width/4,i.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),r.colorAttachment.set(n),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,r.colorAttachment.setDirty(),t(e,i,n,r))}(t,e,o,r)}}(r,t,i),r.clear({color:g.transparent}),r.setColorMode(new b([o.ONE,o.ONE],g.transparent,[!0,!0,!0,!0]));for(var a=!0,s=0;s<n.length;s++){var l=n[s];if(!e.hasRenderableParent(l)){var u=e.getTile(l),c=u.getBucket(i);if(c){var h=t.context.program.get(),p=c.programConfigurations.get(i.id),f=t.useProgram("heatmap",p),d=t.transform.zoom;(a||f.program!==h)&&(p.setUniforms(t.context,f,i.paint,{zoom:d}),a=!1),o.uniform1f(f.uniforms.u_extrude_scale,_(u,1,d)),o.uniform1f(f.uniforms.u_intensity,i.paint.get("heatmap-intensity")),o.uniformMatrix4fv(f.uniforms.u_matrix,!1,l.posMatrix),f.draw(r,o.TRIANGLES,i.id,c.layoutVertexBuffer,c.indexBuffer,c.segments,p)}}}r.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,e){var i=t.context,n=i.gl,r=e.heatmapFbo;if(r){i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),i.activeTexture.set(n.TEXTURE1);var o=e.colorRampTexture;o||(o=e.colorRampTexture=new y(i,e.colorRamp,n.RGBA)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),i.setDepthMode(v.disabled);var a=t.useProgram("heatmapTexture"),s=e.paint.get("heatmap-opacity");n.uniform1f(a.uniforms.u_opacity,s),n.uniform1i(a.uniforms.u_image,0),n.uniform1i(a.uniforms.u_color_ramp,1);var l=m.create();m.ortho(l,0,t.width,t.height,0,0,1),n.uniformMatrix4fv(a.uniforms.u_matrix,!1,l),n.uniform2f(a.uniforms.u_world,n.drawingBufferWidth,n.drawingBufferHeight),t.viewportVAO.bind(t.context,a,t.viewportBuffer,[]),n.drawArrays(n.TRIANGLE_STRIP,0,4)}}(t,i))}},{"../gl/color_mode":65,"../gl/depth_mode":67,"../gl/stencil_mode":70,"../source/pixels_to_tile_units":104,"../style-spec/util/color":153,"./texture":93,"@mapbox/gl-matrix":2}],81:[function(t,e,i){"use strict";function u(t,e,i){var n,r,o,a,s,l,u,c,h=t.context,p=h.gl,f=e.fbo;if(f){var d=t.useProgram("hillshade"),m=t.transform.calculatePosMatrix(e.tileID.toUnwrapped());s=d,l=t,c=(u=i).paint.get("hillshade-illumination-direction")*(Math.PI/180),"viewport"===u.paint.get("hillshade-illumination-anchor")&&(c-=l.transform.angle),l.context.gl.uniform2f(s.uniforms.u_light,u.paint.get("hillshade-exaggeration"),c);var y=(n=t,r=e.tileID,o=r.toCoordinate(),a=new b(o.column,o.row+1,o.zoom),[n.transform.coordinateLocation(o).lat,n.transform.coordinateLocation(a).lat]);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get()),p.uniformMatrix4fv(d.uniforms.u_matrix,!1,m),p.uniform2fv(d.uniforms.u_latrange,y),p.uniform1i(d.uniforms.u_image,0);var _=i.paint.get("hillshade-shadow-color");p.uniform4f(d.uniforms.u_shadow,_.r,_.g,_.b,_.a);var g=i.paint.get("hillshade-highlight-color");p.uniform4f(d.uniforms.u_highlight,g.r,g.g,g.b,g.a);var v=i.paint.get("hillshade-accent-color");if(p.uniform4f(d.uniforms.u_accent,v.r,v.g,v.b,v.a),e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments)d.draw(h,p.TRIANGLES,i.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments);else{var x=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(h,d,x,[]),p.drawArrays(p.TRIANGLE_STRIP,0,x.length)}}}function c(t,e){var i=t.context,n=i.gl;if(e.dem&&e.dem.level){var r=e.dem.level.dim,o=e.dem.getPixels();if(i.activeTexture.set(n.TEXTURE1),i.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(e.tileSize),e.demTexture){var a=e.demTexture;a.update(o,!1),a.bind(n.NEAREST,n.CLAMP_TO_EDGE)}else e.demTexture=new p(i,o,n.RGBA,!1),e.demTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE);i.activeTexture.set(n.TEXTURE0);var s=e.fbo;if(!s){var l=new p(i,{width:r,height:r,data:null},n.RGBA);l.bind(n.LINEAR,n.CLAMP_TO_EDGE),(s=e.fbo=i.createFramebuffer(r,r)).colorAttachment.set(l.texture)}i.bindFramebuffer.set(s.framebuffer),i.viewport.set([0,0,r,r]);var u=d.create();d.ortho(u,0,f,-f,0,0,1),d.translate(u,u,[0,-f,0]);var c=t.useProgram("hillshadePrepare");n.uniformMatrix4fv(c.uniforms.u_matrix,!1,u),n.uniform1f(c.uniforms.u_zoom,e.tileID.overscaledZ),n.uniform2fv(c.uniforms.u_dimension,[2*r,2*r]),n.uniform1i(c.uniforms.u_image,1);var h=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(i,c,h,[]),n.drawArrays(n.TRIANGLE_STRIP,0,h.length),e.needsHillshadePrepare=!1}}var b=t("../geo/coordinate"),p=t("./texture"),f=t("../data/extent"),d=t("@mapbox/gl-matrix").mat4,h=t("../gl/stencil_mode"),m=t("../gl/depth_mode");e.exports=function(t,e,i,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){var r=t.context;r.setDepthMode(t.depthModeForSublayer(0,m.ReadOnly)),r.setStencilMode(h.disabled),r.setColorMode(t.colorModeForRenderPass());for(var o=0,a=n;o<a.length;o+=1){var s=a[o],l=e.getTile(s);l.needsHillshadePrepare&&"offscreen"===t.renderPass?c(t,l):"translucent"===t.renderPass&&u(t,l,i)}r.viewport.set([0,0,t.width,t.height])}}},{"../data/extent":53,"../geo/coordinate":61,"../gl/depth_mode":67,"../gl/stencil_mode":70,"./texture":93,"@mapbox/gl-matrix":2}],82:[function(t,e,i){"use strict";function g(t,e,i,n,r,o,a,s,l){var u,c,h,p,f=e.context,d=f.gl,m=r.paint.get("line-dasharray"),y=r.paint.get("line-pattern");if(s||l){var _=1/A(i,1,e.transform.tileZoom);if(m){u=e.lineAtlas.getDash(m.from,"round"===r.layout.get("line-cap")),c=e.lineAtlas.getDash(m.to,"round"===r.layout.get("line-cap"));var g=u.width*m.fromScale,v=c.width*m.toScale;d.uniform2f(t.uniforms.u_patternscale_a,_/g,-u.height/2),d.uniform2f(t.uniforms.u_patternscale_b,_/v,-c.height/2),d.uniform1f(t.uniforms.u_sdfgamma,e.lineAtlas.width/(256*Math.min(g,v)*S.devicePixelRatio)/2)}else if(y){if(h=e.imageManager.getPattern(y.from),p=e.imageManager.getPattern(y.to),!h||!p)return;d.uniform2f(t.uniforms.u_pattern_size_a,h.displaySize[0]*y.fromScale/_,p.displaySize[1]),d.uniform2f(t.uniforms.u_pattern_size_b,p.displaySize[0]*y.toScale/_,p.displaySize[1]);var x=e.imageManager.getPixelSize(),b=x.width,w=x.height;d.uniform2fv(t.uniforms.u_texsize,[b,w])}d.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}s&&(m?(d.uniform1i(t.uniforms.u_image,0),f.activeTexture.set(d.TEXTURE0),e.lineAtlas.bind(f),d.uniform1f(t.uniforms.u_tex_y_a,u.y),d.uniform1f(t.uniforms.u_tex_y_b,c.y),d.uniform1f(t.uniforms.u_mix,m.t)):y&&(d.uniform1i(t.uniforms.u_image,0),f.activeTexture.set(d.TEXTURE0),e.imageManager.bind(f),d.uniform2fv(t.uniforms.u_pattern_tl_a,h.tl),d.uniform2fv(t.uniforms.u_pattern_br_a,h.br),d.uniform2fv(t.uniforms.u_pattern_tl_b,p.tl),d.uniform2fv(t.uniforms.u_pattern_br_b,p.br),d.uniform1f(t.uniforms.u_fade,y.t))),f.setStencilMode(e.stencilModeForClipping(o));var T=e.translatePosMatrix(o.posMatrix,i,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"));d.uniformMatrix4fv(t.uniforms.u_matrix,!1,T),d.uniform1f(t.uniforms.u_ratio,1/A(i,1,e.transform.zoom)),t.draw(f,d.TRIANGLES,r.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,a)}var S=t("../util/browser"),A=t("../source/pixels_to_tile_units"),v=t("../gl/depth_mode");e.exports=function(t,e,i,n){if("translucent"===t.renderPass&&0!==i.paint.get("line-opacity").constantOr(1)){var r=t.context;r.setDepthMode(t.depthModeForSublayer(0,v.ReadOnly)),r.setColorMode(t.colorModeForRenderPass());for(var o,a=i.paint.get("line-dasharray")?"lineSDF":i.paint.get("line-pattern")?"linePattern":"line",s=!0,l=0,u=n;l<u.length;l+=1){var c=u[l],h=e.getTile(c),p=h.getBucket(i);if(p){var f=p.programConfigurations.get(i.id),d=t.context.program.get(),m=t.useProgram(a,f),y=s||m.program!==d,_=o!==h.tileID.overscaledZ;y&&f.setUniforms(t.context,m,i.paint,{zoom:t.transform.zoom}),g(m,t,h,p,i,c,f,y,_),o=h.tileID.overscaledZ,s=!1}}}}},{"../gl/depth_mode":67,"../source/pixels_to_tile_units":104,"../util/browser":252}],83:[function(t,e,i){"use strict";function w(t,e,i,n,r){var o=n.paint.get("raster-fade-duration");if(0<o){var a=d.now(),s=(a-t.timeAdded)/o,l=e?(a-e.timeAdded)/o:-1,u=i.getSource(),c=r.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),h=!e||Math.abs(e.tileID.overscaledZ-c)>Math.abs(t.tileID.overscaledZ-c),p=h&&t.refreshedUponExpiration?1:f.clamp(h?s:1-l,0,1);return t.refreshedUponExpiration&&1<=s&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}var f=t("../util/util"),T=t("../source/image_source"),d=t("../util/browser"),S=t("../gl/stencil_mode"),A=t("../gl/depth_mode");e.exports=function(t,e,i,n){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")){var r=t.context,o=r.gl,a=e.getSource(),s=t.useProgram("raster");r.setStencilMode(S.disabled),r.setColorMode(t.colorModeForRenderPass()),o.uniform1f(s.uniforms.u_brightness_low,i.paint.get("raster-brightness-min")),o.uniform1f(s.uniforms.u_brightness_high,i.paint.get("raster-brightness-max")),o.uniform1f(s.uniforms.u_saturation_factor,0<(b=i.paint.get("raster-saturation"))?1-1/(1.001-b):-b),o.uniform1f(s.uniforms.u_contrast_factor,0<(x=i.paint.get("raster-contrast"))?1/(1-x):1+x),o.uniform3fv(s.uniforms.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}(i.paint.get("raster-hue-rotate"))),o.uniform1f(s.uniforms.u_buffer_scale,1),o.uniform1i(s.uniforms.u_image0,0),o.uniform1i(s.uniforms.u_image1,1);for(var l=n.length&&n[0].overscaledZ,u=0,c=n;u<c.length;u+=1){var h=c[u];r.setDepthMode(t.depthModeForSublayer(h.overscaledZ-l,1===i.paint.get("raster-opacity")?A.ReadWrite:A.ReadOnly,o.LESS));var p=e.getTile(h),f=t.transform.calculatePosMatrix(h.toUnwrapped(),!0);p.registerFadeDuration(i.paint.get("raster-fade-duration")),o.uniformMatrix4fv(s.uniforms.u_matrix,!1,f);var d=e.findLoadedParent(h,0,{}),m=w(p,d,e,i,t.transform),y=void 0,_=void 0;if(r.activeTexture.set(o.TEXTURE0),p.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(o.TEXTURE1),d?(d.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),y=Math.pow(2,d.tileID.overscaledZ-p.tileID.overscaledZ),_=[p.tileID.canonical.x*y%1,p.tileID.canonical.y*y%1]):p.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),o.uniform2fv(s.uniforms.u_tl_parent,_||[0,0]),o.uniform1f(s.uniforms.u_scale_parent,y||1),o.uniform1f(s.uniforms.u_fade_t,m.mix),o.uniform1f(s.uniforms.u_opacity,m.opacity*i.paint.get("raster-opacity")),a instanceof T){var g=a.boundsBuffer;a.boundsVAO.bind(r,s,g,[]),o.drawArrays(o.TRIANGLE_STRIP,0,g.length)}else if(p.maskedBoundsBuffer&&p.maskedIndexBuffer&&p.segments)s.draw(r,o.TRIANGLES,i.id,p.maskedBoundsBuffer,p.maskedIndexBuffer,p.segments);else{var v=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(r,s,v,[]),o.drawArrays(o.TRIANGLE_STRIP,0,v.length)}}}var x,b}},{"../gl/depth_mode":67,"../gl/stencil_mode":70,"../source/image_source":102,"../util/browser":252,"../util/util":275}],84:[function(t,e,i){"use strict";function o(t,e,i,n,r,o,a,s,l,u){var c=t.context,h=c.gl,p=t.transform,f="map"===s,d="map"===l,m=f&&"line"===i.layout.get("symbol-placement"),y=f&&!d&&!m,_=d;c.setDepthMode(_?t.depthModeForSublayer(0,F.ReadOnly):F.disabled);for(var g,v=0,x=n;v<x.length;v+=1){var b=x[v],w=e.getTile(b),T=w.getBucket(i);if(T){var S=r?T.text:T.icon;if(S&&S.segments.get().length){var A=S.programConfigurations.get(i.id),M=r||T.sdfIcons,E=r?T.textSizeData:T.iconSizeData;if(g||(g=t.useProgram(M?"symbolSDF":"symbolIcon",A),A.setUniforms(t.context,g,i.paint,{zoom:t.transform.zoom}),k(g,t,i,r,y,d,E)),c.activeTexture.set(h.TEXTURE0),h.uniform1i(g.uniforms.u_texture,0),r)w.glyphAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.uniform2fv(g.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var L=1!==i.layout.get("icon-size").constantOr(0)||T.iconsNeedLinear,z=d||0!==p.pitch;w.iconAtlasTexture.bind(M||t.options.rotating||t.options.zooming||L||z?h.LINEAR:h.NEAREST,h.CLAMP_TO_EDGE),h.uniform2fv(g.uniforms.u_texsize,w.iconAtlasTexture.size)}h.uniformMatrix4fv(g.uniforms.u_matrix,!1,t.translatePosMatrix(b.posMatrix,w,o,a));var P=D(w,1,t.transform.zoom),C=B.getLabelPlaneMatrix(b.posMatrix,d,f,t.transform,P),I=B.getGlCoordMatrix(b.posMatrix,d,f,t.transform,P);h.uniformMatrix4fv(g.uniforms.u_gl_coord_matrix,!1,t.translatePosMatrix(I,w,o,a,!0)),m?(h.uniformMatrix4fv(g.uniforms.u_label_plane_matrix,!1,O),B.updateLineLabels(T,b.posMatrix,t,r,C,I,d,u)):h.uniformMatrix4fv(g.uniforms.u_label_plane_matrix,!1,C),h.uniform1f(g.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),R(g,A,t,i,w,S,r,M,d)}}}}function k(t,e,i,n,r,o,a){var s=e.context.gl,l=e.transform;s.uniform1i(t.uniforms.u_pitch_with_map,o?1:0),s.uniform1f(t.uniforms.u_is_text,n?1:0),s.uniform1f(t.uniforms.u_pitch,l.pitch/360*2*Math.PI);var u="constant"===a.functionType||"source"===a.functionType,c="constant"===a.functionType||"camera"===a.functionType;s.uniform1i(t.uniforms.u_is_size_zoom_constant,u?1:0),s.uniform1i(t.uniforms.u_is_size_feature_constant,c?1:0),s.uniform1f(t.uniforms.u_camera_to_center_distance,l.cameraToCenterDistance);var h=p.evaluateSizeForZoom(a,l.zoom,f.properties[n?"text-size":"icon-size"]);void 0!==h.uSizeT&&s.uniform1f(t.uniforms.u_size_t,h.uSizeT),void 0!==h.uSize&&s.uniform1f(t.uniforms.u_size,h.uSize),s.uniform1f(t.uniforms.u_aspect_ratio,l.width/l.height),s.uniform1i(t.uniforms.u_rotate_symbol,r?1:0)}function R(t,e,i,n,r,o,a,s,l){var u=i.context,c=u.gl,h=i.transform;if(s){var p=0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),f=l?Math.cos(h._pitch)*h.cameraToCenterDistance:1;c.uniform1f(t.uniforms.u_gamma_scale,f),p&&(c.uniform1f(t.uniforms.u_is_halo,1),d(o,n,u,t)),c.uniform1f(t.uniforms.u_is_halo,0)}d(o,n,u,t)}function d(t,e,i,n){n.draw(i,i.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}var a=t("./draw_collision_debug"),D=t("../source/pixels_to_tile_units"),B=t("../symbol/projection"),p=t("../symbol/symbol_size"),O=t("@mapbox/gl-matrix").mat4.identity(new Float32Array(16)),f=t("../style/style_layer/symbol_style_layer_properties").layout,s=t("../gl/stencil_mode"),F=t("../gl/depth_mode");e.exports=function(t,e,i,n){if("translucent"===t.renderPass){var r=t.context;r.setStencilMode(s.disabled),r.setColorMode(t.colorModeForRenderPass()),0!==i.paint.get("icon-opacity").constantOr(1)&&o(t,e,i,n,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright")),0!==i.paint.get("text-opacity").constantOr(1)&&o(t,e,i,n,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&a(t,e,i,n)}}},{"../gl/depth_mode":67,"../gl/stencil_mode":70,"../source/pixels_to_tile_units":104,"../style/style_layer/symbol_style_layer_properties":209,"../symbol/projection":224,"../symbol/symbol_size":228,"./draw_collision_debug":76,"@mapbox/gl-matrix":2}],85:[function(t,e,i){"use strict";var c=t("@mapbox/shelf-pack"),h=t("../util/image").AlphaImage;e.exports={makeGlyphAtlas:function(t){var e=new h({width:0,height:0}),i={},n=new c(0,0,{autoResize:!0});for(var r in t){var o=t[r],a=i[r]={};for(var s in o){var l=o[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u=n.packOne(l.bitmap.width+2,l.bitmap.height+2);e.resize({width:n.w,height:n.h}),h.copy(l.bitmap,e,{x:0,y:0},{x:u.x+1,y:u.y+1},l.bitmap),a[s]={rect:u,metrics:l.metrics}}}}return n.shrink(),e.resize({width:n.w,height:n.h}),{image:e,positions:i}}}},{"../util/image":263,"@mapbox/shelf-pack":5}],86:[function(t,e,i){"use strict";var c=t("../style/load_glyph_range"),a=t("@mapbox/tiny-sdf"),s=t("../util/is_char_in_unicode_block"),h=t("../util/util").asyncAll,l=t("../util/image").AlphaImage,n=function(t,e){this.requestTransform=t,this.localIdeographFontFamily=e,this.entries={}};n.prototype.setURL=function(t){this.url=t},n.prototype.getGlyphs=function(t,u){var l=this,e=[];for(var i in t)for(var n=0,r=t[i];n<r.length;n+=1){var o=r[n];e.push({stack:i,id:o})}h(e,function(t,i){var n=t.stack,r=t.id,o=l.entries[n];o||(o=l.entries[n]={glyphs:{},requests:{}});var e=o.glyphs[r];if(void 0===e)if(e=l._tinySDF(o,n,r))i(null,{stack:n,id:r,glyph:e});else{var a=Math.floor(r/256);if(65535<256*a)i(new Error("glyphs > 65535 not supported"));else{var s=o.requests[a];s||(s=o.requests[a]=[],c(n,a,l.url,l.requestTransform,function(t,e){if(e)for(var i in e)o.glyphs[+i]=e[+i];for(var n=0,r=s;n<r.length;n+=1)(0,r[n])(t,e);delete o.requests[a]})),s.push(function(t,e){t?i(t):e&&i(null,{stack:n,id:r,glyph:e[r]||null})})}}else i(null,{stack:n,id:r,glyph:e})},function(t,e){if(t)u(t);else if(e){for(var i={},n=0,r=e;n<r.length;n+=1){var o=r[n],a=o.stack,s=o.id,l=o.glyph;(i[a]||(i[a]={}))[s]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}u(null,i)}})},n.prototype._tinySDF=function(t,e,i){var n=this.localIdeographFontFamily;if(n&&(s["CJK Unified Ideographs"](i)||s["Hangul Syllables"](i))){var r=t.tinySDF;if(!r){var o="400";/bold/i.test(e)?o="900":/medium/i.test(e)?o="500":/light/i.test(e)&&(o="200"),r=t.tinySDF=new a(24,3,8,.25,n,o)}return{id:i,bitmap:new l({width:30,height:30},r.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},e.exports=n},{"../style/load_glyph_range":184,"../util/image":263,"../util/is_char_in_unicode_block":265,"../util/util":275,"@mapbox/tiny-sdf":6}],87:[function(t,e,i){"use strict";function s(t,e){var i=e.pixelRatio,n={x:t.x+c,y:t.y+c,w:t.w-2*c,h:t.h-2*c};return{pixelRatio:i,textureRect:n,tl:[n.x,n.y],br:[n.x+n.w,n.y+n.h],displaySize:[n.w/i,n.h/i]}}var l=t("@mapbox/shelf-pack"),u=t("../util/image").RGBAImage,c=1;e.exports={imagePosition:s,makeImageAtlas:function(t){var e=new u({width:0,height:0}),i={},n=new l(0,0,{autoResize:!0});for(var r in t){var o=t[r],a=n.packOne(o.data.width+2*c,o.data.height+2*c);e.resize({width:n.w,height:n.h}),u.copy(o.data,e,{x:0,y:0},{x:a.x+c,y:a.y+c},o.data),i[r]=s(a,o)}return n.shrink(),e.resize({width:n.w,height:n.h}),{image:e,positions:i}}}},{"../util/image":263,"@mapbox/shelf-pack":5}],88:[function(t,e,i){"use strict";var n=t("@mapbox/shelf-pack"),f=t("../util/image").RGBAImage,d=t("./image_atlas").imagePosition,r=t("./texture"),o=function(){this.images={},this.loaded=!1,this.requestors=[],this.shelfPack=new n(64,64,{autoResize:!0}),this.patterns={},this.atlasImage=new f({width:64,height:64}),this.dirty=!0};o.prototype.isLoaded=function(){return this.loaded},o.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t)){for(var e=0,i=this.requestors;e<i.length;e+=1){var n=i[e],r=n.ids,o=n.callback;this._notify(r,o)}this.requestors=[]}},o.prototype.getImage=function(t){return this.images[t]},o.prototype.addImage=function(t,e){this.images[t]=e},o.prototype.removeImage=function(t){delete this.images[t];var e=this.patterns[t];e&&(this.shelfPack.unref(e.bin),delete this.patterns[t])},o.prototype.getImages=function(t,e){var i=!0;if(!this.isLoaded())for(var n=0,r=t;n<r.length;n+=1){var o=r[n];this.images[o]||(i=!1)}this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})},o.prototype._notify=function(t,e){for(var i={},n=0,r=t;n<r.length;n+=1){var o=r[n],a=this.images[o];a&&(i[o]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf})}e(null,i)},o.prototype.getPixelSize=function(){return{width:this.shelfPack.w,height:this.shelfPack.h}},o.prototype.getPattern=function(t){var e=this.patterns[t];if(e)return e.position;var i=this.getImage(t);if(!i)return null;var n=i.data.width+2,r=i.data.height+2,o=this.shelfPack.packOne(n,r);if(!o)return null;this.atlasImage.resize(this.getPixelSize());var a=i.data,s=this.atlasImage,l=o.x+1,u=o.y+1,c=a.width,h=a.height;f.copy(a,s,{x:0,y:0},{x:l,y:u},{width:c,height:h}),f.copy(a,s,{x:0,y:h-1},{x:l,y:u-1},{width:c,height:1}),f.copy(a,s,{x:0,y:0},{x:l,y:u+h},{width:c,height:1}),f.copy(a,s,{x:c-1,y:0},{x:l-1,y:u},{width:1,height:h}),f.copy(a,s,{x:0,y:0},{x:l+c,y:u},{width:1,height:h}),this.dirty=!0;var p=d(o,i);return this.patterns[t]={bin:o,position:p},p},o.prototype.bind=function(t){var e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)},e.exports=o},{"../util/image":263,"./image_atlas":87,"./texture":93,"@mapbox/shelf-pack":5}],89:[function(t,e,i){"use strict";var S=t("../util/util"),n=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};n.prototype.getDash=function(t,e){var i=t.join(",")+String(e);return this.positions[i]||(this.positions[i]=this.addDash(t,e)),this.positions[i]},n.prototype.addDash=function(t,e){var i=e?7:0,n=2*i+1;if(this.nextRow+n>this.height)return S.warnOnce("LineAtlas out of space"),null;for(var r=0,o=0;o<t.length;o++)r+=t[o];for(var a=this.width/r,s=a/2,l=t.length%2==1,u=-i;u<=i;u++)for(var c=this.nextRow+i+u,h=this.width*c,p=l?-t[t.length-1]:0,f=t[0],d=1,m=0;m<this.width;m++){for(;f<m/a;)p=f,f+=t[d],l&&d===t.length-1&&(f+=t[0]),d++;var y=Math.abs(m-p*a),_=Math.abs(m-f*a),g=Math.min(y,_),v=d%2==1,x=void 0;if(e){var b=i?u/i*(s+1):0;if(v){var w=s-Math.abs(b);x=Math.sqrt(g*g+w*w)}else x=s-Math.sqrt(g*g+b*b)}else x=(v?1:-1)*g;this.data[3+4*(h+m)]=Math.max(0,Math.min(255,x+128))}var T={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:r};return this.nextRow+=n,this.dirty=!0,T},n.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))},e.exports=n},{"../util/util":275}],90:[function(t,e,i){"use strict";var v=t("../util/browser"),c=t("@mapbox/gl-matrix").mat4,n=t("../source/source_cache"),o=t("../data/extent"),h=t("../source/pixels_to_tile_units"),x=t("../util/util"),a=t("./vertex_array_object"),r=t("../data/array_types"),s=r.RasterBoundsArray,l=r.PosArray,u=t("../data/raster_bounds_attributes"),p=t("../data/pos_attributes"),f=t("../data/program_configuration").ProgramConfiguration,d=t("../symbol/cross_tile_symbol_index"),m=t("../shaders"),y=t("./program"),_=t("../gl/context"),g=t("../gl/depth_mode"),b=t("../gl/stencil_mode"),w=t("../gl/color_mode"),T=(t("./texture"),t("./tile_mask")),S=t("../style-spec/util/color"),A={symbol:t("./draw_symbol"),circle:t("./draw_circle"),heatmap:t("./draw_heatmap"),line:t("./draw_line"),fill:t("./draw_fill"),"fill-extrusion":t("./draw_fill_extrusion"),hillshade:t("./draw_hillshade"),raster:t("./draw_raster"),background:t("./draw_background"),debug:t("./draw_debug")},M=function(t,e){this.context=new _(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=n.maxUnderzooming+n.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new f,this.crossTileSymbolIndex=new d};M.prototype.resize=function(t,e){var i=this.context.gl;if(this.width=t*v.devicePixelRatio,this.height=e*v.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,r=this.style._order;n<r.length;n+=1){var o=r[n];this.style._layers[o].resize()}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},M.prototype.setup=function(){var t=this.context,e=new l;e.emplaceBack(0,0),e.emplaceBack(o,0),e.emplaceBack(0,o),e.emplaceBack(o,o),this.tileExtentBuffer=t.createVertexBuffer(e,p.members),this.tileExtentVAO=new a,this.tileExtentPatternVAO=new a;var i=new l;i.emplaceBack(0,0),i.emplaceBack(o,0),i.emplaceBack(o,o),i.emplaceBack(0,o),i.emplaceBack(0,0),this.debugBuffer=t.createVertexBuffer(i,p.members),this.debugVAO=new a;var n=new s;n.emplaceBack(0,0,0,0),n.emplaceBack(o,0,o,0),n.emplaceBack(0,o,0,o),n.emplaceBack(o,o,o,o),this.rasterBoundsBuffer=t.createVertexBuffer(n,u.members),this.rasterBoundsVAO=new a;var r=new l;r.emplaceBack(0,0),r.emplaceBack(1,0),r.emplaceBack(0,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,p.members),this.viewportVAO=new a},M.prototype.clearStencil=function(){var t=this.context,e=t.gl;t.setColorMode(w.disabled),t.setDepthMode(g.disabled),t.setStencilMode(new b({func:e.ALWAYS,mask:0},0,255,e.ZERO,e.ZERO,e.ZERO));var i=c.create();c.ortho(i,0,this.width,this.height,0,0,1),c.scale(i,i,[e.drawingBufferWidth,e.drawingBufferHeight,0]);var n=this.useProgram("clippingMask");e.uniformMatrix4fv(n.uniforms.u_matrix,!1,i),this.viewportVAO.bind(t,n,this.viewportBuffer,[]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},M.prototype._renderTileClippingMasks=function(t){var e=this.context,i=e.gl;e.setColorMode(w.disabled),e.setDepthMode(g.disabled);var n=1;this._tileClippingMaskIDs={};for(var r=0,o=t;r<o.length;r+=1){var a=o[r],s=this._tileClippingMaskIDs[a.key]=n++;e.setStencilMode(new b({func:i.ALWAYS,mask:0},s,255,i.KEEP,i.KEEP,i.REPLACE));var l=this.useProgram("clippingMask");i.uniformMatrix4fv(l.uniforms.u_matrix,!1,a.posMatrix),this.tileExtentVAO.bind(this.context,l,this.tileExtentBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,this.tileExtentBuffer.length)}},M.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new b({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},M.prototype.colorModeForRenderPass=function(){var t=this.context.gl;return this._showOverdrawInspector?new w([t.CONSTANT_COLOR,t.ONE],new S(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?w.unblended:w.alphaBlended},M.prototype.depthModeForSublayer=function(t,e,i){var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,r=n-1+this.depthRange;return new g(i||this.context.gl.LEQUAL,e,[r,n])},M.prototype.render=function(t,e){var n=this;for(var i in this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(v.now()),t.sourceCaches){var r=n.style.sourceCaches[i];r.used&&r.prepare(n.context)}var o=this.style._order,a=x.filterObject(this.style.sourceCaches,function(t){return"raster"===t.getSource().type||"raster-dem"===t.getSource().type});for(var s in a)!function(t){var e=a[s],i=e.getVisibleCoordinates().map(function(t){return e.getTile(t)});T(i,n.context)}();this.renderPass="offscreen";var l,u=[];this.depthRboNeedsClear=!0;for(var c=0;c<o.length;c++){var h=n.style._layers[o[c]];h.hasOffscreenPass()&&!h.isHidden(n.transform.zoom)&&(h.source!==(l&&l.id)&&(u=[],(l=n.style.sourceCaches[h.source])&&(u=l.getVisibleCoordinates()).reverse()),u.length&&n.renderLayer(n,l,h,u))}this.context.bindFramebuffer.set(null),this.context.clear({color:e.showOverdrawInspector?S.black:S.transparent,depth:1}),this._showOverdrawInspector=e.showOverdrawInspector,this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.renderPass="opaque";var p,f=[];for(this.currentLayer=o.length-1,this.currentLayer;0<=this.currentLayer;this.currentLayer--){var d=n.style._layers[o[n.currentLayer]];d.source!==(p&&p.id)&&(f=[],(p=n.style.sourceCaches[d.source])&&(n.clearStencil(),f=p.getVisibleCoordinates(),p.getSource().isTileClipped&&n._renderTileClippingMasks(f))),n.renderLayer(n,p,d,f)}this.renderPass="translucent";var m,y=[];for(this.currentLayer=0,this.currentLayer;this.currentLayer<o.length;this.currentLayer++){var _=n.style._layers[o[n.currentLayer]];_.source!==(m&&m.id)&&(y=[],(m=n.style.sourceCaches[_.source])&&(n.clearStencil(),y=m.getVisibleCoordinates(),m.getSource().isTileClipped&&n._renderTileClippingMasks(y)),y.reverse()),n.renderLayer(n,m,_,y)}if(this.options.showTileBoundaries){var g=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];g&&A.debug(this,g,g.getVisibleCoordinates())}},M.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},M.prototype.renderLayer=function(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||n.length)&&(this.id=i.id,A[i.type](t,e,i,n))},M.prototype.translatePosMatrix=function(t,e,i,n,r){if(!i[0]&&!i[1])return t;var o=r?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){var a=Math.sin(o),s=Math.cos(o);i=[i[0]*s-i[1]*a,i[0]*a+i[1]*s]}var l=[r?i[0]:h(e,i[0],this.transform.zoom),r?i[1]:h(e,i[1],this.transform.zoom),0],u=new Float32Array(16);return c.translate(u,t,l),u},M.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},M.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&0<e.length?e.pop():null},M.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var i=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new y(this.context,m[t],e,this._showOverdrawInspector)),this.cache[i]},M.prototype.useProgram=function(t,e){var i=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.context.program.set(i.program),i},e.exports=M},{"../data/array_types":39,"../data/extent":53,"../data/pos_attributes":57,"../data/program_configuration":58,"../data/raster_bounds_attributes":59,"../gl/color_mode":65,"../gl/context":66,"../gl/depth_mode":67,"../gl/stencil_mode":70,"../shaders":97,"../source/pixels_to_tile_units":104,"../source/source_cache":111,"../style-spec/util/color":153,"../symbol/cross_tile_symbol_index":218,"../util/browser":252,"../util/util":275,"./draw_background":74,"./draw_circle":75,"./draw_debug":77,"./draw_fill":78,"./draw_fill_extrusion":79,"./draw_heatmap":80,"./draw_hillshade":81,"./draw_line":82,"./draw_raster":83,"./draw_symbol":84,"./program":92,"./texture":93,"./tile_mask":94,"./vertex_array_object":95,"@mapbox/gl-matrix":2}],91:[function(t,e,i){"use strict";var l=t("../source/pixels_to_tile_units");i.isPatternMissing=function(t,e){if(!t)return!1;var i=e.imageManager.getPattern(t.from),n=e.imageManager.getPattern(t.to);return!i||!n},i.prepare=function(t,e,i){var n=e.context,r=n.gl,o=e.imageManager.getPattern(t.from),a=e.imageManager.getPattern(t.to);r.uniform1i(i.uniforms.u_image,0),r.uniform2fv(i.uniforms.u_pattern_tl_a,o.tl),r.uniform2fv(i.uniforms.u_pattern_br_a,o.br),r.uniform2fv(i.uniforms.u_pattern_tl_b,a.tl),r.uniform2fv(i.uniforms.u_pattern_br_b,a.br);var s=e.imageManager.getPixelSize(),l=s.width,u=s.height;r.uniform2fv(i.uniforms.u_texsize,[l,u]),r.uniform1f(i.uniforms.u_mix,t.t),r.uniform2fv(i.uniforms.u_pattern_size_a,o.displaySize),r.uniform2fv(i.uniforms.u_pattern_size_b,a.displaySize),r.uniform1f(i.uniforms.u_scale_a,t.fromScale),r.uniform1f(i.uniforms.u_scale_b,t.toScale),n.activeTexture.set(r.TEXTURE0),e.imageManager.bind(e.context)},i.setTile=function(t,e,i){var n=e.context.gl;n.uniform1f(i.uniforms.u_tile_units_to_pixels,1/l(t,1,e.transform.tileZoom));var r=Math.pow(2,t.tileID.overscaledZ),o=t.tileSize*Math.pow(2,e.transform.tileZoom)/r,a=o*(t.tileID.canonical.x+t.tileID.wrap*r),s=o*t.tileID.canonical.y;n.uniform2f(i.uniforms.u_pixel_coord_upper,a>>16,s>>16),n.uniform2f(i.uniforms.u_pixel_coord_lower,65535&a,65535&s)}},{"../source/pixels_to_tile_units":104}],92:[function(t,e,i){"use strict";var _=t("../util/browser"),g=t("../shaders"),y=(t("../data/program_configuration").ProgramConfiguration,t("./vertex_array_object")),n=(t("../gl/context"),function(t,e,i,n){var r=t.gl;this.program=r.createProgram();var o=i.defines().concat("#define DEVICE_PIXEL_RATIO "+_.devicePixelRatio.toFixed(1));n&&o.push("#define OVERDRAW_INSPECTOR;");var a=o.concat(g.prelude.fragmentSource,e.fragmentSource).join("\n"),s=o.concat(g.prelude.vertexSource,e.vertexSource).join("\n"),l=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(l,a),r.compileShader(l),r.attachShader(this.program,l);var u=r.createShader(r.VERTEX_SHADER);r.shaderSource(u,s),r.compileShader(u),r.attachShader(this.program,u);for(var c=i.layoutAttributes||[],h=0;h<c.length;h++)r.bindAttribLocation(this.program,h,c[h].name);r.linkProgram(this.program),this.numAttributes=r.getProgramParameter(this.program,r.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(var p=0;p<this.numAttributes;p++){var f=r.getActiveAttrib(this.program,p);f&&(this.attributes[f.name]=r.getAttribLocation(this.program,f.name))}for(var d=r.getProgramParameter(this.program,r.ACTIVE_UNIFORMS),m=0;m<d;m++){var y=r.getActiveUniform(this.program,m);y&&(this.uniforms[y.name]=r.getUniformLocation(this.program,y.name))}});n.prototype.draw=function(t,e,i,n,r,o,a,s,l){for(var u,c=t.gl,h=(u={},u[c.LINES]=2,u[c.TRIANGLES]=3,u)[e],p=0,f=o.get();p<f.length;p+=1){var d=f[p],m=d.vaos||(d.vaos={});(m[i]||(m[i]=new y)).bind(t,this,n,a?a.getPaintVertexBuffers():[],r,d.vertexOffset,s,l),c.drawElements(e,d.primitiveLength*h,c.UNSIGNED_SHORT,d.primitiveOffset*h*2)}},e.exports=n},{"../data/program_configuration":58,"../gl/context":66,"../shaders":97,"../util/browser":252,"./vertex_array_object":95}],93:[function(t,e,i){"use strict";var n=t("../util/window"),a=n.HTMLImageElement,s=n.HTMLCanvasElement,l=n.HTMLVideoElement,u=n.ImageData,r=function(t,e,i,n){this.context=t;var r=e.width,o=e.height;this.size=[r,o],this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)};r.prototype.update=function(t,e){var i=t.width,n=t.height;this.size=[i,n];var r=this.context,o=r.gl;o.bindTexture(o.TEXTURE_2D,this.texture),r.pixelStoreUnpack.set(1),this.format===o.RGBA&&!1!==e&&r.pixelStoreUnpackPremultiplyAlpha.set(!0),t instanceof a||t instanceof s||t instanceof l||t instanceof u?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,t):o.texImage2D(o.TEXTURE_2D,0,this.format,i,n,0,this.format,o.UNSIGNED_BYTE,t.data)},r.prototype.bind=function(t,e,i){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},r.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null},e.exports=r},{"../util/window":254}],94:[function(t,e,i){"use strict";function h(t,e,i,n,r){for(var o=0;o<i.length;o++){var a=i[o];if(n.isLessThan(a.tileID))break;if(e.key===a.tileID.key)return;if(a.tileID.isChildOf(e)){for(var s=e.children(1/0),l=0;l<s.length;l++)h(t,s[l],i.slice(o),n,r);return}}var u=e.overscaledZ-t.overscaledZ,c=new p(u,e.canonical.x-(t.canonical.x<<u),e.canonical.y-(t.canonical.y<<u));r[c.key]=r[c.key]||c}var n=t("../source/tile_id"),s=n.OverscaledTileID,p=n.CanonicalTileID;e.exports=function(t,e){for(var i=t.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),n=0;n<i.length;n++){var r={},o=i[n],a=i.slice(n+1);h(o.tileID.wrapped(),o.tileID,a,new s(0,o.tileID.wrap+1,0,0,0),r),o.setMask(r,e)}}},{"../source/tile_id":114}],95:[function(t,e,i){"use strict";var n=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};n.prototype.bind=function(t,e,i,n,r,o,a,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==n.length,u=0;!l&&u<n.length;u++)this.boundPaintVertexBuffers[u]!==n[u]&&(l=!0);var c=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||l||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||c?this.freshBind(e,i,n,r,o,a,s):(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind())},n.prototype.freshBind=function(t,e,i,n,r,o,a){var s,l=t.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=u.currentNumAttributes||0;for(var h=l;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=i;p<f.length;p+=1)f[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r);for(var d=0,m=i;d<m.length;d+=1){var y=m[d];y.bind(),y.setVertexAttribPointers(c,t,r)}o&&(o.bind(),o.setVertexAttribPointers(c,t,r)),n&&n.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,r)),u.currentNumAttributes=l},n.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},e.exports=n},{}],96:[function(t,e,i){"use strict";var n=t("../util/util");i.packUint8ToFloat=function(t,e){return 256*(t=n.clamp(Math.floor(t),0,255))+(e=n.clamp(Math.floor(e),0,255))}},{"../util/util":275}],97:[function(t,e,i){"use strict";var n={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\n// Unpack a pair of values that have been packed into a single float.\n// The packed values are assumed to be 8-bit unsigned integers, and are\n// packed like so:\n// packedValue = floor(input[0]) * 256 + input[1],\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue = int(packedValue);\n    int v0 = packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec2 unpack_opacity(const float packedOpacity) {\n    int intOpacity = int(packedOpacity) / 2;\n    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\n}\n\n// To minimize the number of attributes needed, we encode a 4-component\n// color into a pair of floats (i.e. a vec2) as follows:\n// [ floor(color.r * 255) * 256 + color.g * 255,\n//   floor(color.b * 255) * 256 + color.g * 255 ]\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\n// Unpack a pair of paint values and interpolate between them.\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\n// Unpack a pair of paint values and interpolate between them.\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},background:{fragmentSource:"uniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main() {\n    gl_FragColor = u_color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},backgroundPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\nuniform float u_opacity;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},circle:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize highp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    vec2 extrude = v_data.xy;\n    float extrude_length = length(extrude);\n\n    lowp float antialiasblur = v_data.z;\n    float antialiased_blur = -max(blur, antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform bool u_pitch_with_map;\nuniform vec2 u_extrude_scale;\nuniform highp float u_camera_to_center_distance;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec3 v_data;\n\nvoid main(void) {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize highp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec2 circle_center = floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n        vec2 corner_position = circle_center;\n        if (u_scale_with_map) {\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale;\n        } else {\n            // Pitching the circle with the map effectively scales it with the map\n            // To counteract the effect for pitch-scale: viewport, we rescale the\n            // whole circle based on the pitch scaling effect at its central point\n            vec4 projected_center = u_matrix * vec4(circle_center, 0, 1);\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n        }\n\n        gl_Position = u_matrix * vec4(corner_position, 0, 1);\n    } else {\n        gl_Position = u_matrix * vec4(circle_center, 0, 1);\n\n        if (u_scale_with_map) {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n        } else {\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n        }\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    lowp float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n\n    v_data = vec3(extrude.x, extrude.y, antialiasblur);\n}\n"},clippingMask:{fragmentSource:"void main() {\n    gl_FragColor = vec4(1.0);\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},heatmap:{fragmentSource:"#pragma mapbox: define highp float weight\n\nuniform highp float u_intensity;\nvarying vec2 v_extrude;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main() {\n    #pragma mapbox: initialize highp float weight\n\n    // Kernel density estimation with a Gaussian kernel of size 5x5\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = weight * u_intensity * GAUSS_COEF * exp(d);\n\n    gl_FragColor = vec4(val, 1.0, 1.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\n\nuniform mat4 u_matrix;\nuniform float u_extrude_scale;\nuniform float u_opacity;\nuniform float u_intensity;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_extrude;\n\n// Effective \"0\" in the kernel density texture to adjust the kernel size to;\n// this empirically chosen number minimizes artifacts on overlapping kernels\n// for typical heatmap cases (assuming clustered source)\nconst highp float ZERO = 1.0 / 255.0 / 16.0;\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main(void) {\n    #pragma mapbox: initialize highp float weight\n    #pragma mapbox: initialize mediump float radius\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 unscaled_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // This 'extrude' comes in ranging from [-1, -1], to [1, 1].  We'll use\n    // it to produce the vertices of a square mesh framing the point feature\n    // we're adding to the kernel density texture.  We'll also pass it as\n    // a varying, so that the fragment shader can determine the distance of\n    // each fragment from the point feature.\n    // Before we do so, we need to scale it up sufficiently so that the\n    // kernel falls effectively to zero at the edge of the mesh.\n    // That is, we want to know S such that\n    // weight * u_intensity * GAUSS_COEF * exp(-0.5 * 3.0^2 * S^2) == ZERO\n    // Which solves to:\n    // S = sqrt(-2.0 * log(ZERO / (weight * u_intensity * GAUSS_COEF))) / 3.0\n    float S = sqrt(-2.0 * log(ZERO / weight / u_intensity / GAUSS_COEF)) / 3.0;\n\n    // Pass the varying in units of radius\n    v_extrude = S * unscaled_extrude;\n\n    // Scale by radius and the zoom-based scale factor to produce actual\n    // mesh position\n    vec2 extrude = v_extrude * radius * u_extrude_scale;\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec4 pos = vec4(floor(a_pos * 0.5) + extrude, 0, 1);\n\n    gl_Position = u_matrix * pos;\n}\n"},heatmapTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform sampler2D u_color_ramp;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    float t = texture2D(u_image, v_pos).r;\n    vec4 color = texture2D(u_color_ramp, vec2(t, 0.5));\n    gl_FragColor = color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},collisionBox:{fragmentSource:"\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        gl_FragColor *= .1;\n    }\n}",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = 0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n    gl_Position.xy += a_extrude * u_extrude_scale * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n}\n"},collisionCircle:{fragmentSource:"\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    float alpha = 0.5;\n\n    // Red = collision, hide label\n    vec4 color = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n\n    // Blue = no collision, label is showing\n    if (v_placed > 0.5) {\n        color = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\n    }\n\n    if (v_notUsed > 0.5) {\n        // This box not used, fade it out\n        color *= .2;\n    }\n\n    float extrude_scale_length = length(v_extrude_scale);\n    float extrude_length = length(v_extrude) * extrude_scale_length;\n    float stroke_width = 15.0 * extrude_scale_length;\n    float radius = v_radius * extrude_scale_length;\n\n    float distance_to_edge = abs(extrude_length - radius);\n    float opacity_t = smoothstep(-stroke_width, 0.0, -distance_to_edge);\n\n    gl_FragColor = opacity_t * color;\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_anchor_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_placed;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\nuniform float u_camera_to_center_distance;\n\nvarying float v_placed;\nvarying float v_notUsed;\nvarying float v_radius;\n\nvarying vec2 v_extrude;\nvarying vec2 v_extrude_scale;\n\nvoid main() {\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    highp float collision_perspective_ratio = 0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance);\n\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n\n    highp float padding_factor = 1.2; // Pad the vertices slightly to make room for anti-alias blur\n    gl_Position.xy += a_extrude * u_extrude_scale * padding_factor * gl_Position.w * collision_perspective_ratio;\n\n    v_placed = a_placed.x;\n    v_notUsed = a_placed.y;\n    v_radius = abs(a_extrude.y); // We don't pitch the circles, so both units of the extrusion vector are equal in magnitude to the radius\n\n    v_extrude = a_extrude * padding_factor;\n    v_extrude_scale = u_extrude_scale * u_camera_to_center_distance * collision_perspective_ratio;\n}\n"},debug:{fragmentSource:"uniform highp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define highp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize highp vec4 color\n\n    gl_FragColor = v_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define highp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize highp vec4 color\n\n    vec3 normal = a_normal_ed.xyz;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec3 normal = a_normal_ed.xyz;\n    float edgedistance = a_normal_ed.w;\n\n    base = max(0.0, base);\n    height = max(0.0, height);\n\n    float t = mod(normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = normal.x == 1.0 && normal.y == 0.0 && normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_image;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_image, v_pos) * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(0.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x = a_pos.x;\n    v_pos.y = 1.0 - a_pos.y;\n}\n"},hillshadePrepare:{fragmentSource:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D u_image;\nvarying vec2 v_pos;\nuniform vec2 u_dimension;\nuniform float u_zoom;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_image, coord) * 255.0;\n    return (data.r + data.g * 256.0 + data.b * 256.0 * 256.0) / 4.0;\n}\n\nvoid main() {\n    vec2 epsilon = 1.0 / u_dimension;\n\n    // queried pixels:\n    // +-----------+\n    // |   |   |   |\n    // | a | b | c |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | d | e | f |\n    // |   |   |   |\n    // +-----------+\n    // |   |   |   |\n    // | g | h | i |\n    // |   |   |   |\n    // +-----------+\n\n    float a = getElevation(v_pos + vec2(-epsilon.x, -epsilon.y), 0.0);\n    float b = getElevation(v_pos + vec2(0, -epsilon.y), 0.0);\n    float c = getElevation(v_pos + vec2(epsilon.x, -epsilon.y), 0.0);\n    float d = getElevation(v_pos + vec2(-epsilon.x, 0), 0.0);\n    float e = getElevation(v_pos, 0.0);\n    float f = getElevation(v_pos + vec2(epsilon.x, 0), 0.0);\n    float g = getElevation(v_pos + vec2(-epsilon.x, epsilon.y), 0.0);\n    float h = getElevation(v_pos + vec2(0, epsilon.y), 0.0);\n    float i = getElevation(v_pos + vec2(epsilon.x, epsilon.y), 0.0);\n\n    // here we divide the x and y slopes by 8 * pixel size\n    // where pixel size (aka meters/pixel) is:\n    // circumference of the world / (pixels per tile * number of tiles)\n    // which is equivalent to: 8 * 40075016.6855785 / (512 * pow(2, u_zoom))\n    // which can be reduced to: pow(2, 19.25619978527 - u_zoom)\n    // we want to vertically exaggerate the hillshading though, because otherwise\n    // it is barely noticeable at low zooms. to do this, we multiply this by some\n    // scale factor pow(2, (u_zoom - 14) * a) where a is an arbitrary value and 14 is the\n    // maxzoom of the tile source. here we use a=0.3 which works out to the\n    // expression below. see nickidlugash's awesome breakdown for more info\n    // https://github.com/mapbox/mapbox-gl-js/pull/5286#discussion_r148419556\n    float exaggeration = u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\n\n    vec2 deriv = vec2(\n        (c + f + f + i) - (a + d + d + g),\n        (g + h + h + i) - (a + b + b + c)\n    ) /  pow(2.0, (u_zoom - 14.0) * exaggeration + 19.2562 - u_zoom);\n\n    gl_FragColor = clamp(vec4(\n        deriv.x / 2.0 + 0.5,\n        deriv.y / 2.0 + 0.5,\n        1.0,\n        1.0), 0.0, 1.0);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (a_texture_pos / 8192.0) / 2.0 + 0.25;\n}\n"},hillshade:{fragmentSource:"uniform sampler2D u_image;\nvarying vec2 v_pos;\n\nuniform vec2 u_latrange;\nuniform vec2 u_light;\nuniform vec4 u_shadow;\nuniform vec4 u_highlight;\nuniform vec4 u_accent;\n\n#define PI 3.141592653589793\n\nvoid main() {\n    vec4 pixel = texture2D(u_image, v_pos);\n\n    vec2 deriv = ((pixel.rg * 2.0) - 1.0);\n\n    // We divide the slope by a scale factor based on the cosin of the pixel's approximate latitude\n    // to account for mercator projection distortion. see #4807 for details\n    float scaleFactor = cos(radians((u_latrange[0] - u_latrange[1]) * (1.0 - v_pos.y) + u_latrange[1]));\n    // We also multiply the slope by an arbitrary z-factor of 1.25\n    float slope = atan(1.25 * length(deriv) / scaleFactor);\n    float aspect = deriv.x != 0.0 ? atan(deriv.y, -deriv.x) : PI / 2.0 * (deriv.y > 0.0 ? 1.0 : -1.0);\n\n    float intensity = u_light.x;\n    // We add PI to make this property match the global light object, which adds PI/2 to the light's azimuthal\n    // position property to account for 0deg corresponding to north/the top of the viewport in the style spec\n    // and the original shader was written to accept (-illuminationDirection - 90) as the azimuthal.\n    float azimuth = u_light.y + PI;\n\n    // We scale the slope exponentially based on intensity, using a calculation similar to\n    // the exponential interpolation function in the style spec:\n    // https://github.com/mapbox/mapbox-gl-js/blob/master/src/style-spec/expression/definitions/interpolate.js#L217-L228\n    // so that higher intensity values create more opaque hillshading.\n    float base = 1.875 - intensity * 1.75;\n    float maxValue = 0.5 * PI;\n    float scaledSlope = intensity != 0.5 ? ((pow(base, slope) - 1.0) / (pow(base, maxValue) - 1.0)) * maxValue : slope;\n\n    // The accent color is calculated with the cosine of the slope while the shade color is calculated with the sine\n    // so that the accent color's rate of change eases in while the shade color's eases out.\n    float accent = cos(scaledSlope);\n    // We multiply both the accent and shade color by a clamped intensity value\n    // so that intensities >= 0.5 do not additionally affect the color values\n    // while intensity values < 0.5 make the overall color more transparent.\n    vec4 accent_color = (1.0 - accent) * u_accent * clamp(intensity * 2.0, 0.0, 1.0);\n    float shade = abs(mod((aspect + azimuth) / PI + 0.5, 2.0) - 1.0);\n    vec4 shade_color = mix(u_shadow, u_highlight, shade) * sin(scaledSlope) * clamp(intensity * 2.0, 0.0, 1.0);\n    gl_FragColor = accent_color * (1.0 - shade_color.a) + shade_color;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = a_texture_pos / 8192.0;\n}\n"},line:{fragmentSource:"#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform vec2 u_texsize;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize mediump float width\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float width\n    #pragma mapbox: initialize lowp float floorwidth\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec4 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float width\n    #pragma mapbox: initialize lowp float floorwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos = a_pos_normal.xy;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = a_pos_normal.zw;\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth = gapwidth / 2.0;\n    float halfwidth = width / 2.0;\n    offset = -1.0 * offset;\n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    if (color0.a > 0.0) {\n        color0.rgb = color0.rgb / color0.a;\n    }\n    if (color1.a > 0.0) {\n        color1.rgb = color1.rgb / color1.a;\n    }\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    // We are using Int16 for texture position coordinates to give us enough precision for\n    // fractional coordinates. We use 8192 to scale the texture coordinates in the buffer\n    // as an arbitrarily high number to preserve adequate precision when rendering.\n    // This is also the same value as the EXTENT we are using for our tile buffer pos coordinates,\n    // so math for modifying either is consistent.\n    v_pos0 = (((a_texture_pos / 8192.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\n\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    lowp float alpha = opacity * v_fade_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform float u_fade_change;\n\n#pragma mapbox: define lowp float opacity\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n\n    float size;\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // See comments in symbol_sdf.vertex\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // See comments in symbol_sdf.vertex\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n\n    v_tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    v_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n}\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\n\nuniform bool u_is_halo;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform sampler2D u_texture;\nuniform highp float u_gamma_scale;\nuniform bool u_is_text;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 fill_color\n    #pragma mapbox: initialize highp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 tex = v_data0.xy;\n    float gamma_scale = v_data1.x;\n    float size = v_data1.y;\n    float fade_opacity = v_data1[2];\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    lowp vec4 color = fill_color;\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\n    lowp float buff = (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color = halo_color;\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\n    }\n\n    lowp float dist = texture2D(u_texture, tex).a;\n    highp float gamma_scaled = gamma * gamma_scale;\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n    gl_FragColor = color * (alpha * opacity * fade_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\n// contents of a_size vary based on the type of property value\n// used for {text,icon}-size.\n// For constants, a_size is disabled.\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\n// For composite functions:\n// [ text-size(lowerZoomStop, feature),\n//   text-size(upperZoomStop, feature) ]\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\nuniform highp float u_size; // used when size is both zoom and feature constant\n\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_gl_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform float u_fade_change;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\nvoid main() {\n    #pragma mapbox: initialize highp vec4 fill_color\n    #pragma mapbox: initialize highp vec4 halo_color\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float halo_width\n    #pragma mapbox: initialize lowp float halo_blur\n\n    vec2 a_pos = a_pos_offset.xy;\n    vec2 a_offset = a_pos_offset.zw;\n\n    vec2 a_tex = a_data.xy;\n    vec2 a_size = a_data.zw;\n\n    highp float segment_angle = -a_projected_pos[2];\n    float size;\n\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\n        size = a_size[0] / 10.0;\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\n        size = u_size;\n    } else {\n        size = u_size;\n    }\n\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance = projectedPoint.w;\n    // If the label is pitched with the map, layout is done in pitched space,\n    // which makes labels in the distance smaller relative to viewport space.\n    // We counteract part of that effect by multiplying by the perspective ratio.\n    // If the label isn't pitched with the map, we do layout in viewport space,\n    // which makes labels in the distance larger relative to the features around\n    // them. We counteract part of that effect by dividing by the perspective ratio.\n    highp float distance_ratio = u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\n\n    size *= perspective_ratio;\n\n    float fontScale = u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation = 0.0;\n    if (u_rotate_symbol) {\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\n        // space, project it, and measure its angle in projected space.\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n\n        vec2 a = projectedPoint.xy / projectedPoint.w;\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\n\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\n    float gamma_scale = gl_Position.w;\n\n    vec2 tex = a_tex / u_texsize;\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\n    float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\n\n    v_data0 = vec2(tex.x, tex.y);\n    v_data1 = vec3(gamma_scale, size, interpolated_fade_opacity);\n}\n"}},r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=function(t){var e=n[t],a={};e.fragmentSource=e.fragmentSource.replace(r,function(t,e,i,n,r){return a[r]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nvarying "+i+" "+n+" "+r+";\n#else\nuniform "+i+" "+n+" u_"+r+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+r+"\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n"}),e.vertexSource=e.vertexSource.replace(r,function(t,e,i,n,r){var o="float"===n?"vec2":"vec4";return a[r]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+i+" "+o+" a_"+r+";\nvarying "+i+" "+n+" "+r+";\n#else\nuniform "+i+" "+n+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = unpack_mix_"+o+"(a_"+r+", a_"+r+"_t);\n#else\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+i+" "+o+" a_"+r+";\n#else\nuniform "+i+" "+n+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+i+" "+n+" "+r+" = unpack_mix_"+o+"(a_"+r+", a_"+r+"_t);\n#else\n    "+i+" "+n+" "+r+" = u_"+r+";\n#endif\n"})};for(var a in n)o(a);e.exports=n},{}],98:[function(t,e,i){"use strict";var n=t("./image_source"),o=t("../util/window"),a=t("../data/raster_bounds_attributes"),s=t("../render/vertex_array_object"),l=t("../render/texture"),r=function(r){function t(t,e,i,n){r.call(this,t,e,i,n),this.options=e,this.animate=void 0===e.animate||e.animate}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.load=function(){this.canvas=this.canvas||o.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero.")):(this.play=function(){this._playing=!0,this.map._rerender()},this.pause=function(){this._playing=!1},this._finishLoading())},t.prototype.getCanvas=function(){return this.canvas},t.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},t.prototype.onRemove=function(){this.pause()},t.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var e=this.map.painter.context,i=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,a.members)),this.boundsVAO||(this.boundsVAO=new s),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.canvas)):(this.texture=new l(e,this.canvas,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[n];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},t.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},t.prototype.hasTransition=function(){return this._playing},t.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},t}(n);e.exports=r},{"../data/raster_bounds_attributes":59,"../render/texture":93,"../render/vertex_array_object":95,"../util/window":254,"./image_source":102}],99:[function(t,e,i){"use strict";var n=t("../util/evented"),a=t("../util/util"),s=t("../util/window"),l=t("../data/extent"),u=t("../util/ajax").ResourceType,c=t("../util/browser"),r=function(o){function t(t,e,i,n){o.call(this),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=i,this.setEventedParent(n),this._data=e.data,this._options=a.extend({},e),this._collectResourceTiming=e.collectResourceTiming,this._resourceTiming=[],void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type);var r=l/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*r,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*r,extent:l,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?Math.min(e.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:l,radius:(e.clusterRadius||50)*r,log:!1}},e.workerOptions)}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.load=function(){var i=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){if(t)i.fire("error",{error:t});else{var e={dataType:"source",sourceDataType:"metadata"};i._collectResourceTiming&&i._resourceTiming&&0<i._resourceTiming.length&&(e.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire("data",e)}})},t.prototype.onAdd=function(t){this.map=t,this.load()},t.prototype.setData=function(t){var i=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){if(t)return i.fire("error",{error:t});var e={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&0<i._resourceTiming.length&&(e.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire("data",e)}),this},t.prototype._updateWorkerData=function(i){var t,e,n=this,r=a.extend({},this.workerOptions),o=this._data;"string"==typeof o?(r.request=this.map._transformRequest((t=o,(e=s.document.createElement("a")).href=t,e.href),u.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(o),this.workerID=this.dispatcher.send(this.type+".loadData",r,function(t,e){n._loaded=!0,e&&e.resourceTiming&&e.resourceTiming[n.id]&&(n._resourceTiming=e.resourceTiming[n.id].slice(0)),i(t)},this.workerID)},t.prototype.loadTile=function(i,n){var r=this,o=void 0===i.workerID||"expired"===i.state?"loadTile":"reloadTile",t={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.devicePixelRatio,overscaling:i.tileID.overscaleFactor(),showCollisionBoxes:this.map.showCollisionBoxes};i.workerID=this.dispatcher.send(o,t,function(t,e){return i.unloadVectorData(),i.aborted?n(null):t?n(t):(i.loadVectorData(e,r.map.painter,"reloadTile"===o),n(null))},this.workerID)},t.prototype.abortTile=function(t){t.aborted=!0},t.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},t.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id})},t.prototype.serialize=function(){return a.extend({},this._options,{type:this.type,data:this._data})},t.prototype.hasTransition=function(){return!1},t}(n);e.exports=r},{"../data/extent":53,"../util/ajax":251,"../util/browser":252,"../util/evented":260,"../util/util":275,"../util/window":254}],100:[function(t,e,i){"use strict";function n(t,e){var i=t.source,n=t.tileID.canonical;if(!this._geoJSONIndexes[i])return e(null,null);var r=this._geoJSONIndexes[i].getTile(n.z,n.x,n.y);if(!r)return e(null,null);var o=new u(r.features),a=c(o);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:o,rawData:a.buffer})}var o=t("../util/ajax"),s=t("../util/performance"),l=t("geojson-rewind"),u=t("./geojson_wrapper"),c=t("vt-pbf"),h=t("supercluster"),p=t("geojson-vt"),r=function(r){function t(t,e,i){r.call(this,t,e,n),i&&(this.loadGeoJSON=i),this._geoJSONIndexes={}}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.loadData=function(r,o){var a=this;this.loadGeoJSON(r,function(t,e){if(t||!e)return o(t);if("object"!=typeof e)return o(new Error("Input data is not a valid GeoJSON object."));l(e,!0);try{a._geoJSONIndexes[r.source]=r.cluster?h(r.superclusterOptions).load(e.features):p(e,r.geojsonVtOptions)}catch(t){return o(t)}a.loaded[r.source]={};var i={};if(r.request&&r.request.collectResourceTiming){var n=s.getEntriesByName(r.request.url);n&&(i.resourceTiming={},i.resourceTiming[r.source]=JSON.parse(JSON.stringify(n)))}o(null,i)})},t.prototype.reloadTile=function(t,e){var i=this.loaded[t.source],n=t.uid;return i&&i[n]?r.prototype.reloadTile.call(this,t,e):this.loadTile(t,e)},t.prototype.loadGeoJSON=function(t,e){if(t.request)o.getJSON(t.request,e);else{if("string"!=typeof t.data)return e(new Error("Input data is not a valid GeoJSON object."));try{return e(null,JSON.parse(t.data))}catch(t){return e(new Error("Input data is not a valid GeoJSON object."))}}},t.prototype.removeSource=function(t,e){this._geoJSONIndexes[t.source]&&delete this._geoJSONIndexes[t.source],e()},t}(t("./vector_tile_worker_source"));e.exports=r},{"../util/ajax":251,"../util/performance":268,"./geojson_wrapper":101,"./vector_tile_worker_source":116,"geojson-rewind":15,"geojson-vt":19,supercluster:32,"vt-pbf":34}],101:[function(t,e,i){"use strict";var h=t("@mapbox/point-geometry"),n=t("@mapbox/vector-tile").VectorTileFeature.prototype.toGeoJSON,r=t("../data/extent"),o=function(t){this._feature=t,this.extent=r,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))};o.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],e=0,i=this._feature.geometry;e<i.length;e+=1){var n=i[e];t.push([new h(n[0],n[1])])}return t}for(var r=[],o=0,a=this._feature.geometry;o<a.length;o+=1){for(var s=[],l=0,u=a[o];l<u.length;l+=1){var c=u[l];s.push(new h(c[0],c[1]))}r.push(s)}return r},o.prototype.toGeoJSON=function(t,e,i){return n.call(this,t,e,i)};var a=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r,this.length=t.length,this._features=t};a.prototype.feature=function(t){return new o(this._features[t])},e.exports=a},{"../data/extent":53,"@mapbox/point-geometry":4,"@mapbox/vector-tile":8}],102:[function(t,e,i){"use strict";var o=t("../util/util"),a=t("./tile_id").CanonicalTileID,s=t("../geo/lng_lat"),l=t("@mapbox/point-geometry"),n=t("../util/evented"),u=t("../util/ajax"),c=t("../util/browser"),h=t("../data/extent"),p=t("../data/array_types").RasterBoundsArray,f=t("../data/raster_bounds_attributes"),d=t("../render/vertex_array_object"),m=t("../render/texture"),r=function(r){function t(t,e,i,n){r.call(this),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(n),this.options=e}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.load=function(){var i=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,u.getImage(this.map._transformRequest(this.url,u.ResourceType.Image),function(t,e){t?i.fire("error",{error:t}):e&&(i.image=c.getImageData(e),i._finishLoading())})},t.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire("data",{dataType:"source",sourceDataType:"metadata"}))},t.prototype.onAdd=function(t){this.map=t,this.load()},t.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,i=t.map(function(t){return e.transform.locationCoordinate(s.convert(t)).zoomTo(0)}),n=this.centerCoord=o.getCoordinatesCenter(i);n.column=Math.floor(n.column),n.row=Math.floor(n.row),this.tileID=new a(n.zoom,n.column,n.row),this.minzoom=this.maxzoom=n.zoom;var r=i.map(function(t){var e=t.zoomTo(n.zoom);return new l(Math.round((e.column-n.column)*h),Math.round((e.row-n.row)*h))});return this._boundsArray=new p,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,h,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,h),this._boundsArray.emplaceBack(r[2].x,r[2].y,h,h),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire("data",{dataType:"source",sourceDataType:"content"}),this},t.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,e=t.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,f.members)),this.boundsVAO||(this.boundsVAO=new d),this.texture||(this.texture=new m(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},t.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t).buckets={}:t.state="errored",e(null)},t.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},t.prototype.hasTransition=function(){return!1},t}(n);e.exports=r},{"../data/array_types":39,"../data/extent":53,"../data/raster_bounds_attributes":59,"../geo/lng_lat":62,"../render/texture":93,"../render/vertex_array_object":95,"../util/ajax":251,"../util/browser":252,"../util/evented":260,"../util/util":275,"./tile_id":114,"@mapbox/point-geometry":4}],103:[function(t,e,i){"use strict";var r=t("../util/util"),o=t("../util/ajax"),a=t("../util/browser"),s=t("../util/mapbox").normalizeSourceURL;e.exports=function(t,e,n){var i=function(t,e){if(t)return n(t);if(e){var i=r.pick(e,["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds"]);e.vector_layers&&(i.vectorLayers=e.vector_layers,i.vectorLayerIds=i.vectorLayers.map(function(t){return t.id})),n(null,i)}};t.url?o.getJSON(e(s(t.url),o.ResourceType.Source),i):a.frame(function(){return i(null,t)})}},{"../util/ajax":251,"../util/browser":252,"../util/mapbox":267,"../util/util":275}],104:[function(t,e,i){"use strict";var n=t("../data/extent");e.exports=function(t,e,i){return e*(n/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}},{"../data/extent":53}],105:[function(t,e,i){"use strict";function p(t,e){var i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}i.rendered=function(t,e,i,n,r,o,a){var s=t.tilesIn(i);s.sort(p);for(var l=[],u=0,c=s;u<c.length;u+=1){var h=c[u];l.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,h.queryGeometry,h.scale,n,o,t.id,a)})}return function(t){for(var e={},i={},n=0,r=t;n<r.length;n+=1){var o=r[n],a=o.queryResults,s=o.wrappedTileID,l=i[s]=i[s]||{};for(var u in a)for(var c=a[u],h=l[u]=l[u]||{},p=e[u]=e[u]||[],f=0,d=c;f<d.length;f+=1){var m=d[f];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m.feature))}}return e}(l)},i.source=function(e,t){for(var i=e.getRenderableIds().map(function(t){return e.getTileByID(t)}),n=[],r={},o=0;o<i.length;o++){var a=i[o],s=a.tileID.canonical.key;r[s]||(r[s]=!0,a.querySourceFeatures(n,t))}return n}},{}],106:[function(t,e,i){"use strict";var n=t("../util/ajax"),o=t("../util/util"),a=(t("../util/evented"),t("../util/mapbox").normalizeTileURL),s=t("../util/browser"),l=t("./tile_id").OverscaledTileID,r=function(r){function t(t,e,i,n){r.call(this,t,e,i,n),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({},e)}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds}},t.prototype.loadTile=function(r,o){var t=a(r.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);r.request=n.getImage(this.map._transformRequest(t,n.ResourceType.Tile),function(t,e){if(delete r.request,r.aborted)r.state="unloaded",o(null);else if(t)r.state="errored",o(t);else if(e){this.map._refreshExpiredTiles&&r.setExpiryData(e),delete e.cacheControl,delete e.expires;var i=s.getImageData(e),n={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:i};r.workerID&&"expired"!==r.state||(r.workerID=this.dispatcher.send("loadDEMTile",n,function(t,e){t&&(r.state="errored",o(t)),e&&(r.dem=e,r.needsHillshadePrepare=!0,r.state="loaded",o(null))}.bind(this)))}}.bind(this)),r.neighboringTiles=this._getNeighboringTiles(r.tileID)},t.prototype._getNeighboringTiles=function(t){var e=t.canonical,i=Math.pow(2,e.z),n=(e.x-1+i)%i,r=0===e.x?t.wrap-1:t.wrap,o=(e.x+1+i)%i,a=e.x+1===i?t.wrap+1:t.wrap,s={};return s[new l(t.overscaledZ,r,e.z,n,e.y).key]={backfilled:!1},s[new l(t.overscaledZ,a,e.z,o,e.y).key]={backfilled:!1},0<e.y&&(s[new l(t.overscaledZ,r,e.z,n,e.y-1).key]={backfilled:!1},s[new l(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},s[new l(t.overscaledZ,a,e.z,o,e.y-1).key]={backfilled:!1}),e.y+1<i&&(s[new l(t.overscaledZ,r,e.z,n,e.y+1).key]={backfilled:!1},s[new l(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},s[new l(t.overscaledZ,a,e.z,o,e.y+1).key]={backfilled:!1}),s},t.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},t}(t("./raster_tile_source"));e.exports=r},{"../util/ajax":251,"../util/browser":252,"../util/evented":260,"../util/mapbox":267,"../util/util":275,"./raster_tile_source":108,"./tile_id":114}],107:[function(t,e,i){"use strict";var o=t("../data/dem_data").DEMData,n=function(){this.loading={},this.loaded={}};n.prototype.loadTile=function(t,e){var i=t.source,n=t.uid;this.loading[i]||(this.loading[i]={});var r=new o(n);(this.loading[i][n]=r).loadFromImage(t.rawImageData),delete this.loading[i][n],this.loaded[i]=this.loaded[i]||{},e(null,this.loaded[i][n]=r)},n.prototype.removeTile=function(t){var e=this.loaded[t.source],i=t.uid;e&&e[i]&&delete e[i]},e.exports=n},{"../data/dem_data":52}],108:[function(t,e,i){"use strict";var o=t("../util/util"),n=t("../util/ajax"),r=t("../util/evented"),a=t("./load_tilejson"),s=t("../util/mapbox").normalizeTileURL,l=t("./tile_bounds"),u=t("../render/texture"),c=function(r){function t(t,e,i,n){r.call(this),this.id=t,this.dispatcher=i,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({},e),o.extend(this,o.pick(e,["url","scheme","tileSize"]))}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.load=function(){var i=this;this.fire("dataloading",{dataType:"source"}),a(this._options,this.map._transformRequest,function(t,e){t?i.fire("error",t):e&&(o.extend(i,e),e.bounds&&(i.tileBounds=new l(e.bounds,i.minzoom,i.maxzoom)),i.fire("data",{dataType:"source",sourceDataType:"metadata"}),i.fire("data",{dataType:"source",sourceDataType:"content"}))})},t.prototype.onAdd=function(t){this.map=t,this.load()},t.prototype.serialize=function(){return o.extend({},this._options)},t.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},t.prototype.loadTile=function(r,o){var a=this,t=s(r.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);r.request=n.getImage(this.map._transformRequest(t,n.ResourceType.Tile),function(t,e){if(delete r.request,r.aborted)r.state="unloaded",o(null);else if(t)r.state="errored",o(t);else if(e){a.map._refreshExpiredTiles&&r.setExpiryData(e),delete e.cacheControl,delete e.expires;var i=a.map.painter.context,n=i.gl;r.texture=a.map.painter.getTileTexture(e.width),r.texture?(r.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e)):(r.texture=new u(i,e,n.RGBA),r.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),n.generateMipmap(n.TEXTURE_2D),r.state="loaded",o(null)}})},t.prototype.abortTile=function(t,e){t.request&&(t.request.abort(),delete t.request),e()},t.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},t.prototype.hasTransition=function(){return!1},t}(r);e.exports=c},{"../render/texture":93,"../util/ajax":251,"../util/evented":260,"../util/mapbox":267,"../util/util":275,"./load_tilejson":103,"./tile_bounds":113}],109:[function(t,n,e){"use strict";var r=t("../util/ajax"),i=t("../util/evented"),o=t("../util/window"),a=!1,s=null;n.exports.evented=new i,n.exports.registerForPluginAvailability=function(t){return s?t({pluginBlobURL:s,errorCallback:n.exports.errorCallback}):n.exports.evented.once("pluginAvailable",t),t},n.exports.createBlobURL=function(t){return o.URL.createObjectURL(new o.Blob([t.data],{type:"text/javascript"}))},n.exports.clearRTLTextPlugin=function(){a=!1,s=null},n.exports.setRTLTextPlugin=function(t,i){if(a)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=!0,n.exports.errorCallback=i,r.getArrayBuffer({url:t},function(t,e){t?i(t):e&&(s=n.exports.createBlobURL(e),n.exports.evented.fire("pluginAvailable",{pluginBlobURL:s,errorCallback:i}))})},n.exports.applyArabicShaping=null,n.exports.processBidirectionalText=null},{"../util/ajax":251,"../util/evented":260,"../util/window":254}],110:[function(t,e,i){"use strict";var o=t("../util/util"),a={vector:t("../source/vector_tile_source"),raster:t("../source/raster_tile_source"),"raster-dem":t("../source/raster_dem_tile_source"),geojson:t("../source/geojson_source"),video:t("../source/video_source"),image:t("../source/image_source"),canvas:t("../source/canvas_source")};i.create=function(t,e,i,n){var r=new a[e.type](t,e,i,n);if(r.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+r.id);return o.bindAll(["load","abort","unload","serialize","prepare"],r),r},i.getType=function(t){return a[t]},i.setType=function(t,e){a[t]=e}},{"../source/canvas_source":98,"../source/geojson_source":99,"../source/image_source":102,"../source/raster_dem_tile_source":106,"../source/raster_tile_source":108,"../source/vector_tile_source":115,"../source/video_source":117,"../util/util":275}],111:[function(t,e,i){"use strict";function y(t,e){var i=e.zoomTo(t.canonical.z);return new s((i.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*b,(i.row-t.canonical.y)*b)}function g(t){return"raster"===t||"image"===t||"video"===t}var o=t("./source").create,n=t("./tile"),r=t("../util/evented"),a=t("../util/lru_cache"),v=t("../geo/coordinate"),x=t("../util/util"),b=t("../data/extent"),s=(t("../gl/context"),t("@mapbox/point-geometry")),w=t("../util/browser"),T=t("./tile_id").OverscaledTileID,l=function(r){function _(t,e,i){var n=this;r.call(this),this.id=t,this.dispatcher=i,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(n._sourceLoaded=!0),n._sourceLoaded&&!n._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(n.reload(),n.transform&&n.update(n.transform))}),this.on("error",function(){n._sourceErrored=!0}),this._source=o(t,e,i,this),this._tiles={},this._cache=new a(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={}}return r&&(_.__proto__=r),((_.prototype=Object.create(r&&r.prototype)).constructor=_).prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},_.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},_.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},_.prototype.getSource=function(){return this._source},_.prototype.pause=function(){this._paused=!0},_.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},_.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},_.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},_.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},_.prototype.serialize=function(){return this._source.serialize()},_.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._tiles)this._tiles[e].upload(t)},_.prototype.getIds=function(){var a=this;return Object.keys(this._tiles).map(Number).sort(function(t,e){var i=a._tiles[t].tileID,n=a._tiles[e].tileID,r=new s(i.canonical.x,i.canonical.y).rotate(a.transform.angle),o=new s(n.canonical.x,n.canonical.y).rotate(a.transform.angle);return i.overscaledZ-n.overscaledZ||o.y-r.y||o.x-r.x})},_.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},_.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0,{});return!!e&&this._isIdRenderable(e.tileID.key)},_.prototype._isIdRenderable=function(t){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]},_.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._resetCache(),this._tiles)this._reloadTile(t,"reloading")},_.prototype._reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))},_.prototype._tileLoaded=function(t,e,i,n){if(n)return t.state="errored",void(404!==n.status?this._source.fire("error",{tile:t,error:n}):this.update(this.transform));t.timeAdded=w.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._source.fire("data",{dataType:"source",tile:t,coord:t.tileID}),this.map&&(this.map.painter.tileExtentVAO.vao=null)},_.prototype._backfillDEM=function(t){function e(t,e){t.needsHillshadePrepare=!0;var i=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===n||1<Math.abs(n)||(1<Math.abs(i)&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}for(var i=this.getRenderableIds(),n=0;n<i.length;n++){var r=i[n];if(t.neighboringTiles&&t.neighboringTiles[r]){var o=this.getTileByID(r);e(t,o),e(o,t)}}},_.prototype.getTile=function(t){return this.getTileByID(t.key)},_.prototype.getTileByID=function(t){return this._tiles[t]},_.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},_.prototype._findLoadedChildren=function(t,e,i){var n=!1;for(var r in this._tiles){var o=this._tiles[r];if(!(i[r]||!o.hasData()||o.tileID.overscaledZ<=t.overscaledZ||o.tileID.overscaledZ>e)){var a=Math.pow(2,o.tileID.canonical.z-t.canonical.z);if(Math.floor(o.tileID.canonical.x/a)===t.canonical.x&&Math.floor(o.tileID.canonical.y/a)===t.canonical.y)for(i[r]=o.tileID,n=!0;o&&o.tileID.overscaledZ-1>t.overscaledZ;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);if(!s)break;(o=this._tiles[s.key])&&o.hasData()&&(delete i[r],i[s.key]=s)}}}return n},_.prototype.findLoadedParent=function(t,e,i){for(var n=t.overscaledZ-1;e<=n;n--){var r=t.scaledTo(n);if(!r)return;var o=String(r.key),a=this._tiles[o];if(a&&a.hasData())return i[o]=r,a;if(this._cache.has(o))return i[o]=r,this._cache.get(o)}},_.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),i=Math.floor(5*e),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(n)},_.prototype.update=function(t){var e=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(t),this._coveredTiles={},this.used?this._source.tileID?i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(t){return new T(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)}):(i=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter(function(t){return e._source.hasTile(t)}))):i=[];var n,r=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),o=Math.max(r-_.maxOverzooming,this._source.minzoom),a=Math.max(r+_.maxUnderzooming,this._source.minzoom),s=this._updateRetainedTiles(i,r),l={};if(g(this._source.type))for(var u=Object.keys(s),c=0;c<u.length;c++){var h=u[c],p=s[h],f=e._tiles[h];if(f&&(void 0===f.fadeEndTime||f.fadeEndTime>=w.now())){e._findLoadedChildren(p,a,s)&&(s[h]=p);var d=e.findLoadedParent(p,o,l);d&&e._addTile(d.tileID)}}for(n in l)s[n]||(e._coveredTiles[n]=!0);for(n in l)s[n]=l[n];for(var m=x.keysDifference(this._tiles,s),y=0;y<m.length;y++)e._removeTile(m[y])}},_.prototype._updateRetainedTiles=function(t,e){for(var i={},n={},r=Math.max(e-_.maxOverzooming,this._source.minzoom),o=Math.max(e+_.maxUnderzooming,this._source.minzoom),a=0;a<t.length;a++){var s=t[a],l=this._addTile(s),u=!1;if(l.hasData())i[s.key]=s;else{u=l.wasRequested(),i[s.key]=s;var c=!0;if(e+1>this._source.maxzoom){var h=s.children(this._source.maxzoom)[0],p=this.getTile(h);p&&p.hasData()?i[h.key]=h:c=!1}else{this._findLoadedChildren(s,o,i);for(var f=s.children(this._source.maxzoom),d=0;d<f.length;d++)if(!i[f[d].key]){c=!1;break}}if(!c)for(var m=s.overscaledZ-1;r<=m;--m){var y=s.scaledTo(m);if(n[y.key])break;if(n[y.key]=!0,!(l=this.getTile(y))&&u&&(l=this._addTile(y)),l&&(i[y.key]=y,u=l.wasRequested(),l.hasData()))break}}}return i},_.prototype._addTile=function(t){var e=this._tiles[t.key];if(e)return e;(e=this._cache.getAndRemove(t.key))&&this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e));var i=Boolean(e);return i||(e=new n(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire("dataloading",{tile:e,coord:e.tileID,dataType:"source"}),e):null},_.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(function(){i._reloadTile(t,"expired"),delete i._timers[t]},n))},_.prototype._setCacheInvalidationTimer=function(t,e){var i=this;t in this._cacheTimers&&(clearTimeout(this._cacheTimers[t]),delete this._cacheTimers[t]);var n=e.getExpiryTimeout();n&&(this._cacheTimers[t]=setTimeout(function(){i._cache.remove(t),delete i._cacheTimers[t]},n))},_.prototype._removeTile=function(t){var e=this._tiles[t];if(e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),!(0<e.uses)))if(e.hasData()){e.tileID=e.tileID.wrapped();var i=e.tileID.key;this._cache.add(i,e),this._setCacheInvalidationTimer(i,e)}else e.aborted=!0,this._abortTile(e),this._unloadTile(e)},_.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._resetCache()},_.prototype._resetCache=function(){for(var t in this._cacheTimers)clearTimeout(this._cacheTimers[t]);this._cacheTimers={},this._cache.reset()},_.prototype.tilesIn=function(t){for(var e=[],i=this.getIds(),n=1/0,r=1/0,o=-1/0,a=-1/0,s=t[0].zoom,l=0;l<t.length;l++){var u=t[l];n=Math.min(n,u.column),r=Math.min(r,u.row),o=Math.max(o,u.column),a=Math.max(a,u.row)}for(var c=0;c<i.length;c++){var h=this._tiles[i[c]],p=h.tileID,f=[y(p,new v(n,r,s)),y(p,new v(o,a,s))];if(f[0].x<b&&f[0].y<b&&0<=f[1].x&&0<=f[1].y){for(var d=[],m=0;m<t.length;m++)d.push(y(p,t[m]));e.push({tile:h,tileID:p,queryGeometry:[d],scale:Math.pow(2,this.transform.zoom-h.tileID.overscaledZ)})}}return e},_.prototype.getVisibleCoordinates=function(){for(var e=this,t=this.getRenderableIds().map(function(t){return e._tiles[t].tileID}),i=0,n=t;i<n.length;i+=1){var r=n[i];r.posMatrix=e.transform.calculatePosMatrix(r.toUnwrapped())}return t},_.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(g(this._source.type))for(var t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=w.now())return!0}return!1},_}(r);l.maxOverzooming=10,l.maxUnderzooming=3,e.exports=l},{"../data/extent":53,"../geo/coordinate":61,"../gl/context":66,"../util/browser":252,"../util/evented":260,"../util/lru_cache":266,"../util/util":275,"./source":110,"./tile":112,"./tile_id":114,"@mapbox/point-geometry":4}],112:[function(t,e,i){"use strict";var p=t("../util/util"),o=t("../data/bucket").deserialize,u=(t("../data/feature_index"),t("@mapbox/vector-tile")),c=t("pbf"),h=t("../util/vectortile_to_geojson"),f=t("../style-spec/feature_filter"),d=(t("../symbol/collision_index"),t("../data/bucket/symbol_bucket")),n=t("../data/array_types"),m=n.RasterBoundsArray,a=n.CollisionBoxArray,y=t("../data/raster_bounds_attributes"),_=t("../data/extent"),g=t("@mapbox/point-geometry"),r=t("../render/texture"),v=t("../data/segment").SegmentVector,x=t("../data/index_array_type").TriangleIndexArray,s=t("../util/browser"),l=function(t,e){this.tileID=t,this.uid=p.uniqueId(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.expiredRequestCount=0,this.state="loading"};l.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<s.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},l.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},l.prototype.loadVectorData=function(t,e,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.rawTileData&&(this.rawTileData=t.rawTileData),this.collisionBoxArray=t.collisionBoxArray,this.featureIndex=t.featureIndex,this.featureIndex.rawTileData=this.rawTileData,this.buckets=o(t.buckets,e.style),i)for(var n in this.buckets){var r=this.buckets[n];r instanceof d&&(r.justReloaded=!0)}t.iconAtlasImage&&(this.iconAtlasImage=t.iconAtlasImage),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a},l.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.iconAtlasTexture&&this.iconAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.collisionBoxArray=null,this.featureIndex=null,this.state="unloaded"},l.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},l.prototype.getBucket=function(t){return this.buckets[t.id]},l.prototype.upload=function(t){for(var e in this.buckets){var i=this.buckets[e];i.uploaded||(i.upload(t),i.uploaded=!0)}var n=t.gl;this.iconAtlasImage&&(this.iconAtlasTexture=new r(t,this.iconAtlasImage,n.RGBA),this.iconAtlasImage=null),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},l.prototype.queryRenderedFeatures=function(t,e,i,n,r,o,a){if(!this.featureIndex||!this.collisionBoxArray)return{};var s=0,l={};for(var u in t){var c=this.getBucket(t[u]);c&&(s=Math.max(s,t[u].queryRadius(c)),c instanceof d&&void 0!==c.bucketInstanceId&&(l[c.bucketInstanceId]=!0))}return this.featureIndex.query({queryGeometry:e,scale:i,tileSize:this.tileSize,bearing:r,params:n,additionalRadius:s,collisionBoxArray:this.collisionBoxArray,sourceID:o,collisionIndex:a,bucketInstanceIds:l},t)},l.prototype.querySourceFeatures=function(t,e){if(this.rawTileData){this.vtLayers||(this.vtLayers=new u.VectorTile(new c(this.rawTileData)).layers);var i=e?e.sourceLayer:"",n=this.vtLayers._geojsonTileLayer||this.vtLayers[i];if(n)for(var r=f(e&&e.filter),o={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y},a=0;a<n.length;a++){var s=n.feature(a);if(r({zoom:this.tileID.overscaledZ},s)){var l=new h(s,o.z,o.x,o.y);l.tile=o,t.push(l)}}}},l.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},l.prototype.setMask=function(t,e){if(!p.deepEqual(this.mask,t)&&(this.mask=t,this.clearMask(),!p.deepEqual(t,{0:!0}))){var i=new m,n=new x;this.segments=new v,this.segments.prepareSegment(0,i,n);for(var r=Object.keys(t),o=0;o<r.length;o++){var a=t[r[o]],s=_>>a.z,l=new g(a.x*s,a.y*s),u=new g(l.x+s,l.y+s),c=this.segments.prepareSegment(4,i,n);i.emplaceBack(l.x,l.y,l.x,l.y),i.emplaceBack(u.x,l.y,u.x,l.y),i.emplaceBack(l.x,u.y,l.x,u.y),i.emplaceBack(u.x,u.y,u.x,u.y);var h=c.vertexLength;n.emplaceBack(h,h+1,h+2),n.emplaceBack(h+1,h+2,h+3),c.vertexLength+=4,c.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(i,y.members),this.maskedIndexBuffer=e.createIndexBuffer(n)}},l.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},l.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var i=p.parseCacheControl(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),r=!1;if(this.expirationTime>n)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{var o=this.expirationTime-e;o?this.expirationTime=n+Math.max(o,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},l.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},e.exports=l},{"../data/array_types":39,"../data/bucket":40,"../data/bucket/symbol_bucket":51,"../data/extent":53,"../data/feature_index":54,"../data/index_array_type":55,"../data/raster_bounds_attributes":59,"../data/segment":60,"../render/texture":93,"../style-spec/feature_filter":148,"../symbol/collision_index":217,"../util/browser":252,"../util/util":275,"../util/vectortile_to_geojson":276,"@mapbox/point-geometry":4,"@mapbox/vector-tile":8,pbf:30}],113:[function(t,e,i){"use strict";var n=t("../geo/lng_lat_bounds"),r=t("../util/util").clamp,o=function(t,e,i){this.bounds=n.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24};o.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},o.prototype.contains=function(t){var e=Math.floor(this.lngX(this.bounds.getWest(),t.z)),i=Math.floor(this.latY(this.bounds.getNorth(),t.z)),n=Math.ceil(this.lngX(this.bounds.getEast(),t.z)),r=Math.ceil(this.latY(this.bounds.getSouth(),t.z));return t.x>=e&&t.x<n&&t.y>=i&&t.y<r},o.prototype.lngX=function(t,e){return(t+180)*(Math.pow(2,e)/360)},o.prototype.latY=function(t,e){var i=r(Math.sin(Math.PI/180*t),-.9999,.9999),n=Math.pow(2,e)/(2*Math.PI);return Math.pow(2,e-1)+.5*Math.log((1+i)/(1-i))*-n},e.exports=o},{"../geo/lng_lat_bounds":63,"../util/util":275}],114:[function(t,e,i){"use strict";function o(t,e,i,n){(t*=2)<0&&(t=-1*t-1);var r=1<<e;return 32*(r*r*t+r*n+i)+e}var r=t("@mapbox/whoots-js"),n=t("../util/web_worker_transfer").register,a=t("../geo/coordinate"),s=function(t,e,i){this.z=t,this.x=e,this.y=i,this.key=o(0,t,e,i)};s.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},s.prototype.url=function(t,e){var i=r.getTileBBox(this.x,this.y,this.z),n=function(t,e,i){for(var n,r="",o=t;0<o;o--)r+=(e&(n=1<<o-1)?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)};var l=function(t,e){this.wrap=t,this.canonical=e,this.key=o(t,e.z,e.x,e.y)},u=function(t,e,i,n,r){this.overscaledZ=t,this.wrap=e,this.canonical=new s(i,+n,+r),this.key=o(e,t,n,r)};u.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new u(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new u(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},u.prototype.isChildOf=function(t){var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},u.prototype.children=function(t){if(this.overscaledZ>=t)return[new u(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new u(e,this.wrap,e,i,n),new u(e,this.wrap,e,i+1,n),new u(e,this.wrap,e,i,n+1),new u(e,this.wrap,e,i+1,n+1)]},u.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},u.prototype.wrapped=function(){return new u(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},u.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},u.prototype.toUnwrapped=function(){return new l(this.wrap,this.canonical)},u.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},u.prototype.toCoordinate=function(){return new a(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)},n("CanonicalTileID",s),n("OverscaledTileID",u,{omit:["posMatrix"]}),e.exports={CanonicalTileID:s,OverscaledTileID:u,UnwrappedTileID:l}},{"../geo/coordinate":61,"../util/web_worker_transfer":278,"@mapbox/whoots-js":12}],115:[function(t,e,i){"use strict";var n=t("../util/evented"),o=t("../util/util"),a=t("./load_tilejson"),s=t("../util/mapbox").normalizeTileURL,l=t("./tile_bounds"),u=t("../util/ajax").ResourceType,c=t("../util/browser"),r=function(r){function t(t,e,i,n){if(r.call(this),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,o.extend(this,o.pick(e,["url","scheme","tileSize"])),this._options=o.extend({type:"vector"},e),this._collectResourceTiming=e.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n)}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.load=function(){var i=this;this.fire("dataloading",{dataType:"source"}),a(this._options,this.map._transformRequest,function(t,e){t?i.fire("error",t):e&&(o.extend(i,e),e.bounds&&(i.tileBounds=new l(e.bounds,i.minzoom,i.maxzoom)),i.fire("data",{dataType:"source",sourceDataType:"metadata"}),i.fire("data",{dataType:"source",sourceDataType:"content"}))})},t.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},t.prototype.onAdd=function(t){this.map=t,this.load()},t.prototype.serialize=function(){return o.extend({},this._options)},t.prototype.loadTile=function(i,n){function t(t,e){return i.aborted?n(null):t?n(t):(e&&e.resourceTiming&&(i.resourceTiming=e.resourceTiming),this.map._refreshExpiredTiles&&i.setExpiryData(e),i.loadVectorData(e,this.map.painter),n(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}var e=i.tileID.overscaleFactor(),r=s(i.tileID.canonical.url(this.tiles,this.scheme),this.url),o={request:this.map._transformRequest(r,u.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*e,type:this.type,source:this.id,pixelRatio:c.devicePixelRatio,overscaling:e,showCollisionBoxes:this.map.showCollisionBoxes};o.request.collectResourceTiming=this._collectResourceTiming,void 0===i.workerID||"expired"===i.state?i.workerID=this.dispatcher.send("loadTile",o,t.bind(this)):"loading"===i.state?i.reloadCallback=n:this.dispatcher.send("reloadTile",o,t.bind(this),i.workerID)},t.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},t.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},t.prototype.hasTransition=function(){return!1},t}(n);e.exports=r},{"../util/ajax":251,"../util/browser":252,"../util/evented":260,"../util/mapbox":267,"../util/util":275,"./load_tilejson":103,"./tile_bounds":113}],116:[function(t,e,i){"use strict";function n(t,i){var e=r.getArrayBuffer(t.request,function(t,e){t?i(t):e&&i(null,{vectorTile:new o.VectorTile(new a(e.data)),rawData:e.data,cacheControl:e.cacheControl,expires:e.expires})});return function(){e.abort(),i()}}var r=t("../util/ajax"),o=t("@mapbox/vector-tile"),a=t("pbf"),p=t("./worker_tile"),f=t("../util/util"),d=t("../util/performance"),s=function(t,e,i){this.actor=t,this.layerIndex=e,this.loadVectorData=i||n,this.loading={},this.loaded={}};s.prototype.loadTile=function(a,s){var l=this,u=a.source,c=a.uid;this.loading[u]||(this.loading[u]={});var h=this.loading[u][c]=new p(a);h.abort=this.loadVectorData(a,function(t,e){if(delete l.loading[u][c],t||!e)return s(t);var i=e.rawData,n={};e.expires&&(n.expires=e.expires),e.cacheControl&&(n.cacheControl=e.cacheControl);var r={};if(a.request&&a.request.collectResourceTiming){var o=d.getEntriesByName(a.request.url);o&&(r.resourceTiming=JSON.parse(JSON.stringify(o)))}h.vectorTile=e.vectorTile,h.parse(e.vectorTile,l.layerIndex,l.actor,function(t,e){if(t||!e)return s(t);s(null,f.extend({rawTileData:i.slice(0)},e,n,r))}),l.loaded[u]=l.loaded[u]||{},l.loaded[u][c]=h})},s.prototype.reloadTile=function(t,n){var e=this.loaded[t.source],i=t.uid,r=this;if(e&&e[i]){var o=e[i];o.showCollisionBoxes=t.showCollisionBoxes,"parsing"===o.status?o.reloadCallback=n:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,function(t,e){if(this.reloadCallback){var i=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,r.layerIndex,r.actor,i)}n(t,e)}.bind(o))}},s.prototype.abortTile=function(t,e){var i=this.loading[t.source],n=t.uid;i&&i[n]&&i[n].abort&&(i[n].abort(),delete i[n]),e()},s.prototype.removeTile=function(t,e){var i=this.loaded[t.source],n=t.uid;i&&i[n]&&delete i[n],e()},e.exports=s},{"../util/ajax":251,"../util/performance":268,"../util/util":275,"./worker_tile":119,"@mapbox/vector-tile":8,pbf:30}],117:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("./image_source"),o=t("../data/raster_bounds_attributes"),a=t("../render/vertex_array_object"),s=t("../render/texture"),l=function(r){function t(t,e,i,n){r.call(this,t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.load=function(){var i=this,t=this.options;this.urls=t.urls,n.getVideo(t.urls,function(t,e){t?i.fire("error",{error:t}):e&&(i.video=e,i.video.loop=!0,i.video.addEventListener("playing",function(){i.map._rerender()}),i.map&&i.video.play(),i._finishLoading())})},t.prototype.getVideo=function(){return this.video},t.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},t.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,e=t.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,o.members)),this.boundsVAO||(this.boundsVAO=new a),this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new s(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},t.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},t.prototype.hasTransition=function(){return this.video&&!this.video.paused},t}(r);e.exports=l},{"../data/raster_bounds_attributes":59,"../render/texture":93,"../render/vertex_array_object":95,"../util/ajax":251,"./image_source":102}],118:[function(t,e,i){"use strict";var n=t("../util/actor"),r=t("../style/style_layer_index"),o=t("./vector_tile_worker_source"),a=t("./raster_dem_tile_worker_source"),s=t("./geojson_worker_source"),l=t("./rtl_text_plugin"),u=function(t){var i=this;this.self=t,this.actor=new n(t,this),this.layerIndexes={},this.workerSourceTypes={vector:o,geojson:s},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(i.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');i.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(t){if(l.applyArabicShaping||l.processBidirectionalText)throw new Error("RTL text plugin already registered.");l.applyArabicShaping=t.applyArabicShaping,l.processBidirectionalText=t.processBidirectionalText}};u.prototype.setLayers=function(t,e,i){this.getLayerIndex(t).replace(e),i()},u.prototype.updateLayers=function(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()},u.prototype.loadTile=function(t,e,i){this.getWorkerSource(t,e.type).loadTile(e,i)},u.prototype.loadDEMTile=function(t,e,i){this.getDEMWorkerSource(t).loadTile(e,i)},u.prototype.reloadTile=function(t,e,i){this.getWorkerSource(t,e.type).reloadTile(e,i)},u.prototype.abortTile=function(t,e,i){this.getWorkerSource(t,e.type).abortTile(e,i)},u.prototype.removeTile=function(t,e,i){this.getWorkerSource(t,e.type).removeTile(e,i)},u.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t).removeTile(e)},u.prototype.removeSource=function(t,e,i){var n=this.getWorkerSource(t,e.type);void 0!==n.removeSource?n.removeSource(e,i):i()},u.prototype.loadWorkerSource=function(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t)}},u.prototype.loadRTLTextPlugin=function(t,e,i){try{l.applyArabicShaping||l.processBidirectionalText||(this.self.importScripts(e),l.applyArabicShaping&&l.processBidirectionalText||i(new Error("RTL Text Plugin failed to import scripts from "+e)))}catch(t){i(t)}},u.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},u.prototype.getWorkerSource=function(n,t){var r=this;if(this.workerSources[n]||(this.workerSources[n]={}),!this.workerSources[n][t]){var e={send:function(t,e,i){r.actor.send(t,e,i,n)}};this.workerSources[n][t]=new this.workerSourceTypes[t](e,this.getLayerIndex(n))}return this.workerSources[n][t]},u.prototype.getDEMWorkerSource=function(t){return this.demWorkerSources[t]||(this.demWorkerSources[t]=new a),this.demWorkerSources[t]},e.exports=function(t){return new u(t)}},{"../style/style_layer_index":210,"../util/actor":250,"./geojson_worker_source":100,"./raster_dem_tile_worker_source":107,"./rtl_text_plugin":109,"./vector_tile_worker_source":116}],119:[function(t,e,i){"use strict";function M(t,e){for(var i=new o(e),n=0,r=t;n<r.length;n+=1)r[n].recalculate(i)}var E=t("../data/feature_index"),L=t("../symbol/symbol_layout").performSymbolLayout,z=t("../data/array_types").CollisionBoxArray,P=t("../util/dictionary_coder"),C=t("../data/bucket/symbol_bucket"),I=t("../util/util"),k=t("../render/image_atlas").makeImageAtlas,R=t("../render/glyph_atlas").makeGlyphAtlas,o=t("../style/evaluation_parameters"),n=t("./tile_id").OverscaledTileID,r=function(t){this.tileID=new n(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=t.overscaling,this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming};r.prototype.parse=function(t,e,i,r){function n(){if(b)return r(b);if(w&&T){var t=R(w),e=k(T);for(var i in l){var n=l[i];n instanceof C&&(M(n.layers,this.zoom),L(n,w,t.positions,T,e.positions,this.showCollisionBoxes))}this.status="done",r(null,{buckets:I.values(l).filter(function(t){return!t.isEmpty()}),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,iconAtlasImage:e.image})}}var o=this;this.status="parsing",this.data=t,this.collisionBoxArray=new z;var a=new P(Object.keys(t.layers).sort()),s=new E(this.tileID,this.overscaling);s.bucketLayerIDs=[];var l={},u={featureIndex:s,iconDependencies:{},glyphDependencies:{}},c=e.familiesBySource[this.source];for(var h in c){var p=t.layers[h];if(p){1===p.version&&I.warnOnce('Vector tile source "'+o.source+'" layer "'+h+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var f=a.encode(h),d=[],m=0;m<p.length;m++){var y=p.feature(m);d.push({feature:y,index:m,sourceLayerIndex:f})}for(var _=0,g=c[h];_<g.length;_+=1){var v=g[_],x=v[0];x.minzoom&&o.zoom<Math.floor(x.minzoom)||x.maxzoom&&o.zoom>=x.maxzoom||"none"===x.visibility||(M(v,o.zoom),(l[x.id]=x.createBucket({index:s.bucketLayerIDs.length,layers:v,zoom:o.zoom,pixelRatio:o.pixelRatio,overscaling:o.overscaling,collisionBoxArray:o.collisionBoxArray})).populate(d,u),s.bucketLayerIDs.push(v.map(function(t){return t.id})))}}}var b,w,T,S=I.mapObject(u.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(S).length?i.send("getGlyphs",{uid:this.uid,stacks:S},function(t,e){b||(b=t,w=e,n.call(o))}):w={};var A=Object.keys(u.iconDependencies);A.length?i.send("getImages",{icons:A},function(t,e){b||(b=t,T=e,n.call(o))}):T={},n.call(this)},e.exports=r},{"../data/array_types":39,"../data/bucket/symbol_bucket":51,"../data/feature_index":54,"../render/glyph_atlas":85,"../render/image_atlas":87,"../style/evaluation_parameters":182,"../symbol/symbol_layout":227,"../util/dictionary_coder":257,"../util/util":275,"./tile_id":114}],120:[function(t,e,i){"use strict";function r(t,e){var i={};for(var n in t)"ref"!==n&&(i[n]=t[n]);return o.forEach(function(t){t in e&&(i[t]=e[t])}),i}var o=t("./util/ref_properties");e.exports=function(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=r(t[n],e[t[n].ref]));return t}},{"./util/ref_properties":159}],121:[function(t,e,i){"use strict";function l(t,e,i){i.push({command:x.addSource,args:[t,e[t]]})}function u(t,e,i){e.push({command:x.removeSource,args:[t]}),i[t]=!0}function c(t,e,i){var n;for(n in t[i])if(t[i].hasOwnProperty(n)&&"data"!==n&&!v(t[i][n],e[i][n]))return!1;for(n in e[i])if(e[i].hasOwnProperty(n)&&"data"!==n&&!v(t[i][n],e[i][n]))return!1;return!0}function y(t,e,i,n,r,o){var a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(v(t[a],e[a])||i.push({command:o,args:[n,a,e[a],r]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(v(t[a],e[a])||i.push({command:o,args:[n,a,e[a],r]}))}function _(t){return t.id}function g(t,e){return t[e.id]=e,t}var v=t("./util/deep_equal"),x={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};e.exports=function(t,e){if(!t)return[{command:x.setStyle,args:[e]}];var i=[];try{if(!v(t.version,e.version))return[{command:x.setStyle,args:[e]}];v(t.center,e.center)||i.push({command:x.setCenter,args:[e.center]}),v(t.zoom,e.zoom)||i.push({command:x.setZoom,args:[e.zoom]}),v(t.bearing,e.bearing)||i.push({command:x.setBearing,args:[e.bearing]}),v(t.pitch,e.pitch)||i.push({command:x.setPitch,args:[e.pitch]}),v(t.sprite,e.sprite)||i.push({command:x.setSprite,args:[e.sprite]}),v(t.glyphs,e.glyphs)||i.push({command:x.setGlyphs,args:[e.glyphs]}),v(t.transition,e.transition)||i.push({command:x.setTransition,args:[e.transition]}),v(t.light,e.light)||i.push({command:x.setLight,args:[e.light]});var n={},r=[];!function(t,e,i,n){var r,o,a,s;for(r in e=e||{},t=t||{})t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||u(r,i,n));for(r in e)e.hasOwnProperty(r)&&(t.hasOwnProperty(r)?v(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&c(t,e,r)?i.push({command:x.setGeoJSONSourceData,args:[r,e[r].data]}):(a=e,u(o=r,s=i,n),l(o,a,s))):l(r,e,i))}(t.sources,e.sources,r,n);var o=[];t.layers&&t.layers.forEach(function(t){n[t.source]?i.push({command:x.removeLayer,args:[t.id]}):o.push(t)}),i=i.concat(r),function(t,e,i){e=e||[];var n,r,o,a,s,l,u,c=(t=t||[]).map(_),h=e.map(_),p=t.reduce(g,{}),f=e.reduce(g,{}),d=c.slice(),m=Object.create(null);for(r=n=0;n<c.length;n++)o=c[n],f.hasOwnProperty(o)?r++:(i.push({command:x.removeLayer,args:[o]}),d.splice(d.indexOf(o,r),1));for(r=n=0;n<h.length;n++)o=h[h.length-1-n],d[d.length-1-n]!==o&&(p.hasOwnProperty(o)?(i.push({command:x.removeLayer,args:[o]}),d.splice(d.lastIndexOf(o,d.length-r),1)):r++,l=d[d.length-n],i.push({command:x.addLayer,args:[f[o],l]}),d.splice(d.length-n,0,o),m[o]=!0);for(n=0;n<h.length;n++)if(a=p[o=h[n]],s=f[o],!m[o]&&!v(a,s))if(v(a.source,s.source)&&v(a["source-layer"],s["source-layer"])&&v(a.type,s.type)){for(u in y(a.layout,s.layout,i,o,null,x.setLayoutProperty),y(a.paint,s.paint,i,o,null,x.setPaintProperty),v(a.filter,s.filter)||i.push({command:x.setFilter,args:[o,s.filter]}),v(a.minzoom,s.minzoom)&&v(a.maxzoom,s.maxzoom)||i.push({command:x.setLayerZoomRange,args:[o,s.minzoom,s.maxzoom]}),a)a.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?y(a[u],s[u],i,o,u.slice(6),x.setPaintProperty):v(a[u],s[u])||i.push({command:x.setLayerProperty,args:[o,u,s[u]]}));for(u in s)s.hasOwnProperty(u)&&!a.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?y(a[u],s[u],i,o,u.slice(6),x.setPaintProperty):v(a[u],s[u])||i.push({command:x.setLayerProperty,args:[o,u,s[u]]}))}else i.push({command:x.removeLayer,args:[o]}),l=d[d.lastIndexOf(o)+1],i.push({command:x.addLayer,args:[s,l]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:x.setStyle,args:[e]}]}return i},e.exports.operations=x},{"./util/deep_equal":155}],122:[function(t,e,i){"use strict";e.exports=function(t,e,i){this.message=(t?t+": ":"")+i,null!=e&&e.__line__&&(this.line=e.__line__)}},{}],123:[function(t,e,i){"use strict";var S=t("./types").toString,A=t("./parsing_context"),M=(t("./evaluation_context"),function(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n});M.prototype.evaluate=function(t){return this._evaluate(t,this.args)},M.prototype.eachChild=function(t){this.args.forEach(t)},M.prototype.possibleOutputs=function(){return[void 0]},M.parse=function(i,t){var e=i[0],n=M.definitions[e];if(!n)return t.error('Unknown expression "'+e+'". If you wanted a literal array, use ["literal", [...]].',0);for(var r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter(function(t){var e=t[0];return!Array.isArray(e)||e.length===i.length-1}),s=[],l=1;l<i.length;l++){var u=i[l],c=void 0;if(1===a.length){var h=a[0][0];c=Array.isArray(h)?h[l-1]:h.type}var p=t.parse(u,1+s.length,c);if(!p)return null;s.push(p)}for(var f=null,d=0,m=a;d<m.length;d+=1){var y=m[d],_=y[0],g=y[1];if(f=new A(t.registry,t.path,null,t.scope),Array.isArray(_)&&_.length!==s.length)f.error("Expected "+_.length+" arguments, but found "+s.length+" instead.");else{for(var v=0;v<s.length;v++){var x=Array.isArray(_)?_[v]:_.type,b=s[v];f.concat(v+1).checkSubtype(x,b.type)}if(0===f.errors.length)return new M(e,r,g,s)}}if(1===a.length)t.errors.push.apply(t.errors,f.errors);else{var w=(a.length?a:o).map(function(t){return e=t[0],Array.isArray(e)?"("+e.map(S).join(", ")+")":"("+S(e.type)+"...)";var e}).join(" | "),T=s.map(function(t){return S(t.type)}).join(", ");t.error("Expected arguments of type "+w+", but found ("+T+") instead.")}return null},M.register=function(t,e){for(var i in M.definitions=e)t[i]=M},e.exports={CompoundExpression:M,varargs:function(t){return{type:t}}}},{"./evaluation_context":138,"./parsing_context":141,"./types":146}],124:[function(t,e,i){"use strict";var n=t("../types"),r=n.toString,s=n.array,l=n.ValueType,o=n.StringType,a=n.NumberType,u=n.BooleanType,c=n.checkSubtype,h=t("../values").typeOf,p=t("../runtime_error"),f={string:o,number:a,boolean:u},d=function(t,e){this.type=t,this.input=e};d.parse=function(t,e){if(t.length<2||4<t.length)return e.error("Expected 1, 2, or 3 arguments, but found "+(t.length-1)+" instead.");var i,n;if(2<t.length){var r=t[1];if("string"!=typeof r||!(r in f))return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=f[r]}else i=l;if(3<t.length){if("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2]))return e.error('The length argument to "array" must be a positive integer literal',2);n=t[2]}var o=s(i,n),a=e.parse(t[t.length-1],t.length-1,l);return a?new d(o,a):null},d.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(c(this.type,h(e)))throw new p("Expected value to be of type "+r(this.type)+", but found "+r(h(e))+" instead.");return e},d.prototype.eachChild=function(t){t(this.input)},d.prototype.possibleOutputs=function(){return this.input.possibleOutputs()},e.exports=d},{"../runtime_error":143,"../types":146,"../values":147}],125:[function(t,e,i){"use strict";var n=t("../types"),r=n.ObjectType,s=n.ValueType,o=n.StringType,a=n.NumberType,l=n.BooleanType,u=t("../runtime_error"),c=t("../types"),h=c.checkSubtype,p=c.toString,f=t("../values").typeOf,d={string:o,number:a,boolean:l,object:r},m=function(t,e){this.type=t,this.args=e};m.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var i=t[0],n=d[i],r=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,s);if(!a)return null;r.push(a)}return new m(n,r)},m.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var i=this.args[e].evaluate(t);if(!h(this.type,f(i)))return i;if(e===this.args.length-1)throw new u("Expected value to be of type "+p(this.type)+", but found "+p(f(i))+" instead.")}return null},m.prototype.eachChild=function(t){this.args.forEach(t)},m.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},e.exports=m},{"../runtime_error":143,"../types":146,"../values":147}],126:[function(t,e,i){"use strict";var n=t("../types"),o=n.array,a=n.ValueType,s=n.NumberType,r=t("../runtime_error"),l=function(t,e,i){this.type=t,this.index=e,this.input=i};l.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,s),n=e.parse(t[2],2,o(e.expectedType||a));if(!i||!n)return null;var r=n.type;return new l(r.itemType,i,n)},l.prototype.evaluate=function(t){var e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0||e>=i.length)throw new r("Array index out of bounds: "+e+" > "+i.length+".");if(e!==Math.floor(e))throw new r("Array index must be an integer, but found "+e+" instead.");return i[e]},l.prototype.eachChild=function(t){t(this.index),t(this.input)},l.prototype.possibleOutputs=function(){return[void 0]},e.exports=l},{"../runtime_error":143,"../types":146}],127:[function(t,e,i){"use strict";var l=t("../types").BooleanType,u=function(t,e,i){this.type=t,this.branches=e,this.otherwise=i};u.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var n=[],r=1;r<t.length-1;r+=2){var o=e.parse(t[r],r,l);if(!o)return null;var a=e.parse(t[r+1],r+1,i);if(!a)return null;n.push([o,a]),i=i||a.type}var s=e.parse(t[t.length-1],t.length-1,i);return s?new u(i,n,s):null},u.prototype.evaluate=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var n=i[e],r=n[0],o=n[1];if(r.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},u.prototype.eachChild=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var n=i[e],r=n[0],o=n[1];t(r),t(o)}t(this.otherwise)},u.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.branches.map(function(t){return t[0],t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t},e.exports=u},{"../types":146}],128:[function(t,e,i){"use strict";var n=t("../types"),u=n.checkSubtype,c=n.ValueType,h=function(t,e){this.type=t,this.args=e};h.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var i=null,n=e.expectedType;n&&"value"!==n.kind&&(i=n);for(var r=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],l=e.parse(s,1+r.length,i,void 0,{omitTypeAnnotations:!0});if(!l)return null;i=i||l.type,r.push(l)}return n&&r.some(function(t){return u(n,t.type)})?new h(c,r):new h(i,r)},h.prototype.evaluate=function(t){for(var e=null,i=0,n=this.args;i<n.length&&null===(e=n[i].evaluate(t));i+=1);return e},h.prototype.eachChild=function(t){this.args.forEach(t)},h.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},e.exports=h},{"../types":146}],129:[function(t,e,i){"use strict";var n=t("../types"),r=n.ColorType,s=n.ValueType,o=n.NumberType,a=t("../values"),c=a.Color,h=a.validateRGBA,p=t("../runtime_error"),l={"to-number":o,"to-color":r},u=function(t,e){this.type=t,this.args=e};u.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var i=t[0],n=l[i],r=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,s);if(!a)return null;r.push(a)}return new u(n,r)},u.prototype.evaluate=function(t){if("color"===this.type.kind){for(var e,i,n=0,r=this.args;n<r.length;n+=1)if(i=null,"string"==typeof(e=r[n].evaluate(t))){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(i=e.length<3||4<e.length?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":h(e[0],e[1],e[2],e[3])))return new c(e[0]/255,e[1]/255,e[2]/255,e[3]);throw new p(i||"Could not parse color from value '"+("string"==typeof e?e:JSON.stringify(e))+"'")}for(var a=null,s=0,l=this.args;s<l.length;s+=1)if(null!==(a=l[s].evaluate(t))){var u=Number(a);if(!isNaN(u))return u}throw new p("Could not convert "+JSON.stringify(a)+" to number.")},u.prototype.eachChild=function(t){this.args.forEach(t)},u.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t},e.exports=u},{"../runtime_error":143,"../types":146,"../values":147}],130:[function(t,e,i){"use strict";function o(t){return"string"===t.kind||"number"===t.kind||"boolean"===t.kind||"null"===t.kind}function n(e){return function(){function r(t,e){this.type=s,this.lhs=t,this.rhs=e}return r.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var i=e.parse(t[1],1,a);if(!i)return null;var n=e.parse(t[2],2,a);return n?o(i.type)||o(n.type)?i.type.kind!==n.type.kind&&"value"!==i.type.kind&&"value"!==n.type.kind?e.error("Cannot compare "+l(i.type)+" and "+l(n.type)+"."):new r(i,n):e.error("Expected at least one argument to be a string, number, boolean, or null, but found ("+l(i.type)+", "+l(n.type)+") instead."):null},r.prototype.evaluate=function(t){return e(this.lhs.evaluate(t),this.rhs.evaluate(t))},r.prototype.eachChild=function(t){t(this.lhs),t(this.rhs)},r.prototype.possibleOutputs=function(){return[!0,!1]},r}()}var r=t("../types"),a=r.ValueType,s=r.BooleanType,l=t("../types").toString;e.exports={Equals:n(function(t,e){return t===e}),NotEquals:n(function(t,e){return t!==e})}},{"../types":146}],131:[function(t,e,i){"use strict";function n(t,e){var i=e[0],n=e[1],r=e[2],o=e[3];i=i.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);var a=o?o.evaluate(t):1,s=S(i,n,r,a);if(s)throw new L(s);return new T(i/255*a,n/255*a,r/255*a,a)}function r(t,e){return t in e}function o(t,e){var i=e[t];return void 0===i?null:i}function a(t,e){return e[0].evaluate(t).length}function s(t,e){var i=e[0],n=e[1];return i.evaluate(t)<n.evaluate(t)}function l(t,e){var i=e[0],n=e[1];return i.evaluate(t)>n.evaluate(t)}function u(t,e){var i=e[0],n=e[1];return i.evaluate(t)<=n.evaluate(t)}function c(t,e){var i=e[0],n=e[1];return i.evaluate(t)>=n.evaluate(t)}var h=t("../types"),p=h.NumberType,f=h.StringType,d=h.BooleanType,m=h.ColorType,y=h.ObjectType,_=h.ValueType,g=h.ErrorType,v=h.array,x=h.toString,b=t("../values"),w=b.typeOf,T=b.Color,S=b.validateRGBA,A=t("../compound_expression"),M=A.CompoundExpression,E=A.varargs,L=t("../runtime_error"),z=t("./let"),P=t("./var"),C=t("./literal"),I=t("./assertion"),k=t("./array"),R=t("./coercion"),D=t("./at"),B=t("./match"),O=t("./case"),F=t("./step"),N=t("./interpolate"),j=t("./coalesce"),U=t("./equals"),Z={"==":U.Equals,"!=":U.NotEquals,array:k,at:D,boolean:I,case:O,coalesce:j,interpolate:N,let:z,literal:C,match:B,number:I,object:I,step:F,string:I,"to-color":R,"to-number":R,var:P};M.register(Z,{error:[g,[f],function(t,e){var i=e[0];throw new L(i.evaluate(t))}],typeof:[f,[_],function(t,e){var i=e[0];return x(w(i.evaluate(t)))}],"to-string":[f,[_],function(t,e){var i=e[0],n=typeof(i=i.evaluate(t));return null===i||"string"===n||"number"===n||"boolean"===n?String(i):i instanceof T?i.toString():JSON.stringify(i)}],"to-boolean":[d,[_],function(t,e){var i=e[0];return Boolean(i.evaluate(t))}],"to-rgba":[v(p,4),[m],function(t,e){var i=e[0].evaluate(t),n=i.r,r=i.g,o=i.b,a=i.a;return[255*n/a,255*r/a,255*o/a,a]}],rgb:[m,[p,p,p],n],rgba:[m,[p,p,p,p],n],length:{type:p,overloads:[[[f],a],[[v(_)],a]]},has:{type:d,overloads:[[[f],function(t,e){return r(e[0].evaluate(t),t.properties())}],[[f,y],function(t,e){var i=e[0],n=e[1];return r(i.evaluate(t),n.evaluate(t))}]]},get:{type:_,overloads:[[[f],function(t,e){return o(e[0].evaluate(t),t.properties())}],[[f,y],function(t,e){var i=e[0],n=e[1];return o(i.evaluate(t),n.evaluate(t))}]]},properties:[y,[],function(t){return t.properties()}],"geometry-type":[f,[],function(t){return t.geometryType()}],id:[_,[],function(t){return t.id()}],zoom:[p,[],function(t){return t.globals.zoom}],"heatmap-density":[p,[],function(t){return t.globals.heatmapDensity||0}],"+":[p,E(p),function(t,e){for(var i=0,n=0,r=e;n<r.length;n+=1)i+=r[n].evaluate(t);return i}],"*":[p,E(p),function(t,e){for(var i=1,n=0,r=e;n<r.length;n+=1)i*=r[n].evaluate(t);return i}],"-":{type:p,overloads:[[[p,p],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)-n.evaluate(t)}],[[p],function(t,e){return-e[0].evaluate(t)}]]},"/":[p,[p,p],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)/n.evaluate(t)}],"%":[p,[p,p],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)%n.evaluate(t)}],ln2:[p,[],function(){return Math.LN2}],pi:[p,[],function(){return Math.PI}],e:[p,[],function(){return Math.E}],"^":[p,[p,p],function(t,e){var i=e[0],n=e[1];return Math.pow(i.evaluate(t),n.evaluate(t))}],sqrt:[p,[p],function(t,e){var i=e[0];return Math.sqrt(i.evaluate(t))}],log10:[p,[p],function(t,e){var i=e[0];return Math.log10(i.evaluate(t))}],ln:[p,[p],function(t,e){var i=e[0];return Math.log(i.evaluate(t))}],log2:[p,[p],function(t,e){var i=e[0];return Math.log2(i.evaluate(t))}],sin:[p,[p],function(t,e){var i=e[0];return Math.sin(i.evaluate(t))}],cos:[p,[p],function(t,e){var i=e[0];return Math.cos(i.evaluate(t))}],tan:[p,[p],function(t,e){var i=e[0];return Math.tan(i.evaluate(t))}],asin:[p,[p],function(t,e){var i=e[0];return Math.asin(i.evaluate(t))}],acos:[p,[p],function(t,e){var i=e[0];return Math.acos(i.evaluate(t))}],atan:[p,[p],function(t,e){var i=e[0];return Math.atan(i.evaluate(t))}],min:[p,E(p),function(e,t){return Math.min.apply(Math,t.map(function(t){return t.evaluate(e)}))}],max:[p,E(p),function(e,t){return Math.max.apply(Math,t.map(function(t){return t.evaluate(e)}))}],"filter-==":[d,[f,_],function(t,e){var i=e[0],n=e[1];return t.properties()[i.value]===n.value}],"filter-id-==":[d,[_],function(t,e){var i=e[0];return t.id()===i.value}],"filter-type-==":[d,[f],function(t,e){var i=e[0];return t.geometryType()===i.value}],"filter-<":[d,[f,_],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&r<o}],"filter-id-<":[d,[_],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n<r}],"filter->":[d,[f,_],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&o<r}],"filter-id->":[d,[_],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&r<n}],"filter-<=":[d,[f,_],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[d,[_],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&n<=r}],"filter->=":[d,[f,_],function(t,e){var i=e[0],n=e[1],r=t.properties()[i.value],o=n.value;return typeof r==typeof o&&o<=r}],"filter-id->=":[d,[_],function(t,e){var i=e[0],n=t.id(),r=i.value;return typeof n==typeof r&&r<=n}],"filter-has":[d,[_],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[d,[],function(t){return null!==t.id()}],"filter-type-in":[d,[v(f)],function(t,e){return 0<=e[0].value.indexOf(t.geometryType())}],"filter-id-in":[d,[v(_)],function(t,e){return 0<=e[0].value.indexOf(t.id())}],"filter-in-small":[d,[f,v(_)],function(t,e){var i=e[0];return 0<=e[1].value.indexOf(t.properties()[i.value])}],"filter-in-large":[d,[f,v(_)],function(t,e){var i=e[0],n=e[1];return function(t,e,i,n){for(;i<=n;){var r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[i.value],n.value,0,n.value.length-1)}],">":{type:d,overloads:[[[p,p],l],[[f,f],l]]},"<":{type:d,overloads:[[[p,p],s],[[f,f],s]]},">=":{type:d,overloads:[[[p,p],c],[[f,f],c]]},"<=":{type:d,overloads:[[[p,p],u],[[f,f],u]]},all:{type:d,overloads:[[[d,d],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)&&n.evaluate(t)}],[E(d),function(t,e){for(var i=0,n=e;i<n.length;i+=1)if(!n[i].evaluate(t))return!1;return!0}]]},any:{type:d,overloads:[[[d,d],function(t,e){var i=e[0],n=e[1];return i.evaluate(t)||n.evaluate(t)}],[E(d),function(t,e){for(var i=0,n=e;i<n.length;i+=1)if(n[i].evaluate(t))return!0;return!1}]]},"!":[d,[d],function(t,e){return!e[0].evaluate(t)}],upcase:[f,[f],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[f,[f],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[f,E(f),function(e,t){return t.map(function(t){return t.evaluate(e)}).join("")}]}),e.exports=Z},{"../compound_expression":123,"../runtime_error":143,"../types":146,"../values":147,"./array":124,"./assertion":125,"./at":126,"./case":127,"./coalesce":128,"./coercion":129,"./equals":130,"./interpolate":132,"./let":133,"./literal":134,"./match":135,"./step":136,"./var":137}],132:[function(t,e,i){"use strict";function a(t,e,i,n){var r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}var s=t("@mapbox/unitbezier"),h=t("../../util/interpolate"),n=t("../types"),m=n.toString,y=n.NumberType,p=t("../stops").findStopLessThanOrEqualTo,_=function(t,e,i,n){this.type=t,this.interpolation=e,this.input=i,this.labels=[],this.outputs=[];for(var r=0,o=n;r<o.length;r+=1){var a=o[r],s=a[0],l=a[1];this.labels.push(s),this.outputs.push(l)}};_.interpolationFactor=function(t,e,i,n){var r=0;if("exponential"===t.name)r=a(e,t.base,i,n);else if("linear"===t.name)r=a(e,1,i,n);else if("cubic-bezier"===t.name){var o=t.controlPoints;r=new s(o[0],o[1],o[2],o[3]).solve(a(e,1,i,n))}return r},_.parse=function(t,e){var i=t[1],n=t[2],r=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var o=i[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:o}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var a=i.slice(1);if(4!==a.length||a.some(function(t){return"number"!=typeof t||t<0||1<t}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:a}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,2,y)))return null;var s=[],l=null;e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var u=0;u<r.length;u+=2){var c=r[u],h=r[u+1],p=u+3,f=u+4;if("number"!=typeof c)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(s.length&&s[s.length-1][0]>=c)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var d=e.parse(h,f,l);if(!d)return null;l=l||d.type,s.push([c,d])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new _(l,i,n,s):e.error("Type "+m(l)+" is not interpolatable.")},_.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);var r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);var o=p(e,n),a=e[o],s=e[o+1],l=_.interpolationFactor(this.interpolation,n,a,s),u=i[o].evaluate(t),c=i[o+1].evaluate(t);return h[this.type.kind.toLowerCase()](u,c,l)},_.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1)t(i[e])},_.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t},e.exports=_},{"../../util/interpolate":158,"../stops":145,"../types":146,"@mapbox/unitbezier":7}],133:[function(t,e,i){"use strict";var s=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};s.prototype.evaluate=function(t){t.pushScope(this.bindings);var e=this.result.evaluate(t);return t.popScope(),e},s.prototype.eachChild=function(t){for(var e=0,i=this.bindings;e<i.length;e+=1)t(i[e][1]);t(this.result)},s.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var i=[],n=1;n<t.length-1;n+=2){var r=t[n];if("string"!=typeof r)return e.error("Expected string, but found "+typeof r+" instead.",n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}var a=e.parse(t[t.length-1],t.length-1,void 0,i);return a?new s(i,a):null},s.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},e.exports=s},{}],134:[function(t,e,i){"use strict";var n=t("../values"),o=n.isValue,a=n.typeOf,s=function(t,e){this.type=t,this.value=e};s.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!o(t[1]))return e.error("invalid value");var i=t[1],n=a(i),r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new s(n,i)},s.prototype.evaluate=function(){return this.value},s.prototype.eachChild=function(){},s.prototype.possibleOutputs=function(){return[this.value]},e.exports=s},{"../values":147}],135:[function(t,e,i){"use strict";var y=t("../values").typeOf,_=function(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o};_.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],l=t[a+1];Array.isArray(s)||(s=[s]);var u=e.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return u.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return u.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,y(p)))return null}else i=y(p);if(void 0!==r[String(p)])return u.error("Branch labels must be unique.");r[String(p)]=o.length}var f=e.parse(l,a,n);if(!f)return null;n=n||f.type,o.push(f)}var d=e.parse(t[1],1,i);if(!d)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?new _(i,n,d,r,o,m):null},_.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},_.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},_.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t},e.exports=_},{"../values":147}],136:[function(t,e,i){"use strict";var p=t("../types").NumberType,o=t("../stops").findStopLessThanOrEqualTo,f=function(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,r=i;n<r.length;n+=1){var o=r[n],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};f.parse=function(t,e){var i=t[1],n=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,1,p)))return null;var r=[],o=null;e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType),n.unshift(-1/0);for(var a=0;a<n.length;a+=2){var s=n[a],l=n[a+1],u=a+1,c=a+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var h=e.parse(l,c,o);if(!h)return null;o=o||h.type,r.push([s,h])}return new f(o,i,r)},f.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);var r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[o(e,n)].evaluate(t)},f.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1)t(i[e])},f.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t},e.exports=f},{"../stops":145,"../types":146}],137:[function(t,e,i){"use strict";var n=function(t,e){this.type=e,this.name=t};n.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var i=t[1];return e.scope.has(i)?new n(i,e.scope.get(i).type):e.error('Unknown variable "'+i+'". Make sure "'+i+'" has been bound in an enclosing "let" expression before using it.',1)},n.prototype.evaluate=function(t){return t.scope.get(this.name).evaluate(t)},n.prototype.eachChild=function(){},n.prototype.possibleOutputs=function(){return[void 0]},e.exports=n},{}],138:[function(t,e,i){"use strict";var n=t("./scope"),r=t("./values").Color,o=["Unknown","Point","LineString","Polygon"],a=function(){this.scope=new n,this._parseColorCache={}};a.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},a.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?o[this.feature.type]:this.feature.type:null},a.prototype.properties=function(){return this.feature&&this.feature.properties||{}},a.prototype.pushScope=function(t){this.scope=this.scope.concat(t)},a.prototype.popScope=function(){this.scope=this.scope.parent},a.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=r.parse(t)),e},e.exports=a},{"./scope":144,"./values":147}],139:[function(t,e,i){"use strict";function r(t){return Array.isArray(t)&&0<t.length&&"string"==typeof t[0]&&t[0]in m}function s(t,e,i){void 0===i&&(i={});var n,r,o=new u(m,[],(r={color:C,string:I,number:k,enum:I,boolean:R},"array"===(n=e).type?B(r[n.value]||D,n.length):r[n.type]||null)),a=o.parse(t);return a?v(!1===i.handleErrors?new b(a):new w(a,e)):x(o.errors)}function o(t,e,i){if(void 0===i&&(i={}),"error"===(t=s(t,e,i)).result)return t;var n=t.value.expression,r=y.isFeatureConstant(n);if(!r&&!e["property-function"])return x([new l("","property expressions not supported")]);var o=y.isGlobalPropertyConstant(n,["zoom"]);if(!o&&!1===e["zoom-function"])return x([new l("","zoom expressions not supported")]);var a=function i(t){var n=null;if(t instanceof d)n=i(t.result);else if(t instanceof f)for(var e=0,r=t.args;e<r.length;e+=1){var o=r[e];if(n=i(o))break}else(t instanceof h||t instanceof p)&&t.input instanceof c&&"zoom"===t.input.name&&(n=t);return n instanceof l||t.eachChild(function(t){var e=i(t);e instanceof l?n=e:!n&&e?n=new l("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&e&&n!==e&&(n=new l("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}(n);return a||o?a instanceof l?x([a]):a instanceof p&&"piecewise-constant"===e.function?x([new l("",'"interpolate" expressions cannot be used with this property')]):v(a?new S(r?"camera":"composite",t.value,a):new T(r?"constant":"source",t.value)):x([new l("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}var n=t("../util/extend"),l=t("./parsing_error"),u=t("./parsing_context"),a=t("./evaluation_context"),c=t("./compound_expression").CompoundExpression,h=t("./definitions/step"),p=t("./definitions/interpolate"),f=t("./definitions/coalesce"),d=t("./definitions/let"),m=t("./definitions"),y=t("./is_constant"),_=t("./runtime_error"),g=t("../util/result"),v=g.success,x=g.error,b=function(t){this.expression=t};b.prototype.evaluate=function(t,e){return this._evaluator||(this._evaluator=new a),this._evaluator.globals=t,this._evaluator.feature=e,this.expression.evaluate(this._evaluator)};var w=function(n){function t(t,e){var i;n.call(this,t),this._warningHistory={},this._defaultValue="color"===(i=e).type&&M(i.default)?new L(0,0,0,0):"color"===i.type?L.parse(i.default)||null:void 0===i.default?null:i.default,"enum"===e.type&&(this._enumValues=e.values)}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.evaluate=function(t,e){this._evaluator||(this._evaluator=new a),this._evaluator.globals=t,this._evaluator.feature=e;try{var i=this.expression.evaluate(this._evaluator);if(null==i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new _("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(i)+" instead.");return i}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}},t}(b),T=function(t,e){this.kind=t,this._styleExpression=e};T.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)};var S=function(t,e,i){this.kind=t,this.zoomStops=i.labels,this._styleExpression=e,i instanceof p&&(this._interpolationType=i.interpolation)};S.prototype.evaluate=function(t,e){return this._styleExpression.evaluate(t,e)},S.prototype.interpolationFactor=function(t,e,i){return this._interpolationType?p.interpolationFactor(this._interpolationType,t,e,i):0};var A=t("../function"),M=A.isFunction,E=A.createFunction,L=t("./values").Color,z=function(t,e){this._parameters=t,this._specification=e,n(this,E(this._parameters,this._specification))};z.deserialize=function(t){return new z(t._parameters,t._specification)},z.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}},e.exports={StyleExpression:b,StyleExpressionWithErrorHandling:w,isExpression:r,createExpression:s,createPropertyExpression:o,normalizePropertyExpression:function(t,e){if(M(t))return new z(t,e);if(r(t)){var i=o(t,e);if("error"===i.result)throw new Error(i.value.map(function(t){return t.key+": "+t.message}).join(", "));return i.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=L.parse(t)),{kind:"constant",evaluate:function(){return n}}},ZoomConstantExpression:T,ZoomDependentExpression:S,StylePropertyFunction:z};var P=t("./types"),C=P.ColorType,I=P.StringType,k=P.NumberType,R=P.BooleanType,D=P.ValueType,B=P.array},{"../function":149,"../util/extend":156,"../util/result":160,"./compound_expression":123,"./definitions":131,"./definitions/coalesce":128,"./definitions/interpolate":132,"./definitions/let":133,"./definitions/step":136,"./evaluation_context":138,"./is_constant":140,"./parsing_context":141,"./parsing_error":142,"./runtime_error":143,"./types":146,"./values":147}],140:[function(t,e,i){"use strict";var r=t("./compound_expression").CompoundExpression;e.exports={isFeatureConstant:function e(t){if(t instanceof r){if("get"===t.name&&1===t.args.length)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var i=!0;return t.eachChild(function(t){i&&!e(t)&&(i=!1)}),i},isGlobalPropertyConstant:function e(t,i){if(t instanceof r&&0<=i.indexOf(t.name))return!1;var n=!0;return t.eachChild(function(t){n&&!e(t,i)&&(n=!1)}),n}}},{"./compound_expression":123}],141:[function(p,t,e){"use strict";var o=p("./scope"),n=p("./types").checkSubtype,r=p("./parsing_error"),f=p("./definitions/literal"),d=p("./definitions/assertion"),m=p("./definitions/array"),y=p("./definitions/coercion"),a=function(t,e,i,n,r){void 0===e&&(e=[]),void 0===n&&(n=new o),void 0===r&&(r=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=n,this.errors=r,this.expectedType=i};a.prototype.parse=function(t,e,i,n,r){void 0===r&&(r={});var o=this;if(e&&(o=o.concat(e,i,n)),null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return o.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var a=t[0];if("string"!=typeof a)return o.error("Expression name must be a string, but found "+typeof a+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var s=o.registry[a];if(s){var l=s.parse(t,o);if(!l)return null;if(o.expectedType){var u=o.expectedType,c=l.type;if("string"!==u.kind&&"number"!==u.kind&&"boolean"!==u.kind||"value"!==c.kind)if("array"===u.kind&&"value"===c.kind)r.omitTypeAnnotations||(l=new m(u,l));else if("color"!==u.kind||"value"!==c.kind&&"string"!==c.kind){if(o.checkSubtype(o.expectedType,l.type))return null}else r.omitTypeAnnotations||(l=new y(u,[l]));else r.omitTypeAnnotations||(l=new d(u,[l]))}if(!(l instanceof f)&&function(t){var e=p("./compound_expression").CompoundExpression,i=p("./is_constant"),n=i.isGlobalPropertyConstant,r=i.isFeatureConstant;if(t instanceof p("./definitions/var"))return!1;if(t instanceof e&&"error"===t.name)return!1;var o=!0;return t.eachChild(function(t){t instanceof f||(o=!1)}),!!o&&r(t)&&n(t,["zoom","heatmap-density"])}(l)){var h=new(p("./evaluation_context"));try{l=new f(l.type,l.evaluate(h))}catch(t){return o.error(t.message),null}}return l}return o.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?o.error("'undefined' value invalid. Use null instead."):"object"==typeof t?o.error('Bare objects invalid. Use ["literal", {...}] instead.'):o.error("Expected an array, but found "+typeof t+" instead.")},a.prototype.concat=function(t,e,i){var n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new a(this.registry,n,e||null,r,this.errors)},a.prototype.error=function(t){for(var e=[],i=arguments.length-1;0<i--;)e[i]=arguments[i+1];var n=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new r(n,t))},a.prototype.checkSubtype=function(t,e){var i=n(t,e);return i&&this.error(i),i},t.exports=a},{"./compound_expression":123,"./definitions/array":124,"./definitions/assertion":125,"./definitions/coercion":129,"./definitions/literal":134,"./definitions/var":137,"./evaluation_context":138,"./is_constant":140,"./parsing_error":142,"./scope":144,"./types":146}],142:[function(t,e,i){"use strict";var n=function(i){function t(t,e){i.call(this,e),this.message=e,this.key=t}return i&&(t.__proto__=i),(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Error);e.exports=n},{}],143:[function(t,e,i){"use strict";var n=function(t){this.name="ExpressionEvaluationError",this.message=t};n.prototype.toJSON=function(){return this.message},e.exports=n},{}],144:[function(t,e,i){"use strict";var n=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var i=0,n=e;i<n.length;i+=1){var r=n[i],o=r[0],a=r[1];this.bindings[o]=a}};n.prototype.concat=function(t){return new n(this,t)},n.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},n.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)},e.exports=n},{}],145:[function(t,e,i){"use strict";var s=t("./runtime_error");e.exports={findStopLessThanOrEqualTo:function(t,e){for(var i,n,r=0,o=t.length-1,a=0;r<=o;){if(i=t[a=Math.floor((r+o)/2)],n=t[a+1],e===i||i<e&&e<n)return a;if(i<e)r=a+1;else{if(!(e<i))throw new s("Input is not a number.");o=a-1}}return Math.max(a-1,0)}}},{"./runtime_error":143}],146:[function(t,e,i){"use strict";function n(t,e){return{kind:"array",itemType:t,N:e}}function o(t){if("array"!==t.kind)return t.kind;var e=o(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}var r={kind:"null"},a={kind:"number"},s={kind:"string"},l={kind:"boolean"},u={kind:"color"},c={kind:"object"},h={kind:"value"},p=[r,a,s,l,u,c,n(h)];e.exports={NullType:r,NumberType:a,StringType:s,BooleanType:l,ColorType:u,ObjectType:c,ValueType:h,array:n,ErrorType:{kind:"error"},toString:o,checkSubtype:function t(e,i){if("error"===i.kind)return null;if("array"===e.kind){if("array"===i.kind&&!t(e.itemType,i.itemType)&&("number"!=typeof e.N||e.N===i.N))return null}else{if(e.kind===i.kind)return null;if("value"===e.kind)for(var n=0,r=p;n<r.length;n+=1)if(!t(r[n],i))return null}return"Expected "+o(e)+" but found "+o(i)+" instead."}}},{}],147:[function(t,e,i){"use strict";var s=t("../util/color"),n=t("./types"),l=n.NullType,u=n.NumberType,c=n.StringType,h=n.BooleanType,p=n.ColorType,f=n.ObjectType,d=n.ValueType,m=n.array;e.exports={Color:s,validateRGBA:function(t,e,i,n){return"number"==typeof t&&0<=t&&t<=255&&"number"==typeof e&&0<=e&&e<=255&&"number"==typeof i&&0<=i&&i<=255?void 0===n||"number"==typeof n&&0<=n&&n<=1?null:"Invalid rgba value ["+[t,e,i,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."},isValue:function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof s)return!0;if(Array.isArray(e)){for(var i=0,n=e;i<n.length;i+=1)if(!t(n[i]))return!1;return!0}if("object"!=typeof e)return!1;for(var r in e)if(!t(e[r]))return!1;return!0},typeOf:function t(e){if(null===e)return l;if("string"==typeof e)return c;if("boolean"==typeof e)return h;if("number"==typeof e)return u;if(e instanceof s)return p;if(Array.isArray(e)){for(var i,n=e.length,r=0,o=e;r<o.length;r+=1){var a=t(o[r]);if(i){if(i===a)continue;i=d;break}i=a}return m(i||d,n)}return f}}},{"../util/color":153,"./types":146}],148:[function(t,e,i){"use strict";function r(t){if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return 2<=t.length&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3===t.length&&(Array.isArray(t[1])||Array.isArray(t[2]));case"any":case"all":for(var e=0,i=t.slice(1);e<i.length;e+=1){var n=i[e];if(!r(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}function n(t,e){return t<e?-1:e<t?1:0}function o(t){if(!t)return!0;var e,i=t[0];return t.length<=1?"any"!==i:"=="===i?a(t[1],t[2],"=="):"!="===i?u(a(t[1],t[2],"==")):"<"===i||">"===i||"<="===i||">="===i?a(t[1],t[2],i):"any"===i?(e=t.slice(1),["any"].concat(e.map(o))):"all"===i?["all"].concat(t.slice(1).map(o)):"none"===i?["all"].concat(t.slice(1).map(o).map(u)):"in"===i?s(t[1],t.slice(2)):"!in"===i?u(s(t[1],t.slice(2))):"has"===i?l(t[1]):"!has"!==i||u(l(t[1]))}function a(t,e,i){switch(t){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,t,e]}}function s(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return 200<e.length&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(n)]]:["filter-in-small",t,["literal",e]]}}function l(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function u(t){return["!",t]}var c=t("../expression").createExpression;e.exports=function(t){if(!t)return function(){return!0};r(t)||(t=o(t));var i=c(t,h);if("error"===i.result)throw new Error(i.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,e){return i.value.evaluate(t,e)}},e.exports.isExpressionFilter=r;var h={type:"boolean",default:!1,function:!0,"property-function":!0,"zoom-function":!0}},{"../expression":139}],149:[function(t,e,i){"use strict";function _(t){return t}function T(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function S(t,e,i,n,r){return T(typeof i===r?n[i]:void 0,t.default,e.default)}function A(t,e,i){if("number"!==v(i))return T(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];var r=g(t.stops,i);return t.stops[r][1]}function M(t,e,i){var n=void 0!==t.base?t.base:1;if("number"!==v(i))return T(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];var o,a,s,l,u,c,h=g(t.stops,i),p=(o=i,a=n,s=t.stops[h][0],l=t.stops[h+1][0],c=o-s,0===(u=l-s)?0:1===a?c/u:(Math.pow(a,c)-1)/(Math.pow(a,u)-1)),f=t.stops[h][1],d=t.stops[h+1][1],m=x[e.type]||_;if(t.colorSpace&&"rgb"!==t.colorSpace){var y=L[t.colorSpace];m=function(t,e){return y.reverse(y.interpolate(y.forward(t),y.forward(e),p))}}return"function"==typeof f.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=f.evaluate.apply(void 0,t),n=d.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==n)return m(i,n,p)}}:m(f,d,p)}function E(t,e,i){return"color"===e.type?i=z.parse(i):v(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),T(i,t.default,e.default)}function g(t,e){for(var i,n,r=0,o=t.length-1,a=0;r<=o;){if(i=t[a=Math.floor((r+o)/2)][0],n=t[a+1][0],e===i||i<e&&e<n)return a;i<e?r=a+1:e<i&&(o=a-1)}return Math.max(a-1,0)}var L=t("../util/color_spaces"),z=t("../util/color"),P=t("../util/extend"),v=t("../util/get_type"),x=t("../util/interpolate"),C=t("../expression/definitions/interpolate");e.exports={createFunction:function t(n,r){var o,a,s,e="color"===r.type,i=n.stops&&"object"==typeof n.stops[0][0],l=i||void 0!==n.property,u=i||!l,c=n.type||("interpolated"===r.function?"exponential":"interval");if(e&&((n=P({},n)).stops&&(n.stops=n.stops.map(function(t){return[t[0],z.parse(t[1])]})),n.default?n.default=z.parse(n.default):n.default=z.parse(r.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!L[n.colorSpace])throw new Error("Unknown color space: "+n.colorSpace);if("exponential"===c)o=M;else if("interval"===c)o=A;else if("categorical"===c){o=S,a=Object.create(null);for(var h=0,p=n.stops;h<p.length;h+=1){var f=p[h];a[f[0]]=f[1]}s=typeof n.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');o=E}if(i){for(var d={},m=[],y=0;y<n.stops.length;y++){var _=n.stops[y],g=_[0].zoom;void 0===d[g]&&(d[g]={zoom:g,type:n.type,property:n.property,default:n.default,stops:[]},m.push(g)),d[g].stops.push([_[0].value,_[1]])}for(var v=[],x=0,b=m;x<b.length;x+=1){var w=b[x];v.push([d[w].zoom,t(d[w],r)])}return{kind:"composite",interpolationFactor:C.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:v.map(function(t){return t[0]}),evaluate:function(t,e){var i=t.zoom;return M({stops:v,base:n.base},r,i).evaluate(i,e)}}}return u?{kind:"camera",interpolationFactor:"exponential"===c?C.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==n.base?n.base:1}):function(){return 0},zoomStops:n.stops.map(function(t){return t[0]}),evaluate:function(t){var e=t.zoom;return o(n,r,e,a,s)}}:{kind:"source",evaluate:function(t,e){var i=e&&e.properties?e.properties[n.property]:void 0;return void 0===i?T(n.default,r.default):o(n,r,i,a,s)}}},isFunction:function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}}},{"../expression/definitions/interpolate":132,"../util/color":153,"../util/color_spaces":154,"../util/extend":156,"../util/get_type":157,"../util/interpolate":158}],150:[function(t,e,i){"use strict";function l(t){var e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",n=0,r=t;n<r.length;n+=1)i+=l(r[n])+",";return i+"]"}for(var o=Object.keys(t).sort(),a="{",s=0;s<o.length;s++)a+=JSON.stringify(o[s])+":"+l(t[o[s]])+",";return a+"}"}function s(t){for(var e="",i=0,n=r;i<n.length;i+=1)e+="/"+l(t[n[i]]);return e}var r=t("./util/ref_properties");e.exports=function(t){for(var e={},i=0;i<t.length;i++){var n=s(t[i]),r=e[n];r||(r=e[n]=[]),r.push(t[i])}var o=[];for(var a in e)o.push(e[a]);return o}},{"./util/ref_properties":159}],151:[function(t,e,i){"use strict";e.exports=t("./v8.json")},{"./v8.json":152}],152:[function(t,e,i){e.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_canvas"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_canvas:{type:{required:!0,type:"enum",values:{canvas:{}}},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},animate:{type:"boolean",default:"true"},canvas:{type:"string",required:!0}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,units:"factor of the original icon size",requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"icon-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"]},"icon-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,"property-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,"property-function":!0,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,"property-function":!0,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":!0,"property-function":!0,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:!1,"zoom-function":!0,"property-function":!1,function:"piecewise-constant"},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"]}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map"},"circle-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"viewport"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"heatmap-weight":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!1},"heatmap-intensity":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],function:"interpolated","zoom-function":!1,"property-function":!1,transition:!1},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!1,units:"milliseconds"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,function:"interpolated","zoom-function":!0,transition:!1},"hillshade-illumination-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"viewport"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"hillshade-shadow-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",function:"interpolated","zoom-function":!0,transition:!0},"hillshade-accent-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}}}},{}],153:[function(t,e,i){"use strict";var n=t("csscolorparser").parseCSSColor,r=function(t,e,i,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=i,this.a=n};r.parse=function(t){if(t){if(t instanceof r)return t;if("string"==typeof t){var e=n(t);if(e)return new r(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},r.prototype.toString=function(){var e=this;return"rgba("+[this.r,this.g,this.b].map(function(t){return Math.round(255*t/e.a)}).concat(this.a).join(",")+")"},r.black=new r(0,0,0,1),r.white=new r(1,1,1,1),r.transparent=new r(0,0,0,0),e.exports=r},{csscolorparser:13}],154:[function(t,e,i){"use strict";function a(t){return _<t?Math.pow(t,1/3):t/y+d}function r(t){return m<t?t*t*t:y*(t-d)}function o(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function s(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function l(t){var e=s(t.r),i=s(t.g),n=s(t.b),r=a((.4124564*e+.3575761*i+.1804375*n)/h),o=a((.2126729*e+.7151522*i+.072175*n)/p);return{l:116*o-16,a:500*(r-o),b:200*(o-a((.0193339*e+.119192*i+.9503041*n)/f)),alpha:t.a}}function n(t){var e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=p*r(e),i=h*r(i),n=f*r(n),new u(o(3.2404542*i-1.5371385*e-.4985314*n),o(-.969266*i+1.8760108*e+.041556*n),o(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}var u=t("./color"),c=t("./interpolate").number,h=.95047,p=1,f=1.08883,d=4/29,m=6/29,y=3*m*m,_=m*m*m,g=Math.PI/180,v=180/Math.PI;e.exports={lab:{forward:l,reverse:n,interpolate:function(t,e,i){return{l:c(t.l,e.l,i),a:c(t.a,e.a,i),b:c(t.b,e.b,i),alpha:c(t.alpha,e.alpha,i)}}},hcl:{forward:function(t){var e=l(t),i=e.l,n=e.a,r=e.b,o=Math.atan2(r,n)*v;return{h:o<0?o+360:o,c:Math.sqrt(n*n+r*r),l:i,alpha:t.a}},reverse:function(t){var e=t.h*g,i=t.c;return n({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:(n=t.h,r=e.h,o=i,a=r-n,n+o*(180<a||a<-180?a-360*Math.round(a/360):a)),c:c(t.c,e.c,i),l:c(t.l,e.l,i),alpha:c(t.alpha,e.alpha,i)};var n,r,o,a}}}},{"./color":153,"./interpolate":158}],155:[function(t,e,i){"use strict";e.exports=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"!=typeof e||null===e||null===i)return e===i;if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var r in e)if(!t(e[r],i[r]))return!1;return!0}},{}],156:[function(t,e,i){"use strict";e.exports=function(t){for(var e=[],i=arguments.length-1;0<i--;)e[i]=arguments[i+1];for(var n=0,r=e;n<r.length;n+=1){var o=r[n];for(var a in o)t[a]=o[a]}return t}},{}],157:[function(t,e,i){"use strict";e.exports=function(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}},{}],158:[function(t,e,i){"use strict";function r(t,e,i){return t*(1-i)+e*i}var n=t("./color");e.exports={number:r,color:function(t,e,i){return new n(r(t.r,e.r,i),r(t.g,e.g,i),r(t.b,e.b,i),r(t.a,e.a,i))},array:function(t,i,n){return t.map(function(t,e){return r(t,i[e],n)})}}},{"./color":153}],159:[function(t,e,i){"use strict";e.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],160:[function(t,e,i){"use strict";e.exports={success:function(t){return{result:"success",value:t}},error:function(t){return{result:"error",value:t}}}},{}],161:[function(t,e,i){"use strict";function n(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}e.exports=n,e.exports.deep=function t(e){return Array.isArray(e)?e.map(t):n(e)}},{}],162:[function(l,t,e){"use strict";var u=l("../util/extend"),c=l("../util/unbundle_jsonlint"),h=l("../expression").isExpression,p=l("../function").isFunction;t.exports=function(t){var e=l("./validate_function"),i=l("./validate_expression"),n=l("./validate_object"),r={"*":function(){return[]},array:l("./validate_array"),boolean:l("./validate_boolean"),number:l("./validate_number"),color:l("./validate_color"),constants:l("./validate_constants"),enum:l("./validate_enum"),filter:l("./validate_filter"),function:l("./validate_function"),layer:l("./validate_layer"),object:l("./validate_object"),source:l("./validate_source"),light:l("./validate_light"),string:l("./validate_string")},o=t.value,a=t.valueSpec,s=t.styleSpec;return a.function&&p(c(o))?e(t):a.function&&h(c.deep(o))?i(t):a.type&&r[a.type]?r[a.type](t):n(u({},t,{valueSpec:a.type?s[a.type]:a}))}},{"../expression":139,"../function":149,"../util/extend":156,"../util/unbundle_jsonlint":161,"./validate_array":163,"./validate_boolean":164,"./validate_color":165,"./validate_constants":166,"./validate_enum":167,"./validate_expression":168,"./validate_filter":169,"./validate_function":170,"./validate_layer":172,"./validate_light":174,"./validate_number":175,"./validate_object":176,"./validate_source":179,"./validate_string":180}],163:[function(t,e,i){"use strict";var c=t("../util/get_type"),h=t("./validate"),p=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.valueSpec,n=t.style,r=t.styleSpec,o=t.key,a=t.arrayElementValidator||h;if("array"!==c(e))return[new p(o,e,"array expected, "+c(e)+" found")];if(i.length&&e.length!==i.length)return[new p(o,e,"array length "+i.length+" expected, length "+e.length+" found")];if(i["min-length"]&&e.length<i["min-length"])return[new p(o,e,"array length at least "+i["min-length"]+" expected, length "+e.length+" found")];var s={type:i.value};r.$version<7&&(s.function=i.function),"object"===c(i.value)&&(s=i.value);for(var l=[],u=0;u<e.length;u++)l=l.concat(a({array:e,arrayIndex:u,value:e[u],valueSpec:s,style:n,styleSpec:r,key:o+"["+u+"]"}));return l}},{"../error/validation_error":122,"../util/get_type":157,"./validate":162}],164:[function(t,e,i){"use strict";var r=t("../util/get_type"),o=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.key,n=r(e);return"boolean"!==n?[new o(i,e,"boolean expected, "+n+" found")]:[]}},{"../error/validation_error":122,"../util/get_type":157}],165:[function(t,e,i){"use strict";var r=t("../error/validation_error"),o=t("../util/get_type"),a=t("csscolorparser").parseCSSColor;e.exports=function(t){var e=t.key,i=t.value,n=o(i);return"string"!==n?[new r(e,i,"color expected, "+n+" found")]:null===a(i)?[new r(e,i,'color expected, "'+i+'" found')]:[]}},{"../error/validation_error":122,"../util/get_type":157,csscolorparser:13}],166:[function(t,e,i){"use strict";var n=t("../error/validation_error");e.exports=function(t){var e=t.key,i=t.value;return i?[new n(e,i,"constants have been deprecated as of v8")]:[]}},{"../error/validation_error":122}],167:[function(t,e,i){"use strict";var o=t("../error/validation_error"),a=t("../util/unbundle_jsonlint");e.exports=function(t){var e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(a(i))&&r.push(new o(e,i,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(i)+" found")):-1===Object.keys(n.values).indexOf(a(i))&&r.push(new o(e,i,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(i)+" found")),r}},{"../error/validation_error":122,"../util/unbundle_jsonlint":161}],168:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../expression"),o=r.createExpression,a=r.createPropertyExpression,s=t("../util/unbundle_jsonlint");e.exports=function(e){var t=("property"===e.expressionContext?a:o)(s.deep(e.value),e.valueSpec);return"error"===t.result?t.value.map(function(t){return new n(""+e.key+t.key,e.value,t.message)}):"property"===e.expressionContext&&"text-font"===e.propertyKey&&-1!==t.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new n(e.key,e.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:[]}},{"../error/validation_error":122,"../expression":139,"../util/unbundle_jsonlint":161}],169:[function(t,e,i){"use strict";var u=t("../error/validation_error"),n=t("./validate_expression"),c=t("./validate_enum"),h=t("../util/get_type"),p=t("../util/unbundle_jsonlint"),r=t("../util/extend"),o=t("../feature_filter").isExpressionFilter;e.exports=function(t){return o(p.deep(t.value))?n(r({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var i=e.value,n=e.key;if("array"!==h(i))return[new u(n,i,"array expected, "+h(i)+" found")];var r,o=e.styleSpec,a=[];if(i.length<1)return[new u(n,i,"filter array must have at least 1 element")];switch(a=a.concat(c({key:n+"[0]",value:i[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),p(i[0])){case"<":case"<=":case">":case">=":2<=i.length&&"$type"===p(i[1])&&a.push(new u(n,i,'"$type" cannot be use with operator "'+i[0]+'"'));case"==":case"!=":3!==i.length&&a.push(new u(n,i,'filter array for operator "'+i[0]+'" must have 3 elements'));case"in":case"!in":2<=i.length&&"string"!==(r=h(i[1]))&&a.push(new u(n+"[1]",i[1],"string expected, "+r+" found"));for(var s=2;s<i.length;s++)r=h(i[s]),"$type"===p(i[1])?a=a.concat(c({key:n+"["+s+"]",value:i[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&a.push(new u(n+"["+s+"]",i[s],"string, number, or boolean expected, "+r+" found"));break;case"any":case"all":case"none":for(var l=1;l<i.length;l++)a=a.concat(t({key:n+"["+l+"]",value:i[l],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=h(i[1]),2!==i.length?a.push(new u(n,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"string"!==r&&a.push(new u(n+"[1]",i[1],"string expected, "+r+" found"))}return a}(t)}},{"../error/validation_error":122,"../feature_filter":148,"../util/extend":156,"../util/get_type":157,"../util/unbundle_jsonlint":161,"./validate_enum":167,"./validate_expression":168}],170:[function(t,e,i){"use strict";var f=t("../error/validation_error"),d=t("../util/get_type"),m=t("./validate"),y=t("./validate_object"),_=t("./validate_array"),g=t("./validate_number"),v=t("../util/unbundle_jsonlint");e.exports=function(t){function n(t){var e=[],i=t.value,n=t.key;if("array"!==d(i))return[new f(n,i,"array expected, "+d(i)+" found")];if(2!==i.length)return[new f(n,i,"array length 2 expected, length "+i.length+" found")];if(h){if("object"!==d(i[0]))return[new f(n,i,"object expected, "+d(i[0])+" found")];if(void 0===i[0].zoom)return[new f(n,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new f(n,i,"object stop key must have value")];if(o&&o>v(i[0].zoom))return[new f(n,i[0].zoom,"stop zoom values must appear in ascending order")];v(i[0].zoom)!==o&&(o=v(i[0].zoom),s=void 0,c={}),e=e.concat(y({key:n+"[0]",value:i[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:g,value:r}}))}else e=e.concat(r({key:n+"[0]",value:i[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},i));return e.concat(m({key:n+"[1]",value:i[1],valueSpec:l,style:t.style,styleSpec:t.styleSpec}))}function r(t,e){var i=d(t.value),n=v(t.value),r=null!==t.value?t.value:e;if(a){if(i!==a)return[new f(t.key,r,i+" stop domain type must match previous stop domain type "+a)]}else a=i;if("number"!==i&&"string"!==i&&"boolean"!==i)return[new f(t.key,r,"stop domain value must be a number, string, or boolean")];if("number"===i||"categorical"===u)return"categorical"!==u||"number"!==i||isFinite(n)&&Math.floor(n)===n?"categorical"!==u&&"number"===i&&void 0!==s&&n<s?[new f(t.key,r,"stop domain values must appear in ascending order")]:(s=n,"categorical"===u&&n in c?[new f(t.key,r,"stop domain values must be unique")]:(c[n]=!0,[])):[new f(t.key,r,"integer expected, found "+n)];var o="number expected, "+i+" found";return l["property-function"]&&void 0===u&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new f(t.key,r,o)]}var a,s,o,l=t.valueSpec,u=v(t.value.type),c={},e="categorical"!==u&&void 0===t.value.property,i=!e,h="array"===d(t.value.stops)&&"array"===d(t.value.stops[0])&&"object"===d(t.value.stops[0][0]),p=y({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===u)return[new f(t.key,t.value,'identity function may not have a "stops" property')];var e=[],i=t.value;return e=e.concat(_({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:n})),"array"===d(i)&&0===i.length&&e.push(new f(t.key,i,"array must have at least one stop")),e},default:function(t){return m({key:t.key,value:t.value,valueSpec:l,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===u&&e&&p.push(new f(t.key,t.value,'missing required property "property"')),"identity"===u||t.value.stops||p.push(new f(t.key,t.value,'missing required property "stops"')),"exponential"===u&&"piecewise-constant"===t.valueSpec.function&&p.push(new f(t.key,t.value,"exponential functions not supported")),8<=t.styleSpec.$version&&(i&&!t.valueSpec["property-function"]?p.push(new f(t.key,t.value,"property functions not supported")):e&&!t.valueSpec["zoom-function"]&&"heatmap-color"!==t.objectKey&&p.push(new f(t.key,t.value,"zoom functions not supported"))),"categorical"!==u&&!h||void 0!==t.value.property||p.push(new f(t.key,t.value,'"property" property is required')),p}},{"../error/validation_error":122,"../util/get_type":157,"../util/unbundle_jsonlint":161,"./validate":162,"./validate_array":163,"./validate_number":175,"./validate_object":176}],171:[function(t,e,i){"use strict";var r=t("../error/validation_error"),o=t("./validate_string");e.exports=function(t){var e=t.value,i=t.key,n=o(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new r(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new r(i,e,'"glyphs" url must include a "{range}" token'))),n}},{"../error/validation_error":122,"./validate_string":180}],172:[function(t,e,i){"use strict";var d=t("../error/validation_error"),m=t("../util/unbundle_jsonlint"),y=t("./validate_object"),_=t("./validate_filter"),g=t("./validate_paint_property"),v=t("./validate_layout_property"),x=t("./validate"),b=t("../util/extend");e.exports=function(t){var e=[],i=t.value,n=t.key,r=t.style,o=t.styleSpec;i.type||i.ref||e.push(new d(n,i,'either "type" or "ref" is required'));var a,s=m(i.type),l=m(i.ref);if(i.id)for(var u=m(i.id),c=0;c<t.arrayIndex;c++){var h=r.layers[c];m(h.id)===u&&e.push(new d(n,i.id,'duplicate layer id "'+i.id+'", previously used at line '+h.id.__line__))}if("ref"in i)["type","source","source-layer","filter","layout"].forEach(function(t){t in i&&e.push(new d(n,i[t],'"'+t+'" is prohibited for ref layers'))}),r.layers.forEach(function(t){m(t.id)===l&&(a=t)}),a?a.ref?e.push(new d(n,i.ref,"ref cannot reference another ref layer")):s=m(a.type):e.push(new d(n,i.ref,'ref layer "'+l+'" not found'));else if("background"!==s)if(i.source){var p=r.sources&&r.sources[i.source],f=p&&m(p.type);p?"vector"===f&&"raster"===s?e.push(new d(n,i.source,'layer "'+i.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new d(n,i.source,'layer "'+i.id+'" requires a vector source')):"vector"!==f||i["source-layer"]?"raster-dem"===f&&"hillshade"!==s&&e.push(new d(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):e.push(new d(n,i,'layer "'+i.id+'" must specify a "source-layer"')):e.push(new d(n,i.source,'source "'+i.source+'" not found'))}else e.push(new d(n,i,'missing required property "source"'));return e=e.concat(y({key:n,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return x({key:n+".type",value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"})},filter:_,layout:function(t){return y({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return v(b({layerType:s},t))}}})},paint:function(t){return y({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return g(b({layerType:s},t))}}})}}}))}},{"../error/validation_error":122,"../util/extend":156,"../util/unbundle_jsonlint":161,"./validate":162,"./validate_filter":169,"./validate_layout_property":173,"./validate_object":176,"./validate_paint_property":177}],173:[function(t,e,i){"use strict";var n=t("./validate_property");e.exports=function(t){return n(t,"layout")}},{"./validate_property":178}],174:[function(t,e,i){"use strict";var u=t("../error/validation_error"),c=t("../util/get_type"),h=t("./validate");e.exports=function(t){var e=t.value,i=t.styleSpec,n=i.light,r=t.style,o=[],a=c(e);if(void 0===e)return o;if("object"!==a)return o.concat([new u("light",e,"object expected, "+a+" found")]);for(var s in e){var l=s.match(/^(.*)-transition$/);o=l&&n[l[1]]&&n[l[1]].transition?o.concat(h({key:s,value:e[s],valueSpec:i.transition,style:r,styleSpec:i})):n[s]?o.concat(h({key:s,value:e[s],valueSpec:n[s],style:r,styleSpec:i})):o.concat([new u(s,e[s],'unknown property "'+s+'"')])}return o}},{"../error/validation_error":122,"../util/get_type":157,"./validate":162}],175:[function(t,e,i){"use strict";var o=t("../util/get_type"),a=t("../error/validation_error");e.exports=function(t){var e=t.key,i=t.value,n=t.valueSpec,r=o(i);return"number"!==r?[new a(e,i,"number expected, "+r+" found")]:"minimum"in n&&i<n.minimum?[new a(e,i,i+" is less than the minimum value "+n.minimum)]:"maximum"in n&&i>n.maximum?[new a(e,i,i+" is greater than the maximum value "+n.maximum)]:[]}},{"../error/validation_error":122,"../util/get_type":157}],176:[function(t,e,i){"use strict";var d=t("../error/validation_error"),m=t("../util/get_type"),y=t("./validate");e.exports=function(t){var e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],l=m(i);if("object"!==l)return[new d(e,i,"object expected, "+l+" found")];for(var u in i){var c=u.split(".")[0],h=n[c]||n["*"],p=void 0;if(r[c])p=r[c];else if(n[c])p=y;else if(r["*"])p=r["*"];else{if(!n["*"]){s.push(new d(e,i[u],'unknown property "'+u+'"'));continue}p=y}s=s.concat(p({key:(e?e+".":e)+u,value:i[u],valueSpec:h,style:o,styleSpec:a,object:i,objectKey:u},i))}for(var f in n)r[f]||n[f].required&&void 0===n[f].default&&void 0===i[f]&&s.push(new d(e,i,'missing required property "'+f+'"'));return s}},{"../error/validation_error":122,"../util/get_type":157,"./validate":162}],177:[function(t,e,i){"use strict";var n=t("./validate_property");e.exports=function(t){return n(t,"paint")}},{"./validate_property":178}],178:[function(t,e,i){"use strict";var p=t("./validate"),f=t("../error/validation_error"),d=t("../util/get_type"),m=t("../function").isFunction,y=t("../util/unbundle_jsonlint");e.exports=function(t,e){var i=t.key,n=t.style,r=t.styleSpec,o=t.value,a=t.objectKey,s=r[e+"_"+t.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return p({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});var u,c=t.valueSpec||s[a];if(!c)return[new f(i,o,'unknown property "'+a+'"')];if("string"===d(o)&&c["property-function"]&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new f(i,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(u[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new f(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&m(y.deep(o))&&"identity"===y(o.type)&&h.push(new f(i,o,'"text-font" does not support identity functions'))),h.concat(p({key:t.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyKey:a}))}},{"../error/validation_error":122,"../function":149,"../util/get_type":157,"../util/unbundle_jsonlint":161,"./validate":162}],179:[function(t,e,i){"use strict";var l=t("../error/validation_error"),u=t("../util/unbundle_jsonlint"),c=t("./validate_object"),h=t("./validate_enum");e.exports=function(t){var e=t.value,i=t.key,n=t.styleSpec,r=t.style;if(!e.type)return[new l(i,e,'"type" is required')];var o=u(e.type),a=[];switch(o){case"vector":case"raster":case"raster-dem":if(a=a.concat(c({key:i,value:e,valueSpec:n["source_"+o.replace("-","_")],style:t.style,styleSpec:n})),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&a.push(new l(i+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return a;case"geojson":return c({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n});case"video":return c({key:i,value:e,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return c({key:i,value:e,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return c({key:i,value:e,valueSpec:n.source_canvas,style:r,styleSpec:n});default:return h({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image","canvas"]},style:r,styleSpec:n})}}},{"../error/validation_error":122,"../util/unbundle_jsonlint":161,"./validate_enum":167,"./validate_object":176}],180:[function(t,e,i){"use strict";var r=t("../util/get_type"),o=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.key,n=r(e);return"string"!==n?[new o(i,e,"string expected, "+n+" found")]:[]}},{"../error/validation_error":122,"../util/get_type":157}],181:[function(t,e,i){"use strict";function n(t,e){e=e||l;var i=[];return i=i.concat(s({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:u,"*":function(){return[]}}})),t.constants&&(i=i.concat(a({key:"constants",value:t.constants,style:t,styleSpec:e}))),r(i)}function r(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function o(t){return function(){return r(t.apply(this,arguments))}}var a=t("./validate/validate_constants"),s=t("./validate/validate"),l=t("./reference/latest"),u=t("./validate/validate_glyphs_url");n.source=o(t("./validate/validate_source")),n.light=o(t("./validate/validate_light")),n.layer=o(t("./validate/validate_layer")),n.filter=o(t("./validate/validate_filter")),n.paintProperty=o(t("./validate/validate_paint_property")),n.layoutProperty=o(t("./validate/validate_layout_property")),e.exports=n},{"./reference/latest":151,"./validate/validate":162,"./validate/validate_constants":166,"./validate/validate_filter":169,"./validate/validate_glyphs_url":171,"./validate/validate_layer":172,"./validate/validate_layout_property":173,"./validate/validate_light":174,"./validate/validate_paint_property":177,"./validate/validate_source":179}],182:[function(t,e,i){"use strict";var n=t("./zoom_history"),r=function(t,e){this.zoom=t,this.transition=e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new n,{})};r.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},e.exports=r},{"./zoom_history":212}],183:[function(t,e,i){"use strict";var n=t("../style-spec/reference/latest"),r=t("../util/util"),o=t("../util/evented"),a=t("./validate_style"),s=t("../util/util").sphericalToCartesian,l=(t("../style-spec/util/color"),t("../style-spec/util/interpolate")),u=t("./properties"),c=u.Properties,h=u.Transitionable,p=(u.Transitioning,u.PossiblyEvaluated,u.DataConstantProperty),f=function(){this.specification=n.light.position};f.prototype.possiblyEvaluate=function(t,e){return s(t.expression.evaluate(e))},f.prototype.interpolate=function(t,e,i){return{x:l.number(t.x,e.x,i),y:l.number(t.y,e.y,i),z:l.number(t.z,e.z,i)}};var d=new c({anchor:new p(n.light.anchor),position:new f,color:new p(n.light.color),intensity:new p(n.light.intensity)}),m="-transition",y=function(e){function t(t){e.call(this),this._transitionable=new h(d),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getLight=function(){return this._transitionable.serialize()},t.prototype.setLight=function(t){if(!this._validate(a.light,t))for(var e in t){var i=t[e];r.endsWith(e,m)?this._transitionable.setTransition(e.slice(0,-m.length),i):this._transitionable.setValue(e,i)}},t.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},t.prototype.hasTransition=function(){return this._transitioning.hasTransition()},t.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},t.prototype._validate=function(t,e){return a.emitErrors(this,t.call(a,r.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:n})))},t}(o);e.exports=y},{"../style-spec/reference/latest":151,"../style-spec/util/color":153,"../style-spec/util/interpolate":158,"../util/evented":260,"../util/util":275,"./properties":188,"./validate_style":211}],184:[function(t,e,i){"use strict";var l=t("../util/mapbox").normalizeGlyphsURL,u=t("../util/ajax"),c=t("./parse_glyph_pbf");e.exports=function(t,e,i,n,a){var r=256*e,o=r+255,s=n(l(i).replace("{fontstack}",t).replace("{range}",r+"-"+o),u.ResourceType.Glyphs);u.getArrayBuffer(s,function(t,e){if(t)a(t);else if(e){for(var i={},n=0,r=c(e.data);n<r.length;n+=1){var o=r[n];i[o.id]=o}a(null,i)}})}},{"../util/ajax":251,"../util/mapbox":267,"./parse_glyph_pbf":186}],185:[function(t,e,i){"use strict";var r=t("../util/ajax"),m=t("../util/browser"),o=t("../util/mapbox").normalizeSpriteURL,y=t("../util/image").RGBAImage;e.exports=function(t,e,h){function i(){if(d)h(d);else if(p&&f){var t=m.getImageData(f),e={};for(var i in p){var n=p[i],r=n.width,o=n.height,a=n.x,s=n.y,l=n.sdf,u=n.pixelRatio,c=new y({width:r,height:o});y.copy(t,c,{x:a,y:s},{x:0,y:0},{width:r,height:o}),e[i]={data:c,pixelRatio:u,sdf:l}}h(null,e)}}var p,f,d,n=1<m.devicePixelRatio?"@2x":"";r.getJSON(e(o(t,n,".json"),r.ResourceType.SpriteJSON),function(t,e){d||(d=t,p=e,i())}),r.getImage(e(o(t,n,".png"),r.ResourceType.SpriteImage),function(t,e){d||(d=t,f=e,i())})}},{"../util/ajax":251,"../util/browser":252,"../util/image":263,"../util/mapbox":267}],186:[function(t,e,i){"use strict";function n(t,e,i){1===t&&i.readMessage(r,e)}function r(t,e,i){if(3===t){var n=i.readMessage(h,{}),r=n.id,o=n.bitmap,a=n.width,s=n.height,l=n.left,u=n.top,c=n.advance;e.push({id:r,bitmap:new p({width:a+2*f,height:s+2*f},o),metrics:{width:a,height:s,left:l,top:u,advance:c}})}}function h(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}var p=t("../util/image").AlphaImage,o=t("pbf"),f=3;e.exports=function(t){return new o(t).readFields(n,[])},e.exports.GLYPH_PBF_BORDER=f},{"../util/image":263,pbf:30}],187:[function(t,e,i){"use strict";var l=t("../util/browser"),o=t("../symbol/placement"),u=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};u.prototype.continuePlacement=function(t,e,i,n,r){for(;this._currentTileIndex<t.length;){var o=t[this._currentTileIndex];if(e.placeLayerTile(n,o,i,this._seenCrossTileIDs),this._currentTileIndex++,r())return!0}};var n=function(t,e,i,n,r){this.placement=new o(t,r),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1};n.prototype.isDone=function(){return this._done},n.prototype.continuePlacement=function(t,e,i){for(var n=this,r=l.now(),o=function(){var t=l.now()-r;return!n._forceFullPlacement&&2<t};0<=this._currentPlacementIndex;){var a=e[t[n._currentPlacementIndex]],s=n.placement.collisionIndex.transform.zoom;if("symbol"===a.type&&(!a.minzoom||a.minzoom<=s)&&(!a.maxzoom||a.maxzoom>s)){if(n._inProgressLayer||(n._inProgressLayer=new u),n._inProgressLayer.continuePlacement(i[a.source],n.placement,n._showCollisionBoxes,a,o))return;delete n._inProgressLayer}n._currentPlacementIndex--}this._done=!0},n.prototype.commit=function(t,e){return this.placement.commit(t,e),this.placement},e.exports=n},{"../symbol/placement":223,"../util/browser":252}],188:[function(t,e,i){"use strict";var n=t("../util/util"),r=n.clone,o=n.extend,a=n.easeCubicInOut,s=t("../style-spec/util/interpolate"),l=t("../style-spec/expression").normalizePropertyExpression,u=(t("../style-spec/util/color"),t("../util/web_worker_transfer").register),c=function(t,e){this.property=t,this.value=e,this.expression=l(void 0===e?t.specification.default:e,t.specification)};c.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},c.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var h=function(t){this.property=t,this.value=new c(t,void 0)};h.prototype.transitioned=function(t,e){return new f(this.property,this.value,e,o({},t.transition,this.transition),t.now)},h.prototype.untransitioned=function(){return new f(this.property,this.value,null,{},0)};var p=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};p.prototype.getValue=function(t){return r(this._values[t].value.value)},p.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new h(this._values[t].property)),this._values[t].value=new c(this._values[t].property,null===e?void 0:r(e))},p.prototype.getTransition=function(t){return r(this._values[t].transition)},p.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new h(this._values[t].property)),this._values[t].transition=r(e)||void 0},p.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e],r=this.getValue(n);void 0!==r&&(t[n]=r);var o=this.getTransition(n);void 0!==o&&(t[n+"-transition"]=o)}return t},p.prototype.transitioned=function(t,e){for(var i=new d(this._properties),n=0,r=Object.keys(this._values);n<r.length;n+=1){var o=r[n];i._values[o]=this._values[o].transitioned(t,e._values[o])}return i},p.prototype.untransitioned=function(){for(var t=new d(this._properties),e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e];t._values[n]=this._values[n].untransitioned()}return t};var f=function(t,e,i,n,r){this.property=t,this.value=e,this.begin=r+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)};f.prototype.possiblyEvaluate=function(t){var e=t.now||0,i=this.value.possiblyEvaluate(t),n=this.prior;if(n){if(e>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(e<this.begin)return n.possiblyEvaluate(t);var r=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(t),i,a(r))}return i};var d=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};d.prototype.possiblyEvaluate=function(t){for(var e=new _(this._properties),i=0,n=Object.keys(this._values);i<n.length;i+=1){var r=n[i];e._values[r]=this._values[r].possiblyEvaluate(t)}return e},d.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var i=e[t];if(this._values[i].prior)return!0}return!1};var m=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};m.prototype.getValue=function(t){return r(this._values[t].value)},m.prototype.setValue=function(t,e){this._values[t]=new c(this._values[t].property,null===e?void 0:r(e))},m.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var n=i[e],r=this.getValue(n);void 0!==r&&(t[n]=r)}return t},m.prototype.possiblyEvaluate=function(t){for(var e=new _(this._properties),i=0,n=Object.keys(this._values);i<n.length;i+=1){var r=n[i];e._values[r]=this._values[r].possiblyEvaluate(t)}return e};var y=function(t,e,i){this.property=t,this.value=e,this.globals=i};y.prototype.isConstant=function(){return"constant"===this.value.kind},y.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},y.prototype.evaluate=function(t){return this.property.evaluate(this.value,this.globals,t)};var _=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};_.prototype.get=function(t){return this._values[t]};var g=function(t){this.specification=t};g.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},g.prototype.interpolate=function(t,e,i){var n=s[this.specification.type];return n?n(t,e,i):t};var v=function(t){this.specification=t};v.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new y(this,{kind:"constant",value:t.expression.evaluate(e)},e):new y(this,t.expression,e)},v.prototype.interpolate=function(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0!==t.value.value&&void 0!==e.value.value){var n=s[this.specification.type];return n?new y(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.globals):t}},v.prototype.evaluate=function(t,e,i){return"constant"===t.kind?t.value:t.evaluate(e,i)};var x=function(t){this.specification=t};x.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"!==t.expression.kind)return this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);var i=t.expression.evaluate(e);return this._calculate(i,i,i,e)}},x.prototype._calculate=function(t,e,i,n){var r=n.zoom,o=r-Math.floor(r),a=n.crossFadingFactor();return r>n.zoomHistory.lastIntegerZoom?{from:t,to:e,fromScale:2,toScale:1,t:o+(1-o)*a}:{from:i,to:e,fromScale:.5,toScale:1,t:1-(1-a)*o}},x.prototype.interpolate=function(t){return t};var b=function(t){this.specification=t};b.prototype.possiblyEvaluate=function(){},b.prototype.interpolate=function(){};u("DataDrivenProperty",v),u("DataConstantProperty",g),u("CrossFadedProperty",x),u("HeatmapColorProperty",b),e.exports={PropertyValue:c,Transitionable:p,Transitioning:d,Layout:m,PossiblyEvaluatedPropertyValue:y,PossiblyEvaluated:_,DataConstantProperty:g,DataDrivenProperty:v,CrossFadedProperty:x,HeatmapColorProperty:b,Properties:function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var i=t[e],n=this.defaultPropertyValues[e]=new c(i,void 0),r=this.defaultTransitionablePropertyValues[e]=new h(i);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}}}},{"../style-spec/expression":139,"../style-spec/util/color":153,"../style-spec/util/interpolate":158,"../util/util":275,"../util/web_worker_transfer":278}],189:[function(t,e,i){"use strict";var h=t("@mapbox/point-geometry");e.exports={getMaximumPaintValue:function(t,e,i){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).binders[t].statistics.max},translateDistance:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},translate:function(t,e,i,n,r){if(!e[0]&&!e[1])return t;var o=h.convert(e);"viewport"===i&&o._rotate(-n);for(var a=[],s=0;s<t.length;s++){for(var l=t[s],u=[],c=0;c<l.length;c++)u.push(l[c].sub(o._mult(r)));a.push(u)}return a}}},{"@mapbox/point-geometry":4}],190:[function(t,e,i){"use strict";var n=t("../util/evented"),l=t("./style_layer"),u=t("./load_sprite"),r=t("../render/image_manager"),a=t("../render/glyph_manager"),c=t("./light"),s=t("../render/line_atlas"),h=t("../util/util"),o=t("../util/ajax"),p=t("../util/mapbox"),_=t("../util/browser"),f=t("../util/dispatcher"),d=t("./validate_style"),m=t("../source/source").getType,y=t("../source/source").setType,g=t("../source/query_features"),v=t("../source/source_cache"),x=(t("../source/geojson_source"),t("../style-spec/reference/latest")),b=t("../util/global_worker_pool"),w=t("../style-spec/deref"),T=t("../style-spec/diff"),S=t("../source/rtl_text_plugin"),A=t("./pauseable_placement"),M=t("./zoom_history"),E=t("../symbol/cross_tile_symbol_index"),L=h.pick(T.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),z=h.pick(T.operations,["setCenter","setZoom","setBearing","setPitch"]),P=function(n){function t(t,e){var o=this;void 0===e&&(e={}),n.call(this),this.map=t,this.dispatcher=new f(b(),this),this.imageManager=new r,this.glyphManager=new a(t._transformRequest,e.localIdeographFontFamily),this.lineAtlas=new s(256,512),this.crossTileSymbolIndex=new E,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new M,this._loaded=!1,this._resetUpdates();var i=this;this._rtlTextPluginCallback=S.registerForPluginAvailability(function(t){for(var e in i.dispatcher.broadcast("loadRTLTextPlugin",t.pluginBlobURL,t.errorCallback),i.sourceCaches)i.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var i=e.getSource();if(i&&i.vectorLayerIds)for(var n in o._layers){var r=o._layers[n];r.source===i.id&&o._validateLayer(r)}}}})}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.loadURL=function(t,e){var i=this;void 0===e&&(e={}),this.fire("dataloading",{dataType:"style"});var n="boolean"==typeof e.validate?e.validate:!p.isMapboxURL(t);t=p.normalizeStyleURL(t,e.accessToken);var r=this.map._transformRequest(t,o.ResourceType.Style);o.getJSON(r,function(t,e){t?i.fire("error",{error:t}):e&&i._load(e,n)})},t.prototype.loadJSON=function(t,e){var i=this;void 0===e&&(e={}),this.fire("dataloading",{dataType:"style"}),_.frame(function(){i._load(t,!1!==e.validate)})},t.prototype._load=function(t,e){var n=this;if(!e||!d.emitErrors(this,d(t))){for(var i in this._loaded=!0,(this.stylesheet=t).sources)n.addSource(i,t.sources[i],{validate:!1});t.sprite?u(t.sprite,this.map._transformRequest,function(t,e){if(t)n.fire("error",t);else if(e)for(var i in e)n.imageManager.addImage(i,e[i]);n.imageManager.setLoaded(!0),n.fire("data",{dataType:"style"})}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var r=w(this.stylesheet.layers);this._order=r.map(function(t){return t.id}),this._layers={};for(var o=0,a=r;o<a.length;o+=1){var s=a[o];(s=l.create(s)).setEventedParent(n,{layer:{id:s.id}}),n._layers[s.id]=s}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new c(this.stylesheet.light),this.fire("data",{dataType:"style"}),this.fire("style.load")}},t.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(e){var i=t.sourceLayer;if(i){var n=e.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire("error",{error:new Error('Source layer "'+i+'" does not exist on source "'+n.id+'" as specified by style layer "'+t.id+'"')})}}},t.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},t.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},t.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},t.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},t.prototype.update=function(t){var e=this;if(this._loaded){if(this._changed){var i=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(var r in(i.length||n.length)&&this._updateWorkerLayers(i,n),e._updatedSources){var o=e._updatedSources[r];"reload"===o?e._reloadSource(r):"clear"===o&&e._clearSource(r)}for(var a in e._updatedPaintProps)e._layers[a].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates(),this.fire("data",{dataType:"style"})}for(var s in e.sourceCaches)e.sourceCaches[s].used=!1;for(var l=0,u=e._order;l<u.length;l+=1){var c=u[l],h=e._layers[c];h.recalculate(t),!h.isHidden(t.zoom)&&h.source&&(e.sourceCaches[h.source].used=!0)}this.light.recalculate(t),this.z=t.zoom}},t.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},t.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},t.prototype.setState=function(t){var e=this;if(this._checkLoaded(),d.emitErrors(this,d(t)))return!1;(t=h.clone(t)).layers=w(t.layers);var i=T(this.serialize(),t).filter(function(t){return!(t.command in z)});if(0===i.length)return!1;var n=i.filter(function(t){return!(t.command in L)});if(0<n.length)throw new Error("Unimplemented: "+n.map(function(t){return t.command}).join(", ")+".");return i.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},t.prototype.addImage=function(t,e){if(this.getImage(t))return this.fire("error",{error:new Error("An image with this name already exists.")});this.imageManager.addImage(t,e),this.fire("data",{dataType:"style"})},t.prototype.getImage=function(t){return this.imageManager.getImage(t)},t.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire("error",{error:new Error("No image with this name exists.")});this.imageManager.removeImage(t),this.fire("data",{dataType:"style"})},t.prototype.addSource=function(t,e,i){var n=this;if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e).join(", ")+".");if(!(0<=["vector","raster","geojson","video","image","canvas"].indexOf(e.type)&&this._validate(d.source,"sources."+t,e,null,i))){this.map&&this.map._collectResourceTiming&&(e.collectResourceTiming=!0);var r=this.sourceCaches[t]=new v(t,e,this.dispatcher);r.style=this,r.setEventedParent(this,function(){return{isSourceLoaded:n.loaded(),source:r.serialize(),sourceId:t}}),r.onAdd(this.map),this._changed=!0}},t.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(var e in this._layers)if(this._layers[e].source===t)return this.fire("error",{error:new Error('Source "'+t+'" cannot be removed while layer "'+e+'" is using it.')});var i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire("data",{sourceDataType:"metadata",dataType:"source",sourceId:t}),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0},t.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},t.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},t.prototype.addLayer=function(t,e,i){this._checkLoaded();var n=t.id;if("object"==typeof t.source&&(this.addSource(n,t.source),t=h.clone(t),t=h.extend(t,{source:n})),!this._validate(d.layer,"layers."+n,t,{arrayIndex:-1},i)){var r=l.create(t);this._validateLayer(r),r.setEventedParent(this,{layer:{id:n}});var o=e?this._order.indexOf(e):this._order.length;if(e&&-1===o)return void this.fire("error",{error:new Error('Layer with id "'+e+'" does not exist on this map.')});if(this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=r,this._removedLayers[n]&&r.source){var a=this._removedLayers[n];delete this._removedLayers[n],a.type!==r.type?this._updatedSources[r.source]="clear":(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause())}this._updateLayer(r)}},t.prototype.moveLayer=function(t,e){if(this._checkLoaded(),this._changed=!0,this._layers[t]){var i=this._order.indexOf(t);this._order.splice(i,1);var n=e?this._order.indexOf(e):this._order.length;e&&-1===n?this.fire("error",{error:new Error('Layer with id "'+e+'" does not exist on this map.')}):(this._order.splice(n,0,t),this._layerOrderChanged=!0)}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")})},t.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(e){e.setEventedParent(null);var i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t]}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")})},t.prototype.getLayer=function(t){return this._layers[t]},t.prototype.setLayerZoomRange=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);n?n.minzoom===e&&n.maxzoom===i||(null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._updateLayer(n)):this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")})},t.prototype.setFilter=function(t,e){this._checkLoaded();var i=this.getLayer(t);if(i)return h.deepEqual(i.filter,e)?void 0:null==e?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(d.filter,"layers."+i.id+".filter",e)||(i.filter=h.clone(e),this._updateLayer(i)));this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")})},t.prototype.getFilter=function(t){return h.clone(this.getLayer(t).filter)},t.prototype.setLayoutProperty=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);n?h.deepEqual(n.getLayoutProperty(e),i)||(n.setLayoutProperty(e,i),this._updateLayer(n)):this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},t.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},t.prototype.setPaintProperty=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);if(n){if(!h.deepEqual(n.getPaintProperty(e),i)){var r=n._transitionablePaint._values[e].value.isDataDriven();n.setPaintProperty(e,i),(n._transitionablePaint._values[e].value.isDataDriven()||r)&&this._updateLayer(n),this._changed=!0,this._updatedPaintProps[t]=!0}}else this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},t.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},t.prototype.getTransition=function(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},t.prototype.serialize=function(){var e=this;return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:h.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(t){return e._layers[t].serialize()})},function(t){return void 0!==t})},t.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},t.prototype._flattenRenderedFeatures=function(t){for(var e=[],i=this._order.length-1;0<=i;i--)for(var n=this._order[i],r=0,o=t;r<o.length;r+=1){var a=o[r][n];if(a)for(var s=0,l=a;s<l.length;s+=1){var u=l[s];e.push(u)}}return e},t.prototype.queryRenderedFeatures=function(t,e,i,n){e&&e.filter&&this._validate(d.filter,"queryRenderedFeatures.filter",e.filter);var r={};if(e&&e.layers){if(!Array.isArray(e.layers))return this.fire("error",{error:"parameters.layers must be an Array."}),[];for(var o=0,a=e.layers;o<a.length;o+=1){var s=a[o],l=this._layers[s];if(!l)return this.fire("error",{error:"The layer '"+s+"' does not exist in the map's style and cannot be queried for features."}),[];r[l.source]=!0}}var u=[];for(var c in this.sourceCaches)if(!e.layers||r[c]){var h=g.rendered(this.sourceCaches[c],this._layers,t,e,i,n,this.placement?this.placement.collisionIndex:null);u.push(h)}return this._flattenRenderedFeatures(u)},t.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(d.filter,"querySourceFeatures.filter",e.filter);var i=this.sourceCaches[t];return i?g.source(i,e):[]},t.prototype.addSourceType=function(t,e,i){return m(t)?i(new Error('A source type called "'+t+'" already exists.')):(y(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},t.prototype.getLight=function(){return this.light.getLight()},t.prototype.setLight=function(t){this._checkLoaded();var e=this.light.getLight(),i=!1;for(var n in t)if(!h.deepEqual(t[n],e[n])){i=!0;break}if(i){var r={now:_.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t),this.light.updateTransitions(r)}},t.prototype._validate=function(t,e,i,n,r){return(!r||!1!==r.validate)&&d.emitErrors(this,t.call(d,h.extend({key:e,style:this.serialize(),value:i,styleSpec:x},n)))},t.prototype._remove=function(){for(var t in S.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[t].clearTiles();this.dispatcher.remove()},t.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},t.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},t.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},t.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},t.prototype._updatePlacement=function(t,e,i){for(var n=!1,r=!1,o={},a=0,s=this._order;a<s.length;a+=1){var l=s[a],u=this._layers[l];if("symbol"===u.type){if(!o[u.source]){var c=this.sourceCaches[u.source];o[u.source]=c.getRenderableIds().map(function(t){return c.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var h=this.crossTileSymbolIndex.addLayer(u,o[u.source]);n=n||h}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var p=this._layerOrderChanged;if((p||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now()))&&(this.pauseablePlacement=new A(t,this._order,p,e,i),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,o),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,_.now()),r=!0),n&&this.pauseablePlacement.placement.setStale()),r||n)for(var f=0,d=this._order;f<d.length;f+=1){var m=d[f],y=this._layers[m];"symbol"===y.type&&this.placement.updateLayerOpacities(y,o[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())},t.prototype.getImages=function(t,e,i){this.imageManager.getImages(e.icons,i)},t.prototype.getGlyphs=function(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)},t}(n);e.exports=P},{"../render/glyph_manager":86,"../render/image_manager":88,"../render/line_atlas":89,"../source/geojson_source":99,"../source/query_features":105,"../source/rtl_text_plugin":109,"../source/source":110,"../source/source_cache":111,"../style-spec/deref":120,"../style-spec/diff":121,"../style-spec/reference/latest":151,"../symbol/cross_tile_symbol_index":218,"../util/ajax":251,"../util/browser":252,"../util/dispatcher":258,"../util/evented":260,"../util/global_worker_pool":262,"../util/mapbox":267,"../util/util":275,"./light":183,"./load_sprite":185,"./pauseable_placement":187,"./style_layer":191,"./validate_style":211,"./zoom_history":212}],191:[function(t,e,i){"use strict";var o=t("../util/util"),a=t("../style-spec/reference/latest"),s=t("./validate_style"),n=t("../util/evented"),r=t("./properties"),l=r.Layout,u=r.Transitionable,c=(r.Transitioning,r.Properties,"-transition"),h=function(r){function t(t,e){for(var i in r.call(this),this.id=t.id,this.metadata=t.metadata,this.type=t.type,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.visibility="visible","background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this._featureFilter=function(){return!0},e.layout&&(this._unevaluatedLayout=new l(e.layout)),this._transitionablePaint=new u(e.paint),t.paint)this.setPaintProperty(i,t.paint[i],{validate:!1});for(var n in t.layout)this.setLayoutProperty(n,t.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},t.prototype.setLayoutProperty=function(t,e,i){if(null!=e){var n="layers."+this.id+".layout."+t;if(this._validate(s.layoutProperty,n,t,e,i))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility="none"===e?e:"visible"},t.prototype.getPaintProperty=function(t){return o.endsWith(t,c)?this._transitionablePaint.getTransition(t.slice(0,-c.length)):this._transitionablePaint.getValue(t)},t.prototype.setPaintProperty=function(t,e,i){if(null!=e){var n="layers."+this.id+".paint."+t;if(this._validate(s.paintProperty,n,t,e,i))return}o.endsWith(t,c)?this._transitionablePaint.setTransition(t.slice(0,-c.length),e||void 0):this._transitionablePaint.setValue(t,e)},t.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},t.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},t.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return"none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),o.filterObject(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},t.prototype._validate=function(t,e,i,n,r){return(!r||!1!==r.validate)&&s.emitErrors(this,t.call(s,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:a,style:{glyphs:!0,sprite:!0}}))},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t}(n);e.exports=h;var p={circle:t("./style_layer/circle_style_layer"),heatmap:t("./style_layer/heatmap_style_layer"),hillshade:t("./style_layer/hillshade_style_layer"),fill:t("./style_layer/fill_style_layer"),"fill-extrusion":t("./style_layer/fill_extrusion_style_layer"),line:t("./style_layer/line_style_layer"),symbol:t("./style_layer/symbol_style_layer"),background:t("./style_layer/background_style_layer"),raster:t("./style_layer/raster_style_layer")};h.create=function(t){return new p[t.type](t)}},{"../style-spec/reference/latest":151,"../util/evented":260,"../util/util":275,"./properties":188,"./style_layer/background_style_layer":192,"./style_layer/circle_style_layer":194,"./style_layer/fill_extrusion_style_layer":196,"./style_layer/fill_style_layer":198,"./style_layer/heatmap_style_layer":200,"./style_layer/hillshade_style_layer":202,"./style_layer/line_style_layer":204,"./style_layer/raster_style_layer":206,"./style_layer/symbol_style_layer":208,"./validate_style":211}],192:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("./background_style_layer_properties"),o=t("../properties"),a=(o.Transitionable,o.Transitioning,o.PossiblyEvaluated,function(e){function t(t){e.call(this,t,r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(n));e.exports=a},{"../properties":188,"../style_layer":191,"./background_style_layer_properties":193}],193:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=(r.DataDrivenProperty,r.CrossFadedProperty),l=(r.HeatmapColorProperty,new o({"background-color":new a(n.paint_background["background-color"]),"background-pattern":new s(n.paint_background["background-pattern"]),"background-opacity":new a(n.paint_background["background-opacity"])}));e.exports={paint:l}},{"../../style-spec/reference/latest":151,"../properties":188}],194:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/circle_bucket"),u=t("../../util/intersection_tests").multiPolygonIntersectsBufferedMultiPoint,o=t("../query_utils"),a=o.getMaximumPaintValue,s=o.translateDistance,c=o.translate,l=t("./circle_style_layer_properties"),h=t("../properties"),p=(h.Transitionable,h.Transitioning,h.PossiblyEvaluated,function(e){function t(t){e.call(this,t,l)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createBucket=function(t){return new r(t)},t.prototype.queryRadius=function(t){var e=t;return a("circle-radius",this,e)+a("circle-stroke-width",this,e)+s(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){var a=c(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),r,o),s=this.paint.get("circle-radius").evaluate(e)*o,l=this.paint.get("circle-stroke-width").evaluate(e)*o;return u(a,i,s+l)},t}(n));e.exports=p},{"../../data/bucket/circle_bucket":42,"../../util/intersection_tests":264,"../properties":188,"../query_utils":189,"../style_layer":191,"./circle_style_layer_properties":195}],195:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=r.DataDrivenProperty,l=(r.CrossFadedProperty,r.HeatmapColorProperty,new o({"circle-radius":new s(n.paint_circle["circle-radius"]),"circle-color":new s(n.paint_circle["circle-color"]),"circle-blur":new s(n.paint_circle["circle-blur"]),"circle-opacity":new s(n.paint_circle["circle-opacity"]),"circle-translate":new a(n.paint_circle["circle-translate"]),"circle-translate-anchor":new a(n.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new a(n.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new a(n.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new s(n.paint_circle["circle-stroke-width"]),"circle-stroke-color":new s(n.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new s(n.paint_circle["circle-stroke-opacity"])}));e.exports={paint:l}},{"../../style-spec/reference/latest":151,"../properties":188}],196:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/fill_extrusion_bucket"),s=t("../../util/intersection_tests").multiPolygonIntersectsMultiPolygon,o=t("../query_utils"),a=o.translateDistance,l=o.translate,u=t("./fill_extrusion_style_layer_properties"),c=t("../properties"),h=(c.Transitionable,c.Transitioning,c.PossiblyEvaluated,function(e){function t(t){e.call(this,t,u)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createBucket=function(t){return new r(t)},t.prototype.queryRadius=function(){return a(this.paint.get("fill-extrusion-translate"))},t.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){var a=l(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),r,o);return s(a,i)},t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-extrusion-opacity")&&"none"!==this.visibility},t.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null)},t}(n));e.exports=h},{"../../data/bucket/fill_extrusion_bucket":46,"../../util/intersection_tests":264,"../properties":188,"../query_utils":189,"../style_layer":191,"./fill_extrusion_style_layer_properties":197}],197:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=r.DataDrivenProperty,l=r.CrossFadedProperty,u=(r.HeatmapColorProperty,new o({"fill-extrusion-opacity":new a(n["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new s(n["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new a(n["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new a(n["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new l(n["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new s(n["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new s(n["paint_fill-extrusion"]["fill-extrusion-base"])}));e.exports={paint:u}},{"../../style-spec/reference/latest":151,"../properties":188}],198:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/fill_bucket"),s=t("../../util/intersection_tests").multiPolygonIntersectsMultiPolygon,o=t("../query_utils"),a=o.translateDistance,l=o.translate,u=t("./fill_style_layer_properties"),c=t("../properties"),h=(c.Transitionable,c.Transitioning,c.PossiblyEvaluated,function(e){function t(t){e.call(this,t,u)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.recalculate=function(t){this.paint=this._transitioningPaint.possiblyEvaluate(t),void 0===this._transitionablePaint.getValue("fill-outline-color")&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(t){return new r(t)},t.prototype.queryRadius=function(){return a(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){var a=l(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),r,o);return s(a,i)},t}(n));e.exports=h},{"../../data/bucket/fill_bucket":44,"../../util/intersection_tests":264,"../properties":188,"../query_utils":189,"../style_layer":191,"./fill_style_layer_properties":199}],199:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=r.DataDrivenProperty,l=r.CrossFadedProperty,u=(r.HeatmapColorProperty,new o({"fill-antialias":new a(n.paint_fill["fill-antialias"]),"fill-opacity":new s(n.paint_fill["fill-opacity"]),"fill-color":new s(n.paint_fill["fill-color"]),"fill-outline-color":new s(n.paint_fill["fill-outline-color"]),"fill-translate":new a(n.paint_fill["fill-translate"]),"fill-translate-anchor":new a(n.paint_fill["fill-translate-anchor"]),"fill-pattern":new l(n.paint_fill["fill-pattern"])}));e.exports={paint:u}},{"../../style-spec/reference/latest":151,"../properties":188}],200:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/heatmap_bucket"),o=t("../../util/image").RGBAImage,a=t("./heatmap_style_layer_properties"),s=t("../properties"),l=(s.Transitionable,s.Transitioning,s.PossiblyEvaluated,function(n){function t(t){n.call(this,t,a),this._updateColorRamp()}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.createBucket=function(t){return new r(t)},t.prototype.setPaintProperty=function(t,e,i){n.prototype.setPaintProperty.call(this,t,e,i),"heatmap-color"===t&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){for(var t=this._transitionablePaint._values["heatmap-color"].value.expression,e=new Uint8Array(1024),i=e.length,n=4;n<i;n+=4){var r=t.evaluate({heatmapDensity:n/i});e[n+0]=Math.floor(255*r.r/r.a),e[n+1]=Math.floor(255*r.g/r.a),e[n+2]=Math.floor(255*r.b/r.a),e[n+3]=Math.floor(255*r.a)}this.colorRamp=new o({width:256,height:1},e),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},t}(n));e.exports=l},{"../../data/bucket/heatmap_bucket":47,"../../util/image":263,"../properties":188,"../style_layer":191,"./heatmap_style_layer_properties":201}],201:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=r.DataDrivenProperty,l=(r.CrossFadedProperty,r.HeatmapColorProperty),u=new o({"heatmap-radius":new s(n.paint_heatmap["heatmap-radius"]),"heatmap-weight":new s(n.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new a(n.paint_heatmap["heatmap-intensity"]),"heatmap-color":new l(n.paint_heatmap["heatmap-color"]),"heatmap-opacity":new a(n.paint_heatmap["heatmap-opacity"])});e.exports={paint:u}},{"../../style-spec/reference/latest":151,"../properties":188}],202:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("./hillshade_style_layer_properties"),o=t("../properties"),a=(o.Transitionable,o.Transitioning,o.PossiblyEvaluated,function(e){function t(t){e.call(this,t,r)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},t}(n));e.exports=a},{"../properties":188,"../style_layer":191,"./hillshade_style_layer_properties":203}],203:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=(r.DataDrivenProperty,r.CrossFadedProperty,r.HeatmapColorProperty,new o({"hillshade-illumination-direction":new a(n.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new a(n.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new a(n.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new a(n.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new a(n.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new a(n.paint_hillshade["hillshade-accent-color"])}));e.exports={paint:s}},{"../../style-spec/reference/latest":151,"../properties":188}],204:[function(t,e,i){"use strict";function u(t,e){return 0<e?e+2*t:t}var m=t("@mapbox/point-geometry"),n=t("../style_layer"),r=t("../../data/bucket/line_bucket"),c=t("../../util/intersection_tests").multiPolygonIntersectsBufferedMultiLine,o=t("../query_utils"),a=o.getMaximumPaintValue,s=o.translateDistance,h=o.translate,l=t("./line_style_layer_properties"),p=t("../../util/util").extend,f=t("../evaluation_parameters"),d=t("../properties"),y=(d.Transitionable,d.Transitioning,d.Layout,d.PossiblyEvaluated,new(function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.possiblyEvaluate=function(t,e){return e=new f(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),n.prototype.possiblyEvaluate.call(this,t,e)},t.prototype.evaluate=function(t,e,i){return e=p({},e,{zoom:Math.floor(e.zoom)}),n.prototype.evaluate.call(this,t,e,i)},t}(d.DataDrivenProperty))(l.paint.properties["line-width"].specification));y.useIntegerZoom=!0;var _=function(e){function t(t){e.call(this,t,l)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.recalculate=function(t){e.prototype.recalculate.call(this,t),this.paint._values["line-floorwidth"]=y.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)},t.prototype.createBucket=function(t){return new r(t)},t.prototype.queryRadius=function(t){var e=t,i=u(a("line-width",this,e),a("line-gap-width",this,e)),n=a("line-offset",this,e);return i/2+Math.abs(n)+s(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(t,e,i,n,r,o){var a=h(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),r,o),s=o/2*u(this.paint.get("line-width").evaluate(e),this.paint.get("line-gap-width").evaluate(e)),l=this.paint.get("line-offset").evaluate(e);return l&&(i=function(t,e){for(var i=[],n=new m(0,0),r=0;r<t.length;r++){for(var o=t[r],a=[],s=0;s<o.length;s++){var l=o[s-1],u=o[s],c=o[s+1],h=0===s?n:u.sub(l)._unit()._perp(),p=s===o.length-1?n:c.sub(u)._unit()._perp(),f=h._add(p)._unit(),d=f.x*p.x+f.y*p.y;f._mult(1/d),a.push(f._mult(e)._add(u))}i.push(a)}return i}(i,l*o)),c(a,i,s)},t}(n);e.exports=_},{"../../data/bucket/line_bucket":49,"../../util/intersection_tests":264,"../../util/util":275,"../evaluation_parameters":182,"../properties":188,"../query_utils":189,"../style_layer":191,"./line_style_layer_properties":205,"@mapbox/point-geometry":4}],205:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=r.DataDrivenProperty,l=r.CrossFadedProperty,u=(r.HeatmapColorProperty,new o({"line-cap":new a(n.layout_line["line-cap"]),"line-join":new s(n.layout_line["line-join"]),"line-miter-limit":new a(n.layout_line["line-miter-limit"]),"line-round-limit":new a(n.layout_line["line-round-limit"])})),c=new o({"line-opacity":new s(n.paint_line["line-opacity"]),"line-color":new s(n.paint_line["line-color"]),"line-translate":new a(n.paint_line["line-translate"]),"line-translate-anchor":new a(n.paint_line["line-translate-anchor"]),"line-width":new s(n.paint_line["line-width"]),"line-gap-width":new s(n.paint_line["line-gap-width"]),"line-offset":new s(n.paint_line["line-offset"]),"line-blur":new s(n.paint_line["line-blur"]),"line-dasharray":new l(n.paint_line["line-dasharray"]),"line-pattern":new l(n.paint_line["line-pattern"])});e.exports={paint:c,layout:u}},{"../../style-spec/reference/latest":151,"../properties":188}],206:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("./raster_style_layer_properties"),o=t("../properties"),a=(o.Transitionable,o.Transitioning,o.PossiblyEvaluated,function(e){function t(t){e.call(this,t,r)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(n));e.exports=a},{"../properties":188,"../style_layer":191,"./raster_style_layer_properties":207}],207:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=(r.DataDrivenProperty,r.CrossFadedProperty,r.HeatmapColorProperty,new o({"raster-opacity":new a(n.paint_raster["raster-opacity"]),"raster-hue-rotate":new a(n.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new a(n.paint_raster["raster-brightness-min"]),"raster-brightness-max":new a(n.paint_raster["raster-brightness-max"]),"raster-saturation":new a(n.paint_raster["raster-saturation"]),"raster-contrast":new a(n.paint_raster["raster-contrast"]),"raster-fade-duration":new a(n.paint_raster["raster-fade-duration"])}));e.exports={paint:s}},{"../../style-spec/reference/latest":151,"../properties":188}],208:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/symbol_bucket"),o=t("../../util/token"),a=t("../../style-spec/expression").isExpression,s=t("./symbol_style_layer_properties"),l=t("../properties"),u=(l.Transitionable,l.Transitioning,l.Layout,l.PossiblyEvaluated,function(e){function t(t){e.call(this,t,s)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.recalculate=function(t){e.prototype.recalculate.call(this,t),"auto"===this.layout.get("icon-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},t.prototype.getValueAndResolveTokens=function(t,e){var i=this.layout.get(t).evaluate(e),n=this._unevaluatedLayout._values[t];return n.isDataDriven()||a(n.value)?i:o(e.properties,i)},t.prototype.createBucket=function(t){return new r(t)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t}(n));e.exports=u},{"../../data/bucket/symbol_bucket":51,"../../style-spec/expression":139,"../../util/token":274,"../properties":188,"../style_layer":191,"./symbol_style_layer_properties":209}],209:[function(t,e,i){"use strict";var n=t("../../style-spec/reference/latest"),r=t("../properties"),o=r.Properties,a=r.DataConstantProperty,s=r.DataDrivenProperty,l=(r.CrossFadedProperty,r.HeatmapColorProperty,new o({"symbol-placement":new a(n.layout_symbol["symbol-placement"]),"symbol-spacing":new a(n.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new a(n.layout_symbol["symbol-avoid-edges"]),"icon-allow-overlap":new a(n.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new a(n.layout_symbol["icon-ignore-placement"]),"icon-optional":new a(n.layout_symbol["icon-optional"]),"icon-rotation-alignment":new a(n.layout_symbol["icon-rotation-alignment"]),"icon-size":new s(n.layout_symbol["icon-size"]),"icon-text-fit":new a(n.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new a(n.layout_symbol["icon-text-fit-padding"]),"icon-image":new s(n.layout_symbol["icon-image"]),"icon-rotate":new s(n.layout_symbol["icon-rotate"]),"icon-padding":new a(n.layout_symbol["icon-padding"]),"icon-keep-upright":new a(n.layout_symbol["icon-keep-upright"]),"icon-offset":new s(n.layout_symbol["icon-offset"]),"icon-anchor":new s(n.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new a(n.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new a(n.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new a(n.layout_symbol["text-rotation-alignment"]),"text-field":new s(n.layout_symbol["text-field"]),"text-font":new s(n.layout_symbol["text-font"]),"text-size":new s(n.layout_symbol["text-size"]),"text-max-width":new s(n.layout_symbol["text-max-width"]),"text-line-height":new a(n.layout_symbol["text-line-height"]),"text-letter-spacing":new s(n.layout_symbol["text-letter-spacing"]),"text-justify":new s(n.layout_symbol["text-justify"]),"text-anchor":new s(n.layout_symbol["text-anchor"]),"text-max-angle":new a(n.layout_symbol["text-max-angle"]),"text-rotate":new s(n.layout_symbol["text-rotate"]),"text-padding":new a(n.layout_symbol["text-padding"]),"text-keep-upright":new a(n.layout_symbol["text-keep-upright"]),"text-transform":new s(n.layout_symbol["text-transform"]),"text-offset":new s(n.layout_symbol["text-offset"]),"text-allow-overlap":new a(n.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new a(n.layout_symbol["text-ignore-placement"]),"text-optional":new a(n.layout_symbol["text-optional"])})),u=new o({"icon-opacity":new s(n.paint_symbol["icon-opacity"]),"icon-color":new s(n.paint_symbol["icon-color"]),"icon-halo-color":new s(n.paint_symbol["icon-halo-color"]),"icon-halo-width":new s(n.paint_symbol["icon-halo-width"]),"icon-halo-blur":new s(n.paint_symbol["icon-halo-blur"]),"icon-translate":new a(n.paint_symbol["icon-translate"]),"icon-translate-anchor":new a(n.paint_symbol["icon-translate-anchor"]),"text-opacity":new s(n.paint_symbol["text-opacity"]),"text-color":new s(n.paint_symbol["text-color"]),"text-halo-color":new s(n.paint_symbol["text-halo-color"]),"text-halo-width":new s(n.paint_symbol["text-halo-width"]),"text-halo-blur":new s(n.paint_symbol["text-halo-blur"]),"text-translate":new a(n.paint_symbol["text-translate"]),"text-translate-anchor":new a(n.paint_symbol["text-translate-anchor"])});e.exports={paint:u,layout:l}},{"../../style-spec/reference/latest":151,"../properties":188}],210:[function(t,e,i){"use strict";var g=t("./style_layer"),v=t("../util/util"),x=t("../style-spec/feature_filter"),b=t("../style-spec/group_by_layout"),n=function(t){t&&this.replace(t)};n.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},n.prototype.update=function(t,e){for(var i=this,n=0,r=t;n<r.length;n+=1){var o=r[n];i._layerConfigs[o.id]=o;var a=i._layers[o.id]=g.create(o);a._featureFilter=x(a.filter)}for(var s=0,l=e;s<l.length;s+=1){var u=l[s];delete i._layerConfigs[u],delete i._layers[u]}this.familiesBySource={};for(var c=0,h=b(v.values(this._layerConfigs));c<h.length;c+=1){var p=h[c].map(function(t){return i._layers[t.id]}),f=p[0];if("none"!==f.visibility){var d=f.source||"",m=i.familiesBySource[d];m||(m=i.familiesBySource[d]={});var y=f.sourceLayer||"_geojsonTileLayer",_=m[y];_||(_=m[y]=[]),_.push(p)}}},e.exports=n},{"../style-spec/feature_filter":148,"../style-spec/group_by_layout":150,"../util/util":275,"./style_layer":191}],211:[function(t,e,i){"use strict";e.exports=t("../style-spec/validate_style.min"),e.exports.emitErrors=function(t,e){if(e&&e.length){for(var i=0,n=e;i<n.length;i+=1){var r=n[i].message;t.fire("error",{error:new Error(r)})}return!0}return!1}},{"../style-spec/validate_style.min":181}],212:[function(t,e,i){"use strict";var n=function(){this.first=!0};n.prototype.update=function(t,e){var i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))},e.exports=n},{}],213:[function(t,e,i){"use strict";var n=t("@mapbox/point-geometry"),r=t("../util/web_worker_transfer").register,o=function(r){function t(t,e,i,n){r.call(this,t,e),this.angle=i,void 0!==n&&(this.segment=n)}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(n);r("Anchor",o),e.exports=o},{"../util/web_worker_transfer":278,"@mapbox/point-geometry":4}],214:[function(t,e,i){"use strict";e.exports=function(t,e,i,n,r){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;-i/2<s;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<i/2;){var c=t[a-1],h=t[a],p=t[a+1];if(!p)return!1;var f=c.angleTo(h)-h.angleTo(p);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:f}),u+=f;s-l[0].distance>n;)u-=l.shift().angleDelta;if(r<u)return!1;a++,s+=h.dist(p)}return!0}},{}],215:[function(t,e,i){"use strict";var p=t("@mapbox/point-geometry");e.exports=function(t,e,i,n,r){for(var o=[],a=0;a<t.length;a++)for(var s=t[a],l=void 0,u=0;u<s.length-1;u++){var c=s[u],h=s[u+1];c.x<e&&h.x<e||(c.x<e?c=new p(e,c.y+(h.y-c.y)*((e-c.x)/(h.x-c.x)))._round():h.x<e&&(h=new p(e,c.y+(h.y-c.y)*((e-c.x)/(h.x-c.x)))._round()),c.y<i&&h.y<i||(c.y<i?c=new p(c.x+(h.x-c.x)*((i-c.y)/(h.y-c.y)),i)._round():h.y<i&&(h=new p(c.x+(h.x-c.x)*((i-c.y)/(h.y-c.y)),i)._round()),c.x>=n&&h.x>=n||(c.x>=n?c=new p(n,c.y+(h.y-c.y)*((n-c.x)/(h.x-c.x)))._round():h.x>=n&&(h=new p(n,c.y+(h.y-c.y)*((n-c.x)/(h.x-c.x)))._round()),c.y>=r&&h.y>=r||(c.y>=r?c=new p(c.x+(h.x-c.x)*((r-c.y)/(h.y-c.y)),r)._round():h.y>=r&&(h=new p(c.x+(h.x-c.x)*((r-c.y)/(h.y-c.y)),r)._round()),l&&c.equals(l[l.length-1])||(l=[c],o.push(l)),l.push(h)))))}return o}},{"@mapbox/point-geometry":4}],216:[function(t,e,i){"use strict";var n=function(t,e,i,n,r,o,a,s,l,u,c){var h=a.top*s-l,p=a.bottom*s+l,f=a.left*s-l,d=a.right*s+l;if(this.boxStartIndex=t.length,u){var m=p-h,y=d-f;0<m&&(m=Math.max(10*s,m),this._addLineCollisionCircles(t,e,i,i.segment,y,m,n,r,o,c))}else t.emplaceBack(i.x,i.y,f,h,d,p,n,r,o,0,0);this.boxEndIndex=t.length};n.prototype._addLineCollisionCircles=function(t,e,i,n,r,o,a,s,l,u){var c=o/2,h=Math.floor(r/c),p=1+.4*Math.log(u)/Math.LN2,f=Math.floor(h*p/2),d=-o/2,m=i,y=n+1,_=d,g=-r/2,v=g-r/4;do{if(--y<0){if(g<_)return;y=0;break}_-=e[y].dist(m),m=e[y]}while(v<_);for(var x=e[y].dist(e[y+1]),b=-f;b<h+f;b++){var w=b*c,T=g+w;if(w<0&&(T+=w),r<w&&(T+=w-r),!(T<_)){for(;_+x<T;){if(_+=x,++y+1>=e.length)return;x=e[y].dist(e[y+1])}var S=T-_,A=e[y],M=e[y+1].sub(A)._unit()._mult(S)._add(A)._round(),E=Math.abs(T-d)<c?0:.8*(T-d);t.emplaceBack(M.x,M.y,-o/2,-o/2,o/2,o/2,a,s,l,o/2,E)}}},e.exports=n},{}],217:[function(t,e,i){"use strict";function F(t,e,i){t[e+4]=i?1:0}var N=t("@mapbox/point-geometry"),B=t("../util/intersection_tests"),n=t("./grid_index"),j=(t("@mapbox/gl-matrix").mat4,t("../symbol/projection")),r=function(t,e,i){void 0===e&&(e=new n(t.width+200,t.height+200,25)),void 0===i&&(i=new n(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100};r.prototype.placeCollisionBox=function(t,e,i,n){var r=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),o=i*r.perspectiveRatio,a=t.x1*o+r.point.x,s=t.y1*o+r.point.y,l=t.x2*o+r.point.x,u=t.y2*o+r.point.y;return!e&&this.grid.hitTest(a,s,l,u)?{box:[],offscreen:!1}:{box:[a,s,l,u],offscreen:this.isOffscreen(a,s,l,u)}},r.prototype.approximateTileDistance=function(t,e,i,n,r){var o=r?1:n/this.pitchfactor,a=t.lastSegmentViewportDistance*i;return t.prevTileDistance+a+(o-1)*a*Math.abs(Math.sin(e))},r.prototype.placeCollisionCircles=function(t,e,i,n,r,o,a,s,l,u,c,h,p){var f=[],d=this.projectAnchor(u,o.anchorX,o.anchorY),m=l/24,y=o.lineOffsetX*l,_=o.lineOffsetY*l,g=new N(o.anchorX,o.anchorY),v=j.project(g,c).point,x=j.placeFirstAndLastGlyph(m,s,y,_,!1,v,g,o,a,c,{},!0),b=!1,w=!0,T=d.perspectiveRatio*n,S=1/(n*i),A=0,M=0;x&&(A=this.approximateTileDistance(x.first.tileDistance,x.first.angle,S,d.cameraDistance,p),M=this.approximateTileDistance(x.last.tileDistance,x.last.angle,S,d.cameraDistance,p));for(var E=0;E<t.length;E+=5){var L=t[E],z=t[E+1],P=t[E+2],C=t[E+3];if(!x||C<-A||M<C)F(t,E,!1);else{var I=this.projectPoint(u,L,z),k=P*T;if(0<f.length){var R=I.x-f[f.length-4],D=I.y-f[f.length-3];if(R*R+D*D<k*k*2&&E+8<t.length){var B=t[E+8];if(-A<B&&B<M){F(t,E,!1);continue}}}var O=E/5;if(f.push(I.x,I.y,k,O),F(t,E,!0),w=w&&this.isOffscreen(I.x-k,I.y-k,I.x+k,I.y+k),!e&&this.grid.hitTestCircle(I.x,I.y,k)){if(!h)return{circles:[],offscreen:!1};b=!0}}}return{circles:b?[]:f,offscreen:w}},r.prototype.queryRenderedSymbols=function(t,e,i,n,r,o){var a={},s=[];if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return s;for(var l=this.transform.calculatePosMatrix(e.toUnwrapped()),u=[],c=1/0,h=1/0,p=-1/0,f=-1/0,d=0;d<t.length;d++)for(var m=t[d],y=0;y<m.length;y++){var _=this.projectPoint(l,m[y].x,m[y].y);c=Math.min(c,_.x),h=Math.min(h,_.y),p=Math.max(p,_.x),f=Math.max(f,_.y),u.push(_)}for(var g=e.key,v=[],x=this.grid.query(c,h,p,f),b=0;b<x.length;b++)x[b].sourceID===r&&x[b].tileID===g&&o[x[b].bucketInstanceId]&&v.push(x[b].boxIndex);for(var w=this.ignoredGrid.query(c,h,p,f),T=0;T<w.length;T++)w[T].sourceID===r&&w[T].tileID===g&&o[w[T].bucketInstanceId]&&v.push(w[T].boxIndex);for(var S=0;S<v.length;S++){var A=n.get(v[S]),M=A.sourceLayerIndex,E=A.featureIndex,L=A.bucketIndex;if(void 0===a[M]&&(a[M]={}),void 0===a[M][E]&&(a[M][E]={}),!a[M][E][L]){var z=this.projectAndGetPerspectiveRatio(l,A.anchorPointX,A.anchorPointY),P=i*z.perspectiveRatio,C=A.x1*P+z.point.x,I=A.y1*P+z.point.y,k=A.x2*P+z.point.x,R=A.y2*P+z.point.y,D=[new N(C,I),new N(k,I),new N(k,R),new N(C,R)];B.polygonIntersectsPolygon(u,D)&&(a[M][E][L]=!0,s.push(v[S]))}}return s},r.prototype.insertCollisionBox=function(t,e,i,n,r,o){var a={tileID:i,sourceID:n,bucketInstanceId:r,boxIndex:o};(e?this.ignoredGrid:this.grid).insert(a,t[0],t[1],t[2],t[3])},r.prototype.insertCollisionCircles=function(t,e,i,n,r,o){for(var a=e?this.ignoredGrid:this.grid,s=0;s<t.length;s+=4){var l={tileID:i,sourceID:n,bucketInstanceId:r,boxIndex:o+t[s+3]};a.insertCircle(l,t[s],t[s+1],t[s+2])}},r.prototype.projectAnchor=function(t,e,i){var n=[e,i,0,1];return j.xyTransformMat4(n,n,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5,cameraDistance:n[3]}},r.prototype.projectPoint=function(t,e,i){var n=[e,i,0,1];return j.xyTransformMat4(n,n,t),new N((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100)},r.prototype.projectAndGetPerspectiveRatio=function(t,e,i){var n=[e,i,0,1];return j.xyTransformMat4(n,n,t),{point:new N((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},r.prototype.isOffscreen=function(t,e,i,n){return i<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary},e.exports=r},{"../symbol/projection":224,"../util/intersection_tests":264,"./grid_index":220,"@mapbox/gl-matrix":2,"@mapbox/point-geometry":4}],218:[function(t,e,i){"use strict";var o=t("../data/extent"),a=512/o/2,d=function(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var n=0,r=e;n<r.length;n+=1){var o=r[n],a=o.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:o.crossTileID,coord:this.getScaledCoordinates(o,t)})}};d.prototype.getScaledCoordinates=function(t,e){var i=e.canonical.z-this.tileID.canonical.z,n=a/Math.pow(2,i),r=t.anchor;return{x:Math.floor((e.canonical.x*o+r.x)*n),y:Math.floor((e.canonical.y*o+r.y)*n)}},d.prototype.findMatches=function(t,e,i){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0,o=t;r<o.length;r+=1){var a=o[r];if(!a.crossTileID){var s=this.indexedSymbolInstances[a.key];if(s)for(var l=this.getScaledCoordinates(a,e),u=0,c=s;u<c.length;u+=1){var h=c[u];if(Math.abs(h.coord.x-l.x)<=n&&Math.abs(h.coord.y-l.y)<=n&&!i[h.crossTileID]){i[h.crossTileID]=!0,a.crossTileID=h.crossTileID;break}}}}};var n=function(){this.maxCrossTileID=0};n.prototype.generate=function(){return++this.maxCrossTileID};var u=function(){this.indexes={},this.usedCrossTileIDs={}};u.prototype.addBucket=function(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0,r=e.symbolInstances;n<r.length;n+=1)r[n].crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var o=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var s=this.indexes[a];if(Number(a)>t.overscaledZ)for(var l in s){var u=s[l];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,o)}else{var c=s[t.scaledTo(Number(a)).key];c&&c.findMatches(e.symbolInstances,t,o)}}for(var h=0,p=e.symbolInstances;h<p.length;h+=1){var f=p[h];f.crossTileID||(f.crossTileID=i.generate(),o[f.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new d(t,e.symbolInstances,e.bucketInstanceId),!0},u.prototype.removeBucketCrossTileIDs=function(t,e){for(var i in e.indexedSymbolInstances)for(var n=0,r=e.indexedSymbolInstances[i];n<r.length;n+=1){var o=r[n];delete this.usedCrossTileIDs[t][o.crossTileID]}},u.prototype.removeStaleBuckets=function(t){var e=!1;for(var i in this.indexes){var n=this.indexes[i];for(var r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e};var r=function(){this.layerIndexes={},this.crossTileIDs=new n,this.maxBucketInstanceId=0};r.prototype.addLayer=function(t,e){var i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new u);for(var n=!1,r={},o=0,a=e;o<a.length;o+=1){var s=a[o],l=s.getBucket(t);l&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(s.tileID,l,this.crossTileIDs)&&(n=!0),r[l.bucketInstanceId]=!0)}return i.removeStaleBuckets(r)&&(n=!0),n},r.prototype.pruneUnusedLayers=function(t){var e={};for(var i in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[i]||delete this.layerIndexes[i]},e.exports=r},{"../data/extent":53}],219:[function(t,e,i){"use strict";var A=t("../style-spec/util/interpolate").number,M=t("../symbol/anchor"),E=t("./check_max_angle");e.exports=function(t,e,i,n,r,o,a,s,l){var u=n?.6*o*a:0,c=Math.max(n?n.right-n.left:0,r?r.right-r.left:0),h=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-c*a<e/4&&(e=c*a+e/4),function t(e,i,n,r,o,a,s,l,u){for(var c=a/2,h=0,p=0;p<e.length-1;p++)h+=e[p].dist(e[p+1]);for(var f=0,d=i-n,m=[],y=0;y<e.length-1;y++){for(var _=e[y],g=e[y+1],v=_.dist(g),x=g.angleTo(_);d+n<f+v;){var b=((d+=n)-f)/v,w=A(_.x,g.x,b),T=A(_.y,g.y,b);if(0<=w&&w<u&&0<=T&&T<u&&0<=d-c&&d+c<=h){var S=new M(w,T,x,y);S._round(),r&&!E(e,S,a,r,o)||m.push(S)}}f+=v}return l||m.length||s||(m=t(e,f/2,n,r,o,a,s,!0,u)),m}(t,h?e/2*s%e:(c/2+2*o)*a*s%e,e,u,i,c*a,h,!1,l)}},{"../style-spec/util/interpolate":158,"../symbol/anchor":213,"./check_max_angle":214}],220:[function(t,e,i){"use strict";var n=function(t,e,i){var n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};n.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},n.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},n.prototype.insertCircle=function(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)},n.prototype._insertBoxCell=function(t,e,i,n,r,o){this.boxCells[r].push(o)},n.prototype._insertCircleCell=function(t,e,i,n,r,o){this.circleCells[r].push(o)},n.prototype._query=function(t,e,i,n,r){if(i<0||t>this.width||n<0||e>this.height)return!r&&[];var o=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n)o=Array.prototype.slice.call(this.boxKeys).concat(this.circleKeys);else{var a={hitTest:r,seenUids:{box:{},circle:{}}};this._forEachCell(t,e,i,n,this._queryCell,o,a)}return r?0<o.length:o},n.prototype._queryCircle=function(t,e,i,n){var r=t-i,o=t+i,a=e-i,s=e+i;if(o<0||r>this.width||s<0||a>this.height)return!n&&[];var l=[],u={hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(r,a,o,s,this._queryCellCircle,l,u),n?0<l.length:l},n.prototype.query=function(t,e,i,n){return this._query(t,e,i,n,!1)},n.prototype.hitTest=function(t,e,i,n){return this._query(t,e,i,n,!0)},n.prototype.hitTestCircle=function(t,e,i){return this._queryCircle(t,e,i,!0)},n.prototype._queryCell=function(t,e,i,n,r,o,a){var s=a.seenUids,l=this.boxCells[r];if(null!==l)for(var u=this.bboxes,c=0,h=l;c<h.length;c+=1){var p=h[c];if(!s.box[p]){s.box[p]=!0;var f=4*p;if(t<=u[f+2]&&e<=u[f+3]&&i>=u[f+0]&&n>=u[f+1]){if(a.hitTest)return o.push(!0),!0;o.push(this.boxKeys[p])}}}var d=this.circleCells[r];if(null!==d)for(var m=this.circles,y=0,_=d;y<_.length;y+=1){var g=_[y];if(!s.circle[g]){s.circle[g]=!0;var v=3*g;if(this._circleAndRectCollide(m[v],m[v+1],m[v+2],t,e,i,n)){if(a.hitTest)return o.push(!0),!0;o.push(this.circleKeys[g])}}}},n.prototype._queryCellCircle=function(t,e,i,n,r,o,a){var s=a.circle,l=a.seenUids,u=this.boxCells[r];if(null!==u)for(var c=this.bboxes,h=0,p=u;h<p.length;h+=1){var f=p[h];if(!l.box[f]){l.box[f]=!0;var d=4*f;if(this._circleAndRectCollide(s.x,s.y,s.radius,c[d+0],c[d+1],c[d+2],c[d+3]))return o.push(!0),!0}}var m=this.circleCells[r];if(null!==m)for(var y=this.circles,_=0,g=m;_<g.length;_+=1){var v=g[_];if(!l.circle[v]){l.circle[v]=!0;var x=3*v;if(this._circlesCollide(y[x],y[x+1],y[x+2],s.x,s.y,s.radius))return o.push(!0),!0}}},n.prototype._forEachCell=function(t,e,i,n,r,o,a){for(var s=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),c=this._convertToYCellCoord(n),h=s;h<=u;h++)for(var p=l;p<=c;p++){var f=this.xCellCount*p+h;if(r.call(this,t,e,i,n,f,o,a))return}},n.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},n.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},n.prototype._circlesCollide=function(t,e,i,n,r,o){var a=n-t,s=r-e,l=i+o;return a*a+s*s<l*l},n.prototype._circleAndRectCollide=function(t,e,i,n,r,o,a){var s=(o-n)/2,l=Math.abs(t-(n+s));if(s+i<l)return!1;var u=(a-r)/2,c=Math.abs(e-(r+u));if(u+i<c)return!1;if(l<=s||c<=u)return!0;var h=l-s,p=c-u;return h*h+p*p<=i*i},e.exports=n},{}],221:[function(t,e,i){"use strict";e.exports=function(e){function t(t){s.push(e[t]),l++}function i(t,e,i){var n=a[t];return delete a[t],a[e]=n,s[n].geometry[0].pop(),s[n].geometry[0]=s[n].geometry[0].concat(i[0]),n}function n(t,e,i){var n=o[e];return delete o[e],o[t]=n,s[n].geometry[0].shift(),s[n].geometry[0]=i[0].concat(s[n].geometry[0]),n}function r(t,e,i){var n=i?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var o={},a={},s=[],l=0,u=0;u<e.length;u++){var c=e[u],h=c.geometry,p=c.text;if(p){var f=r(p,h),d=r(p,h,!0);if(f in a&&d in o&&a[f]!==o[d]){var m=n(f,d,h),y=i(f,d,s[m].geometry);delete o[f],delete a[d],a[r(p,s[y].geometry,!0)]=y,s[m].geometry=null}else f in a?i(f,d,h):d in o?n(f,d,h):(t(u),o[f]=l-1,a[d]=l-1)}else t(u)}return s.filter(function(t){return t.geometry})}},{}],222:[function(t,e,i){"use strict";var n=t("../util/web_worker_transfer").register,r=function(){this.opacity=0,this.targetOpacity=0,this.time=0};r.prototype.clone=function(){var t=new r;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t},n("OpacityState",r),e.exports=r},{"../util/web_worker_transfer":278}],223:[function(t,e,i){"use strict";function T(t,e,i){t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0)}function S(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*a+e*s+i*l+e*u+i*c+e*d+i*m+e}var n=t("./collision_index"),h=t("../data/extent"),E=t("./symbol_size"),p=t("./projection"),L=t("../style/style_layer/symbol_style_layer_properties").layout,f=t("../source/pixels_to_tile_units"),o=function(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i};o.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var A=function(t,e,i,n,r){this.text=new o(t?t.text:null,e,i,r),this.icon=new o(t?t.icon:null,e,n,r)};A.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var z=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i},r=function(t,e){this.transform=t.clone(),this.collisionIndex=new n(this.transform),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=e};r.prototype.placeLayerTile=function(t,e,i,n){var r=e.getBucket(t);if(r){var o=r.layers[0].layout,a=Math.pow(2,this.transform.zoom-e.tileID.overscaledZ),s=e.tileSize/h,l=this.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u=p.getLabelPlaneMatrix(l,"map"===o.get("text-pitch-alignment"),"map"===o.get("text-rotation-alignment"),this.transform,f(e,1,this.transform.zoom)),c=p.getLabelPlaneMatrix(l,"map"===o.get("icon-pitch-alignment"),"map"===o.get("icon-rotation-alignment"),this.transform,f(e,1,this.transform.zoom));this.placeLayerBucket(r,l,u,c,a,s,i,n,e.collisionBoxArray,e.tileID.key,t.source)}},r.prototype.placeLayerBucket=function(t,e,i,n,r,o,a,s,l,u,c){for(var h=t.layers[0].layout,p=E.evaluateSizeForZoom(t.textSizeData,this.transform.zoom,L.properties["text-size"]),f=!t.hasTextData()||h.get("text-optional"),d=!t.hasIconData()||h.get("icon-optional"),m=0,y=t.symbolInstances;m<y.length;m+=1){var _=y[m];if(!s[_.crossTileID]){var g=!1,v=!1,x=!0,b=null,w=null,T=null;_.collisionArrays||(_.collisionArrays=t.deserializeCollisionBoxes(l,_.textBoxStartIndex,_.textBoxEndIndex,_.iconBoxStartIndex,_.iconBoxEndIndex)),_.collisionArrays.textBox&&(g=0<(b=this.collisionIndex.placeCollisionBox(_.collisionArrays.textBox,h.get("text-allow-overlap"),o,e)).box.length,x=x&&b.offscreen);var S=_.collisionArrays.textCircles;if(S){var A=t.text.placedSymbolArray.get(_.placedTextSymbolIndices[0]),M=E.evaluateSizeForFeature(t.textSizeData,p,A);w=this.collisionIndex.placeCollisionCircles(S,h.get("text-allow-overlap"),r,o,_.key,A,t.lineVertexArray,t.glyphOffsetArray,M,e,i,a,"map"===h.get("text-pitch-alignment")),g=h.get("text-allow-overlap")||0<w.circles.length,x=x&&w.offscreen}_.collisionArrays.iconBox&&(v=0<(T=this.collisionIndex.placeCollisionBox(_.collisionArrays.iconBox,h.get("icon-allow-overlap"),o,e)).box.length,x=x&&T.offscreen),f||d?d?f||(v=v&&g):g=v&&g:v=g=v&&g,g&&b&&this.collisionIndex.insertCollisionBox(b.box,h.get("text-ignore-placement"),u,c,t.bucketInstanceId,_.textBoxStartIndex),v&&T&&this.collisionIndex.insertCollisionBox(T.box,h.get("icon-ignore-placement"),u,c,t.bucketInstanceId,_.iconBoxStartIndex),g&&w&&this.collisionIndex.insertCollisionCircles(w.circles,h.get("text-ignore-placement"),u,c,t.bucketInstanceId,_.textBoxStartIndex),this.placements[_.crossTileID]=new z(g,v,x||t.justReloaded),s[_.crossTileID]=!0}}t.justReloaded=!1},r.prototype.commit=function(t,e){this.commitTime=e;var i=!1,n=t&&0!==this.fadeDuration?(this.commitTime-t.commitTime)/this.fadeDuration:1,r=t?t.opacities:{};for(var o in this.placements){var a=this.placements[o],s=r[o];i=s?(this.opacities[o]=new A(s,n,a.text,a.icon),i||a.text!==s.text.placed||a.icon!==s.icon.placed):(this.opacities[o]=new A(null,n,a.text,a.icon,a.skipFade),i||a.text||a.icon)}for(var l in r){var u=r[l];if(!this.opacities[l]){var c=new A(u,n,!1,!1);c.isHidden()||(this.opacities[l]=c,i=i||u.text.placed||u.icon.placed)}}i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)},r.prototype.updateLayerOpacities=function(t,e){for(var i={},n=0,r=e;n<r.length;n+=1){var o=r[n],a=o.getBucket(t);a&&this.updateBucketOpacities(a,i,o.collisionBoxArray)}},r.prototype.updateBucketOpacities=function(t,e,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();for(var n=t.layers[0].layout,r=new A(null,0,n.get("text-allow-overlap"),n.get("icon-allow-overlap"),!0),o=0;o<t.symbolInstances.length;o++){var a=t.symbolInstances[o],s=e[a.crossTileID],l=this.opacities[a.crossTileID];l?s&&(l=r):(l=r,this.opacities[a.crossTileID]=l),e[a.crossTileID]=!0;var u=0<a.numGlyphVertices||0<a.numVerticalGlyphVertices,c=0<a.numIconVertices;if(u){for(var h=S(l.text),p=(a.numGlyphVertices+a.numVerticalGlyphVertices)/4,f=0;f<p;f++)t.text.opacityVertexArray.emplaceBack(h);for(var d=0,m=a.placedTextSymbolIndices;d<m.length;d+=1){var y=m[d];t.text.placedSymbolArray.get(y).hidden=l.text.isHidden()}}if(c){for(var _=S(l.icon),g=0;g<a.numIconVertices/4;g++)t.icon.opacityVertexArray.emplaceBack(_);t.icon.placedSymbolArray.get(o).hidden=l.icon.isHidden()}a.collisionArrays||(a.collisionArrays=t.deserializeCollisionBoxes(i,a.textBoxStartIndex,a.textBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex));var v=a.collisionArrays;if(v){v.textBox&&t.hasCollisionBoxData()&&T(t.collisionBox.collisionVertexArray,l.text.placed,!1),v.iconBox&&t.hasCollisionBoxData()&&T(t.collisionBox.collisionVertexArray,l.icon.placed,!1);var x=v.textCircles;if(x&&t.hasCollisionCircleData())for(var b=0;b<x.length;b+=5){var w=s||0===x[b+4];T(t.collisionCircle.collisionVertexArray,l.text.placed,w)}}}t.sortFeatures(this.transform.angle),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray)},r.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},r.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},r.prototype.stillRecent=function(t){return"undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>t},r.prototype.setStale=function(){this.stale=!0};var a=Math.pow(2,25),s=Math.pow(2,24),l=Math.pow(2,17),u=Math.pow(2,16),c=Math.pow(2,9),d=Math.pow(2,8),m=Math.pow(2,1);e.exports=r},{"../data/extent":53,"../source/pixels_to_tile_units":104,"../style/style_layer/symbol_style_layer_properties":209,"./collision_index":217,"./projection":224,"./symbol_size":228}],224:[function(t,e,i){"use strict";function B(t,e){var i=[t.x,t.y,0,1];r(i,i,e);var n=i[3];return{point:new U(i[0]/n,i[1]/n),signedDistanceFromCamera:n}}function O(t,e,i,n,r,o,a,s,l,u,c,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,m=e.getoffsetX(s.glyphStartIndex),y=e.getoffsetX(p-1),_=j(t*m,i,n,r,o,a,s.segment,f,d,l,u,c,h);if(!_)return null;var g=j(t*y,i,n,r,o,a,s.segment,f,d,l,u,c,h);return g?{first:_,last:g}:null}function F(t,e,i,n){return t===D.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*n?{useVertical:!0}:(t===D.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function P(t,e,i,n,r,o,a,s,l,u,c,h,p,f){var d,m=e/24,y=t.lineOffsetX*e,_=t.lineOffsetY*e;if(1<t.numGlyphs){var g=t.glyphStartIndex+t.numGlyphs,v=t.lineStartIndex,x=t.lineStartIndex+t.lineLength,b=O(m,s,y,_,i,c,h,t,l,o,p,!1);if(!b)return{notEnoughRoom:!0};var w=B(b.first.point,a).point,T=B(b.last.point,a).point;if(n&&!i){var S=F(t.writingMode,w,T,f);if(S)return S}d=[b.first];for(var A=t.glyphStartIndex+1;A<g-1;A++)d.push(j(m*s.getoffsetX(A),y,_,i,c,h,t.segment,v,x,l,o,p,!1));d.push(b.last)}else{if(n&&!i){var M=B(h,r).point,E=t.lineStartIndex+t.segment+1,L=new U(l.getx(E),l.gety(E)),z=B(L,r),P=0<z.signedDistanceFromCamera?z.point:N(h,L,M,1,r),C=F(t.writingMode,M,P,f);if(C)return C}var I=j(m*s.getoffsetX(t.glyphStartIndex),y,_,i,c,h,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,l,o,p,!1);if(!I)return{notEnoughRoom:!0};d=[I]}for(var k=0,R=d;k<R.length;k+=1){var D=R[k];Z(u,D.point,D.angle)}return{}}function N(t,e,i,n,r){var o=B(t.add(t.sub(e)._unit()),r).point,a=i.sub(o);return i.add(a._mult(n/a.mag()))}function j(t,e,i,n,r,o,a,s,l,u,c,h,p){var f=n?t-e:t+e,d=0<f?1:-1,m=0;n&&(d*=-1,m=Math.PI),d<0&&(m+=Math.PI);for(var y=0<d?s+a:s+a+1,_=y,g=r,v=r,x=0,b=0,w=Math.abs(f);x+b<=w;){if((y+=d)<s||l<=y)return null;if(v=g,void 0===(g=h[y])){var T=new U(u.getx(y),u.gety(y)),S=B(T,c);if(0<S.signedDistanceFromCamera)g=h[y]=S.point;else{var A=y-d;g=N(0===x?o:new U(u.getx(A),u.gety(A)),T,v,w-x+1,c)}}x+=b,b=v.dist(g)}var M=(w-x)/b,E=g.sub(v),L=E.mult(M)._add(v);return L._add(E._unit()._perp()._mult(i*d)),{point:L,angle:m+Math.atan2(g.y-v.y,g.x-v.x),tileDistance:p?{prevTileDistance:y-d===_?0:u.gettileUnitDistanceFromAnchor(y-d),lastSegmentViewportDistance:w-x}:null}}function C(t,e){for(var i=0;i<t;i++){var n=e.length;e.resize(n+4),e.float32.set(o,3*n)}}function r(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15],t}var U=t("@mapbox/point-geometry"),n=t("@mapbox/gl-matrix"),a=n.mat4,I=n.vec4,k=t("./symbol_size"),Z=t("../data/bucket/symbol_bucket").addDynamicAttributes,R=t("../style/style_layer/symbol_style_layer_properties").layout,D=t("../symbol/shaping").WritingMode;e.exports={updateLineLabels:function(t,e,i,n,r,o,a,s){var l,u,c,h,p=n?t.textSizeData:t.iconSizeData,f=k.evaluateSizeForZoom(p,i.transform.zoom,R.properties[n?"text-size":"icon-size"]),d=[256/i.width*2+1,256/i.height*2+1],m=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;m.clear();for(var y=t.lineVertexArray,_=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,g=i.transform.width/i.transform.height,v=!1,x=0;x<_.length;x++){var b=_.get(x);if(b.hidden||b.writingMode===D.vertical&&!v)C(b.numGlyphs,m);else{v=!1;var w=[b.anchorX,b.anchorY,0,1];if(I.transformMat4(w,w,e),u=d,c=(l=w)[0]/l[3],h=l[1]/l[3],c>=-u[0]&&c<=u[0]&&h>=-u[1]&&h<=u[1]){var T=.5+w[3]/i.transform.cameraToCenterDistance*.5,S=k.evaluateSizeForFeature(p,f,b),A=a?S*T:S/T,M=new U(b.anchorX,b.anchorY),E=B(M,r).point,L={},z=P(b,A,!1,s,e,r,o,t.glyphOffsetArray,y,m,E,M,L,g);v=z.useVertical,(z.notEnoughRoom||v||z.needsFlipping&&P(b,A,!0,s,e,r,o,t.glyphOffsetArray,y,m,E,M,L,g).notEnoughRoom)&&C(b.numGlyphs,m)}else C(b.numGlyphs,m)}}n?t.text.dynamicLayoutVertexBuffer.updateData(m):t.icon.dynamicLayoutVertexBuffer.updateData(m)},getLabelPlaneMatrix:function(t,e,i,n,r){var o=a.identity(new Float32Array(16));return e?(a.identity(o),a.scale(o,o,[1/r,1/r,1]),i||a.rotateZ(o,o,n.angle)):(a.scale(o,o,[n.width/2,-n.height/2,1]),a.translate(o,o,[1,-1,0]),a.multiply(o,o,t)),o},getGlCoordMatrix:function(t,e,i,n,r){var o=a.identity(new Float32Array(16));return e?(a.multiply(o,o,t),a.scale(o,o,[r,r,1]),i||a.rotateZ(o,o,-n.angle)):(a.scale(o,o,[1,-1,1]),a.translate(o,o,[-1,-1,0]),a.scale(o,o,[2/n.width,2/n.height,1])),o},project:B,placeFirstAndLastGlyph:O,xyTransformMat4:r};var o=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0])},{"../data/bucket/symbol_bucket":51,"../style/style_layer/symbol_style_layer_properties":209,"../symbol/shaping":226,"./symbol_size":228,"@mapbox/gl-matrix":2,"@mapbox/point-geometry":4}],225:[function(t,e,i){"use strict";var O=t("@mapbox/point-geometry"),k=t("../style/parse_glyph_pbf").GLYPH_PBF_BORDER;e.exports={getIconQuads:function(t,e,i,n,r,o,a){var s,l,u,c,h=e.image,p=i.layout,f=e.top-1/h.pixelRatio,d=e.left-1/h.pixelRatio,m=e.bottom+1/h.pixelRatio,y=e.right+1/h.pixelRatio;if("none"!==p.get("icon-text-fit")&&r){var _=y-d,g=m-f,v=p.get("text-size").evaluate(a)/24,x=r.left*v,b=r.right*v,w=r.top*v,T=b-x,S=r.bottom*v-w,A=p.get("icon-text-fit-padding")[0],M=p.get("icon-text-fit-padding")[1],E=p.get("icon-text-fit-padding")[2],L=p.get("icon-text-fit-padding")[3],z="width"===p.get("icon-text-fit")?.5*(S-g):0,P="height"===p.get("icon-text-fit")?.5*(T-_):0,C="width"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?T:_,I="height"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?S:g;s=new O(x+P-L,w+z-A),l=new O(x+P+M+C,w+z-A),u=new O(x+P+M+C,w+z+E+I),c=new O(x+P-L,w+z+E+I)}else s=new O(d,f),l=new O(y,f),u=new O(y,m),c=new O(d,m);var k=i.layout.get("icon-rotate").evaluate(a)*Math.PI/180;if(k){var R=Math.sin(k),D=Math.cos(k),B=[D,-R,R,D];s._matMult(B),l._matMult(B),c._matMult(B),u._matMult(B)}return[{tl:s,tr:l,bl:c,br:u,tex:{x:h.textureRect.x-1,y:h.textureRect.y-1,w:h.textureRect.w+2,h:h.textureRect.h+2},writingMode:void 0,glyphOffset:[0,0]}]},getGlyphQuads:function(t,e,i,n,r,o,a){for(var s=i.layout.get("text-rotate").evaluate(o)*Math.PI/180,l=i.layout.get("text-offset").evaluate(o).map(function(t){return 24*t}),u=e.positionedGlyphs,c=[],h=0;h<u.length;h++){var p=u[h],f=a[p.glyph];if(f){var d=f.rect;if(d){var m=k+1,y=f.metrics.advance/2,_=n?[p.x+y,p.y]:[0,0],g=n?[0,0]:[p.x+y+l[0],p.y+l[1]],v=f.metrics.left-m-y+g[0],x=-f.metrics.top-m+g[1],b=v+d.w,w=x+d.h,T=new O(v,x),S=new O(b,x),A=new O(v,w),M=new O(b,w);if(n&&p.vertical){var E=new O(-y,y),L=-Math.PI/2,z=new O(5,0);T._rotateAround(L,E)._add(z),S._rotateAround(L,E)._add(z),A._rotateAround(L,E)._add(z),M._rotateAround(L,E)._add(z)}if(s){var P=Math.sin(s),C=Math.cos(s),I=[C,-P,P,C];T._matMult(I),S._matMult(I),A._matMult(I),M._matMult(I)}c.push({tl:T,tr:S,bl:A,br:M,tex:d,writingMode:e.writingMode,glyphOffset:_})}}}return c}}},{"../style/parse_glyph_pbf":186,"@mapbox/point-geometry":4}],226:[function(t,e,i){"use strict";function p(t,e,i,n){var r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function f(t,e,i,n,r,o){for(var a=null,s=p(e,i,r,o),l=0,u=n;l<u.length;l+=1){var c=u[l],h=p(e-c.x,i,r,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function d(t,e,i,n){if(!i)return[];if(!t)return[];for(var r=[],o=function(t,e,i,n){for(var r=0,o=0;o<t.length;o++){var a=n[t.charCodeAt(o)];a&&(r+=a.metrics.advance+e)}return r/Math.max(1,Math.ceil(r/i))}(t,e,i,n),a=0,s=0;s<t.length;s++){var l=t.charCodeAt(s),u=n[l];u&&!_[l]&&(a+=u.metrics.advance+e),s<t.length-1&&(g[l]||L.charAllowsIdeographicBreaking(l))&&r.push(f(s+1,a,o,r,(c=l,h=t.charCodeAt(s+1),p=void 0,p=0,10===c&&(p-=1e4),40!==c&&65288!==c||(p+=50),41!==h&&65289!==h||(p+=50),p),!1))}var c,h,p;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(f(t.length,a,o,r,0,!0))}function M(t){var e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function E(t,e,i,n,r){if(r){var o=e[t[n].glyph];if(o)for(var a=o.metrics.advance,s=(t[n].x+a)*r,l=i;l<=n;l++)t[l].x-=s}}var L=t("../util/script_detection"),m=t("../util/verticalize_punctuation"),y=t("../source/rtl_text_plugin"),z={horizontal:1,vertical:2,horizontalOnly:3};e.exports={shapeText:function(t,e,i,n,r,o,a,s,l,u){var c=t.trim();u===z.vertical&&(c=m(c));var h=[],p={positionedGlyphs:h,text:c,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:u},f=y.processBidirectionalText;return function(t,e,i,n,r,o,a,s,l){for(var u=0,c=-17,h=0,p=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,d=0,m=i;d<m.length;d+=1){var y=m[d];if((y=y.trim()).length){for(var _=p.length,g=0;g<y.length;g++){var v=y.charCodeAt(g),x=e[v];x&&(L.charHasUprightVerticalOrientation(v)&&a!==z.horizontal?(p.push({glyph:v,x:u,y:0,vertical:!0}),u+=l+s):(p.push({glyph:v,x:u,y:c,vertical:!1}),u+=x.metrics.advance+s))}if(p.length!==_){var b=u-s;h=Math.max(b,h),E(p,e,_,p.length-1,f)}u=0,c+=n}else c+=n}var w=M(r),T=w.horizontalAlign,S=w.verticalAlign;!function(t,e,i,n,r,o,a){for(var s=(e-i)*r,l=(-n*a+.5)*o,u=0;u<t.length;u++)t[u].x+=s,t[u].y+=l}(p,f,T,S,h,n,i.length);var A=i.length*n;t.top+=-S*A,t.bottom=t.top+A,t.left+=-T*h,t.right=t.left+h}(p,e,f?f(c,d(c,a,i,e)):function(t,e){for(var i=[],n=0,r=0,o=e;r<o.length;r+=1){var a=o[r];i.push(t.substring(n,a)),n=a}return n<t.length&&i.push(t.substring(n,t.length)),i}(c,d(c,a,i,e)),n,r,o,u,a,l),!!h.length&&p},shapeIcon:function(t,e,i){var n=M(i),r=n.horizontalAlign,o=n.verticalAlign,a=e[0],s=e[1],l=a-t.displaySize[0]*r,u=l+t.displaySize[0],c=s-t.displaySize[1]*o;return{image:t,top:c,bottom:c+t.displaySize[1],left:l,right:u}},WritingMode:z};var _={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},g={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0}},{"../source/rtl_text_plugin":109,"../util/script_detection":269,"../util/verticalize_punctuation":277}],227:[function(t,e,i){"use strict";function B(i,n,r,o,a,s){var t=s.layoutTextSize.evaluate(n),e=s.layoutIconSize.evaluate(n),l=s.textMaxSize.evaluate(n);void 0===l&&(l=t);var u=i.layers[0].layout,c=u.get("text-offset").evaluate(n),h=u.get("icon-offset").evaluate(n),p=t/24,f=i.tilePixelRatio*p,d=i.tilePixelRatio*l/24,m=i.tilePixelRatio*e,y=i.tilePixelRatio*u.get("symbol-spacing"),_=u.get("text-padding")*i.tilePixelRatio,g=u.get("icon-padding")*i.tilePixelRatio,v=u.get("text-max-angle")/180*Math.PI,x="map"===u.get("text-rotation-alignment")&&"line"===u.get("symbol-placement"),b="map"===u.get("icon-rotation-alignment")&&"line"===u.get("symbol-placement"),w=y/2,T=function(t,e){e.x<0||e.x>=et||e.y<0||e.y>=et||i.symbolInstances.push(function(t,e,i,n,r,o,a,s,l,u,c,h,p,f,d,m,y,_,g,v,x,b){var w,T,S=t.addToLineVertexArray(e,i),A=0,M=0,E=0,L=n.horizontal?n.horizontal.text:"",z=[];n.horizontal&&(w=new K(a,i,e,s,l,u,n.horizontal,c,h,p,t.overscaling),M+=V(t,e,n.horizontal,o,p,g,v,f,S,n.vertical?Y.horizontal:Y.horizontalOnly,z,x,b),n.vertical&&(E+=V(t,e,n.vertical,o,p,g,v,f,S,Y.vertical,z,x,b)));var P=w?w.boxStartIndex:t.collisionBoxArray.length,C=w?w.boxEndIndex:t.collisionBoxArray.length;if(r){var I=J(e,r,o,y,n.horizontal,g,v);T=new K(a,i,e,s,l,u,r,d,m,!1,t.overscaling),A=4*I.length;var k=t.iconSizeData,R=null;"source"===k.functionType?R=[10*o.layout.get("icon-size").evaluate(v)]:"composite"===k.functionType&&(R=[10*b.compositeIconSizes[0].evaluate(v),10*b.compositeIconSizes[1].evaluate(v)]),t.addSymbols(t.icon,I,R,_,y,v,!1,e,S.lineStartIndex,S.lineLength)}var D=T?T.boxStartIndex:t.collisionBoxArray.length,B=T?T.boxEndIndex:t.collisionBoxArray.length;return t.glyphOffsetArray.length>=it.MAX_GLYPHS&&Q.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),{key:L,textBoxStartIndex:P,textBoxEndIndex:C,iconBoxStartIndex:D,iconBoxEndIndex:B,textOffset:f,iconOffset:_,anchor:e,line:i,featureIndex:s,feature:v,numGlyphVertices:M,numVerticalGlyphVertices:E,numIconVertices:A,textOpacityState:new H,iconOpacityState:new H,isDuplicate:!1,placedTextSymbolIndices:z,crossTileID:0}}(i,e,t,r,o,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,f,_,x,c,m,g,b,h,{zoom:i.zoom},n,a,s))};if("line"===u.get("symbol-placement"))for(var S=0,A=X(n.geometry,0,0,et,et);S<A.length;S+=1)for(var M=A[S],E=0,L=W(M,y,v,r.vertical||r.horizontal,o,24,d,i.overscaling,et);E<L.length;E+=1){var z=L[E],P=r.horizontal;P&&q(i,P.text,w,z)||T(M,z)}else if("Polygon"===n.type)for(var C=0,I=tt(n.geometry,0);C<I.length;C+=1){var k=I[C],R=$(k,16);T(k[0],new G(R.x,R.y,0))}else if("LineString"===n.type)for(var D=0,B=n.geometry;D<B.length;D+=1){var O=B[D];T(O,new G(O[0].x,O[0].y,0))}else if("Point"===n.type)for(var F=0,N=n.geometry;F<N.length;F+=1)for(var j=0,U=N[F];j<U.length;j+=1){var Z=U[j];T([Z],new G(Z.x,Z.y,0))}}function V(t,e,i,n,r,o,a,s,l,u,c,h,p){var f=y(e,i,n,r,o,a,h),d=t.textSizeData,m=null;return"source"===d.functionType?m=[10*n.layout.get("text-size").evaluate(a)]:"composite"===d.functionType&&(m=[10*p.compositeTextSizes[0].evaluate(a),10*p.compositeTextSizes[1].evaluate(a)]),t.addSymbols(t.text,f,m,s,r,a,u,e,l.lineStartIndex,l.lineLength),c.push(t.text.placedSymbolArray.length-1),4*f.length}function q(t,e,i,n){var r=t.compareText;if(e in r){for(var o=r[e],a=o.length-1;0<=a;a--)if(n.dist(o[a])<i)return!0}else r[e]=[];return r[e].push(n),!1}var G=t("./anchor"),W=t("./get_anchors"),X=t("./clip_line"),H=t("./opacity_state"),n=t("./shaping"),O=n.shapeText,F=n.shapeIcon,Y=n.WritingMode,r=t("./quads"),y=r.getGlyphQuads,J=r.getIconQuads,K=t("./collision_feature"),Q=t("../util/util"),N=t("../util/script_detection"),$=t("../util/find_pole_of_inaccessibility"),tt=t("../util/classify_rings"),et=t("../data/extent"),it=t("../data/bucket/symbol_bucket"),j=t("../style/evaluation_parameters");t("@mapbox/point-geometry");e.exports={performSymbolLayout:function(t,e,i,n,r,o){t.createArrays(),t.symbolInstances=[];var a=512*t.overscaling;t.tilePixelRatio=et/a,t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.functionType){var c=t.textSizeData.zoomRange,h=c.min,p=c.max;u.compositeTextSizes=[l["text-size"].possiblyEvaluate(new j(h)),l["text-size"].possiblyEvaluate(new j(p))]}if("composite"===t.iconSizeData.functionType){var f=t.iconSizeData.zoomRange,d=f.min,m=f.max;u.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new j(d)),l["icon-size"].possiblyEvaluate(new j(m))]}u.layoutTextSize=l["text-size"].possiblyEvaluate(new j(t.zoom+1)),u.layoutIconSize=l["icon-size"].possiblyEvaluate(new j(t.zoom+1)),u.textMaxSize=l["text-size"].possiblyEvaluate(new j(18));for(var y=24*s.get("text-line-height"),_="map"===s.get("text-rotation-alignment")&&"line"===s.get("symbol-placement"),g=s.get("text-keep-upright"),v=0,x=t.features;v<x.length;v+=1){var b=x[v],w=s.get("text-font").evaluate(b).join(","),T=e[w]||{},S=i[w]||{},A={},M=b.text;if(M){var E=N.allowsVerticalWritingMode(M),L=s.get("text-offset").evaluate(b).map(function(t){return 24*t}),z=24*s.get("text-letter-spacing").evaluate(b),P=N.allowsLetterSpacing(M)?z:0,C=s.get("text-anchor").evaluate(b),I=s.get("text-justify").evaluate(b),k="line"!==s.get("symbol-placement")?24*s.get("text-max-width").evaluate(b):0;A.horizontal=O(M,T,k,y,C,I,P,L,24,Y.horizontal),E&&_&&g&&(A.vertical=O(M,T,k,y,C,I,P,L,24,Y.vertical))}var R=void 0;if(b.icon){var D=n[b.icon];D&&(R=F(r[b.icon],s.get("icon-offset").evaluate(b),s.get("icon-anchor").evaluate(b)),void 0===t.sdfIcons?t.sdfIcons=D.sdf:t.sdfIcons!==D.sdf&&Q.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),D.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==s.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(A.horizontal||R)&&B(t,b,A,R,S,u)}o&&t.generateCollisionDebugBuffers()}}},{"../data/bucket/symbol_bucket":51,"../data/extent":53,"../style/evaluation_parameters":182,"../util/classify_rings":255,"../util/find_pole_of_inaccessibility":261,"../util/script_detection":269,"../util/util":275,"./anchor":213,"./clip_line":215,"./collision_feature":216,"./get_anchors":219,"./opacity_state":222,"./quads":225,"./shaping":226,"@mapbox/point-geometry":4}],228:[function(t,e,i){"use strict";var h=t("../style-spec/expression").normalizePropertyExpression,r=t("../style-spec/util/interpolate"),p=t("../util/util");e.exports={getSizeData:function(t,e){var i=e.expression;if("constant"===i.kind)return{functionType:"constant",layoutSize:i.evaluate({zoom:t+1})};if("source"===i.kind)return{functionType:"source"};for(var n=i.zoomStops,r=0;r<n.length&&n[r]<=t;)r++;for(var o=r=Math.max(0,r-1);o<n.length&&n[o]<t+1;)o++;o=Math.min(n.length-1,o);var a={min:n[r],max:n[o]};return"composite"===i.kind?{functionType:"composite",zoomRange:a,propertyValue:e.value}:{functionType:"camera",layoutSize:i.evaluate({zoom:t+1}),zoomRange:a,sizeRange:{min:i.evaluate({zoom:a.min}),max:i.evaluate({zoom:a.max})},propertyValue:e.value}},evaluateSizeForFeature:function(t,e,i){var n=e;return"source"===t.functionType?i.lowerSize/10:"composite"===t.functionType?r.number(i.lowerSize/10,i.upperSize/10,n.uSizeT):n.uSize},evaluateSizeForZoom:function(t,e,i){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var n=t.propertyValue,r=t.zoomRange,o=t.sizeRange,a=h(n,i.specification),s=p.clamp(a.interpolationFactor(e,r.min,r.max),0,1);return{uSizeT:0,uSize:o.min+s*(o.max-o.min)}}var l=t.propertyValue,u=t.zoomRange,c=h(l,i.specification);return{uSizeT:p.clamp(c.interpolationFactor(e,u.min,u.max),0,1),uSize:0}}}},{"../style-spec/expression":139,"../style-spec/util/interpolate":158,"../util/util":275}],229:[function(t,e,i){"use strict";var r=t("../source/rtl_text_plugin");e.exports=function(t,e,i){var n=e.layout.get("text-transform").evaluate(i);return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),r.applyArabicShaping&&(t=r.applyArabicShaping(t)),t}},{"../source/rtl_text_plugin":109}],230:[function(t,e,i){"use strict";var h=t("../util/dom"),p=t("@mapbox/point-geometry"),f={scrollZoom:t("./handler/scroll_zoom"),boxZoom:t("./handler/box_zoom"),dragRotate:t("./handler/drag_rotate"),dragPan:t("./handler/drag_pan"),keyboard:t("./handler/keyboard"),doubleClickZoom:t("./handler/dblclick_zoom"),touchZoomRotate:t("./handler/touch_zoom_rotate")};e.exports=function(r,t){function e(){u=null}function i(t,e){var i=h.mousePos(o,e);return r.fire(t,{lngLat:r.unproject(i),point:i,originalEvent:e})}function n(t,e){var i=h.touchPos(o,e),n=i.reduce(function(t,e,i,n){return t.add(e.div(n.length))},new p(0,0));return r.fire(t,{lngLat:r.unproject(n),point:n,lngLats:i.map(function(t){return r.unproject(t)},this),points:i,originalEvent:e})}var o=r.getCanvasContainer(),a=null,s=!1,l=null,u=null;for(var c in f)r[c]=new f[c](r,t),t.interactive&&t[c]&&r[c].enable(t[c]);o.addEventListener("mouseout",function(t){i("mouseout",t)},!1),o.addEventListener("mousedown",function(t){r.doubleClickZoom.isActive()||r.stop(),l=h.mousePos(o,t),i("mousedown",t),s=!0},!1),o.addEventListener("mouseup",function(t){var e=r.dragRotate&&r.dragRotate.isActive();a&&!e&&i("contextmenu",a),a=null,s=!1,i("mouseup",t)},!1),o.addEventListener("mousemove",function(t){if(!(r.dragPan&&r.dragPan.isActive()||r.dragRotate&&r.dragRotate.isActive())){for(var e=t.toElement||t.target;e&&e!==o;)e=e.parentNode;e===o&&i("mousemove",t)}},!1),o.addEventListener("mouseover",function(t){for(var e=t.toElement||t.target;e&&e!==o;)e=e.parentNode;e===o&&i("mouseover",t)},!1),o.addEventListener("touchstart",function(t){r.stop(),n("touchstart",t),!t.touches||1<t.touches.length||(u?(clearTimeout(u),u=null,i("dblclick",t)):u=setTimeout(e,300))},!1),o.addEventListener("touchend",function(t){n("touchend",t)},!1),o.addEventListener("touchmove",function(t){n("touchmove",t)},!1),o.addEventListener("touchcancel",function(t){n("touchcancel",t)},!1),o.addEventListener("click",function(t){h.mousePos(o,t).equals(l)&&i("click",t)},!1),o.addEventListener("dblclick",function(t){i("dblclick",t),t.preventDefault()},!1),o.addEventListener("contextmenu",function(t){var e=r.dragRotate&&r.dragRotate.isActive();s||e?s&&(a=t):i("contextmenu",t),t.preventDefault()},!1)}},{"../util/dom":259,"./handler/box_zoom":239,"./handler/dblclick_zoom":240,"./handler/drag_pan":241,"./handler/drag_rotate":242,"./handler/keyboard":243,"./handler/scroll_zoom":244,"./handler/touch_zoom_rotate":245,"@mapbox/point-geometry":4}],231:[function(t,e,i){"use strict";var I=t("../util/util"),k=t("../style-spec/util/interpolate").number,r=t("../util/browser"),R=t("../geo/lng_lat"),d=t("../geo/lng_lat_bounds"),D=t("@mapbox/point-geometry"),n=function(i){function t(t,e){i.call(this),this.moving=!1,this.transform=t,this._bearingSnap=e.bearingSnap}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getCenter=function(){return this.transform.center},t.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},t.prototype.panBy=function(t,e,i){return t=D.convert(t).mult(-1),this.panTo(this.transform.center,I.extend({offset:t},e),i)},t.prototype.panTo=function(t,e,i){return this.easeTo(I.extend({center:t},e),i)},t.prototype.getZoom=function(){return this.transform.zoom},t.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},t.prototype.zoomTo=function(t,e,i){return this.easeTo(I.extend({zoom:t},e),i)},t.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},t.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},t.prototype.getBearing=function(){return this.transform.bearing},t.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},t.prototype.rotateTo=function(t,e,i){return this.easeTo(I.extend({bearing:t},e),i)},t.prototype.resetNorth=function(t,e){return this.rotateTo(0,I.extend({duration:1e3},t),e),this},t.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},t.prototype.getPitch=function(){return this.transform.pitch},t.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},t.prototype.fitBounds=function(t,e,i){if("number"==typeof(e=I.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){var n=e.padding;e.padding={top:n,bottom:n,right:n,left:n}}if(!I.deepEqual(Object.keys(e.padding).sort(function(t,e){return t<e?-1:e<t?1:0}),["bottom","left","right","top"]))return I.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'"),this;t=d.convert(t);var r=[(e.padding.left-e.padding.right)/2,(e.padding.top-e.padding.bottom)/2],o=Math.min(e.padding.right,e.padding.left),a=Math.min(e.padding.top,e.padding.bottom);e.offset=[e.offset[0]+r[0],e.offset[1]+r[1]];var s=D.convert(e.offset),l=this.transform,u=l.project(t.getNorthWest()),c=l.project(t.getSouthEast()),h=c.sub(u),p=(l.width-2*o-2*Math.abs(s.x))/h.x,f=(l.height-2*a-2*Math.abs(s.y))/h.y;return f<0||p<0?(I.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset."),this):(e.center=l.unproject(u.add(c).div(2)),e.zoom=Math.min(l.scaleZoom(l.scale*Math.min(p,f)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,i):this.flyTo(e,i))},t.prototype.jumpTo=function(t,e){this.stop();var i=this.transform,n=!1,r=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(n=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=R.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),this.fire("movestart",e).fire("move",e),n&&this.fire("zoomstart",e).fire("zoom",e).fire("zoomend",e),r&&this.fire("rotate",e),o&&this.fire("pitchstart",e).fire("pitch",e).fire("pitchend",e),this.fire("moveend",e)},t.prototype.easeTo=function(t,o){var a=this;this.stop(),!1===(t=I.extend({offset:[0,0],duration:500,easing:I.ease},t)).animate&&(t.duration=0);var s=this.transform,l=this.getZoom(),u=this.getBearing(),c=this.getPitch(),h="zoom"in t?+t.zoom:l,p="bearing"in t?this._normalizeBearing(t.bearing,u):u,f="pitch"in t?+t.pitch:c,d=s.centerPoint.add(D.convert(t.offset)),e=s.pointLocation(d),i=R.convert(t.center||e);this._normalizeCenter(i);var m,y,_=s.project(e),g=s.project(i).sub(_),v=s.zoomScale(h-l);return t.around&&(m=R.convert(t.around),y=s.locationPoint(m)),this.zooming=h!==l,this.rotating=u!==p,this.pitching=f!==c,this._prepareEase(o,t.noMoveStart),clearTimeout(this._onEaseEnd),this._ease(function(t){if(a.zooming&&(s.zoom=k(l,h,t)),a.rotating&&(s.bearing=k(u,p,t)),a.pitching&&(s.pitch=k(c,f,t)),m)s.setLocationAtPoint(m,y);else{var e=s.zoomScale(s.zoom-l),i=l<h?Math.min(2,v):Math.max(.5,v),n=Math.pow(i,1-t),r=s.unproject(_.add(g.mult(t*n)).mult(e));s.setLocationAtPoint(s.renderWorldCopies?r.wrap():r,d)}a._fireMoveEvents(o)},function(){t.delayEndEvents?a._onEaseEnd=setTimeout(function(){return a._afterEase(o)},t.delayEndEvents):a._afterEase(o)},t),this},t.prototype._prepareEase=function(t,e){this.moving=!0,e||this.fire("movestart",t),this.zooming&&this.fire("zoomstart",t),this.pitching&&this.fire("pitchstart",t)},t.prototype._fireMoveEvents=function(t){this.fire("move",t),this.zooming&&this.fire("zoom",t),this.rotating&&this.fire("rotate",t),this.pitching&&this.fire("pitch",t)},t.prototype._afterEase=function(t){var e=this.zooming,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,e&&this.fire("zoomend",t),i&&this.fire("pitchend",t),this.fire("moveend",t)},t.prototype.flyTo=function(t,r){function e(t){var e=(b*b-x*x+(t?-1:1)*A*A*w*w)/(2*(t?b:x)*A*w);return Math.log(Math.sqrt(e*e+1)-e)}function i(t){return(Math.exp(t)-Math.exp(-t))/2}function n(t){return(Math.exp(t)+Math.exp(-t))/2}var o=this;this.stop(),t=I.extend({offset:[0,0],speed:1.2,curve:1.42,easing:I.ease},t);var a=this.transform,s=this.getZoom(),l=this.getBearing(),u=this.getPitch(),c="zoom"in t?I.clamp(+t.zoom,a.minZoom,a.maxZoom):s,h="bearing"in t?this._normalizeBearing(t.bearing,l):l,p="pitch"in t?+t.pitch:u,f=a.zoomScale(c-s),d=a.centerPoint.add(D.convert(t.offset)),m=a.pointLocation(d),y=R.convert(t.center||m);this._normalizeCenter(y);var _=a.project(m),g=a.project(y).sub(_),v=t.curve,x=Math.max(a.width,a.height),b=x/f,w=g.mag();if("minZoom"in t){var T=I.clamp(Math.min(t.minZoom,s,c),a.minZoom,a.maxZoom),S=x/a.zoomScale(T-s);v=Math.sqrt(S/w*2)}var A=v*v,M=e(0),E=function(t){return n(M)/n(M+v*t)},L=function(t){return x*((n(M)*(i(e=M+v*t)/n(e))-i(M))/A)/w;var e},z=(e(1)-M)/v;if(Math.abs(w)<1e-6||!isFinite(z)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,r);var P=b<x?-1:1;z=Math.abs(Math.log(b/x))/v,L=function(){return 0},E=function(t){return Math.exp(P*v*t)}}if("duration"in t)t.duration=+t.duration;else{var C="screenSpeed"in t?+t.screenSpeed/v:+t.speed;t.duration=1e3*z/C}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=l!==h,this.pitching=p!==u,this._prepareEase(r,!1),this._ease(function(t){var e=t*z,i=1/E(e);a.zoom=s+a.scaleZoom(i),o.rotating&&(a.bearing=k(l,h,t)),o.pitching&&(a.pitch=k(u,p,t));var n=a.unproject(_.add(g.mult(L(e))).mult(i));a.setLocationAtPoint(a.renderWorldCopies?n.wrap():n,d),o._fireMoveEvents(r)},function(){return o._afterEase(r)},t),this},t.prototype.isEasing=function(){return!!this._isEasing},t.prototype.isMoving=function(){return this.moving},t.prototype.stop=function(){return this._onFrame&&this._finishAnimation(),this},t.prototype._ease=function(i,t,e){var n=this;!1===e.animate||0===e.duration?(i(1),t()):(this._easeStart=r.now(),this._isEasing=!0,this._easeOptions=e,this._startAnimation(function(t){var e=Math.min((r.now()-n._easeStart)/n._easeOptions.duration,1);i(n._easeOptions.easing(e)),1===e&&n.stop()},function(){n._isEasing=!1,t()}))},t.prototype._updateCamera=function(){this._onFrame&&this._onFrame(this.transform)},t.prototype._startAnimation=function(t,e){return void 0===e&&(e=function(){}),this.stop(),this._onFrame=t,this._finishFn=e,this._update(),this},t.prototype._finishAnimation=function(){delete this._onFrame;var t=this._finishFn;delete this._finishFn,t.call(this)},t.prototype._normalizeBearing=function(t,e){t=I.wrap(t,-180,180);var i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t},t.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=180<i?-360:i<-180?360:0}},t}(t("../util/evented"));e.exports=n},{"../geo/lng_lat":62,"../geo/lng_lat_bounds":63,"../style-spec/util/interpolate":158,"../util/browser":252,"../util/evented":260,"../util/util":275,"@mapbox/point-geometry":4}],232:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/config"),a=function(t){this.options=t,r.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};a.prototype.getDefaultPosition=function(){return"bottom-right"},a.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},a.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},a.prototype._updateEditLink=function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:o.ACCESS_TOKEN}];if(t){var e=n.reduce(function(t,e,i){return e.value&&(t+=e.key+"="+e.value+(i<n.length-1?"&":"")),t},"?");t.href="https://www.mapbox.com/feedback/"+e+(this._map._hash?this._map._hash.getHashString(!0):"")}},a.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink())},a.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var e=this._map.style.sourceCaches;for(var i in e){var r=e[i].getSource();r.attribution&&n.indexOf(r.attribution)<0&&n.push(r.attribution)}n.sort(function(t,e){return t.length-e.length}),(n=n.filter(function(t,e){for(var i=e+1;i<n.length;i++)if(0<=n[i].indexOf(t))return!1;return!0})).length?(this._container.innerHTML=n.join(" | "),this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null}},a.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")},e.exports=a},{"../../util/config":256,"../../util/dom":259,"../../util/util":275}],233:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=function(){this._fullscreen=!1,r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};a.prototype.onAdd=function(t){return this._map=t,this._mapContainer=this._map.getContainer(),this._container=n.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",r.warnOnce("This device does not support fullscreen mode.")),this._container},a.prototype.onRemove=function(){n.remove(this._container),this._map=null,o.document.removeEventListener(this._fullscreenchange,this._changeIcon)},a.prototype._checkFullscreenSupport=function(){return!!(o.document.fullscreenEnabled||o.document.mozFullScreenEnabled||o.document.msFullscreenEnabled||o.document.webkitFullscreenEnabled)},a.prototype._setupUI=function(){var t=this._fullscreenButton=n.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.document.addEventListener(this._fullscreenchange,this._changeIcon)},a.prototype._isFullscreen=function(){return this._fullscreen},a.prototype._changeIcon=function(){(o.document.fullscreenElement||o.document.mozFullScreenElement||o.document.webkitFullscreenElement||o.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"))},a.prototype._onClickFullscreen=function(){this._isFullscreen()?o.document.exitFullscreen?o.document.exitFullscreen():o.document.mozCancelFullScreen?o.document.mozCancelFullScreen():o.document.msExitFullscreen?o.document.msExitFullscreen():o.document.webkitCancelFullScreen&&o.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()},e.exports=a},{"../../util/dom":259,"../../util/util":275,"../../util/window":254}],234:[function(t,e,i){"use strict";var n,r=t("../../util/evented"),o=t("../../util/dom"),a=t("../../util/window"),s=t("../../util/util"),l=t("../../geo/lng_lat"),u=t("../marker"),c={positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},h="mapboxgl-ctrl",p=function(e){function t(t){e.call(this),this.options=s.extend({},c,t),s.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker","_onClickGeolocate"],this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.onAdd=function(t){return this._map=t,this._container=o.create("div",h+" "+h+"-group"),e=this._setupUI,void 0!==n?e(n):void 0!==a.navigator.permissions?a.navigator.permissions.query({name:"geolocation"}).then(function(t){n="denied"!==t.state,e(n)}):(n=!!a.navigator.geolocation,e(n)),this._container;var e},t.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(a.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),o.remove(this._container),this._map=void 0},t.prototype._onSuccess=function(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire("geolocate",t),this._finish()},t.prototype._updateCamera=function(t){var e=new l(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy;this._map.fitBounds(e.toBounds(i),this.options.fitBoundsOptions,{geolocateSource:!0})},t.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},t.prototype._onError=function(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire("error",t),this._finish()},t.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},t.prototype._setupUI=function(t){var e=this;!1!==t&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=o.create("button",h+"-icon "+h+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new u(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)),this.options.trackUserLocation&&this._map.on("movestart",function(t){t.geolocateSource||"ACTIVE_LOCK"!==e._watchState||(e._watchState="BACKGROUND",e._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),e._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),e.fire("trackuserlocationend"))}))},t.prototype._onClickGeolocate=function(){if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire("trackuserlocationstart");break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire("trackuserlocationend");break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire("trackuserlocationstart")}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=a.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else a.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4)},t.prototype._clearWatch=function(){a.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},t}(r);e.exports=p},{"../../geo/lng_lat":62,"../../util/dom":259,"../../util/evented":260,"../../util/util":275,"../../util/window":254,"../marker":248}],235:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=function(){r.bindAll(["_updateLogo"],this)};o.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},o.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo)},o.prototype.getDefaultPosition=function(){return"bottom-left"},o.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},o.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},e.exports=o},{"../../util/dom":259,"../../util/util":275}],236:[function(t,e,i){"use strict";var r=t("../../util/dom"),n=t("../../util/util"),o=t("../handler/drag_rotate"),a={showCompass:!0,showZoom:!0},s=function(t){var e=this;this.options=n.extend({},a,t),this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom In",function(){return e._map.zoomIn()}),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom Out",function(){return e._map.zoomOut()})),this.options.showCompass&&(n.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset North",function(){return e._map.resetNorth()}),this._compassArrow=r.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};s.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},s.prototype.onAdd=function(t){return this._map=t,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new o(t,{button:"left",element:this._compass}),this._handler.enable()),this._container},s.prototype.onRemove=function(){r.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._handler.disable(),delete this._handler),delete this._map},s.prototype._createButton=function(t,e,i){var n=r.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",e),n.addEventListener("click",i),n},e.exports=s},{"../../util/dom":259,"../../util/util":275,"../handler/drag_rotate":242}],237:[function(t,e,i){"use strict";function n(t,e,i){var n,r,o,a,s,l,u=i&&i.maxWidth||100,c=t._container.clientHeight/2,h=(n=t.unproject([0,c]),r=t.unproject([u,c]),o=Math.PI/180,a=n.lat*o,s=r.lat*o,l=Math.sin(a)*Math.sin(s)+Math.cos(a)*Math.cos(s)*Math.cos((r.lng-n.lng)*o),6371e3*Math.acos(Math.min(l,1)));if(i&&"imperial"===i.unit){var p=3.2808*h;5280<p?f(e,u,p/5280,"mi"):f(e,u,p,"ft")}else if(i&&"nautical"===i.unit){f(e,u,h/1852,"nm")}else f(e,u,h,"m")}function f(t,e,i,n){var r,o,a,s=(r=i,(o=Math.pow(10,(""+Math.floor(r)).length-1))*(a=10<=(a=r/o)?10:5<=a?5:3<=a?3:2<=a?2:1)),l=s/i;"m"===n&&1e3<=s&&(s/=1e3,n="km"),t.style.width=e*l+"px",t.innerHTML=s+n}var r=t("../../util/dom"),o=t("../../util/util"),a=function(t){this.options=t,o.bindAll(["_onMove"],this)};a.prototype.getDefaultPosition=function(){return"bottom-left"},a.prototype._onMove=function(){n(this._map,this._container,this.options)},a.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},a.prototype.onRemove=function(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},e.exports=a},{"../../util/dom":259,"../../util/util":275}],238:[function(t,e,i){},{}],239:[function(t,e,i){"use strict";var s=t("../../util/dom"),r=t("../../geo/lng_lat_bounds"),n=t("../../util/util"),o=t("../../util/window"),a=function(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),n.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};a.prototype.isEnabled=function(){return!!this._enabled},a.prototype.isActive=function(){return!!this._active},a.prototype.enable=function(){this.isEnabled()||(this._map.dragPan&&this._map.dragPan.disable(),this._el.addEventListener("mousedown",this._onMouseDown,!1),this._map.dragPan&&this._map.dragPan.enable(),this._enabled=!0)},a.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},a.prototype._onMouseDown=function(t){t.shiftKey&&0===t.button&&(o.document.addEventListener("mousemove",this._onMouseMove,!1),o.document.addEventListener("keydown",this._onKeyDown,!1),o.document.addEventListener("mouseup",this._onMouseUp,!1),s.disableDrag(),this._startPos=s.mousePos(this._el,t),this._active=!0)},a.prototype._onMouseMove=function(t){var e=this._startPos,i=s.mousePos(this._el,t);this._box||(this._box=s.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var n=Math.min(e.x,i.x),r=Math.max(e.x,i.x),o=Math.min(e.y,i.y),a=Math.max(e.y,i.y);s.setTransform(this._box,"translate("+n+"px,"+o+"px)"),this._box.style.width=r-n+"px",this._box.style.height=a-o+"px"},a.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,i=s.mousePos(this._el,t),n=(new r).extend(this._map.unproject(e)).extend(this._map.unproject(i));this._finish(),e.x===i.x&&e.y===i.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(n,{linear:!0}).fire("boxzoomend",{originalEvent:t,boxZoomBounds:n})}},a.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},a.prototype._finish=function(){this._active=!1,o.document.removeEventListener("mousemove",this._onMouseMove,!1),o.document.removeEventListener("keydown",this._onKeyDown,!1),o.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag()},a.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},e.exports=a},{"../../geo/lng_lat_bounds":63,"../../util/dom":259,"../../util/util":275,"../../util/window":254}],240:[function(t,e,i){"use strict";var n=t("../../util/util"),r=function(t){this._map=t,n.bindAll(["_onDblClick","_onZoomEnd"],this)};r.prototype.isEnabled=function(){return!!this._enabled},r.prototype.isActive=function(){return!!this._active},r.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},r.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},r.prototype._onDblClick=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},r.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)},e.exports=r},{"../../util/util":275}],241:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),a=t("../../util/browser"),p=r.bezier(0,0,.3,1),s=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp","_onDragFrame","_onDragFinished"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},s.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(o.document.addEventListener("touchmove",this._onMove),o.document.addEventListener("touchend",this._onTouchEnd)):(o.document.addEventListener("mousemove",this._onMove),o.document.addEventListener("mouseup",this._onMouseUp)),o.addEventListener("blur",this._onMouseUp),this._active=!1,this._previousPos=n.mousePos(this._el,t),this._inertia=[[a.now(),this._previousPos]])},s.prototype._onMove=function(t){if(!this._ignoreEvent(t)){(this._lastMoveEvent=t).preventDefault();var e=n.mousePos(this._el,t);if(this._drainInertiaBuffer(),this._inertia.push([a.now(),e]),!this._previousPos)return void(this._previousPos=e);this._pos=e,this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t),this._map._startAnimation(this._onDragFrame,this._onDragFinished)),this._map._update()}},s.prototype._onDragFrame=function(t){var e=this._lastMoveEvent;e&&(t.setLocationAtPoint(t.pointLocation(this._previousPos),this._pos),this._fireEvent("drag",e),this._fireEvent("move",e),this._previousPos=this._pos,delete this._lastMoveEvent)},s.prototype._onDragFinished=function(t){var e=this;if(this.isActive()){this._active=!1,delete this._lastMoveEvent,delete this._previousPos,delete this._pos,this._fireEvent("dragend",t),this._drainInertiaBuffer();var i=function(){e._map.moving=!1,e._fireEvent("moveend",t)},n=this._inertia;if(n.length<2)return void i();var r=n[n.length-1],o=n[0],a=r[1].sub(o[1]),s=(r[0]-o[0])/1e3;if(0===s||r[1].equals(o[1]))return void i();var l=a.mult(.3/s),u=l.mag();1400<u&&(u=1400,l._unit()._mult(u));var c=u/750,h=l.mult(-c/2);this._map.panBy(h,{duration:1e3*c,easing:p,noMoveStart:!0},{originalEvent:t})}},s.prototype._onUp=function(t){this._onDragFinished(t)},s.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("mousemove",this._onMove),o.document.removeEventListener("mouseup",this._onMouseUp),o.removeEventListener("blur",this._onMouseUp))},s.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("touchmove",this._onMove),o.document.removeEventListener("touchend",this._onTouchEnd))},s.prototype._fireEvent=function(t,e){return this._map.fire(t,e?{originalEvent:e}:{})},s.prototype._ignoreEvent=function(t){var e=this._map;return!(!e.boxZoom||!e.boxZoom.isActive())||!(!e.dragRotate||!e.dragRotate.isActive())||(t.touches?1<t.touches.length:!!t.ctrlKey||"mousemove"!==t.type&&t.button&&0!==t.button)},s.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=a.now();0<t.length&&160<e-t[0][0];)t.shift()},e.exports=s},{"../../util/browser":252,"../../util/dom":259,"../../util/util":275,"../../util/window":254}],242:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),o=t("../../util/window"),c=t("../../util/browser"),m=r.bezier(0,0,.25,1),a=function(t,e){this._map=t,this._el=e.element||t.getCanvasContainer(),this._button=e.button||"right",this._bearingSnap=e.bearingSnap||0,this._pitchWithRotate=!1!==e.pitchWithRotate,r.bindAll(["_onDown","_onMove","_onUp","_onDragFrame","_onDragFinished"],this)};a.prototype.isEnabled=function(){return!!this._enabled},a.prototype.isActive=function(){return!!this._active},a.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},a.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},a.prototype._onDown=function(t){if(!(this._map.boxZoom&&this._map.boxZoom.isActive()||this._map.dragPan&&this._map.dragPan.isActive()||this.isActive())){if("right"===this._button){var e=t.ctrlKey?0:2,i=t.button;if(void 0!==o.InstallTrigger&&2===t.button&&t.ctrlKey&&0<=o.navigator.platform.toUpperCase().indexOf("MAC")&&(i=0),i!==e)return}else if(t.ctrlKey||0!==t.button)return;n.disableDrag(),o.document.addEventListener("mousemove",this._onMove,{capture:!0}),o.document.addEventListener("mouseup",this._onUp),o.addEventListener("blur",this._onUp),this._active=!1,this._inertia=[[c.now(),this._map.getBearing()]],this._previousPos=n.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault()}},a.prototype._onMove=function(t){this._lastMoveEvent=t;var e=n.mousePos(this._el,t);this._previousPos?(this._pos=e,this.isActive()||(this._active=!0,this._map.moving=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t),this._map._startAnimation(this._onDragFrame,this._onDragFinished)),this._map._update()):this._previousPos=e},a.prototype._onUp=function(t){o.document.removeEventListener("mousemove",this._onMove,{capture:!0}),o.document.removeEventListener("mouseup",this._onUp),o.removeEventListener("blur",this._onUp),n.enableDrag(),this._onDragFinished(t)},a.prototype._onDragFrame=function(t){var e=this._lastMoveEvent;if(e){var i=this._previousPos,n=this._pos,r=.8*(i.x-n.x),o=-.5*(i.y-n.y),a=t.bearing-r,s=t.pitch-o,l=this._inertia,u=l[l.length-1];this._drainInertiaBuffer(),l.push([c.now(),this._map._normalizeBearing(a,u[1])]),t.bearing=a,this._pitchWithRotate&&(this._fireEvent("pitch",e),t.pitch=s),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._previousPos=this._pos}},a.prototype._onDragFinished=function(t){var e=this;if(this.isActive()){this._active=!1,delete this._lastMoveEvent,delete this._previousPos,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),r=this._inertia,o=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):(e._map.moving=!1,e._fireEvent("moveend",t)),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(r.length<2)return void o();var a=r[0],s=r[r.length-1],l=r[r.length-2],u=i._normalizeBearing(n,l[1]),c=s[1]-a[1],h=c<0?-1:1,p=(s[0]-a[0])/1e3;if(0===c||0===p)return void o();var f=Math.abs(c*(.25/p));180<f&&(f=180);var d=f/180;u+=h*f*(d/2),Math.abs(i._normalizeBearing(u,0))<this._bearingSnap&&(u=i._normalizeBearing(0,u)),i.rotateTo(u,{duration:1e3*d,easing:m,noMoveStart:!0},{originalEvent:t})}},a.prototype._fireEvent=function(t,e){return this._map.fire(t,e?{originalEvent:e}:{})},a.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=c.now();0<t.length&&160<e-t[0][0];)t.shift()},e.exports=a},{"../../util/browser":252,"../../util/dom":259,"../../util/util":275,"../../util/window":254}],243:[function(t,e,i){"use strict";function u(t){return t*(2-t)}var n=t("../../util/util"),r=function(t){this._map=t,this._el=t.getCanvasContainer(),n.bindAll(["_onKeyDown"],this)};r.prototype.isEnabled=function(){return!!this._enabled},r.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},r.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},r.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,i=0,n=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),l={duration:300,delayEndEvents:500,easing:u,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*i,pitch:a.getPitch()+10*n,offset:[100*-r,100*-o],center:a.getCenter()};a.easeTo(l,{originalEvent:t})}},e.exports=r},{"../../util/util":275}],244:[function(t,e,i){"use strict";var n=t("../../util/dom"),s=t("../../util/util"),l=t("../../util/browser"),r=t("../../util/window"),a=t("../../style-spec/util/interpolate").number,o=t("../../geo/lng_lat"),u=4.000244140625,c=r.navigator.userAgent.toLowerCase(),h=-1!==c.indexOf("firefox"),p=-1!==c.indexOf("safari")&&-1===c.indexOf("chrom"),f=function(t){this._map=t,this._el=t.getCanvasContainer(),this._delta=0,s.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};f.prototype.isEnabled=function(){return!!this._enabled},f.prototype.isActive=function(){return!!this._active},f.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},f.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},f.prototype._onWheel=function(t){var e=0;"wheel"===t.type?(e=t.deltaY,h&&t.deltaMode===r.WheelEvent.DOM_DELTA_PIXEL&&(e/=l.devicePixelRatio),t.deltaMode===r.WheelEvent.DOM_DELTA_LINE&&(e*=40)):"mousewheel"===t.type&&(e=-t.wheelDeltaY,p&&(e/=3));var i=l.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==e&&e%u==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":400<n?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this.isActive()||this._start(t)),t.preventDefault()},f.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},f.prototype._start=function(t){if(this._delta){this._active=!0,this._map.moving=!0,this._map.zooming=!0,this._map.fire("movestart",{originalEvent:t}),this._map.fire("zoomstart",{originalEvent:t}),clearTimeout(this._finishTimeout);var e=n.mousePos(this._el,t);this._around=o.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(e)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._map._startAnimation(this._onScrollFrame,this._onScrollFinished)}},f.prototype._onScrollFrame=function(t){if(this.isActive()){if(0!==this._delta){var e="wheel"===this._type&&Math.abs(this._delta)>u?1/450:.01,i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);var n="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(n*i))),"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}if("wheel"===this._type){var r=Math.min((l.now()-this._lastWheelEventTime)/200,1),o=this._easing(r);t.zoom=a(this._startZoom,this._targetZoom,o),1===r&&this._map.stop()}else t.zoom=this._targetZoom,this._map.stop();t.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire("move",{originalEvent:this._lastWheelEvent}),this._map.fire("zoom",{originalEvent:this._lastWheelEvent})}},f.prototype._onScrollFinished=function(){var t=this;this.isActive()&&(this._active=!1,this._finishTimeout=setTimeout(function(){t._map.moving=!1,t._map.zooming=!1,t._map.fire("zoomend"),t._map.fire("moveend"),delete t._targetZoom},200))},f.prototype._smoothOutEasing=function(t){var e=s.ease;if(this._prevEase){var i=this._prevEase,n=(l.now()-i.start)/i.duration,r=i.easing(n+.01)-i.easing(n),o=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-o*o);e=s.bezier(o,a,.25,1)}return this._prevEase={start:l.now(),duration:t,easing:e},e},e.exports=f},{"../../geo/lng_lat":62,"../../style-spec/util/interpolate":158,"../../util/browser":252,"../../util/dom":259,"../../util/util":275,"../../util/window":254}],245:[function(t,e,i){"use strict";var c=t("../../util/dom"),n=t("../../util/util"),f=t("../../util/window"),h=t("../../util/browser"),d=n.bezier(0,0,.15,1),r=function(t){this._map=t,this._el=t.getCanvasContainer(),n.bindAll(["_onStart","_onMove","_onEnd"],this)};r.prototype.isEnabled=function(){return!!this._enabled},r.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},r.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},r.prototype.disableRotation=function(){this._rotationDisabled=!0},r.prototype.enableRotation=function(){this._rotationDisabled=!1},r.prototype._onStart=function(t){if(2===t.touches.length){var e=c.mousePos(this._el,t.touches[0]),i=c.mousePos(this._el,t.touches[1]);this._startVec=e.sub(i),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],f.document.addEventListener("touchmove",this._onMove,!1),f.document.addEventListener("touchend",this._onEnd,!1)}},r.prototype._onMove=function(t){if(2===t.touches.length){var e=c.mousePos(this._el,t.touches[0]),i=c.mousePos(this._el,t.touches[1]),n=e.add(i).div(2),r=e.sub(i),o=r.mag()/this._startVec.mag(),a=this._rotationDisabled?0:180*r.angleWith(this._startVec)/Math.PI,s=this._map;if(this._gestureIntent){var l={duration:0,around:s.unproject(n)};"rotate"===this._gestureIntent&&(l.bearing=this._startBearing+a),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(l.zoom=s.transform.scaleZoom(this._startScale*o)),s.stop(),this._drainInertiaBuffer(),this._inertia.push([h.now(),o,n]),s.easeTo(l,{originalEvent:t})}else{var u=.15<Math.abs(1-o);10<Math.abs(a)?this._gestureIntent="rotate":u&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=r,this._startScale=s.transform.scale,this._startBearing=s.transform.bearing)}t.preventDefault()}},r.prototype._onEnd=function(t){f.document.removeEventListener("touchmove",this._onMove),f.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,i=this._map;if(e.length<2)i.snapToNorth({},{originalEvent:t});else{var n=e[e.length-1],r=e[0],o=i.transform.scaleZoom(this._startScale*n[1]),a=i.transform.scaleZoom(this._startScale*r[1]),s=o-a,l=(n[0]-r[0])/1e3,u=n[2];if(0!==l&&o!==a){var c=.15*s/l;2.5<Math.abs(c)&&(c=0<c?2.5:-2.5);var h=1e3*Math.abs(c/(12*.15)),p=o+c*h/2e3;p<0&&(p=0),i.easeTo({zoom:p,duration:h,easing:d,around:this._aroundCenter?i.getCenter():i.unproject(u)},{originalEvent:t})}else i.snapToNorth({},{originalEvent:t})}},r.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=h.now();2<t.length&&160<e-t[0][0];)t.shift()},e.exports=r},{"../../util/browser":252,"../../util/dom":259,"../../util/util":275,"../../util/window":254}],246:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/window"),o=t("../util/throttle"),a=function(){n.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=o(this._updateHashUnthrottled.bind(this),300)};a.prototype.addTo=function(t){return this._map=t,r.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},a.prototype.remove=function(){return r.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},a.prototype.getHashString=function(t){var e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,n),o=Math.round(e.lng*r)/r,a=Math.round(e.lat*r)/r,s=this._map.getBearing(),l=this._map.getPitch(),u="";return u+=t?"#/"+o+"/"+a+"/"+i:"#"+i+"/"+a+"/"+o,(s||l)&&(u+="/"+Math.round(10*s)/10),l&&(u+="/"+Math.round(l)),u},a.prototype._onHashChange=function(){var t=r.location.hash.replace("#","").split("/");return 3<=t.length&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},a.prototype._updateHashUnthrottled=function(){var t=this.getHashString();r.history.replaceState("","",t)},e.exports=a},{"../util/throttle":272,"../util/util":275,"../util/window":254}],247:[function(t,e,i){"use strict";function n(t){t.parentNode&&t.parentNode.removeChild(t)}var l=t("../util/util"),p=t("../util/browser"),r=t("../util/window"),o=t("../util/window"),f=o.HTMLImageElement,a=o.HTMLElement,u=t("../util/dom"),c=t("../util/ajax"),h=t("../style/style"),d=t("../style/evaluation_parameters"),m=t("../render/painter"),y=t("../geo/transform"),_=t("./hash"),g=t("./bind_handlers"),s=t("./camera"),v=t("../geo/lng_lat"),x=t("../geo/lng_lat_bounds"),b=t("@mapbox/point-geometry"),w=t("./control/attribution_control"),T=t("./control/logo_control"),S=t("@mapbox/mapbox-gl-supported"),A=t("../util/image").RGBAImage;t("./events");var M={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300},E=function(s){function t(t){if(null!=(t=l.extend({},M,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than minZoom");var e=new y(t.minZoom,t.maxZoom,t.renderWorldCopies);s.call(this,e,t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming;var i=t.transformRequest;if(this._transformRequest=i?function(t,e){return i(t,e)||{url:t}}:function(t){return{url:t}},"string"==typeof t.container){var n=r.document.getElementById(t.container);if(!n)throw new Error("Container '"+t.container+"' not found.");this._container=n}else{if(!(t.container instanceof a))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}t.maxBounds&&this.setMaxBounds(t.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),void 0!==r&&(r.addEventListener("online",this._onWindowOnline,!1),r.addEventListener("resize",this._onWindowResize,!1)),g(this,t),this._hash=t.hash&&(new _).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),this.resize(),t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new w),this.addControl(new T,t.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}s&&(t.__proto__=s);var e={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var i=t.onAdd(this),n=this._controlPositions[e];return-1!==e.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},t.prototype.removeControl=function(t){return t.onRemove(this),this},t.prototype.resize=function(){var t=this._containerDimensions(),e=t[0],i=t[1];return this._resizeCanvas(e,i),this.transform.resize(e,i),this.painter.resize(e,i),this.fire("movestart").fire("move").fire("resize").fire("moveend")},t.prototype.getBounds=function(){var t=new x(this.transform.pointLocation(new b(0,this.transform.height)),this.transform.pointLocation(new b(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new b(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new b(0,this.transform.size.y)))),t},t.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new x([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},t.prototype.setMaxBounds=function(t){if(t){var e=x.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null!=t||(this.transform.lngRange=null,this.transform.latRange=null,this._update());return this},t.prototype.setMinZoom=function(t){if(0<=(t=null==t?0:t)&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},t.prototype.getMinZoom=function(){return this.transform.minZoom},t.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},t.prototype.getMaxZoom=function(){return this.transform.maxZoom},t.prototype.project=function(t){return this.transform.locationPoint(v.convert(t))},t.prototype.unproject=function(t){return this.transform.pointLocation(b.convert(t))},t.prototype.on=function(n,r,o){var a=this;if(void 0===o)return s.prototype.on.call(this,n,r);var t=function(){if("mouseenter"===n||"mouseover"===n){var i=!1;return{layer:r,listener:o,delegates:{mousemove:function(t){var e=a.getLayer(r)?a.queryRenderedFeatures(t.point,{layers:[r]}):[];e.length?i||(i=!0,o.call(a,l.extend({features:e},t,{type:n}))):i=!1},mouseout:function(){i=!1}}}}if("mouseleave"===n||"mouseout"===n){var e=!1;return{layer:r,listener:o,delegates:{mousemove:function(t){(a.getLayer(r)?a.queryRenderedFeatures(t.point,{layers:[r]}):[]).length?e=!0:e&&(e=!1,o.call(a,l.extend({},t,{type:n})))},mouseout:function(t){e&&(e=!1,o.call(a,l.extend({},t,{type:n})))}}}}var t;return{layer:r,listener:o,delegates:(t={},t[n]=function(t){var e=a.getLayer(r)?a.queryRenderedFeatures(t.point,{layers:[r]}):[];e.length&&o.call(a,l.extend({features:e},t))},t)}}();for(var e in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[n]=this._delegatedListeners[n]||[],this._delegatedListeners[n].push(t),t.delegates)a.on(e,t.delegates[e]);return this},t.prototype.off=function(t,e,i){if(void 0===i)return s.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var n=this._delegatedListeners[t],r=0;r<n.length;r++){var o=n[r];if(o.layer===e&&o.listener===i){for(var a in o.delegates)this.off(a,o.delegates[a]);return n.splice(r,1),this}}return this},t.prototype.queryRenderedFeatures=function(t,e){return e=2===arguments.length?(t=arguments[0],arguments[1]):1===arguments.length&&((i=arguments[0])instanceof b||Array.isArray(i))?(t=arguments[0],{}):1===arguments.length?(t=void 0,arguments[0]):(t=void 0,{}),this.style?this.style.queryRenderedFeatures(this._makeQueryGeometry(t),e,this.transform.zoom,this.transform.angle):[];var i},t.prototype._makeQueryGeometry=function(t){var e,i=this;if(void 0===t&&(t=[b.convert([0,0]),b.convert([this.transform.width,this.transform.height])]),t instanceof b||"number"==typeof t[0])e=[b.convert(t)];else{var n=[b.convert(t[0]),b.convert(t[1])];e=[n[0],new b(n[1].x,n[0].y),n[1],new b(n[0].x,n[1].y),n[0]]}return e.map(function(t){return i.transform.pointCoordinate(t)})},t.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},t.prototype.setStyle=function(t,e){if((!e||!1!==e.diff&&!e.localIdeographFontFamily)&&this.style&&t&&"object"==typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){l.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new h(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)):delete this.style,this},t.prototype.getStyle=function(){if(this.style)return this.style.serialize()},t.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")},t.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},t.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];return void 0===e?void this.fire("error",{error:new Error("There is no source with ID '"+t+"'")}):e.loaded()},t.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var i=t[e]._tiles;for(var n in i){var r=i[n];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},t.prototype.addSourceType=function(t,e,i){return this.style.addSourceType(t,e,i)},t.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},t.prototype.getSource=function(t){return this.style.getSource(t)},t.prototype.addImage=function(t,e,i){void 0===i&&(i={});var n=i.pixelRatio;void 0===n&&(n=1);var r=i.sdf;if(void 0===r&&(r=!1),e instanceof f){var o=p.getImageData(e),a=o.width,s=o.height,l=o.data;this.style.addImage(t,{data:new A({width:a,height:s},l),pixelRatio:n,sdf:r})}else{if(void 0===e.width||void 0===e.height)return this.fire("error",{error:new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")});var u=e.width,c=e.height,h=e.data;this.style.addImage(t,{data:new A({width:u,height:c},h.slice(0)),pixelRatio:n,sdf:r})}},t.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire("error",{error:new Error("Missing required image id")}),!1)},t.prototype.removeImage=function(t){this.style.removeImage(t)},t.prototype.loadImage=function(t,e){c.getImage(this._transformRequest(t,c.ResourceType.Image),e)},t.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},t.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},t.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},t.prototype.getLayer=function(t){return this.style.getLayer(t)},t.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},t.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0),this},t.prototype.getFilter=function(t){return this.style.getFilter(t)},t.prototype.setPaintProperty=function(t,e,i){return this.style.setPaintProperty(t,e,i),this._update(!0),this},t.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},t.prototype.setLayoutProperty=function(t,e,i){return this.style.setLayoutProperty(t,e,i),this._update(!0),this},t.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},t.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},t.prototype.getLight=function(){return this.style.getLight()},t.prototype.getContainer=function(){return this._container},t.prototype.getCanvasContainer=function(){return this._canvasContainer},t.prototype.getCanvas=function(){return this._canvas},t.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},t.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSContainer=u.create("div","mapboxgl-missing-css",t)).innerHTML="Missing Mapbox GL JS CSS";var e=this._canvasContainer=u.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=u.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var n=this._controlContainer=u.create("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){r[t]=u.create("div","mapboxgl-ctrl-"+t,n)})},t.prototype._resizeCanvas=function(t,e){var i=r.devicePixelRatio||1;this._canvas.width=i*t,this._canvas.height=i*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},t.prototype._setupPainter=function(){var t=l.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},S.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);e?this.painter=new m(e,this.transform):this.fire("error",{error:new Error("Failed to initialize WebGL")})},t.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&(p.cancelFrame(this._frameId),this._frameId=null),this.fire("webglcontextlost",{originalEvent:t})},t.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:t})},t.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},t.prototype._update=function(t){this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender())},t.prototype._render=function(){this._updateCamera();var t=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var e=this.transform.zoom,i=p.now();this.style.zoomHistory.update(e,i);var n=new d(e,{now:i,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=n.crossFadingFactor();1===r&&r===this._crossFadingFactor||(t=!0,this._crossFadingFactor=r),this.style.update(n)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming,fadeDuration:this._fadeDuration}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this.style&&(this.style.hasTransitions()||t)&&(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty)&&this._rerender(),this},t.prototype.remove=function(){this._hash&&this._hash.remove(),p.cancelFrame(this._frameId),this._frameId=null,this.setStyle(null),void 0!==r&&(r.removeEventListener("resize",this._onWindowResize,!1),r.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),n(this._canvasContainer),n(this._controlContainer),n(this._missingCSSContainer),this._container.classList.remove("mapboxgl-map"),this.fire("remove")},t.prototype._rerender=function(){var t=this;this.style&&!this._frameId&&(this._frameId=p.frame(function(){t._frameId=null,t._render()}))},t.prototype._onWindowOnline=function(){this._update()},t.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},e.showTileBoundaries.get=function(){return!!this._showTileBoundaries},e.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},e.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},e.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&((this._showCollisionBoxes=t)?this.style._generateCollisionBoxes():this._update())},e.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},e.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},e.repaint.get=function(){return!!this._repaint},e.repaint.set=function(t){this._repaint=t,this._update()},e.vertices.get=function(){return!!this._vertices},e.vertices.set=function(t){this._vertices=t,this._update()},t.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(t.dataType+"data",t)},t.prototype._onDataLoading=function(t){this.fire(t.dataType+"dataloading",t)},Object.defineProperties(t.prototype,e),t}(s);e.exports=E},{"../geo/lng_lat":62,"../geo/lng_lat_bounds":63,"../geo/transform":64,"../render/painter":90,"../style/evaluation_parameters":182,"../style/style":190,"../util/ajax":251,"../util/browser":252,"../util/dom":259,"../util/image":263,"../util/util":275,"../util/window":254,"./bind_handlers":230,"./camera":231,"./control/attribution_control":232,"./control/logo_control":235,"./events":238,"./hash":246,"@mapbox/mapbox-gl-supported":3,"@mapbox/point-geometry":4}],248:[function(t,e,i){"use strict";var v=t("../util/dom"),n=t("../geo/lng_lat"),x=t("@mapbox/point-geometry"),r=t("../util/smart_wrap"),b=t("../util/util").bindAll,o=function(t,e){if(b(["_update","_onMapClick"],this),!t){t=v.create("div");var i=v.createNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS(null,"height","41px"),i.setAttributeNS(null,"width","27px"),i.setAttributeNS(null,"viewBox","0 0 27 41");var n=v.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"stroke-width","1"),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"fill-rule","evenodd");var r=v.createNS("http://www.w3.org/2000/svg","g");r.setAttributeNS(null,"fill-rule","nonzero");var o=v.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"transform","translate(3.0, 29.0)"),o.setAttributeNS(null,"fill","#000000");for(var a=0,s=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];a<s.length;a+=1){var l=s[a],u=v.createNS("http://www.w3.org/2000/svg","ellipse");u.setAttributeNS(null,"opacity","0.04"),u.setAttributeNS(null,"cx","10.5"),u.setAttributeNS(null,"cy","5.80029008"),u.setAttributeNS(null,"rx",l.rx),u.setAttributeNS(null,"ry",l.ry),o.appendChild(u)}var c=v.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"fill","#3FB1CE");var h=v.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),c.appendChild(h);var p=v.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"fill","#000000");var f=v.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),p.appendChild(f);var d=v.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(6.0, 7.0)"),d.setAttributeNS(null,"fill","#FFFFFF");var m=v.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");var y=v.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#000000"),y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962");var _=v.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#FFFFFF"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962"),m.appendChild(y),m.appendChild(_),r.appendChild(o),r.appendChild(c),r.appendChild(p),r.appendChild(d),r.appendChild(m),i.appendChild(r),t.appendChild(i);var g=[0,-14];e&&e.offset||(e?e.offset=g:e={offset:g})}this._offset=x.convert(e&&e.offset||[0,0]),t.classList.add("mapboxgl-marker"),this._element=t,this._popup=null};o.prototype.addTo=function(t){return this.remove(),(this._map=t).getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),delete this._map),v.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(t){return this._lngLat=n.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&("offset"in t.options||(t.options.offset=this._offset),this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)),this},o.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var t=this._popup;return t&&(t.isOpen()?t.remove():t.addTo(this._map)),this},o.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=r(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),v.setTransform(this._element,"translate(-50%, -50%) translate("+this._pos.x+"px, "+this._pos.y+"px)"))},o.prototype.getOffset=function(){return this._offset},o.prototype.setOffset=function(t){return this._offset=x.convert(t),this._update(),this},e.exports=o},{"../geo/lng_lat":62,"../util/dom":259,"../util/smart_wrap":270,"../util/util":275,"@mapbox/point-geometry":4}],249:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/evented"),u=t("../util/dom"),o=t("../geo/lng_lat"),c=t("@mapbox/point-geometry"),a=t("../util/window"),h=t("../util/smart_wrap"),s={closeButton:!0,closeOnClick:!0},l=function(e){function t(t){e.call(this),this.options=n.extend(Object.create(s),t),n.bindAll(["_update","_onClickClose"],this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},t.prototype.isOpen=function(){return!!this._map},t.prototype.remove=function(){return this._content&&u.remove(this._content),this._container&&(u.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},t.prototype.getLngLat=function(){return this._lngLat},t.prototype.setLngLat=function(t){return this._lngLat=o.convert(t),this._pos=null,this._update(),this},t.prototype.setText=function(t){return this.setDOMContent(a.document.createTextNode(t))},t.prototype.setHTML=function(t){var e,i=a.document.createDocumentFragment(),n=a.document.createElement("body");for(n.innerHTML=t;e=n.firstChild;)i.appendChild(e);return this.setDOMContent(i)},t.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},t.prototype._createContent=function(){this._content&&u.remove(this._content),this._content=u.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=u.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},t.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=u.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=u.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this._map.transform.renderWorldCopies&&(this._lngLat=h(this._lngLat,this._pos,this._map.transform));var t=this._pos=this._map.project(this._lngLat),e=this.options.anchor,i=function t(e){if(e){if("number"==typeof e){var i=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{top:new c(0,e),"top-left":new c(i,i),"top-right":new c(-i,i),bottom:new c(0,-e),"bottom-left":new c(i,-i),"bottom-right":new c(-i,-i),left:new c(e,0),right:new c(-e,0)}}if(e instanceof c||Array.isArray(e)){var n=c.convert(e);return{top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{top:c.convert(e.top||[0,0]),"top-left":c.convert(e["top-left"]||[0,0]),"top-right":c.convert(e["top-right"]||[0,0]),bottom:c.convert(e.bottom||[0,0]),"bottom-left":c.convert(e["bottom-left"]||[0,0]),"bottom-right":c.convert(e["bottom-right"]||[0,0]),left:c.convert(e.left||[0,0]),right:c.convert(e.right||[0,0])}}return t(new c(0,0))}(this.options.offset);if(!e){var n=this._container.offsetWidth,r=this._container.offsetHeight;e=t.y+i.bottom.y<r?["top"]:t.y>this._map.transform.height-r?["bottom"]:[],t.x<n/2?e.push("left"):t.x>this._map.transform.width-n/2&&e.push("right"),e=0===e.length?"bottom":e.join("-")}var o=t.add(i[e]).round(),a={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},s=this._container.classList;for(var l in a)s.remove("mapboxgl-popup-anchor-"+l);s.add("mapboxgl-popup-anchor-"+e),u.setTransform(this._container,a[e]+" translate("+o.x+"px,"+o.y+"px)")}},t.prototype._onClickClose=function(){this.remove()},t}(r);e.exports=l},{"../geo/lng_lat":62,"../util/dom":259,"../util/evented":260,"../util/smart_wrap":270,"../util/util":275,"../util/window":254,"@mapbox/point-geometry":4}],250:[function(t,e,i){"use strict";var n=t("./util"),r=t("./web_worker_transfer"),s=r.serialize,l=r.deserialize,o=function(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.callbackID=0,n.bindAll(["receive"],this),this.target.addEventListener("message",this.receive,!1)};o.prototype.send=function(t,e,i,n){var r=i?this.mapId+":"+this.callbackID++:null;i&&(this.callbacks[r]=i);var o=[];this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:t,id:String(r),data:s(e,o)},o)},o.prototype.receive=function(t){var e,n=this,i=t.data,r=i.id;if(!i.targetMapId||this.mapId===i.targetMapId){var o=function(t,e){var i=[];n.target.postMessage({sourceMapId:n.mapId,type:"<response>",id:String(r),error:t?String(t):null,data:s(e,i)},i)};if("<response>"===i.type)e=this.callbacks[i.id],delete this.callbacks[i.id],e&&i.error?e(new Error(i.error)):e&&e(null,l(i.data));else if(void 0!==i.id&&this.parent[i.type])this.parent[i.type](i.sourceMapId,l(i.data),o);else if(void 0!==i.id&&this.parent.getWorkerSource){var a=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,a[0])[a[1]](l(i.data),o)}else this.parent[i.type](l(i.data))}},o.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},e.exports=o},{"./util":275,"./web_worker_transfer":278}],251:[function(t,e,i){"use strict";function n(t){var e=new s.XMLHttpRequest;for(var i in e.open("GET",t.url,!0),t.headers)e.setRequestHeader(i,t.headers[i]);return e.withCredentials="include"===t.credentials,e}var s=t("./window"),r={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};i.ResourceType=r,"function"==typeof Object.freeze&&Object.freeze(r);var o=function(i){function t(t,e){i.call(this,t),this.status=e}return i&&(t.__proto__=i),(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Error);i.getJSON=function(t,e){var i=n(t);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){e(new Error(i.statusText))},i.onload=function(){if(200<=i.status&&i.status<300&&i.response){var t;try{t=JSON.parse(i.response)}catch(t){return e(t)}e(null,t)}else e(new o(i.statusText,i.status))},i.send(),i},i.getArrayBuffer=function(t,e){var i=n(t);return i.responseType="arraybuffer",i.onerror=function(){e(new Error(i.statusText))},i.onload=function(){var t=i.response;if(0===t.byteLength&&200===i.status)return e(new Error("http status 200 returned without content."));200<=i.status&&i.status<300&&i.response?e(null,{data:t,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):e(new o(i.statusText,i.status))},i.send(),i};i.getImage=function(t,o){return i.getArrayBuffer(t,function(t,e){if(t)o(t);else if(e){var i=new s.Image,n=s.URL||s.webkitURL;i.onload=function(){o(null,i),n.revokeObjectURL(i.src)};var r=new s.Blob([new Uint8Array(e.data)],{type:"image/png"});i.cacheControl=e.cacheControl,i.expires=e.expires,i.src=e.data.byteLength?n.createObjectURL(r):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}})},i.getVideo=function(t,e){var i,n,r=s.document.createElement("video");r.onloadstart=function(){e(null,r)};for(var o=0;o<t.length;o++){var a=s.document.createElement("source");i=t[o],n=void 0,(n=s.document.createElement("a")).href=i,n.protocol===s.document.location.protocol&&n.host===s.document.location.host||(r.crossOrigin="Anonymous"),a.src=t[o],r.appendChild(a)}return r}},{"./window":254}],252:[function(t,e,i){"use strict";var n=t("./window"),r=n.performance&&n.performance.now?n.performance.now.bind(n.performance):Date.now.bind(Date),o=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||n.msRequestAnimationFrame,a=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.msCancelAnimationFrame;e.exports={now:r,frame:function(t){return o(t)},cancelFrame:function(t){return a(t)},getImageData:function(t){var e=n.document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(0,0,t.width,t.height)},hardwareConcurrency:n.navigator.hardwareConcurrency||4,get devicePixelRatio(){return n.devicePixelRatio},supportsWebp:!1};var s=n.document.createElement("img");s.onload=function(){e.exports.supportsWebp=!0},s.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":254}],253:[function(t,e,i){"use strict";var n=t("webworkify"),r=t("../window"),o=r.URL.createObjectURL(new n(t("../../source/worker"),{bare:!0}));e.exports=function(){return new r.Worker(o)}},{"../../source/worker":118,"../window":254,webworkify:36}],254:[function(t,e,i){"use strict";e.exports=self},{}],255:[function(t,e,i){"use strict";function u(t,e){return e.area-t.area}var c=t("quickselect"),h=t("./util").calculateSignedArea;e.exports=function(t,e){var i=t.length;if(i<=1)return[t];for(var n,r,o=[],a=0;a<i;a++){var s=h(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(n&&o.push(n),n=[t[a]]):n.push(t[a]))}if(n&&o.push(n),1<e)for(var l=0;l<o.length;l++)o[l].length<=e||(c(o[l],e,1,o[l].length-1,u),o[l]=o[l].slice(0,e));return o}},{"./util":275,quickselect:31}],256:[function(t,e,i){"use strict";e.exports={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null}},{}],257:[function(t,e,i){"use strict";var n=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}};n.prototype.encode=function(t){return this._stringToNumber[t]},n.prototype.decode=function(t){return this._numberToString[t]},e.exports=n},{}],258:[function(t,e,i){"use strict";var a=t("./util"),s=t("./actor"),n=function(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();for(var i=this.workerPool.acquire(this.id),n=0;n<i.length;n++){var r=i[n],o=new s(r,e,this.id);o.name="Worker "+n,this.actors.push(o)}};n.prototype.broadcast=function(i,n,t){t=t||function(){},a.asyncAll(this.actors,function(t,e){t.send(i,n,e)},t)},n.prototype.send=function(t,e,i,n){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[n].send(t,e,i),n},n.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},e.exports=n},{"./actor":250,"./util":275}],259:[function(t,e,i){"use strict";function n(t){for(var e=0;e<t.length;e++)if(t[e]in s)return t[e];return t[0]}var a=t("@mapbox/point-geometry"),r=t("./window");i.create=function(t,e,i){var n=r.document.createElement(t);return e&&(n.className=e),i&&i.appendChild(n),n},i.createNS=function(t,e){return r.document.createElementNS(t,e)};var o,s=r.document.documentElement.style,l=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){l&&(o=s[l],s[l]="none")},i.enableDrag=function(){l&&(s[l]=o)};var u=n(["transform","WebkitTransform"]);i.setTransform=function(t,e){t.style[u]=e};var c=function(t){t.preventDefault(),t.stopPropagation(),r.removeEventListener("click",c,!0)};i.suppressClick=function(){r.addEventListener("click",c,!0),r.setTimeout(function(){r.removeEventListener("click",c,!0)},0)},i.mousePos=function(t,e){var i=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new a(e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop)},i.touchPos=function(t,e){for(var i=t.getBoundingClientRect(),n=[],r="touchend"===e.type?e.changedTouches:e.touches,o=0;o<r.length;o++)n.push(new a(r[o].clientX-i.left-t.clientLeft,r[o].clientY-i.top-t.clientTop));return n},i.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)}},{"./window":254,"@mapbox/point-geometry":4}],260:[function(t,e,i){"use strict";function n(t,e,i){i[t]=i[t]||[],i[t].push(e)}function s(t,e,i){if(i&&i[t]){var n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}var l=t("./util"),r=function(){};r.prototype.on=function(t,e){return this._listeners=this._listeners||{},n(t,e,this._listeners),this},r.prototype.off=function(t,e){return s(t,e,this._listeners),s(t,e,this._oneTimeListeners),this},r.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},n(t,e,this._oneTimeListeners),this},r.prototype.fire=function(t,e){if(this.listens(t)){e=l.extend({},e,{type:t,target:this});for(var i=0,n=this._listeners&&this._listeners[t]?this._listeners[t].slice():[];i<n.length;i+=1)n[i].call(this,e);for(var r=0,o=this._oneTimeListeners&&this._oneTimeListeners[t]?this._oneTimeListeners[t].slice():[];r<o.length;r+=1){var a=o[r];s(t,a,this._oneTimeListeners),a.call(this,e)}this._eventedParent&&this._eventedParent.fire(t,l.extend({},e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData))}else l.endsWith(t,"error")&&console.error(e&&e.error||e||"Empty error event");return this},r.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&0<this._listeners[t].length||this._oneTimeListeners&&this._oneTimeListeners[t]&&0<this._oneTimeListeners[t].length||this._eventedParent&&this._eventedParent.listens(t)},r.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this},e.exports=r},{"./util":275}],261:[function(t,e,i){"use strict";function x(t,e){return e.max-t.max}function b(t,e,i,n){this.p=new T(t,e),this.h=i,this.d=function(t,e){for(var i=!1,n=1/0,r=0;r<e.length;r++)for(var o=e[r],a=0,s=o.length,l=s-1;a<s;l=a++){var u=o[a],c=o[l];u.y>t.y!=c.y>t.y&&t.x<(c.x-u.x)*(t.y-u.y)/(c.y-u.y)+u.x&&(i=!i),n=Math.min(n,h(t,u,c))}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var w=t("tinyqueue"),T=t("@mapbox/point-geometry"),h=t("./intersection_tests").distToSegmentSquared;e.exports=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=!1);for(var n=1/0,r=1/0,o=-1/0,a=-1/0,s=t[0],l=0;l<s.length;l++){var u=s[l];(!l||u.x<n)&&(n=u.x),(!l||u.y<r)&&(r=u.y),(!l||u.x>o)&&(o=u.x),(!l||u.y>a)&&(a=u.y)}var c=o-n,h=a-r,p=Math.min(c,h),f=p/2,d=new w(null,x);if(0===p)return new T(n,r);for(var m=n;m<o;m+=p)for(var y=r;y<a;y+=p)d.push(new b(m+f,y+f,f,t));for(var _=function(t){for(var e=0,i=0,n=0,r=t[0],o=0,a=r.length,s=a-1;o<a;s=o++){var l=r[o],u=r[s],c=l.x*u.y-u.x*l.y;i+=(l.x+u.x)*c,n+=(l.y+u.y)*c,e+=3*c}return new b(i/e,n/e,0,t)}(t),g=d.length;d.length;){var v=d.pop();(v.d>_.d||!_.d)&&(_=v,i&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,g)),v.max-_.d<=e||(f=v.h/2,d.push(new b(v.p.x-f,v.p.y-f,f,t)),d.push(new b(v.p.x+f,v.p.y-f,f,t)),d.push(new b(v.p.x-f,v.p.y+f,f,t)),d.push(new b(v.p.x+f,v.p.y+f,f,t)),g+=4)}return i&&(console.log("num probes: "+g),console.log("best distance: "+_.d)),_.p}},{"./intersection_tests":264,"@mapbox/point-geometry":4,tinyqueue:33}],262:[function(t,e,i){"use strict";var n,r=t("./worker_pool");e.exports=function(){return n||(n=new r),n}},{"./worker_pool":279}],263:[function(t,e,i){"use strict";function a(t,e,i,n){var r=e.width,o=e.height;if(n){if(n.length!==r*o*i)throw new RangeError("mismatched image size")}else n=new Uint8Array(r*o*i);return t.width=r,t.height=o,t.data=n,t}function n(t,e,i){var n=e.width,r=e.height;if(n!==t.width||r!==t.height){var o=a({},{width:n,height:r},i);s(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,r)},i),t.width=n,t.height=r,t.data=o.data}}function s(t,e,i,n,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,l=0;l<r.height;l++)for(var u=((i.y+l)*t.width+i.x)*o,c=((n.y+l)*e.width+n.x)*o,h=0;h<r.width*o;h++)s[c+h]=a[u+h];return e}var r=t("./web_worker_transfer").register,o=function(t,e){a(this,t,1,e)};o.prototype.resize=function(t){n(this,t,1)},o.prototype.clone=function(){return new o({width:this.width,height:this.height},new Uint8Array(this.data))},o.copy=function(t,e,i,n,r){s(t,e,i,n,r,1)};var l=function(t,e){a(this,t,4,e)};l.prototype.resize=function(t){n(this,t,4)},l.prototype.clone=function(){return new l({width:this.width,height:this.height},new Uint8Array(this.data))},l.copy=function(t,e,i,n,r){s(t,e,i,n,r,4)},r("AlphaImage",o),r("RGBAImage",l),e.exports={AlphaImage:o,RGBAImage:l}},{"./web_worker_transfer":278}],264:[function(t,e,i){"use strict";function l(t,e,i){if(1<t.length){if(u(t,e))return!0;for(var n=0;n<e.length;n++)if(c(e[n],t,i))return!0}for(var r=0;r<t.length;r++)if(c(t[r],e,i))return!0;return!1}function u(t,e){if(0===t.length||0===e.length)return!1;for(var i=0;i<t.length-1;i++)for(var n=t[i],r=t[i+1],o=0;o<e.length-1;o++){var a=e[o],s=e[o+1];if(u=r,f(l=n,c=a,h=s)!==f(u,c,h)&&f(l,u,c)!==f(l,u,h))return!0}var l,u,c,h;return!1}function c(t,e,i){var n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(var r=1;r<e.length;r++)if(o(t,e[r-1],e[r])<n)return!0;return!1}function o(t,e,i){var n=e.distSqr(i);if(0===n)return t.distSqr(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r<0?t.distSqr(e):1<r?t.distSqr(i):t.distSqr(i.sub(e)._mult(r)._add(e))}function h(t,e){for(var i,n,r,o=!1,a=0;a<t.length;a++)for(var s=0,l=(i=t[a]).length-1;s<i.length;l=s++)n=i[s],r=i[l],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(o=!o);return o}function p(t,e){for(var i=!1,n=0,r=t.length-1;n<t.length;r=n++){var o=t[n],a=t[r];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(i=!i)}return i}var f=t("./util").isCounterClockwise;e.exports={multiPolygonIntersectsBufferedMultiPoint:function(t,e,i){for(var n=0;n<t.length;n++)for(var r=t[n],o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++){var l=a[s];if(p(r,l))return!0;if(c(l,r,i))return!0}return!1},multiPolygonIntersectsMultiPolygon:function(t,e){if(1===t.length&&1===t[0].length)return h(e,t[0][0]);for(var i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(h(t,n[r]))return!0;for(var o=0;o<t.length;o++){for(var a=t[o],s=0;s<a.length;s++)if(h(e,a[s]))return!0;for(var l=0;l<e.length;l++)if(u(a,e[l]))return!0}return!1},multiPolygonIntersectsBufferedMultiLine:function(t,e,i){for(var n=0;n<e.length;n++)for(var r=e[n],o=0;o<t.length;o++){var a=t[o];if(3<=a.length)for(var s=0;s<r.length;s++)if(p(a,r[s]))return!0;if(l(a,r,i))return!0}return!1},polygonIntersectsPolygon:function(t,e){for(var i=0;i<t.length;i++)if(p(e,t[i]))return!0;for(var n=0;n<e.length;n++)if(p(t,e[n]))return!0;return!!u(t,e)},distToSegmentSquared:o}},{"./util":275}],265:[function(t,e,i){"use strict";e.exports={"Latin-1 Supplement":function(t){return 128<=t&&t<=255},Arabic:function(t){return 1536<=t&&t<=1791},"Arabic Supplement":function(t){return 1872<=t&&t<=1919},"Arabic Extended-A":function(t){return 2208<=t&&t<=2303},"Hangul Jamo":function(t){return 4352<=t&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return 5120<=t&&t<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(t){return 6320<=t&&t<=6399},"General Punctuation":function(t){return 8192<=t&&t<=8303},"Letterlike Symbols":function(t){return 8448<=t&&t<=8527},"Number Forms":function(t){return 8528<=t&&t<=8591},"Miscellaneous Technical":function(t){return 8960<=t&&t<=9215},"Control Pictures":function(t){return 9216<=t&&t<=9279},"Optical Character Recognition":function(t){return 9280<=t&&t<=9311},"Enclosed Alphanumerics":function(t){return 9312<=t&&t<=9471},"Geometric Shapes":function(t){return 9632<=t&&t<=9727},"Miscellaneous Symbols":function(t){return 9728<=t&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return 11008<=t&&t<=11263},"CJK Radicals Supplement":function(t){return 11904<=t&&t<=12031},"Kangxi Radicals":function(t){return 12032<=t&&t<=12255},"Ideographic Description Characters":function(t){return 12272<=t&&t<=12287},"CJK Symbols and Punctuation":function(t){return 12288<=t&&t<=12351},Hiragana:function(t){return 12352<=t&&t<=12447},Katakana:function(t){return 12448<=t&&t<=12543},Bopomofo:function(t){return 12544<=t&&t<=12591},"Hangul Compatibility Jamo":function(t){return 12592<=t&&t<=12687},Kanbun:function(t){return 12688<=t&&t<=12703},"Bopomofo Extended":function(t){return 12704<=t&&t<=12735},"CJK Strokes":function(t){return 12736<=t&&t<=12783},"Katakana Phonetic Extensions":function(t){return 12784<=t&&t<=12799},"Enclosed CJK Letters and Months":function(t){return 12800<=t&&t<=13055},"CJK Compatibility":function(t){return 13056<=t&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return 13312<=t&&t<=19903},"Yijing Hexagram Symbols":function(t){return 19904<=t&&t<=19967},"CJK Unified Ideographs":function(t){return 19968<=t&&t<=40959},"Yi Syllables":function(t){return 40960<=t&&t<=42127},"Yi Radicals":function(t){return 42128<=t&&t<=42191},"Hangul Jamo Extended-A":function(t){return 43360<=t&&t<=43391},"Hangul Syllables":function(t){return 44032<=t&&t<=55215},"Hangul Jamo Extended-B":function(t){return 55216<=t&&t<=55295},"Private Use Area":function(t){return 57344<=t&&t<=63743},"CJK Compatibility Ideographs":function(t){return 63744<=t&&t<=64255},"Arabic Presentation Forms-A":function(t){return 64336<=t&&t<=65023},"Vertical Forms":function(t){return 65040<=t&&t<=65055},"CJK Compatibility Forms":function(t){return 65072<=t&&t<=65103},"Small Form Variants":function(t){return 65104<=t&&t<=65135},"Arabic Presentation Forms-B":function(t){return 65136<=t&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return 65280<=t&&t<=65519}}},{}],266:[function(t,e,i){"use strict";var n=function(t,e){this.max=t,this.onRemove=e,this.reset()};n.prototype.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},n.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},n.prototype.has=function(t){return t in this.data},n.prototype.keys=function(){return this.order},n.prototype.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},n.prototype.get=function(t){return this.has(t)?this.data[t]:null},n.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},n.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},e.exports=n},{}],267:[function(t,e,i){"use strict";function o(t,e){var i=s(u.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"/"!==i.path&&(t.path=""+i.path+t.path),!u.REQUIRE_ACCESS_TOKEN)return l(t);if(!(e=e||u.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params.push("access_token="+e),l(t)}function a(t){return 0===t.indexOf("mapbox:")}function s(t){var e=t.match(r);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function l(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var u=t("./config"),c=t("./browser"),n="See https://www.mapbox.com/api-documentation/#access-tokens";i.isMapboxURL=a,i.normalizeStyleURL=function(t,e){if(!a(t))return t;var i=s(t);return i.path="/styles/v1"+i.path,o(i,e)},i.normalizeGlyphsURL=function(t,e){if(!a(t))return t;var i=s(t);return i.path="/fonts/v1"+i.path,o(i,e)},i.normalizeSourceURL=function(t,e){if(!a(t))return t;var i=s(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),o(i,e)},i.normalizeSpriteURL=function(t,e,i,n){var r=s(t);return a(t)?(r.path="/styles/v1"+r.path+"/sprite"+e+i,o(r,n)):(r.path+=""+e+i,l(r))};var h=/(\.(png|jpg)\d*)(?=$)/;i.normalizeTileURL=function(t,e,i){if(!e||!a(e))return t;var n=s(t),r=2<=c.devicePixelRatio||512===i?"@2x":"",o=c.supportsWebp?".webp":"$1";return n.path=n.path.replace(h,""+r+o),function(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(u.ACCESS_TOKEN||""))}(n.params),l(n)};var r=/^(\w+):\/\/([^\/?]*)(\/[^?]+)?\??(.+)?/},{"./browser":252,"./config":256}],268:[function(t,e,i){"use strict";e.exports={getEntriesByName:function(t){return!(!performance||!performance.getEntriesByName)&&performance.getEntriesByName(t)}}},{}],269:[function(t,e,r){"use strict";var i=t("./is_char_in_unicode_block");e.exports.allowsIdeographicBreaking=function(t){for(var e=0,i=t;e<i.length;e+=1){var n=i[e];if(!r.charAllowsIdeographicBreaking(n.charCodeAt(0)))return!1}return!0},e.exports.allowsVerticalWritingMode=function(t){for(var e=0,i=t;e<i.length;e+=1){var n=i[e];if(r.charHasUprightVerticalOrientation(n.charCodeAt(0)))return!0}return!1},e.exports.allowsLetterSpacing=function(t){for(var e=0,i=t;e<i.length;e+=1){var n=i[e];if(!r.charAllowsLetterSpacing(n.charCodeAt(0)))return!1}return!0},e.exports.charAllowsLetterSpacing=function(t){return!(i.Arabic(t)||i["Arabic Supplement"](t)||i["Arabic Extended-A"](t)||i["Arabic Presentation Forms-A"](t)||i["Arabic Presentation Forms-B"](t))},e.exports.charAllowsIdeographicBreaking=function(t){return!!(!(t<11904)&&(i["Bopomofo Extended"](t)||i.Bopomofo(t)||i["CJK Compatibility Forms"](t)||i["CJK Compatibility Ideographs"](t)||i["CJK Compatibility"](t)||i["CJK Radicals Supplement"](t)||i["CJK Strokes"](t)||i["CJK Symbols and Punctuation"](t)||i["CJK Unified Ideographs Extension A"](t)||i["CJK Unified Ideographs"](t)||i["Enclosed CJK Letters and Months"](t)||i["Halfwidth and Fullwidth Forms"](t)||i.Hiragana(t)||i["Ideographic Description Characters"](t)||i["Kangxi Radicals"](t)||i["Katakana Phonetic Extensions"](t)||i.Katakana(t)||i["Vertical Forms"](t)||i["Yi Radicals"](t)||i["Yi Syllables"](t)))},r.charHasUprightVerticalOrientation=function(t){return!!(746===t||747===t||!(t<4352)&&(i["Bopomofo Extended"](t)||i.Bopomofo(t)||i["CJK Compatibility Forms"](t)&&!(65097<=t&&t<=65103)||i["CJK Compatibility Ideographs"](t)||i["CJK Compatibility"](t)||i["CJK Radicals Supplement"](t)||i["CJK Strokes"](t)||!(!i["CJK Symbols and Punctuation"](t)||12296<=t&&t<=12305||12308<=t&&t<=12319||12336===t)||i["CJK Unified Ideographs Extension A"](t)||i["CJK Unified Ideographs"](t)||i["Enclosed CJK Letters and Months"](t)||i["Hangul Compatibility Jamo"](t)||i["Hangul Jamo Extended-A"](t)||i["Hangul Jamo Extended-B"](t)||i["Hangul Jamo"](t)||i["Hangul Syllables"](t)||i.Hiragana(t)||i["Ideographic Description Characters"](t)||i.Kanbun(t)||i["Kangxi Radicals"](t)||i["Katakana Phonetic Extensions"](t)||i.Katakana(t)&&12540!==t||!(!i["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||65306<=t&&t<=65310||65339===t||65341===t||65343===t||65371<=t&&t<=65503||65507===t||65512<=t&&t<=65519)||!(!i["Small Form Variants"](t)||65112<=t&&t<=65118||65123<=t&&t<=65126)||i["Unified Canadian Aboriginal Syllabics"](t)||i["Unified Canadian Aboriginal Syllabics Extended"](t)||i["Vertical Forms"](t)||i["Yijing Hexagram Symbols"](t)||i["Yi Syllables"](t)||i["Yi Radicals"](t)))},r.charHasNeutralVerticalOrientation=function(t){return!!(i["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||i["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||i["Letterlike Symbols"](t)||i["Number Forms"](t)||i["Miscellaneous Technical"](t)&&(8960<=t&&t<=8967||8972<=t&&t<=8991||8996<=t&&t<=9e3||9003===t||9085<=t&&t<=9114||9150<=t&&t<=9165||9167===t||9169<=t&&t<=9179||9186<=t&&t<=9215)||i["Control Pictures"](t)&&9251!==t||i["Optical Character Recognition"](t)||i["Enclosed Alphanumerics"](t)||i["Geometric Shapes"](t)||i["Miscellaneous Symbols"](t)&&!(9754<=t&&t<=9759)||i["Miscellaneous Symbols and Arrows"](t)&&(11026<=t&&t<=11055||11088<=t&&t<=11097||11192<=t&&t<=11243)||i["CJK Symbols and Punctuation"](t)||i.Katakana(t)||i["Private Use Area"](t)||i["CJK Compatibility Forms"](t)||i["Small Form Variants"](t)||i["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||9984<=t&&t<=10087||10102<=t&&t<=10131||65532===t||65533===t)},r.charHasRotatedVerticalOrientation=function(t){return!(r.charHasUprightVerticalOrientation(t)||r.charHasNeutralVerticalOrientation(t))}},{"./is_char_in_unicode_block":265}],270:[function(t,e,i){"use strict";var s=t("../geo/lng_lat");e.exports=function(t,e,i){if(t=new s(t.lng,t.lat),e){var n=new s(t.lng-360,t.lat),r=new s(t.lng+360,t.lat),o=i.locationPoint(t).distSqr(e);i.locationPoint(n).distSqr(e)<o?t=n:i.locationPoint(r).distSqr(e)<o&&(t=r)}for(;180<Math.abs(t.lng-i.center.lng);){var a=i.locationPoint(t);if(0<=a.x&&0<=a.y&&a.x<=i.width&&a.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}},{"../geo/lng_lat":62}],271:[function(t,e,i){"use strict";function l(t,e){return Math.ceil(t/e)*e}var u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},n=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};n.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},n.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},n.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},n.prototype.clear=function(){this.length=0},n.prototype.resize=function(t){this.reserve(t),this.length=t},n.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},n.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")},e.exports.StructArray=n,e.exports.Struct=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},e.exports.viewTypes=u,e.exports.createLayout=function(t,o){void 0===o&&(o=1);var a=0,s=0;return{members:t.map(function(t){var e,i=(e=t.type,u[e].BYTES_PER_ELEMENT),n=a=l(a,Math.max(o,i)),r=t.components||1;return s=Math.max(s,i),a+=i*r,{name:t.name,type:t.type,components:r,offset:n}}),size:l(a,Math.max(s,o)),alignment:o}}},{}],272:[function(t,e,i){"use strict";e.exports=function(t,e){var i=!1,n=0,r=function(){n=0,i&&(t(),n=setTimeout(r,e),i=!1)};return function(){return i=!0,n||r(),n}}},{}],273:[function(t,e,i){"use strict";function c(t,e){if(t.row>e.row){var i=t;t=e,e=i}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function h(t,e,i,n,r){var o=Math.max(i,Math.floor(e.y0)),a=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,c=0<t.dx,h=e.dx<0,p=o;p<a;p++){var f=l*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,d=u*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;r(Math.floor(d),Math.ceil(f),p)}}function n(t,e,i,n,r,o){var a,s=c(t,e),l=c(e,i),u=c(i,t);s.dy>l.dy&&(a=s,s=l,l=a),s.dy>u.dy&&(a=s,s=u,u=a),l.dy>u.dy&&(a=l,l=u,u=a),s.dy&&h(u,s,n,r,o),l.dy&&h(u,l,n,r,o)}t("../geo/coordinate");var p=t("../source/tile_id").OverscaledTileID;e.exports=function(a,t,s,l){function e(t,e,i){var n,r,o;if(0<=i&&i<=u)for(n=t;n<e;n++)0!==(r=Math.floor(n/u))&&!0!==l||(o=new p(s,r,a,(n%u+u)%u,i),c[o.key]=o)}void 0===l&&(l=!0);var u=1<<a,c={};return n(t[0],t[1],t[2],0,u,e),n(t[2],t[3],t[0],0,u,e),Object.keys(c).map(function(t){return c[t]})}},{"../geo/coordinate":61,"../source/tile_id":114}],274:[function(t,e,i){"use strict";e.exports=function(i,t){return t.replace(/{([^{}]+)}/g,function(t,e){return e in i?String(i[e]):""})}},{}],275:[function(t,e,n){"use strict";var o=t("@mapbox/unitbezier"),c=t("../geo/coordinate");t("@mapbox/point-geometry");n.easeCubicInOut=function(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},n.bezier=function(t,e,i,n){var r=new o(t,e,i,n);return function(t){return r.solve(t)}},n.ease=n.bezier(.25,.1,.25,1),n.clamp=function(t,e,i){return Math.min(i,Math.max(e,t))},n.wrap=function(t,e,i){var n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r},n.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,o=new Array(t.length),a=null;t.forEach(function(t,i){e(t,function(t,e){t&&(a=t),o[i]=e,0==--r&&n(a,o)})})},n.values=function(t){var e=[];for(var i in t)e.push(t[i]);return e},n.keysDifference=function(t,e){var i=[];for(var n in t)n in e||i.push(n);return i},n.extend=function(t){for(var e=[],i=arguments.length-1;0<i--;)e[i]=arguments[i+1];for(var n=0,r=e;n<r.length;n+=1){var o=r[n];for(var a in o)t[a]=o[a]}return t},n.pick=function(t,e){for(var i={},n=0;n<e.length;n++){var r=e[n];r in t&&(i[r]=t[r])}return i};var i=1;n.uniqueId=function(){return i++},n.bindAll=function(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})},n.getCoordinatesCenter=function(t){for(var e=1/0,i=1/0,n=-1/0,r=-1/0,o=0;o<t.length;o++)e=Math.min(e,t[o].column),i=Math.min(i,t[o].row),n=Math.max(n,t[o].column),r=Math.max(r,t[o].row);var a=n-e,s=r-i,l=Math.max(a,s),u=Math.max(0,Math.floor(-Math.log(l)/Math.LN2));return new c((e+n)/2,(i+r)/2,0).zoomTo(u)},n.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},n.mapObject=function(t,e,i){var n={};for(var r in t)n[r]=e.call(i||this,t[r],r,t);return n},n.filterObject=function(t,e,i){var n={};for(var r in t)e.call(i||this,t[r],r,t)&&(n[r]=t[r]);return n},n.deepEqual=t("../style-spec/util/deep_equal"),n.clone=function(t){return Array.isArray(t)?t.map(n.clone):"object"==typeof t&&t?n.mapObject(t,n.clone):t},n.arraysIntersect=function(t,e){for(var i=0;i<t.length;i++)if(0<=e.indexOf(t[i]))return!0;return!1};var r={};n.warnOnce=function(t){r[t]||("undefined"!=typeof console&&console.warn(t),r[t]=!0)},n.isCounterClockwise=function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)},n.calculateSignedArea=function(t){for(var e=0,i=0,n=t.length,r=n-1,o=void 0,a=void 0;i<n;r=i++)o=t[i],e+=((a=t[r]).x-o.x)*(o.y+a.y);return e},n.isClosedPolygon=function(t){if(t.length<4)return!1;var e=t[0],i=t[t.length-1];return!(0<Math.abs(e.x-i.x)||0<Math.abs(e.y-i.y))&&.01<Math.abs(n.calculateSignedArea(t))},n.sphericalToCartesian=function(t){var e=t[0],i=t[1],n=t[2];return i+=90,i*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(i)*Math.sin(n),y:e*Math.sin(i)*Math.sin(n),z:e*Math.cos(n)}},n.parseCacheControl=function(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,e,i,n){var r=i||n;return o[e]=!r||r.toLowerCase(),""}),o["max-age"]){var e=parseInt(o["max-age"],10);isNaN(e)?delete o["max-age"]:o["max-age"]=e}return o}},{"../geo/coordinate":61,"../style-spec/util/deep_equal":155,"@mapbox/point-geometry":4,"@mapbox/unitbezier":7}],276:[function(t,e,i){"use strict";var n=function(t,e,i,n){this.type="Feature",(this._vectorTileFeature=t)._z=e,t._x=i,t._y=n,this.properties=t.properties,null!=t.id&&(this.id=t.id)},r={geometry:{}};r.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},r.geometry.set=function(t){this._geometry=t},n.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(n.prototype,r),e.exports=n},{}],277:[function(t,o,e){"use strict";var a=t("./script_detection");o.exports=function(t){for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i+1)||null,r=t.charCodeAt(i-1)||null;n&&a.charHasRotatedVerticalOrientation(n)&&!o.exports.lookup[t[i+1]]||r&&a.charHasRotatedVerticalOrientation(r)&&!o.exports.lookup[t[i-1]]||!o.exports.lookup[t[i]]?e+=t[i]:e+=o.exports.lookup[t[i]]}return e},o.exports.lookup={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"}},{"./script_detection":269}],278:[function(t,e,i){"use strict";function n(t,e,i){void 0===i&&(i={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),m[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}var r=t("grid-index"),o=t("../style-spec/util/color"),a=t("../style-spec/expression"),s=a.StylePropertyFunction,l=a.StyleExpression,u=a.StyleExpressionWithErrorHandling,c=a.ZoomDependentExpression,h=a.ZoomConstantExpression,p=t("../style-spec/expression/compound_expression").CompoundExpression,f=t("../style-spec/expression/definitions"),d=t("./window").ImageData,m={};for(var y in n("Object",Object),r.serialize=function(t,e){var i=t.toArrayBuffer();return e&&e.push(i),i},r.deserialize=function(t){return new r(t)},n("Grid",r),n("Color",o),n("StylePropertyFunction",s),n("StyleExpression",l,{omit:["_evaluator"]}),n("StyleExpressionWithErrorHandling",u,{omit:["_evaluator"]}),n("ZoomDependentExpression",c),n("ZoomConstantExpression",h),n("CompoundExpression",p,{omit:["_evaluate"]}),f)f[y]._classRegistryKey||n("Expression_"+y,f[y]);e.exports={register:n,serialize:function t(e,i){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(e instanceof ArrayBuffer)return i&&i.push(e),e;if(ArrayBuffer.isView(e)){var n=e;return i&&i.push(n.buffer),n}if(e instanceof d)return i&&i.push(e.data.buffer),e;if(Array.isArray(e)){for(var r=[],o=0,a=e;o<a.length;o+=1){var s=a[o];r.push(t(s,i))}return r}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);var l=e.constructor,u=l._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var c={};if(l.serialize)c._serialized=l.serialize(e,i);else for(var h in e)if(e.hasOwnProperty(h)&&!(0<=m[u].omit.indexOf(h))){var p=e[h];c[h]=0<=m[u].shallow.indexOf(h)?p:t(p,i)}return{name:u,properties:c}},deserialize:function e(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof d)return t;if(Array.isArray(t))return t.map(function(t){return e(t)});if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);var i=t,n=i.name,r=i.properties;if(!n)throw new Error("can't deserialize object of anonymous class");var o=m[n].klass;if(!o)throw new Error("can't deserialize unregistered class "+n);if(o.deserialize)return o.deserialize(r._serialized);for(var a=Object.create(o.prototype),s=0,l=Object.keys(r);s<l.length;s+=1){var u=l[s];a[u]=0<=m[n].shallow.indexOf(u)?r[u]:e(r[u])}return a}}},{"../style-spec/expression":139,"../style-spec/expression/compound_expression":123,"../style-spec/expression/definitions":131,"../style-spec/util/color":153,"./window":254,"grid-index":24}],279:[function(i,t,e){"use strict";var n=i("./web_worker"),r=function(){this.active={}};r.prototype.acquire=function(t){if(!this.workers){var e=i("../").workerCount;for(this.workers=[];this.workers.length<e;)this.workers.push(new n)}return this.active[t]=!0,this.workers.slice()},r.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},t.exports=r},{"../":73,"./web_worker":253}]},{},[73])(73)}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet"),require("esri-leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet","esri-leaflet"],e):e((t.L=t.L||{},t.L.esri=t.L.esri||{},t.L.esri.Vector=t.L.esri.Vector||{}),t.L,t.L.esri)}(this,function(e,o,a){"use strict";function s(n,r){a.request(n,{},function(t,i){if(t)throw new Error("Unable to fetch vector tile style metadata");a.request(i.sources.esri.url,{},function(t,e){t||(l(i,e,n),r._mapboxGL=o.mapboxGL({accessToken:"ezree",style:i}),r._ready=!0,r.fire("ready",{},!0))},r)},r)}function l(t,e,i){t.sources.esri.url&&-1===t.sources.esri.url.indexOf("http")&&(t.sources.esri.url=i.replace("/resources/styles/root.json","")),e.tiles&&"/"!==e.tiles[0].charAt(0)&&(e.tiles[0]="/"+e.tiles[0]),e.tileMap&&"/"!==e.tileMap.charAt(0)&&(e.tileMap="/"+e.tileMap),t.sources.esri={type:"vector",scheme:"xyz",tilejson:e.tilejson||"2.0.0",format:e.tileInfo&&e.tileInfo.format||"pbf",index:e.tileMap?t.sources.esri.url+e.tileMap:null,tiles:[t.sources.esri.url+e.tiles[0]],description:e.description,name:e.name},-1===t.glyphs.indexOf("http")&&(t.glyphs=i.replace("styles/root.json",t.glyphs.replace("../","")),t.sprite=i.replace("styles/root.json",t.sprite.replace("../","")))}o="default"in o?o.default:o,function(t){if("object"==typeof e&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mapboxgl=t()}}(function(){return function o(a,s,l){function u(e,t){if(!s[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=s[e]={exports:{}};a[e][0].call(r.exports,function(t){return u(a[e][1][t]||t)},r,r.exports,o,a,s,l)}return s[e].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)u(l[t]);return u}({1:[function(t,e,i){function n(t){t?(this.array=t.array,this.pos=t.pos):(this.array=new ArrayBuffer(this.defaultLength),this.length=this.defaultLength,this.setupViews())}(e.exports=n).prototype={pos:0,itemSize:4,defaultLength:8192,arrayType:"ARRAY_BUFFER",get index(){return this.pos/this.itemSize},setupViews:function(){this.ubytes=new Uint8Array(this.array),this.bytes=new Int8Array(this.array),this.ushorts=new Uint16Array(this.array),this.shorts=new Int16Array(this.array)},bind:function(t){var e=t[this.arrayType];this.buffer?t.bindBuffer(e,this.buffer):(this.buffer=t.createBuffer(),t.bindBuffer(e,this.buffer),t.bufferData(e,this.array.slice(0,this.pos),t.STATIC_DRAW),this.array=null)},destroy:function(t){this.buffer&&t.deleteBuffer(this.buffer)},resize:function(){if(this.length<this.pos+this.itemSize){for(;this.length<this.pos+this.itemSize;)this.length=2*Math.round(1.5*this.length/2);this.array=new ArrayBuffer(this.length),new Uint8Array(this.array).set(this.ubytes),this.setupViews()}}}},{}],2:[function(t,e,i){var n=t("./line_vertex_buffer"),r=t("./line_element_buffer"),o=t("./fill_vertex_buffer"),a=t("./triangle_element_buffer"),s=t("./outline_element_buffer"),l=t("./glyph_vertex_buffer"),u=t("./triangle_element_buffer"),c=t("./icon_vertex_buffer"),h=t("./triangle_element_buffer"),p=t("./collision_box_vertex_buffer"),f=t("./circle_vertex_buffer"),d=t("./triangle_element_buffer");e.exports=function(t){return{glyphVertex:new l((t=t||{}).glyphVertex),glyphElement:new u(t.glyphElement),iconVertex:new c(t.iconVertex),iconElement:new h(t.iconElement),circleVertex:new f(t.circleVertex),circleElement:new d(t.circleElement),fillVertex:new o(t.fillVertex),fillElement:new a(t.fillElement),outlineElement:new s(t.outlineElement),lineVertex:new n(t.lineVertex),lineElement:new r(t.lineElement),collisionBoxVertex:new p(t.collisionBoxVertex)}}},{"./circle_vertex_buffer":3,"./collision_box_vertex_buffer":4,"./fill_vertex_buffer":5,"./glyph_vertex_buffer":6,"./icon_vertex_buffer":7,"./line_element_buffer":8,"./line_vertex_buffer":9,"./outline_element_buffer":10,"./triangle_element_buffer":11}],3:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{defaultLength:32768,itemSize:4,add:function(t,e,i,n){var r=this.pos/2;this.resize(),this.shorts[r+0]=2*t+(i+1)/2,this.shorts[r+1]=2*e+(n+1)/2,this.pos+=this.itemSize},bind:function(t,e,i){o.prototype.bind.call(this,t),t.vertexAttribPointer(e.a_pos,2,t.SHORT,!1,this.itemSize,i+0)}})},{"../../util/util":106,"./buffer":1}],4:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{itemSize:12,defaultLength:32768,add:function(t,e,i,n){var r=this.pos,o=r/2,a=this.index;return this.resize(),this.shorts[o+0]=t.x,this.shorts[o+1]=t.y,this.shorts[o+2]=Math.round(e.x),this.shorts[o+3]=Math.round(e.y),this.ubytes[r+8]=Math.floor(10*i),this.ubytes[r+9]=Math.floor(10*n),this.pos+=this.itemSize,a}})},{"../../util/util":106,"./buffer":1}],5:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{itemSize:4,add:function(t,e){var i=this.pos/2;this.resize(),this.shorts[i+0]=t,this.shorts[i+1]=e,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],6:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{defaultLength:32768,itemSize:16,add:function(t,e,i,n,r,o,a,s,l){var u=this.pos,c=u/2;this.resize(),this.shorts[c+0]=t,this.shorts[c+1]=e,this.shorts[c+2]=Math.round(64*i),this.shorts[c+3]=Math.round(64*n),this.ubytes[u+8]=Math.floor(r/4),this.ubytes[u+9]=Math.floor(o/4),this.ubytes[u+10]=Math.floor(10*l),this.ubytes[u+12]=Math.floor(10*a),this.ubytes[u+13]=Math.floor(10*Math.min(s,25)),this.pos+=this.itemSize},bind:function(t,e,i){o.prototype.bind.call(this,t);var n=this.itemSize;t.vertexAttribPointer(e.a_pos,2,t.SHORT,!1,n,i+0),t.vertexAttribPointer(e.a_offset,2,t.SHORT,!1,n,i+4),t.vertexAttribPointer(e.a_data1,4,t.UNSIGNED_BYTE,!1,n,i+8),t.vertexAttribPointer(e.a_data2,2,t.UNSIGNED_BYTE,!1,n,i+12)}})},{"../../util/util":106,"./buffer":1}],7:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{defaultLength:32768,itemSize:16,add:function(t,e,i,n,r,o,a,s,l){var u=this.pos,c=u/2;this.resize(),this.shorts[c+0]=t,this.shorts[c+1]=e,this.shorts[c+2]=Math.round(64*i),this.shorts[c+3]=Math.round(64*n),this.ubytes[u+8]=r/4,this.ubytes[u+9]=o/4,this.ubytes[u+10]=Math.floor(10*(l||0)),this.ubytes[u+12]=Math.floor(10*(a||0)),this.ubytes[u+13]=Math.floor(10*Math.min(s||25,25)),this.pos+=this.itemSize},bind:function(t,e,i){o.prototype.bind.call(this,t);var n=this.itemSize;t.vertexAttribPointer(e.a_pos,2,t.SHORT,!1,n,i+0),t.vertexAttribPointer(e.a_offset,2,t.SHORT,!1,n,i+4),t.vertexAttribPointer(e.a_data1,4,t.UNSIGNED_BYTE,!1,n,i+8),t.vertexAttribPointer(e.a_data2,2,t.UNSIGNED_BYTE,!1,n,i+12)}})},{"../../util/util":106,"./buffer":1}],8:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(t,e,i){var n=this.pos/2;this.resize(),this.ushorts[n+0]=t,this.ushorts[n+1]=e,this.ushorts[n+2]=i,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],9:[function(t,e,i){function u(t){r.call(this,t)}var n=t("../../util/util"),r=t("./buffer");(e.exports=u).extrudeScale=63,u.prototype=n.inherit(r,{itemSize:8,defaultLength:32768,add:function(t,e,i,n,r){var o=this.pos,a=o/2,s=this.index,l=u.extrudeScale;return this.resize(),this.shorts[a+0]=2*Math.floor(t.x)|i,this.shorts[a+1]=2*Math.floor(t.y)|n,this.bytes[o+4]=Math.round(l*e.x),this.bytes[o+5]=Math.round(l*e.y),this.bytes[o+6]=(r||0)/128,this.bytes[o+7]=(r||0)%128,this.pos+=this.itemSize,s}})},{"../../util/util":106,"./buffer":1}],10:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{itemSize:4,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(t,e){var i=this.pos/2;this.resize(),this.ushorts[i+0]=t,this.ushorts[i+1]=e,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],11:[function(t,e,i){function n(t){o.call(this,t)}var r=t("../../util/util"),o=t("./buffer");(e.exports=n).prototype=r.inherit(o,{itemSize:6,arrayType:"ELEMENT_ARRAY_BUFFER",add:function(t,e,i){var n=this.pos/2;this.resize(),this.ushorts[n+0]=t,this.ushorts[n+1]=e,this.ushorts[n+2]=i,this.pos+=this.itemSize}})},{"../../util/util":106,"./buffer":1}],12:[function(t,e,i){function n(t){this.buffers=t,this.elementGroups=new r(t.circleVertex,t.circleElement)}var r=t("./element_groups");(e.exports=n).prototype.addFeatures=function(){for(var t=0;t<this.features.length;t++)for(var e=this.features[t].loadGeometry()[0],i=0;i<e.length;i++){this.elementGroups.makeRoomFor(6);var n=e[i].x,r=e[i].y;if(!(n<0||4096<=n||r<0||4096<=r)){var o=this.buffers.circleVertex.index-this.elementGroups.current.vertexStartIndex;this.buffers.circleVertex.add(n,r,-1,-1),this.buffers.circleVertex.add(n,r,1,-1),this.buffers.circleVertex.add(n,r,1,1),this.buffers.circleVertex.add(n,r,-1,1),this.elementGroups.elementBuffer.add(o,o+1,o+2),this.elementGroups.elementBuffer.add(o,o+3,o+2),this.elementGroups.current.vertexLength+=4,this.elementGroups.current.elementLength+=2}}}},{"./element_groups":14}],13:[function(t,e,i){e.exports=function(t,e,i,n,r){var o=new y("layout",t.type,t.layout,{}).values(),a={lastIntegerZoom:1/0,lastIntegerZoomTime:0,lastZoom:0},s={};for(var l in o)s[l]=o[l].calculate(i,a);"symbol"===t.type&&(o["text-size"]&&(s["text-max-size"]=o["text-size"].calculate(18,a),s["text-size"]=o["text-size"].calculate(i+1,a)),o["icon-size"]&&(s["icon-max-size"]=o["icon-size"].calculate(18,a),s["icon-size"]=o["icon-size"].calculate(i+1,a)));var u=new("line"===t.type?c:"fill"===t.type?h:"symbol"===t.type?p:"circle"===t.type?f:null)(e,new d[t.type](s),n,i,r);return u.id=t.id,u.type=t.type,u["source-layer"]=t["source-layer"],u.interactive=t.interactive,u.minZoom=t.minzoom,u.maxZoom=t.maxzoom,u.filter=m(t.filter),u.features=[],u};var c=t("./line_bucket"),h=t("./fill_bucket"),p=t("./symbol_bucket"),f=t("./circle_bucket"),d=t("../style/layout_properties"),m=t("feature-filter"),y=t("../style/style_declaration_set")},{"../style/layout_properties":53,"../style/style_declaration_set":59,"./circle_bucket":12,"./fill_bucket":16,"./line_bucket":17,"./symbol_bucket":18,"feature-filter":108}],14:[function(t,e,i){function n(t,e,i){this.vertexBuffer=t,this.elementBuffer=e,this.secondElementBuffer=i,this.groups=[]}function r(t,e,i){this.vertexStartIndex=t,this.elementStartIndex=e,this.secondElementStartIndex=i,this.elementLength=0,this.vertexLength=0,this.secondElementLength=0}(e.exports=n).prototype.makeRoomFor=function(t){(!this.current||65535<this.current.vertexLength+t)&&(this.current=new r(this.vertexBuffer.index,this.elementBuffer&&this.elementBuffer.index,this.secondElementBuffer&&this.secondElementBuffer.index),this.groups.push(this.current))}},{}],15:[function(t,e,i){function n(t,e){this.x=t.x,this.y=t.y,this.z=t.z-Math.log(e)/Math.LN2,this.rtree=r(9),this.toBeInserted=[]}function x(t,e,i){return"Point"===e?h(t,i):"LineString"===e?o(t,i):"Polygon"===e&&(!!(w(n=t,new T((r=i)[0],r[1]))||w(n,new T(r[0],r[3]))||w(n,new T(r[2],r[1]))||w(n,new T(r[2],r[3])))||o(n,r)||o(t,i));var n,r}function o(t,e){for(var i=0;i<t.length;i++)for(var n=t[i],r=0,o=n.length-1;r<n.length;o=r++){var a=n[r],s=n[o],l=new T(a.y,a.x),u=new T(s.y,s.x);if(c(a,s,e[0],e[2],e[1])||c(a,s,e[0],e[2],e[3])||c(l,u,e[1],e[3],e[0])||c(l,u,e[1],e[3],e[2]))return!0}return h(t,e)}function c(t,e,i,n,r){if(e.y===t.y)return e.y===r&&Math.min(t.x,e.x)<=n&&Math.max(t.x,e.x)>=i;var o=(r-t.y)/(e.y-t.y),a=t.x+o*(e.x-t.x);return i<=a&&a<=n&&o<=1&&0<=o}function h(t,e){for(var i=0;i<t.length;i++)for(var n=t[i],r=0;r<n.length;r++)if(n[r].x>=e[0]&&n[r].y>=e[1]&&n[r].x<=e[2]&&n[r].y<=e[3])return!0;return!1}function s(t,e,i){var n=e.distSqr(i);if(0===n)return t.distSqr(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r<0?t.distSqr(e):1<r?t.distSqr(i):t.distSqr(i.sub(e)._mult(r)._add(e))}function b(t,e,i){for(var n=i*i,r=0;r<t.length;r++)for(var o=t[r],a=1;a<o.length;a++){if(s(e,o[a-1],o[a])<n)return!0}return!1}function w(t,e){for(var i,n,r,o=!1,a=0;a<t.length;a++)for(var s=0,l=(i=t[a]).length-1;s<i.length;l=s++)n=i[s],r=i[l],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(o=!o);return o}var r=t("rbush"),T=t("point-geometry"),S=t("vector-tile"),A=t("../util/util");(e.exports=n).prototype.insert=function(t,e,i){t.layers=e,t.feature=i,this.toBeInserted.push(t)},n.prototype._load=function(){this.rtree.load(this.toBeInserted),this.toBeInserted=[]},n.prototype.query=function(t,e){this.toBeInserted.length&&this._load();var i,n,r,o,a,s,l=t.params||{},u=t.x,c=t.y,h=[];n=void 0!==u&&void 0!==c?[u-(i=(l.radius||0)*(t.tileExtent||4096)/t.scale),c-i,u+i,c+i]:[t.minX,t.minY,t.maxX,t.maxY];for(var p=this.rtree.search(n),f=0;f<p.length;f++){var d=p[f].feature,m=p[f].layers,y=S.VectorTileFeature.types[d.type];if((!l.$type||y===l.$type)&&(!i||(r=d.loadGeometry(),o=y,a=new T(u,c),s=i,"Point"===o?function(t,e,i){for(var n=i*i,r=0;r<t.length;r++)for(var o=t[r],a=0;a<o.length;a++)if(o[a].distSqr(e)<=n)return!0;return!1}(r,a,s):"LineString"===o?b(r,a,s):"Polygon"===o&&(w(r,a)||b(r,a,s))))&&x(d.loadGeometry(),y,n)){var _=d.toGeoJSON(this.x,this.y,this.z);l.includeGeometry||(_.geometry=null);for(var g=0;g<m.length;g++){var v=m[g];l.layerIds&&l.layerIds.indexOf(v)<0||h.push(A.extend({layer:v},_))}}}e(null,h)}},{"../util/util":106,"point-geometry":137,rbush:139,"vector-tile":144}],16:[function(t,e,i){function n(t){this.buffers=t,this.elementGroups=new r(t.fillVertex,t.fillElement,t.outlineElement)}var r=t("./element_groups");(e.exports=n).prototype.addFeatures=function(){for(var t=this.features,e=0;e<t.length;e++){var i=t[e].loadGeometry();i&&this.addFeature(i)}},n.prototype.addFeature=function(t){for(var e=0;e<t.length;e++)this.addFill(t[e])},n.prototype.addFill=function(t){if(!(t.length<3)){var e=t.length;this.elementGroups.makeRoomFor(e+1);for(var i,n,r,o=this.elementGroups.current,a=this.buffers.fillVertex,s=this.buffers.fillElement,l=this.buffers.outlineElement,u=a.index-o.vertexStartIndex,c=0;c<t.length;c++)n=a.index-o.vertexStartIndex,r=t[c],a.add(r.x,r.y),o.vertexLength++,2<=c&&(r.x!==t[0].x||r.y!==t[0].y)&&(s.add(u,i,n),o.elementLength++),1<=c&&(l.add(i,n),o.secondElementLength++),i=n}}},{"./element_groups":14}],17:[function(t,e,i){function n(t,e){this.buffers=t,this.elementGroups=new r(t.lineVertex,t.lineElement),this.layoutProperties=e}var r=t("./element_groups");(e.exports=n).prototype.addFeatures=function(){for(var t=this.features,e=0;e<t.length;e++){var i=t[e].loadGeometry();i&&this.addFeature(i)}},n.prototype.addFeature=function(t){for(var e=this.layoutProperties,i=0;i<t.length;i++)this.addLine(t[i],e["line-join"],e["line-cap"],e["line-miter-limit"],e["line-round-limit"])},n.prototype.addLine=function(t,e,i,n,r){for(var o=t.length;2<o&&t[o-1].equals(t[o-2]);)o--;if(!(t.length<2)){"bevel"===e&&(n=1.05);var a=t[0],s=t[o-1],l=a.equals(s);if(this.elementGroups.makeRoomFor(10*o),2!==o||!l){var u,c,h,p,f,d,m,y=i,_=l?"butt":i,g=1,v=0,x=!0;this.e1=this.e2=this.e3=-1,l&&(u=t[o-2],f=a.sub(u)._unit()._perp());for(var b=0;b<o;b++)if(!(h=l&&b===o-1?t[1]:t[b+1])||!t[b].equals(h)){f&&(p=f),u&&(c=u),u=t[b],c&&(v+=u.dist(c)),f=h?h.sub(u)._unit()._perp():p;var w=(p=p||f).add(f)._unit(),T=w.x*f.x+w.y*f.y,S=1/T,A=c&&h,M=A?e:h?y:_;if(A&&"round"===M&&(S<r?M="miter":S<=2&&(M="fakeround")),"miter"===M&&n<S&&(M="bevel"),"bevel"===M&&(2<S&&(M="flipbevel"),S<n&&(M="miter")),"miter"===M)w._mult(S),this.addCurrentVertex(u,g,v,w,0,0,!1);else if("flipbevel"===M){if(100<S)w=f.clone();else{var E=0<p.x*f.y-p.y*f.x?-1:1,L=S*p.add(f).mag()/p.sub(f).mag();w._perp()._mult(L*E)}this.addCurrentVertex(u,g,v,w,0,0,!1),g=-g}else if("bevel"===M||"fakeround"===M){var z=0<g*(p.x*f.y-p.y*f.x),P=-Math.sqrt(S*S-1);if(z?(m=0,d=P):(d=0,m=P),x||this.addCurrentVertex(u,g,v,p,d,m,!1),"fakeround"===M){for(var C,I=Math.floor(8*(.5-(T-.5))),k=0;k<I;k++)C=f.mult((k+1)/(I+1))._add(p)._unit(),this.addPieSliceVertex(u,g,v,C,z);this.addPieSliceVertex(u,g,v,w,z);for(var R=I-1;0<=R;R--)C=p.mult((R+1)/(I+1))._add(f)._unit(),this.addPieSliceVertex(u,g,v,C,z)}h&&this.addCurrentVertex(u,g,v,f,-d,-m,!1)}else"butt"===M?(x||this.addCurrentVertex(u,g,v,p,0,0,!1),h&&this.addCurrentVertex(u,g,v,f,0,0,!1)):"square"===M?(x||(this.addCurrentVertex(u,g,v,p,1,1,!1),this.e1=this.e2=-1,g=1),h&&this.addCurrentVertex(u,g,v,f,-1,-1,!1)):"round"===M&&(x||(this.addCurrentVertex(u,g,v,p,0,0,!1),this.addCurrentVertex(u,g,v,p,1,1,!0),this.e1=this.e2=-1,g=1),h&&(this.addCurrentVertex(u,g,v,f,-1,-1,!0),this.addCurrentVertex(u,g,v,f,0,0,!1)));x=!1}}}},n.prototype.addCurrentVertex=function(t,e,i,n,r,o,a){var s,l=a?1:0,u=this.buffers.lineVertex,c=this.buffers.lineElement,h=this.elementGroups.current,p=this.elementGroups.current.vertexStartIndex;s=n.mult(e),r&&s._sub(n.perp()._mult(r)),this.e3=u.add(t,s,l,0,i)-p,0<=this.e1&&0<=this.e2&&(c.add(this.e1,this.e2,this.e3),h.elementLength++),this.e1=this.e2,this.e2=this.e3,s=n.mult(-e),o&&s._sub(n.perp()._mult(o)),this.e3=u.add(t,s,l,1,i)-p,0<=this.e1&&0<=this.e2&&(c.add(this.e1,this.e2,this.e3),h.elementLength++),this.e1=this.e2,this.e2=this.e3,h.vertexLength+=2},n.prototype.addPieSliceVertex=function(t,e,i,n,r){var o=this.buffers.lineVertex,a=this.buffers.lineElement,s=this.elementGroups.current,l=this.elementGroups.current.vertexStartIndex,u=r;n=n.mult(e*(r?-1:1)),this.e3=o.add(t,n,0,u,i)-l,s.vertexLength+=1,0<=this.e1&&0<=this.e2&&(a.add(this.e1,this.e2,this.e3),s.elementLength++),r?this.e2=this.e3:this.e1=this.e3}},{"./element_groups":14}],18:[function(t,e,i){function n(t,e,i,n,r){this.buffers=t,this.layoutProperties=e,this.overscaling=i,this.zoom=n,this.collisionDebug=r;var o=512*i;this.tilePixelRatio=4096/o,this.compareText={},this.symbolInstances=[]}function M(t,e,i,n,r,o,a,s,l,u,c,h){this.x=t.x,this.y=t.y,this.hasText=!!i,this.hasIcon=!!n,this.hasText&&(this.glyphQuads=o?p(t,i,a,e,r,l):[],this.textCollisionFeature=new d(e,t,i,a,s,l)),this.hasIcon&&(this.iconQuads=o?f(t,n,u,e,r,h):[],this.iconCollisionFeature=new d(e,t,n,u,c,h))}var v=t("./element_groups"),E=t("../symbol/anchor"),L=t("../symbol/get_anchors"),x=t("../util/token"),r=t("../symbol/quads"),o=t("../symbol/shaping"),l=t("../symbol/resolve_text"),a=t("../symbol/resolve_icons"),b=t("../symbol/mergelines"),w=o.shapeText,T=o.shapeIcon,p=r.getGlyphQuads,f=r.getIconQuads,z=t("../symbol/clip_line"),_=t("point-geometry"),d=t("../symbol/collision_feature");(e.exports=n).prototype.needsPlacement=!0,n.prototype.addFeatures=function(t){var e=this.layoutProperties,i=this.features,n=this.textFeatures,r=.5,o=.5;switch(e["text-anchor"]){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(e["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}for(var a="right"===e["text-justify"]?1:"left"===e["text-justify"]?0:.5,s=24*e["text-line-height"],l="line"!==e["symbol-placement"]?24*e["text-max-width"]:0,u=24*e["text-letter-spacing"],c=[24*e["text-offset"][0],24*e["text-offset"][1]],h=e["text-font"].join(","),p=[],f=0;f<i.length;f++)p.push(i[f].loadGeometry());if("line"===e["symbol-placement"]){var d=b(i,n,p);p=d.geometries,i=d.features,n=d.textFeatures}for(var m,y,_=0;_<i.length;_++)if(p[_]){if(m=n[_]?w(n[_],this.stacks[h],l,s,r,o,a,u,c):null,e["icon-image"]){var g=x(i[_].properties,e["icon-image"]),v=this.icons[g];y=T(v,e),v&&(void 0===this.sdfIcons?this.sdfIcons=v.sdf:this.sdfIcons!==v.sdf&&console.warn("Style sheet warning: Cannot mix SDF and non-SDF icons in one bucket"))}else y=null;(m||y)&&this.addFeature(p[_],m,y)}this.placeFeatures(t,this.buffers,this.collisionDebug)},n.prototype.addFeature=function(t,e,i){var n=this.layoutProperties,r=n["text-size"]/24,o=this.tilePixelRatio*r,a=this.tilePixelRatio*n["text-max-size"]/24,s=this.tilePixelRatio*n["icon-size"],l=this.tilePixelRatio*n["symbol-spacing"],u=n["symbol-avoid-edges"],c=n["text-padding"]*this.tilePixelRatio,h=n["icon-padding"]*this.tilePixelRatio,p=n["text-max-angle"]/180*Math.PI,f="map"===n["text-rotation-alignment"]&&"line"===n["symbol-placement"],d="map"===n["icon-rotation-alignment"]&&"line"===n["symbol-placement"],m=n["text-allow-overlap"]||n["icon-allow-overlap"]||n["text-ignore-placement"]||n["icon-ignore-placement"],y="line"===n["symbol-placement"],_=l/2;y&&(t=z(t,0,0,4096,4096));for(var g=0;g<t.length;g++)for(var v=t[g],x=y?L(v,l,p,e,i,24,a,this.overscaling):[new E(v[0].x,v[0].y,0)],b=0,w=x.length;b<w;b++){var T=x[b];if(!(e&&y&&this.anchorIsTooClose(e.text,_,T))){var S=!(T.x<0||4096<T.x||T.y<0||4096<T.y);if(!u||S){var A=S||m;this.symbolInstances.push(new M(T,v,e,i,n,A,o,c,f,s,h,d))}}}},n.prototype.anchorIsTooClose=function(t,e,i){var n=this.compareText;if(t in n){for(var r=n[t],o=r.length-1;0<=o;o--)if(i.dist(r[o])<e)return!0}else n[t]=[];return n[t].push(i),!1},n.prototype.placeFeatures=function(t,e,i){this.buffers=e;var n=this.elementGroups={text:new v(e.glyphVertex,e.glyphElement),icon:new v(e.iconVertex,e.iconElement),sdfIcons:this.sdfIcons},r=this.layoutProperties,o=t.maxScale;n.text["text-size"]=r["text-size"],n.icon["icon-size"]=r["icon-size"];var a="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],s="map"===r["icon-rotation-alignment"]&&"line"===r["symbol-placement"];if(r["text-allow-overlap"]||r["icon-allow-overlap"]||r["text-ignore-placement"]||r["icon-ignore-placement"]){var l=t.angle,u=Math.sin(l),c=Math.cos(l);this.symbolInstances.sort(function(t,e){var i=u*t.x+c*t.y;return u*e.x+c*e.y-i})}for(var h=0;h<this.symbolInstances.length;h++){var p=this.symbolInstances[h],f=p.hasText,d=p.hasIcon,m=r["text-optional"]||!f,y=r["icon-optional"]||!d,_=f&&!r["text-allow-overlap"]?t.placeCollisionFeature(p.textCollisionFeature):t.minScale,g=d&&!r["icon-allow-overlap"]?t.placeCollisionFeature(p.iconCollisionFeature):t.minScale;m||y?!y&&_?_=Math.max(g,_):!m&&g&&(g=Math.max(g,_)):g=_=Math.max(g,_),f&&(r["text-ignore-placement"]||t.insertCollisionFeature(p.textCollisionFeature,_),_<=o&&this.addSymbols(e.glyphVertex,e.glyphElement,n.text,p.glyphQuads,_,r["text-keep-upright"],a,t.angle)),d&&(r["icon-ignore-placement"]||t.insertCollisionFeature(p.iconCollisionFeature,g),g<=o&&this.addSymbols(e.iconVertex,e.iconElement,n.icon,p.iconQuads,g,r["icon-keep-upright"],s,t.angle))}i&&this.addToDebugBuffers(t)},n.prototype.addSymbols=function(t,e,i,n,r,o,a,s){i.makeRoomFor(4*n.length);for(var l=i.current,u=this.zoom,c=Math.max(Math.log(r)/Math.LN2+u,0),h=0;h<n.length;h++){var p=n[h],f=(p.angle+s+Math.PI)%(2*Math.PI);if(!(o&&a&&(f<=Math.PI/2||f>3*Math.PI/2))){var d=p.tl,m=p.tr,y=p.bl,_=p.br,g=p.tex,v=p.anchorPoint,x=Math.max(u+Math.log(p.minScale)/Math.LN2,c),b=Math.min(u+Math.log(p.maxScale)/Math.LN2,25);if(!(b<=x)){x===c&&(x=0);var w=t.index-l.vertexStartIndex;t.add(v.x,v.y,d.x,d.y,g.x,g.y,x,b,c),t.add(v.x,v.y,m.x,m.y,g.x+g.w,g.y,x,b,c),t.add(v.x,v.y,y.x,y.y,g.x,g.y+g.h,x,b,c),t.add(v.x,v.y,_.x,_.y,g.x+g.w,g.y+g.h,x,b,c),l.vertexLength+=4,e.add(w,w+1,w+2),e.add(w+1,w+2,w+3),l.elementLength+=2}}}},n.prototype.getDependencies=function(t,e,i){function n(t){return t||r?i(t):void(r=!0)}var r=!1;this.getTextDependencies(t,e,n),this.getIconDependencies(t,e,n)},n.prototype.getIconDependencies=function(t,e,i){if(this.layoutProperties["icon-image"]){var n=this.features,r=a(n,this.layoutProperties);r.length?e.send("get icons",{icons:r},function(t,e){return t?i(t):(this.icons=e,void i())}.bind(this)):i()}else i()},n.prototype.getTextDependencies=function(t,e,n){var i=this.features,r=this.layoutProperties["text-font"],o=this.stacks=t.stacks;void 0===o[r]&&(o[r]={});var a=o[r],s=l(i,this.layoutProperties,a);this.textFeatures=s.textFeatures,e.send("get glyphs",{uid:t.uid,fontstack:r,codepoints:s.codepoints},function(t,e){if(t)return n(t);for(var i in e)a[i]=e[i];n()})},n.prototype.addToDebugBuffers=function(t){this.elementGroups.collisionBox=new v(this.buffers.collisionBoxVertex),this.elementGroups.collisionBox.makeRoomFor(0);for(var e=this.buffers.collisionBoxVertex,i=-t.angle,n=t.yStretch,r=0;r<this.symbolInstances.length;r++)for(var o=0;o<2;o++){var a=this.symbolInstances[r][0===o?"textCollisionFeature":"iconCollisionFeature"];if(a)for(var s=a.boxes,l=0;l<s.length;l++){var u=s[l],c=u.anchorPoint,h=new _(u.x1,u.y1*n)._rotate(i),p=new _(u.x2,u.y1*n)._rotate(i),f=new _(u.x1,u.y2*n)._rotate(i),d=new _(u.x2,u.y2*n)._rotate(i),m=Math.max(0,Math.min(25,this.zoom+Math.log(u.maxScale)/Math.LN2)),y=Math.max(0,Math.min(25,this.zoom+Math.log(u.placementScale)/Math.LN2));e.add(c,h,m,y),e.add(c,p,m,y),e.add(c,p,m,y),e.add(c,d,m,y),e.add(c,d,m,y),e.add(c,f,m,y),e.add(c,f,m,y),e.add(c,h,m,y),this.elementGroups.collisionBox.current.vertexLength+=8}}}},{"../symbol/anchor":62,"../symbol/clip_line":65,"../symbol/collision_feature":67,"../symbol/get_anchors":69,"../symbol/mergelines":72,"../symbol/quads":73,"../symbol/resolve_icons":74,"../symbol/resolve_text":75,"../symbol/shaping":76,"../util/token":105,"./element_groups":14,"point-geometry":137}],19:[function(t,e,i){function n(t,e,i){this.column=t,this.row=e,this.zoom=i}(e.exports=n).prototype={clone:function(){return new n(this.column,this.row,this.zoom)},zoomTo:function(t){return this.clone()._zoomTo(t)},sub:function(t){return this.clone()._sub(t)},_zoomTo:function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},_sub:function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this}}},{}],20:[function(t,e,i){function n(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}e.exports=n;var r=t("../util/util").wrap;n.prototype.wrap=function(){return new n(r(this.lng,-180,180),this.lat)},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},{"../util/util":106}],21:[function(t,e,i){function o(t,e){if(t)for(var i=e?[t,e]:t,n=0,r=i.length;n<r;n++)this.extend(i[n])}e.exports=o;var a=t("./lng_lat");o.prototype={extend:function(t){var e,i,n=this._sw,r=this._ne;if(t instanceof a)i=e=t;else{if(!(t instanceof o))return t?this.extend(a.convert(t)||o.convert(t)):this;if(e=t._sw,i=t._ne,!e||!i)return this}return n||r?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new a(e.lng,e.lat),this._ne=new a(i.lng,i.lat)),this},getCenter:function(){return new a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},getNorthWest:function(){return new a(this.getWest(),this.getNorth())},getSouthEast:function(){return new a(this.getEast(),this.getSouth())},getWest:function(){return this._sw.lng},getSouth:function(){return this._sw.lat},getEast:function(){return this._ne.lng},getNorth:function(){return this._ne.lat}},o.convert=function(t){return!t||t instanceof o?t:new o(t)}},{"./lng_lat":20}],22:[function(t,e,i){function n(t,e){this.tileSize=512,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this.zoom=0,this.center=new r(0,0),this.angle=0,this._altitude=1.5,this._pitch=0}var r=t("./lng_lat"),d=t("point-geometry"),m=t("./coordinate"),o=t("../util/util").wrap,y=t("../util/interpolate"),_=t("gl-matrix").vec4,g=t("gl-matrix").mat4;(e.exports=n).prototype={get minZoom(){return this._minZoom},set minZoom(t){this._minZoom=t,this.zoom=Math.max(this.zoom,t)},get maxZoom(){return this._maxZoom},set maxZoom(t){this._maxZoom=t,this.zoom=Math.min(this.zoom,t)},get worldSize(){return this.tileSize*this.scale},get centerPoint(){return this.size._div(2)},get size(){return new d(this.width,this.height)},get bearing(){return-this.angle/Math.PI*180},set bearing(t){this.angle=-o(t,-180,180)*Math.PI/180},get pitch(){return this._pitch/Math.PI*180},set pitch(t){this._pitch=Math.min(60,t)/180*Math.PI},get altitude(){return this._altitude},set altitude(t){this._altitude=Math.max(.75,t)},get zoom(){return this._zoom},set zoom(t){t=Math.min(Math.max(t,this.minZoom),this.maxZoom),this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this._constrain()},get center(){return this._center},set center(t){this._center=t,this._constrain()},zoomScale:function(t){return Math.pow(2,t)},scaleZoom:function(t){return Math.log(t)/Math.LN2},project:function(t,e){return new d(this.lngX(t.lng,e),this.latY(t.lat,e))},unproject:function(t,e){return new r(this.xLng(t.x,e),this.yLat(t.y,e))},get x(){return this.lngX(this.center.lng)},get y(){return this.latY(this.center.lat)},get point(){return new d(this.x,this.y)},lngX:function(t,e){return(180+t)*(e||this.worldSize)/360},latY:function(t,e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*(e||this.worldSize)/360},xLng:function(t,e){return 360*t/(e||this.worldSize)-180},yLat:function(t,e){var i=180-360*t/(e||this.worldSize);return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90},panBy:function(t){var e=this.centerPoint._add(t);this.center=this.pointLocation(e)},setLocationAtPoint:function(t,e){var i=this.locationCoordinate(t),n=this.pointCoordinate(e),r=this.pointCoordinate(this.centerPoint),o=n._sub(i);this.center=this.coordinateLocation(r._sub(o))},setZoomAround:function(t,e){var i;e&&(i=this.locationPoint(e)),this.zoom=t,e&&this.setLocationAtPoint(e,i)},setBearingAround:function(t,e){var i;e&&(i=this.locationPoint(e)),this.bearing=t,e&&this.setLocationAtPoint(e,i)},locationPoint:function(t){return this.coordinatePoint(this.locationCoordinate(t))},pointLocation:function(t){return this.coordinateLocation(this.pointCoordinate(t))},locationCoordinate:function(t){var e=this.zoomScale(this.tileZoom)/this.worldSize,i=r.convert(t);return new m(this.lngX(i.lng)*e,this.latY(i.lat)*e,this.tileZoom)},coordinateLocation:function(t){var e=this.zoomScale(t.zoom);return new r(this.xLng(t.column,e),this.yLat(t.row,e))},pointCoordinate:function(t,e){void 0===e&&(e=0);var i=this.coordinatePointMatrix(this.tileZoom),n=g.invert(new Float64Array(16),i);if(!n)throw new Error("failed to invert matrix");var r=_.transformMat4([],[t.x,t.y,0,1],n),o=_.transformMat4([],[t.x,t.y,1,1],n),a=r[3],s=o[3],l=r[0]/a,u=o[0]/s,c=r[1]/a,h=o[1]/s,p=r[2]/a,f=o[2]/s,d=p===f?0:(e-p)/(f-p);return new m(y(l,u,d),y(c,h,d),this.tileZoom)},coordinatePoint:function(t){var e=this.coordinatePointMatrix(t.zoom),i=_.transformMat4([],[t.column,t.row,0,1],e);return new d(i[0]/i[3],i[1]/i[3])},coordinatePointMatrix:function(t){var e=this.getProjMatrix(),i=this.worldSize/this.zoomScale(t);return g.scale(e,e,[i,i,1]),g.multiply(e,this.getPixelMatrix(),e),e},getPixelMatrix:function(){var t=g.create();return g.scale(t,t,[this.width/2,-this.height/2,1]),g.translate(t,t,[1,-1,0]),t},_constrain:function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,i,n,r,o,a,s,l=this.size;this.latRange&&(t=this.latY(this.latRange[1]),r=(e=this.latY(this.latRange[0]))-t<l.y?l.y/(e-t):0),this.lngRange&&(i=this.lngX(this.lngRange[0]),o=(n=this.lngX(this.lngRange[1]))-i<l.x?l.x/(n-i):0);var u=Math.max(o||0,r||0);if(u)return this.center=this.unproject(new d(o?(n+i)/2:this.x,r?(e+t)/2:this.y)),this.zoom+=this.scaleZoom(u),void(this._constraining=!1);if(this.latRange){var c=this.y,h=l.y/2;c-h<t&&(s=t+h),e<c+h&&(s=e-h)}if(this.lngRange){var p=this.x,f=l.x/2;p-f<i&&(a=i+f),n<p+f&&(a=n-f)}(void 0!==a||void 0!==s)&&(this.center=this.unproject(new d(void 0!==a?a:this.x,void 0!==s?s:this.y))),this._constraining=!1}},getProjMatrix:function(){var t=new Float64Array(16),e=Math.atan(.5/this.altitude),i=Math.sin(e)*this.altitude/Math.sin(Math.PI/2-this._pitch-e),n=Math.cos(Math.PI/2-this._pitch)*i+this.altitude;return g.perspective(t,2*Math.atan(this.height/2/this.altitude),this.width/this.height,.1,n),g.translate(t,t,[0,0,-this.altitude]),g.scale(t,t,[1,-1,1/this.height]),g.rotateX(t,t,this._pitch),g.rotateZ(t,t,this.angle),g.translate(t,t,[-this.x,-this.y,0]),t}}},{"../util/interpolate":102,"../util/util":106,"./coordinate":19,"./lng_lat":20,"gl-matrix":116,"point-geometry":137}],23:[function(t,e,i){var f={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};e.exports=function(t,e,i,n){n=n||1;var r,o,a,s,l,u,c,h,p=[];for(r=0,o=t.length;r<o;r++)if(l=f[t[r]]){for(h=null,a=0,s=l[1].length;a<s;a+=2)h=-1===l[1][a]&&-1===l[1][a+1]?null:(u=e+l[1][a]*n,c=i-l[1][a+1]*n,h&&p.push(h.x,h.y,u,c),{x:u,y:c});e+=l[0]*n}return p}},{}],24:[function(t,e,i){var n=e.exports={};n.Map=t("./ui/map"),n.Control=t("./ui/control/control"),n.Navigation=t("./ui/control/navigation"),n.Attribution=t("./ui/control/attribution"),n.Popup=t("./ui/popup"),n.GeoJSONSource=t("./source/geojson_source"),n.VideoSource=t("./source/video_source"),n.ImageSource=t("./source/image_source"),n.Style=t("./style/style"),n.LngLat=t("./geo/lng_lat"),n.LngLatBounds=t("./geo/lng_lat_bounds"),n.Point=t("point-geometry"),n.Evented=t("./util/evented"),n.util=t("./util/util"),n.supported=t("./util/browser").supported;var r=t("./util/ajax");n.util.getJSON=r.getJSON,n.util.getArrayBuffer=r.getArrayBuffer;var o=t("./util/config");n.config=o,Object.defineProperty(n,"accessToken",{get:function(){return o.ACCESS_TOKEN},set:function(t){o.ACCESS_TOKEN=t}})},{"./geo/lng_lat":20,"./geo/lng_lat_bounds":21,"./source/geojson_source":39,"./source/image_source":41,"./source/video_source":48,"./style/style":56,"./ui/control/attribution":79,"./ui/control/control":80,"./ui/control/navigation":81,"./ui/map":91,"./ui/popup":92,"./util/ajax":94,"./util/browser":95,"./util/config":99,"./util/evented":100,"./util/util":106,"point-geometry":137}],25:[function(t,e,i){var _=t("gl-matrix").mat3;e.exports=function(t,e,i){var n,r=t.gl,o=e.paint["background-color"],a=e.paint["background-pattern"],s=e.paint["background-opacity"],l=a?t.spriteAtlas.getPosition(a.from,!0):null,u=a?t.spriteAtlas.getPosition(a.to,!0):null;if(l&&u){n=t.patternShader,r.switchShader(n,i),r.uniform1i(n.u_image,0),r.uniform2fv(n.u_pattern_tl_a,l.tl),r.uniform2fv(n.u_pattern_br_a,l.br),r.uniform2fv(n.u_pattern_tl_b,u.tl),r.uniform2fv(n.u_pattern_br_b,u.br),r.uniform1f(n.u_opacity,s);var c=t.transform,h=l.size,p=u.size,f=c.locationCoordinate(c.center),d=1/Math.pow(2,c.zoomFraction);r.uniform1f(n.u_mix,a.t);var m=_.create();_.scale(m,m,[1/(h[0]*a.fromScale),1/(h[1]*a.fromScale)]),_.translate(m,m,[f.column*c.tileSize%(h[0]*a.fromScale),f.row*c.tileSize%(h[1]*a.fromScale)]),_.rotate(m,m,-c.angle),_.scale(m,m,[d*c.width/2,-d*c.height/2]);var y=_.create();_.scale(y,y,[1/(p[0]*a.toScale),1/(p[1]*a.toScale)]),_.translate(y,y,[f.column*c.tileSize%(p[0]*a.toScale),f.row*c.tileSize%(p[1]*a.toScale)]),_.rotate(y,y,-c.angle),_.scale(y,y,[d*c.width/2,-d*c.height/2]),r.uniformMatrix3fv(n.u_patternmatrix_a,!1,m),r.uniformMatrix3fv(n.u_patternmatrix_b,!1,y),t.spriteAtlas.bind(r,!0)}else n=t.fillShader,r.switchShader(n,i),r.uniform4fv(n.u_color,o);r.disable(r.STENCIL_TEST),r.bindBuffer(r.ARRAY_BUFFER,t.backgroundBuffer),r.vertexAttribPointer(n.a_pos,t.backgroundBuffer.itemSize,r.SHORT,!1,0,0),r.drawArrays(r.TRIANGLE_STRIP,0,t.backgroundBuffer.itemCount),r.enable(r.STENCIL_TEST),r.stencilMask(0),r.stencilFunc(r.EQUAL,128,128)}},{"gl-matrix":116}],26:[function(t,e,i){var m=t("../util/browser.js");e.exports=function(t,e,i,n){if(n.buffers){i=t.translateMatrix(i,n,e.paint["circle-translate"],e.paint["circle-translate-anchor"]);var r=n.elementGroups[e.ref||e.id];if(r){var o=t.gl;o.disable(o.STENCIL_TEST),o.switchShader(t.circleShader,i,n.exMatrix);var a=n.buffers.circleVertex,s=t.circleShader,l=n.buffers.circleElement,u=1/m.devicePixelRatio/e.paint["circle-radius"];o.uniform4fv(s.u_color,e.paint["circle-color"]),o.uniform1f(s.u_blur,Math.max(e.paint["circle-blur"],u)),o.uniform1f(s.u_size,e.paint["circle-radius"]);for(var c=0;c<r.groups.length;c++){var h=r.groups[c],p=h.vertexStartIndex*a.itemSize;a.bind(o,s,p),l.bind(o,s,p);var f=3*h.elementLength,d=h.elementStartIndex*l.itemSize;o.drawElements(o.TRIANGLES,f,o.UNSIGNED_SHORT,d)}o.enable(o.STENCIL_TEST)}}}},{"../util/browser.js":95}],27:[function(t,e,i){e.exports=function(t,e,i,n){var r=n.elementGroups[e.ref||e.id].collisionBox;if(r){var o=t.gl,a=n.buffers.collisionBoxVertex,s=t.collisionBoxShader;o.enable(o.STENCIL_TEST),o.switchShader(s,i),a.bind(o,s),o.lineWidth(1),o.vertexAttribPointer(s.a_pos,2,o.SHORT,!1,12,0),o.vertexAttribPointer(s.a_extrude,2,o.SHORT,!1,12,4),o.vertexAttribPointer(s.a_data,2,o.UNSIGNED_BYTE,!1,12,8),o.uniform1f(s.u_scale,Math.pow(2,t.transform.zoom-n.coord.z)),o.uniform1f(s.u_zoom,10*t.transform.zoom),o.uniform1f(s.u_maxzoom,10*(n.coord.z+1));var l=r.groups[0].vertexStartIndex,u=r.groups[0].vertexLength;o.drawArrays(o.LINES,l,u),o.disable(o.STENCIL_TEST)}}},{}],28:[function(t,e,i){var r=t("../lib/debugtext"),o=t("../util/browser");e.exports=function(t,e){var i=t.gl;i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.switchShader(t.debugShader,e.posMatrix),i.bindBuffer(i.ARRAY_BUFFER,t.debugBuffer),i.vertexAttribPointer(t.debugShader.a_pos,t.debugBuffer.itemSize,i.SHORT,!1,0,0),i.uniform4f(t.debugShader.u_color,1,0,0,1),i.lineWidth(4),i.drawArrays(i.LINE_STRIP,0,t.debugBuffer.itemCount);var n=r(e.coord.toString(),50,200,5);i.bindBuffer(i.ARRAY_BUFFER,t.debugTextBuffer),i.bufferData(i.ARRAY_BUFFER,new Int16Array(n),i.STREAM_DRAW),i.vertexAttribPointer(t.debugShader.a_pos,t.debugTextBuffer.itemSize,i.SHORT,!1,0,0),i.lineWidth(8*o.devicePixelRatio),i.uniform4f(t.debugShader.u_color,1,1,1,1),i.drawArrays(i.LINES,0,n.length/t.debugTextBuffer.itemSize),i.lineWidth(2*o.devicePixelRatio),i.uniform4f(t.debugShader.u_color,0,0,0,1),i.drawArrays(i.LINES,0,n.length/t.debugTextBuffer.itemSize),i.blendFunc(i.ONE_MINUS_DST_ALPHA,i.ONE)}},{"../lib/debugtext":23,"../util/browser":95}],29:[function(t,e,i){var A=t("../util/browser"),M=t("gl-matrix").mat3;e.exports=function(t,e,i,n){if(n.buffers){var r=n.elementGroups[e.ref||e.id];if(r){var o,a,s,l,u=t.gl,c=t.translateMatrix(i,n,e.paint["fill-translate"],e.paint["fill-translate-anchor"]),h=e.paint["fill-color"];u.stencilMask(63),u.clear(u.STENCIL_BUFFER_BIT),u.stencilFunc(u.NOTEQUAL,128,128),u.stencilOpSeparate(u.FRONT,u.INCR_WRAP,u.KEEP,u.KEEP),u.stencilOpSeparate(u.BACK,u.DECR_WRAP,u.KEEP,u.KEEP),u.colorMask(!1,!1,!1,!1),u.switchShader(t.fillShader,c),(o=n.buffers.fillVertex).bind(u),(a=n.buffers.fillElement).bind(u);for(var p,f,d=0;d<r.groups.length;d++)p=(s=r.groups[d]).vertexStartIndex*o.itemSize,u.vertexAttribPointer(t.fillShader.a_pos,2,u.SHORT,!1,4,p+0),l=3*s.elementLength,f=s.elementStartIndex*a.itemSize,u.drawElements(u.TRIANGLES,l,u.UNSIGNED_SHORT,f);u.colorMask(!0,!0,!0,!0),u.stencilOp(u.KEEP,u.KEEP,u.KEEP),u.stencilMask(0);var m=e.paint["fill-outline-color"];if(!0===e.paint["fill-antialias"]&&(!e.paint["fill-pattern"]||m)){u.switchShader(t.outlineShader,c),u.lineWidth(2*A.devicePixelRatio),m?u.stencilFunc(u.EQUAL,128,128):u.stencilFunc(u.EQUAL,128,191),u.uniform2f(t.outlineShader.u_world,u.drawingBufferWidth,u.drawingBufferHeight),u.uniform4fv(t.outlineShader.u_color,m||h),o=n.buffers.fillVertex,(a=n.buffers.outlineElement).bind(u);for(var y=0;y<r.groups.length;y++)p=(s=r.groups[y]).vertexStartIndex*o.itemSize,u.vertexAttribPointer(t.outlineShader.a_pos,2,u.SHORT,!1,4,p+0),l=2*s.secondElementLength,f=s.secondElementStartIndex*a.itemSize,u.drawElements(u.LINES,l,u.UNSIGNED_SHORT,f)}var _,g=e.paint["fill-pattern"],v=e.paint["fill-opacity"]||1;if(g){var x=t.spriteAtlas.getPosition(g.from,!0),b=t.spriteAtlas.getPosition(g.to,!0);if(!x||!b)return;_=t.patternShader,u.switchShader(_,i),u.uniform1i(_.u_image,0),u.uniform2fv(_.u_pattern_tl_a,x.tl),u.uniform2fv(_.u_pattern_br_a,x.br),u.uniform2fv(_.u_pattern_tl_b,b.tl),u.uniform2fv(_.u_pattern_br_b,b.br),u.uniform1f(_.u_opacity,v),u.uniform1f(_.u_mix,g.t);var w=n.tileExtent/n.tileSize/Math.pow(2,t.transform.tileZoom-n.coord.z),T=M.create();M.scale(T,T,[1/(x.size[0]*w*g.fromScale),1/(x.size[1]*w*g.fromScale)]);var S=M.create();M.scale(S,S,[1/(b.size[0]*w*g.toScale),1/(b.size[1]*w*g.toScale)]),u.uniformMatrix3fv(_.u_patternmatrix_a,!1,T),u.uniformMatrix3fv(_.u_patternmatrix_b,!1,S),t.spriteAtlas.bind(u,!0)}else _=t.fillShader,u.switchShader(_,i),u.uniform4fv(_.u_color,h);u.stencilFunc(u.NOTEQUAL,0,63),u.bindBuffer(u.ARRAY_BUFFER,t.tileExtentBuffer),u.vertexAttribPointer(_.a_pos,t.tileExtentBuffer.itemSize,u.SHORT,!1,0,0),u.drawArrays(u.TRIANGLE_STRIP,0,t.tileExtentBuffer.itemCount),u.stencilMask(0),u.stencilFunc(u.EQUAL,128,128)}}}},{"../util/browser":95,"gl-matrix":116}],30:[function(t,e,i){var j=t("../util/browser"),U=t("gl-matrix").mat2;e.exports=function(t,e,i,n){if(n.buffers){var r=n.elementGroups[e.ref||e.id];if(r){var o=t.gl;if(!(e.paint["line-width"]<=0)){var a=1/j.devicePixelRatio,s=e.paint["line-blur"]+a,l=e.paint["line-width"]/2,u=-1,c=0;0<e.paint["line-gap-width"]&&(u=e.paint["line-gap-width"]/2+.5*a,l=e.paint["line-width"],c=u-a/2);var h=c+l+a/2+0,p=e.paint["line-color"],f=t.transform.scale/(1<<n.coord.z)/(n.tileExtent/n.tileSize),d=t.translateMatrix(i,n,e.paint["line-translate"],e.paint["line-translate-anchor"]),m=t.transform,y=U.create();U.scale(y,y,[1,Math.cos(m._pitch)]),U.rotate(y,y,t.transform.angle);var _,g=Math.sqrt(m.height*m.height/4*(1+m.altitude*m.altitude)),v=(g+m.height/2*Math.tan(m._pitch))/g-1,x=n.tileSize/t.transform.tileSize,b=e.paint["line-dasharray"],w=e.paint["line-pattern"];if(b){_=t.linesdfpatternShader,o.switchShader(_,d,n.exMatrix),o.uniform2fv(_.u_linewidth,[h,u]),o.uniform1f(_.u_ratio,f),o.uniform1f(_.u_blur,s),o.uniform4fv(_.u_color,p);var T=t.lineAtlas.getDash(b.from,"round"===e.layout["line-cap"]),S=t.lineAtlas.getDash(b.to,"round"===e.layout["line-cap"]);t.lineAtlas.bind(o);var A=Math.pow(2,Math.floor(Math.log(t.transform.scale)/Math.LN2)-n.coord.z)/8*x,M=[A/T.width/b.fromScale,-T.height/2],E=t.lineAtlas.width/(b.fromScale*T.width*256*j.devicePixelRatio)/2,L=[A/S.width/b.toScale,-S.height/2],z=t.lineAtlas.width/(b.toScale*S.width*256*j.devicePixelRatio)/2;o.uniform2fv(_.u_patternscale_a,M),o.uniform1f(_.u_tex_y_a,T.y),o.uniform2fv(_.u_patternscale_b,L),o.uniform1f(_.u_tex_y_b,S.y),o.uniform1i(_.u_image,0),o.uniform1f(_.u_sdfgamma,Math.max(E,z)),o.uniform1f(_.u_mix,b.t),o.uniform1f(_.u_extra,v),o.uniformMatrix2fv(_.u_antialiasingmatrix,!1,y)}else if(w){var P=t.spriteAtlas.getPosition(w.from,!0),C=t.spriteAtlas.getPosition(w.to,!0);if(!P||!C)return;var I=n.tileExtent/n.tileSize/Math.pow(2,t.transform.tileZoom-n.coord.z)*x;t.spriteAtlas.bind(o,!0),_=t.linepatternShader,o.switchShader(_,d,n.exMatrix),o.uniform2fv(_.u_linewidth,[h,u]),o.uniform1f(_.u_ratio,f),o.uniform1f(_.u_blur,s),o.uniform2fv(_.u_pattern_size_a,[P.size[0]*I*w.fromScale,C.size[1]]),o.uniform2fv(_.u_pattern_size_b,[C.size[0]*I*w.toScale,C.size[1]]),o.uniform2fv(_.u_pattern_tl_a,P.tl),o.uniform2fv(_.u_pattern_br_a,P.br),o.uniform2fv(_.u_pattern_tl_b,C.tl),o.uniform2fv(_.u_pattern_br_b,C.br),o.uniform1f(_.u_fade,w.t),o.uniform1f(_.u_opacity,e.paint["line-opacity"]),o.uniform1f(_.u_extra,v),o.uniformMatrix2fv(_.u_antialiasingmatrix,!1,y)}else _=t.lineShader,o.switchShader(_,d,n.exMatrix),o.uniform2fv(_.u_linewidth,[h,u]),o.uniform1f(_.u_ratio,f),o.uniform1f(_.u_blur,s),o.uniform1f(_.u_extra,v),o.uniformMatrix2fv(_.u_antialiasingmatrix,!1,y),o.uniform4fv(_.u_color,p);var k=n.buffers.lineVertex;k.bind(o);var R=n.buffers.lineElement;R.bind(o);for(var D=0;D<r.groups.length;D++){var B=r.groups[D],O=B.vertexStartIndex*k.itemSize;o.vertexAttribPointer(_.a_pos,2,o.SHORT,!1,8,O+0),o.vertexAttribPointer(_.a_data,4,o.BYTE,!1,8,O+4);var F=3*B.elementLength,N=B.elementStartIndex*R.itemSize;o.drawElements(o.TRIANGLES,F,o.UNSIGNED_SHORT,N)}}}}}},{"../util/browser":95,"gl-matrix":116}],31:[function(t,e,i){var p=t("../util/util");e.exports=function(t,e,i,n){var r=t.gl;r.disable(r.STENCIL_TEST);var o,a,s=t.rasterShader;r.switchShader(s,i),r.uniform1f(s.u_brightness_low,e.paint["raster-brightness-min"]),r.uniform1f(s.u_brightness_high,e.paint["raster-brightness-max"]),r.uniform1f(s.u_saturation_factor,0<(a=e.paint["raster-saturation"])?1-1/(1.001-a):-a),r.uniform1f(s.u_contrast_factor,0<(o=e.paint["raster-contrast"])?1/(1-o):1+o),r.uniform3fv(s.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}(e.paint["raster-hue-rotate"]));var l,u,c=n.source&&n.source._pyramid.findLoadedParent(n.coord,0,{}),h=function(t,e,i,n){if(!t.source)return[1,0];var r=(new Date).getTime(),o=i.paint["raster-fade-duration"],a=(r-t.timeAdded)/o,s=e?(r-e.timeAdded)/o:-1,l=t.source._pyramid.coveringZoomLevel(n),u=!!e&&Math.abs(e.coord.z-l)>Math.abs(t.coord.z-l),c=[];c[1]=(c[0]=!e||u?p.clamp(a,0,1):p.clamp(1-s,0,1),1-c[0]);var h=i.paint["raster-opacity"];return c[0]*=h,c[1]*=h,c}(n,c,e,t.transform);r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n.texture),c?(r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,c.texture),l=Math.pow(2,c.coord.z-n.coord.z),u=[n.coord.x*l%1,n.coord.y*l%1]):h[1]=0,r.uniform2fv(s.u_tl_parent,u||[0,0]),r.uniform1f(s.u_scale_parent,l||1),r.uniform1f(s.u_buffer_scale,1),r.uniform1f(s.u_opacity0,h[0]),r.uniform1f(s.u_opacity1,h[1]),r.uniform1i(s.u_image0,0),r.uniform1i(s.u_image1,1),r.bindBuffer(r.ARRAY_BUFFER,n.boundsBuffer||t.tileExtentBuffer),r.vertexAttribPointer(s.a_pos,2,r.SHORT,!1,8,0),r.vertexAttribPointer(s.a_texture_pos,2,r.SHORT,!1,8,4),r.drawArrays(r.TRIANGLE_STRIP,0,4),r.enable(r.STENCIL_TEST)}},{"../util/util":106}],32:[function(t,e,i){function s(t,e,i,n,r,o,a){var s=t.gl;i=t.translateMatrix(i,n,e.paint[o+"-translate"],e.paint[o+"-translate-anchor"]);var l,u,c,h=t.transform,p="map"===e.layout[o+"-rotation-alignment"],f=p;c=f?(l=R.create(),u=n.tileExtent/n.tileSize/Math.pow(2,t.transform.zoom-n.coord.z),1/Math.cos(h._pitch)):(l=R.clone(n.exMatrix),u=t.transform.altitude,1),R.scale(l,l,[u,u,1]);var d=e.paint[o+"-size"],m=d/D[o];R.scale(l,l,[m,m,1]);var y,_,g,v,x=Math.sqrt(h.height*h.height/4*(1+h.altitude*h.altitude)),b=(x+h.height/2*Math.tan(h._pitch))/x-1,w="text"===o;if(w||t.style.sprite.loaded()){s.activeTexture(s.TEXTURE0),y=a?t.sdfShader:t.iconShader,v=w?(t.glyphAtlas.updateTexture(s),_=n.buffers.glyphVertex,g=n.buffers.glyphElement,[t.glyphAtlas.width/4,t.glyphAtlas.height/4]):(t.spriteAtlas.bind(s,p||t.options.rotating||t.options.zooming||1!==m||a||t.transform.pitch),_=n.buffers.iconVertex,g=n.buffers.iconElement,[t.spriteAtlas.width/4,t.spriteAtlas.height/4]),s.switchShader(y,i,l),s.uniform1i(y.u_texture,0),s.uniform2fv(y.u_texsize,v),s.uniform1i(y.u_skewed,f),s.uniform1f(y.u_extra,b);var T=Math.log(d/r[o+"-size"])/Math.LN2||0;s.uniform1f(y.u_zoom,10*(t.transform.zoom-T));var S,A,M,E,L=t.frameHistory.getFadeProperties(300);if(s.uniform1f(y.u_fadedist,10*L.fadedist),s.uniform1f(y.u_minfadezoom,Math.floor(10*L.minfadezoom)),s.uniform1f(y.u_maxfadezoom,Math.floor(10*L.maxfadezoom)),s.uniform1f(y.u_fadezoom,10*(t.transform.zoom+L.bump)),g.bind(s),a){var z=.105*D[o]/d/k.devicePixelRatio;s.uniform1f(y.u_gamma,z*c),s.uniform4fv(y.u_color,e.paint[o+"-color"]),s.uniform1f(y.u_buffer,.75);for(var P=0;P<r.groups.length;P++)A=(S=r.groups[P]).vertexStartIndex*_.itemSize,_.bind(s,y,A),M=3*S.elementLength,E=S.elementStartIndex*g.itemSize,s.drawElements(s.TRIANGLES,M,s.UNSIGNED_SHORT,E);if(e.paint[o+"-halo-width"]){s.uniform1f(y.u_gamma,(1.19*e.paint[o+"-halo-blur"]/m/8+z)*c),s.uniform4fv(y.u_color,e.paint[o+"-halo-color"]),s.uniform1f(y.u_buffer,(6-e.paint[o+"-halo-width"]/m)/8);for(var C=0;C<r.groups.length;C++)A=(S=r.groups[C]).vertexStartIndex*_.itemSize,_.bind(s,y,A),M=3*S.elementLength,E=S.elementStartIndex*g.itemSize,s.drawElements(s.TRIANGLES,M,s.UNSIGNED_SHORT,E)}}else{s.uniform1f(y.u_opacity,e.paint["icon-opacity"]);for(var I=0;I<r.groups.length;I++)A=(S=r.groups[I]).vertexStartIndex*_.itemSize,_.bind(s,y,A),M=3*S.elementLength,E=S.elementStartIndex*g.itemSize,s.drawElements(s.TRIANGLES,M,s.UNSIGNED_SHORT,E)}}}var k=t("../util/browser"),R=t("gl-matrix").mat4,l=t("./draw_collision_debug");e.exports=function(t,e,i,n){if(n.buffers){var r=n.elementGroups[e.ref||e.id];if(r){var o=!(e.layout["text-allow-overlap"]||e.layout["icon-allow-overlap"]||e.layout["text-ignore-placement"]||e.layout["icon-ignore-placement"]),a=t.gl;o&&a.disable(a.STENCIL_TEST),r.text.groups.length&&s(t,e,i,n,r.text,"text",!0),r.icon.groups.length&&s(t,e,i,n,r.icon,"icon",r.sdfIcons),l(t,e,i,n),o&&a.enable(a.STENCIL_TEST)}}};var D={icon:1,text:24}},{"../util/browser":95,"./draw_collision_debug":27,"gl-matrix":116}],33:[function(t,e,i){var c=t("../util/browser"),a=t("gl-matrix").mat4;e.exports=function(l,t,e,i){function n(t,e,i,n){u.switchShader(l.dotShader,i),u.uniform1f(l.dotShader.u_size,4*c.devicePixelRatio),u.uniform1f(l.dotShader.u_blur,.25),u.uniform4fv(l.dotShader.u_color,[.1,0,0,.1]),t.bind(u,l.dotShader,0);for(var r=0;r<e.length;r++){var o=e[r],a=o.vertexStartIndex,s=o.vertexLength;u.vertexAttribPointer(l.dotShader.a_pos,2,u.SHORT,!1,n,0),u.drawArrays(u.POINTS,a,s)}}var u=l.gl;if(i&&i.buffers){var r=i.elementGroups[t.ref||t.id];if(r){if(u.blendFunc(u.ONE,u.ONE_MINUS_SRC_ALPHA),"fill"===t.type)n(i.buffers.fillVertex,r.groups,e,4);else if("symbol"===t.type)n(i.buffers.iconVertex,r.icon.groups,e,16),n(i.buffers.glyphVertex,r.text.groups,e,16);else if("line"===t.type){var o=a.clone(e);a.scale(o,o,[.5,.5,1]),n(i.buffers.lineVertex,r.groups,o,8)}u.blendFunc(u.ONE_MINUS_DST_ALPHA,u.ONE)}}}},{"../util/browser":95,"gl-matrix":116}],34:[function(t,e,i){function n(){this.frameHistory=[]}(e.exports=n).prototype.getFadeProperties=function(t){void 0===t&&(t=300);for(var e=(new Date).getTime();3<this.frameHistory.length&&this.frameHistory[1].time+t<e;)this.frameHistory.shift();this.frameHistory[1].time+t<e&&(this.frameHistory[0].z=this.frameHistory[1].z);var i=this.frameHistory.length;i<3&&console.warn("there should never be less than three frames in the history");var n=this.frameHistory[0].z,r=this.frameHistory[i-1],o=r.z,a=Math.min(n,o),s=Math.max(n,o),l=(r.z-this.frameHistory[1].z)/((r.time-this.frameHistory[1].time)/t);return isNaN(l)&&console.warn("fadedist should never be NaN"),{fadedist:l,minfadezoom:a,maxfadezoom:s,bump:(e-r.time)/t*l}},n.prototype.record=function(t){var e=(new Date).getTime();this.frameHistory.length||this.frameHistory.push({time:0,z:t},{time:0,z:t}),(2===this.frameHistory.length||this.frameHistory[this.frameHistory.length-1].z!==t)&&this.frameHistory.push({time:e,z:t})}},{}],35:[function(t,e,i){var o=t("./shaders"),r=t("../util/util");i.extend=function(i){var e=i.lineWidth,n=i.getParameter(i.ALIASED_LINE_WIDTH_RANGE);return i.lineWidth=function(t){e.call(i,r.clamp(t,n[0],n[1]))},i.getShader=function(t,e){var i=e===this.FRAGMENT_SHADER?"fragment":"vertex";if(!o[t]||!o[t][i])throw new Error("Could not find shader "+t);var n=this.createShader(e),r=o[t][i];if("undefined"==typeof orientation&&(r=r.replace(/ highp /g," ")),this.shaderSource(n,r),this.compileShader(n),!this.getShaderParameter(n,this.COMPILE_STATUS))throw new Error(this.getShaderInfoLog(n));return n},i.initializeShader=function(t,e,i){var n={program:this.createProgram(),fragment:this.getShader(t,this.FRAGMENT_SHADER),vertex:this.getShader(t,this.VERTEX_SHADER),attributes:[]};if(this.attachShader(n.program,n.vertex),this.attachShader(n.program,n.fragment),this.linkProgram(n.program),this.getProgramParameter(n.program,this.LINK_STATUS)){for(var r=0;r<e.length;r++)n[e[r]]=this.getAttribLocation(n.program,e[r]),n.attributes.push(n[e[r]]);for(var o=0;o<i.length;o++)n[i[o]]=this.getUniformLocation(n.program,i[o])}else console.error(this.getProgramInfoLog(n.program));return n},i.switchShader=function(t,e,i){if(e||console.trace("posMatrix does not have required argument"),this.currentShader!==t){this.useProgram(t.program);for(var n=this.currentShader?this.currentShader.attributes:[],r=t.attributes,o=0;o<n.length;o++)r.indexOf(n[o])<0&&this.disableVertexAttribArray(n[o]);for(var a=0;a<r.length;a++)n.indexOf(r[a])<0&&this.enableVertexAttribArray(r[a]);this.currentShader=t}t.posMatrix!==e&&(this.uniformMatrix4fv(t.u_matrix,!1,e),t.posMatrix=e),i&&t.exMatrix!==i&&t.u_exmatrix&&(this.uniformMatrix4fv(t.u_exmatrix,!1,i),t.exMatrix=i)},i.vertexAttrib2fv=function(t,e){i.vertexAttrib2f(t,e[0],e[1])},i.vertexAttrib3fv=function(t,e){i.vertexAttrib3f(t,e[0],e[1],e[2])},i.vertexAttrib4fv=function(t,e){i.vertexAttrib4f(t,e[0],e[1],e[2],e[3])},i}},{"../util/util":106,"./shaders":38}],36:[function(t,e,i){function n(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}}(e.exports=n).prototype.setSprite=function(t){this.sprite=t},n.prototype.getDash=function(t,e){var i=t.join(",")+e;return this.positions[i]||(this.positions[i]=this.addDash(t,e)),this.positions[i]},n.prototype.addDash=function(t,e){var i=e?7:0,n=2*i+1;if(this.nextRow+n>this.height)return console.warn("LineAtlas out of space"),null;for(var r=0,o=0;o<t.length;o++)r+=t[o];for(var a=this.width/r,s=a/2,l=t.length%2==1,u=-i;u<=i;u++)for(var c=this.nextRow+i+u,h=this.width*c,p=l?-t[t.length-1]:0,f=t[0],d=1,m=0;m<this.width;m++){for(;f<m/a;)p=f,f+=t[d],l&&d===t.length-1&&(f+=t[0]),d++;var y,_=Math.abs(m-p*a),g=Math.abs(m-f*a),v=Math.min(_,g),x=d%2==1;if(e){var b=i?u/i*(s+1):0;if(x){var w=s-Math.abs(b);y=Math.sqrt(v*v+w*w)}else y=s-Math.sqrt(v*v+b*b)}else y=(x?1:-1)*v;this.data[3+4*(h+m)]=Math.max(0,Math.min(255,y+128))}var T={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:r};return this.nextRow+=n,this.dirty=!0,T},n.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},n.prototype.debug=function(){var t=document.createElement("canvas");document.body.appendChild(t),t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.background="#ff0",t.width=this.width,t.height=this.height;for(var e=t.getContext("2d"),i=e.getImageData(0,0,this.width,this.height),n=0;n<this.data.length;n++)if(this.sdf){var r=4*n;i.data[r]=i.data[r+1]=i.data[r+2]=0,i.data[r+3]=this.data[n]}else i.data[n]=this.data[n];e.putImageData(i,0,0)}},{}],37:[function(t,e,i){function n(t,e){this.gl=r.extend(t),this.transform=e,this.reusableTextures={},this.preFbos={},this.frameHistory=new a,this.setup()}var r=t("./gl_util"),o=t("../util/browser"),u=t("gl-matrix").mat4,a=t("./frame_history");(e.exports=n).prototype.resize=function(t,e){var i=this.gl;this.width=t*o.devicePixelRatio,this.height=e*o.devicePixelRatio,i.viewport(0,0,this.width,this.height)},n.prototype.setup=function(){var t=this.gl;t.verbose=!0,t.enable(t.BLEND),t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE),t.enable(t.STENCIL_TEST),this.debugShader=t.initializeShader("debug",["a_pos"],["u_matrix","u_color"]),this.rasterShader=t.initializeShader("raster",["a_pos","a_texture_pos"],["u_matrix","u_brightness_low","u_brightness_high","u_saturation_factor","u_spin_weights","u_contrast_factor","u_opacity0","u_opacity1","u_image0","u_image1","u_tl_parent","u_scale_parent","u_buffer_scale"]),this.circleShader=t.initializeShader("circle",["a_pos"],["u_matrix","u_exmatrix","u_blur","u_size","u_color"]),this.lineShader=t.initializeShader("line",["a_pos","a_data"],["u_matrix","u_linewidth","u_color","u_ratio","u_blur","u_extra","u_antialiasingmatrix"]),this.linepatternShader=t.initializeShader("linepattern",["a_pos","a_data"],["u_matrix","u_linewidth","u_ratio","u_pattern_size_a","u_pattern_size_b","u_pattern_tl_a","u_pattern_br_a","u_pattern_tl_b","u_pattern_br_b","u_blur","u_fade","u_opacity","u_extra","u_antialiasingmatrix"]),this.linesdfpatternShader=t.initializeShader("linesdfpattern",["a_pos","a_data"],["u_matrix","u_linewidth","u_color","u_ratio","u_blur","u_patternscale_a","u_tex_y_a","u_patternscale_b","u_tex_y_b","u_image","u_sdfgamma","u_mix","u_extra","u_antialiasingmatrix"]),this.dotShader=t.initializeShader("dot",["a_pos"],["u_matrix","u_size","u_color","u_blur"]),this.sdfShader=t.initializeShader("sdf",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_color","u_gamma","u_buffer","u_zoom","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom","u_skewed","u_extra"]),this.iconShader=t.initializeShader("icon",["a_pos","a_offset","a_data1","a_data2"],["u_matrix","u_exmatrix","u_texture","u_texsize","u_zoom","u_fadedist","u_minfadezoom","u_maxfadezoom","u_fadezoom","u_opacity","u_skewed","u_extra"]),this.outlineShader=t.initializeShader("outline",["a_pos"],["u_matrix","u_color","u_world"]),this.patternShader=t.initializeShader("pattern",["a_pos"],["u_matrix","u_pattern_tl_a","u_pattern_br_a","u_pattern_tl_b","u_pattern_br_b","u_mix","u_patternmatrix_a","u_patternmatrix_b","u_opacity","u_image"]),this.fillShader=t.initializeShader("fill",["a_pos"],["u_matrix","u_color"]),this.collisionBoxShader=t.initializeShader("collisionbox",["a_pos","a_extrude","a_data"],["u_matrix","u_scale","u_zoom","u_maxzoom"]),this.identityMatrix=u.create(),this.backgroundBuffer=t.createBuffer(),this.backgroundBuffer.itemSize=2,this.backgroundBuffer.itemCount=4,t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.bufferData(t.ARRAY_BUFFER,new Int16Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW),this.setExtent(4096),this.debugTextBuffer=t.createBuffer(),this.debugTextBuffer.itemSize=2},n.prototype.setExtent=function(t){if(t&&t!==this.tileExtent){this.tileExtent=t;var e=this.gl;this.tileExtentBuffer=e.createBuffer(),this.tileExtentBuffer.itemSize=4,this.tileExtentBuffer.itemCount=4,e.bindBuffer(e.ARRAY_BUFFER,this.tileExtentBuffer),e.bufferData(e.ARRAY_BUFFER,new Int16Array([0,0,0,0,this.tileExtent,0,32767,0,0,this.tileExtent,0,32767,this.tileExtent,this.tileExtent,32767,32767]),e.STATIC_DRAW),this.debugBuffer=e.createBuffer(),this.debugBuffer.itemSize=2,this.debugBuffer.itemCount=5,e.bindBuffer(e.ARRAY_BUFFER,this.debugBuffer),e.bufferData(e.ARRAY_BUFFER,new Int16Array([0,0,this.tileExtent-1,0,this.tileExtent-1,this.tileExtent-1,0,this.tileExtent-1,0,0]),e.STATIC_DRAW)}},n.prototype.clearColor=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},n.prototype.clearStencil=function(){var t=this.gl;t.clearStencil(0),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT)},n.prototype.drawClippingMask=function(t){var e=this.gl;e.switchShader(this.fillShader,t.posMatrix),e.colorMask(!1,!1,!1,!1),e.clearStencil(0),e.stencilMask(191),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.EQUAL,192,64),e.stencilMask(192),e.stencilOp(e.REPLACE,e.KEEP,e.KEEP),e.bindBuffer(e.ARRAY_BUFFER,this.tileExtentBuffer),e.vertexAttribPointer(this.fillShader.a_pos,this.tileExtentBuffer.itemSize,e.SHORT,!1,8,0),e.drawArrays(e.TRIANGLE_STRIP,0,this.tileExtentBuffer.itemCount),e.stencilFunc(e.EQUAL,128,128),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilMask(0),e.colorMask(!0,!0,!0,!0)},n.prototype.prepareBuffers=function(){},n.prototype.bindDefaultFramebuffer=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)};var s={symbol:t("./draw_symbol"),circle:t("./draw_circle"),line:t("./draw_line"),fill:t("./draw_fill"),raster:t("./draw_raster"),background:t("./draw_background"),debug:t("./draw_debug"),vertices:t("./draw_vertices")};n.prototype.render=function(t,e){this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.spriteAtlas=t.spriteAtlas,this.spriteAtlas.setSprite(t.sprite),this.glyphAtlas=t.glyphAtlas,this.glyphAtlas.bind(this.gl),this.frameHistory.record(this.transform.zoom),this.prepareBuffers(),this.clearColor();for(var i=t._groups.length-1;0<=i;i--){var n=t._groups[i],r=t.sources[n.source];r?(this.clearStencil(),r.render(n,this)):void 0===n.source&&this.drawLayers(n,this.identityMatrix)}},n.prototype.drawTile=function(t,e){this.setExtent(t.tileExtent),this.drawClippingMask(t),this.drawLayers(e,t.posMatrix,t),this.options.debug&&s.debug(this,t)},n.prototype.drawLayers=function(t,e,i){for(var n=t.length-1;0<=n;n--){var r=t[n];r.hidden||(s[r.type](this,r,e,i),this.options.vertices&&s.vertices(this,r,e,i))}},n.prototype.drawStencilBuffer=function(){var t=this.gl;t.switchShader(this.fillShader,this.identityMatrix),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.stencilMask(0),t.stencilFunc(t.EQUAL,128,128),t.bindBuffer(t.ARRAY_BUFFER,this.backgroundBuffer),t.vertexAttribPointer(this.fillShader.a_pos,this.backgroundBuffer.itemSize,t.SHORT,!1,0,0),t.uniform4fv(this.fillShader.u_color,[0,0,0,.5]),t.drawArrays(t.TRIANGLE_STRIP,0,this.tileExtentBuffer.itemCount),t.blendFunc(t.ONE_MINUS_DST_ALPHA,t.ONE)},n.prototype.translateMatrix=function(t,e,i,n){if(!i[0]&&!i[1])return t;if("viewport"===n){var r=Math.sin(-this.transform.angle),o=Math.cos(-this.transform.angle);i=[i[0]*o-i[1]*r,i[0]*r+i[1]*o]}var a=this.transform.scale/(1<<e.coord.z)/(e.tileExtent/e.tileSize),s=[i[0]/a,i[1]/a,0],l=new Float32Array(16);return u.translate(l,t,s),l},n.prototype.saveTexture=function(t){var e=this.reusableTextures[t.size];e?e.push(t):this.reusableTextures[t.size]=[t]},n.prototype.getTexture=function(t){var e=this.reusableTextures[t];return e&&0<e.length?e.pop():null}},{"../util/browser":95,"./draw_background":25,"./draw_circle":26,"./draw_debug":28,"./draw_fill":29,"./draw_line":30,"./draw_raster":31,"./draw_symbol":32,"./draw_vertices":33,"./frame_history":34,"./gl_util":35,"gl-matrix":116}],38:[function(t,e,i){e.exports={debug:{vertex:"precision mediump float;attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,step(32767.,a_pos.x),1);}",fragment:"precision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}"},dot:{vertex:"precision mediump float;uniform mat4 u_matrix;uniform float u_size;attribute vec2 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);gl_PointSize=u_size;}",fragment:"precision mediump float;uniform vec4 u_color;uniform float u_blur;void main(){float a,b;a=length(gl_PointCoord-.5);b=smoothstep(.5,.5-u_blur,a);gl_FragColor=u_color*b;}"},fill:{vertex:"precision mediump float;attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}",fragment:"precision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}"},circle:{vertex:"precision mediump float;uniform float u_size;attribute vec2 a_pos;uniform mat4 u_matrix,u_exmatrix;varying vec2 a;void main(){a=vec2(mod(a_pos,2.)*2.-1.);vec4 b=u_exmatrix*vec4(a*u_size,0,0);gl_Position=u_matrix*vec4(floor(a_pos*.5),0,1);gl_Position+=b*gl_Position.w;}",fragment:"precision mediump float;uniform vec4 u_color;uniform float u_blur,u_size;varying vec2 a;void main(){float b=smoothstep(1.-u_blur,1.,length(a));gl_FragColor=u_color*(1.-b);}"},line:{vertex:"precision mediump float;attribute vec2 a_pos;attribute vec4 a_data;uniform highp mat4 u_matrix;uniform float u_ratio,u_extra;uniform vec2 u_linewidth;uniform mat2 u_antialiasingmatrix;varying vec2 a;varying float b,c;void main(){vec2 d,e;d=a_data.xy;e=mod(a_pos,2.);e.y=sign(e.y-.5);a=e;vec4 f=vec4(u_linewidth.s*d*.015873016,0,0);gl_Position=u_matrix*vec4(floor(a_pos*.5)+f.xy/u_ratio,0,1);float g,h,i;g=gl_Position.y/gl_Position.w;h=length(d)/length(u_antialiasingmatrix*d);i=1./(1.-min(g*u_extra,.9));c=i*h;}",fragment:"precision mediump float;uniform vec2 u_linewidth;uniform vec4 u_color;uniform float u_blur;varying vec2 a;varying float b,c;void main(){float d,e,f;d=length(a)*u_linewidth.s;e=u_blur*c;f=clamp(min(d-(u_linewidth.t-e),u_linewidth.s-d)/e,0.,1.);gl_FragColor=u_color*f;}"},linepattern:{vertex:"precision mediump float;attribute vec2 a_pos;attribute vec4 a_data;uniform highp mat4 u_matrix;uniform float u_ratio,u_extra;uniform vec2 u_linewidth;uniform vec4 u_color;uniform mat2 u_antialiasingmatrix;varying vec2 a;varying float b,c;void main(){vec2 d,f,g,h;d=a_data.xy;float e,i,j,k;e=a_data.z*128.+a_data.w;f=mod(a_pos,2.);f.y=sign(f.y-.5);a=f;g=d*.015873016;h=u_linewidth.s*g;gl_Position=u_matrix*vec4(floor(a_pos*.5)+h.xy/u_ratio,0,1);b=e;i=gl_Position.y/gl_Position.w;j=length(d)/length(u_antialiasingmatrix*d);k=1./(1.-min(i*u_extra,.9));c=k*j;}",fragment:"precision mediump float;uniform vec2 u_linewidth,u_pattern_size_a,u_pattern_size_b,u_pattern_tl_a,u_pattern_br_a,u_pattern_tl_b,u_pattern_br_b;uniform float u_point,u_blur,u_fade,u_opacity;uniform sampler2D u_image;varying vec2 a;varying float b,c;void main(){float d,e,f,g,h,i,j;d=length(a)*u_linewidth.s;e=u_blur*c;f=clamp(min(d-(u_linewidth.t-e),u_linewidth.s-d)/e,0.,1.);g=mod(b/u_pattern_size_a.x,1.);h=mod(b/u_pattern_size_b.x,1.);i=.5+a.y*u_linewidth.s/u_pattern_size_a.y;j=.5+a.y*u_linewidth.s/u_pattern_size_b.y;vec2 k,l;k=mix(u_pattern_tl_a,u_pattern_br_a,vec2(g,i));l=mix(u_pattern_tl_b,u_pattern_br_b,vec2(h,j));vec4 m=mix(texture2D(u_image,k),texture2D(u_image,l),u_fade);f*=u_opacity;gl_FragColor=m*f;}"},linesdfpattern:{vertex:"precision mediump float;attribute vec2 a_pos;attribute vec4 a_data;uniform highp mat4 u_matrix;uniform vec2 u_linewidth,u_patternscale_a,u_patternscale_b;uniform float u_ratio,u_tex_y_a,u_tex_y_b,u_extra;uniform mat2 u_antialiasingmatrix;varying vec2 a,b,c;varying float d;void main(){vec2 e,g;e=a_data.xy;float f,i,j,k;f=a_data.z*128.+a_data.w;g=mod(a_pos,2.);g.y=sign(g.y-.5);a=g;vec4 h=vec4(u_linewidth.s*e*.015873016,0,0);gl_Position=u_matrix*vec4(floor(a_pos*.5)+h.xy/u_ratio,0,1);b=vec2(f*u_patternscale_a.x,g.y*u_patternscale_a.y+u_tex_y_a);c=vec2(f*u_patternscale_b.x,g.y*u_patternscale_b.y+u_tex_y_b);i=gl_Position.y/gl_Position.w;j=length(e)/length(u_antialiasingmatrix*e);k=1./(1.-min(i*u_extra,.9));d=k*j;}",fragment:"precision mediump float;uniform vec2 u_linewidth;uniform vec4 u_color;uniform float u_blur,u_sdfgamma,u_mix;uniform sampler2D u_image;varying vec2 a,b,c;varying float d;void main(){float e,f,g,h,i,j;e=length(a)*u_linewidth.s;f=u_blur*d;g=clamp(min(e-(u_linewidth.t-f),u_linewidth.s-e)/f,0.,1.);h=texture2D(u_image,b).a;i=texture2D(u_image,c).a;j=mix(h,i,u_mix);g*=smoothstep(.5-u_sdfgamma,.5+u_sdfgamma,j);gl_FragColor=u_color*g;}"},outline:{vertex:"precision mediump float;attribute vec2 a_pos;uniform highp mat4 u_matrix;uniform vec2 u_world;varying vec2 a;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);a=(gl_Position.xy/gl_Position.w+1.)/2.*u_world;}",fragment:"precision mediump float;uniform vec4 u_color;varying vec2 a;void main(){float b,c;b=length(a-gl_FragCoord.xy);c=smoothstep(1.,0.,b);gl_FragColor=u_color*c;}"},pattern:{vertex:"precision mediump float;uniform mat4 u_matrix;uniform mat3 u_patternmatrix_a,u_patternmatrix_b;attribute vec2 a_pos;varying vec2 a,b;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);a=(u_patternmatrix_a*vec3(a_pos,1)).xy;b=(u_patternmatrix_b*vec3(a_pos,1)).xy;}",fragment:"precision mediump float;uniform float u_opacity,u_mix;uniform vec2 u_pattern_tl_a,u_pattern_br_a,u_pattern_tl_b,u_pattern_br_b;uniform sampler2D u_image;varying vec2 a,b;void main(){vec2 c,d,f,g;c=mod(a,1.);d=mix(u_pattern_tl_a,u_pattern_br_a,c);vec4 e,h;e=texture2D(u_image,d);f=mod(b,1.);g=mix(u_pattern_tl_b,u_pattern_br_b,f);h=texture2D(u_image,g);gl_FragColor=mix(e,h,u_mix)*u_opacity;}"},raster:{vertex:"precision mediump float;uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent,u_buffer_scale;attribute vec2 a_pos,a_texture_pos;varying vec2 a,b;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);a=(a_texture_pos/32767.-.5)/u_buffer_scale+.5;b=a*u_scale_parent+u_tl_parent;}",fragment:"precision mediump float;uniform float u_opacity0,u_opacity1,u_brightness_low,u_brightness_high,u_saturation_factor,u_contrast_factor;uniform sampler2D u_image0,u_image1;varying vec2 a,b;uniform vec3 u_spin_weights;void main(){vec4 c,d,e;c=texture2D(u_image0,a);d=texture2D(u_image1,b);e=c*u_opacity0+d*u_opacity1;vec3 f,h,i;f=e.rgb;f=vec3(dot(f,u_spin_weights.xyz),dot(f,u_spin_weights.zxy),dot(f,u_spin_weights.yzx));float g=(e.r+e.g+e.b)/3.;f+=(g-f)*u_saturation_factor;f=(f-.5)*u_contrast_factor+.5;h=vec3(u_brightness_low);i=vec3(u_brightness_high);gl_FragColor=vec4(mix(h,i,f),e.a);}"},icon:{vertex:"precision mediump float;attribute vec2 a_pos,a_offset;attribute vec4 a_data1,a_data2;uniform highp mat4 u_matrix;uniform mat4 u_exmatrix;uniform float u_zoom,u_fadedist,u_minfadezoom,u_maxfadezoom,u_fadezoom,u_opacity,u_extra;uniform bool u_skewed;uniform vec2 u_texsize;varying vec2 a;varying float b;void main(){vec2 c,e;c=a_data1.xy;float d,f,g,h,i,j;d=a_data1[2];e=a_data2.st;f=e[0];g=e[1];h=10.;i=2.-step(f,u_zoom)-(1.-step(g,u_zoom));j=clamp((u_fadezoom-d)/u_fadedist,0.,1.);if(u_fadedist>=0.)b=j;else b=1.-j;if(u_maxfadezoom<d)b=0.;if(u_minfadezoom>=d)b=1.;i+=step(b,0.);if(u_skewed){vec4 k=u_exmatrix*vec4(a_offset/64.,0,0);gl_Position=u_matrix*vec4(a_pos+k.xy,0,1);gl_Position.z+=i*gl_Position.w;}else{vec4 k=u_exmatrix*vec4(a_offset/64.,i,0);gl_Position=u_matrix*vec4(a_pos,0,1)+k;}a=c/u_texsize;b*=u_opacity;}",fragment:"precision mediump float;uniform sampler2D u_texture;varying vec2 a;varying float b;void main(){gl_FragColor=texture2D(u_texture,a)*b;}"},sdf:{vertex:"precision mediump float;attribute vec2 a_pos,a_offset;attribute vec4 a_data1,a_data2;uniform highp mat4 u_matrix;uniform mat4 u_exmatrix;uniform float u_zoom,u_fadedist,u_minfadezoom,u_maxfadezoom,u_fadezoom,u_extra;uniform bool u_skewed;uniform vec2 u_texsize;varying vec2 a;varying float b,c;void main(){vec2 d,f;d=a_data1.xy;float e,g,h,i,j,k,l;e=a_data1[2];f=a_data2.st;g=f[0];h=f[1];i=2.-step(g,u_zoom)-(1.-step(h,u_zoom));j=clamp((u_fadezoom-e)/u_fadedist,0.,1.);if(u_fadedist>=0.)b=j;else b=1.-j;if(u_maxfadezoom<e)b=0.;if(u_minfadezoom>=e)b=1.;i+=step(b,0.);if(u_skewed){vec4 k=u_exmatrix*vec4(a_offset/64.,0,0);gl_Position=u_matrix*vec4(a_pos+k.xy,0,1);gl_Position.z+=i*gl_Position.w;}else{vec4 k=u_exmatrix*vec4(a_offset/64.,i,0);gl_Position=u_matrix*vec4(a_pos,0,1)+k;}k=gl_Position.y/gl_Position.w;l=1./(1.-k*u_extra);c=l;a=d/u_texsize;}",fragment:"precision mediump float;uniform sampler2D u_texture;uniform vec4 u_color;uniform float u_buffer,u_gamma;varying vec2 a;varying float b,c;void main(){float d,e,f;d=u_gamma*c;e=texture2D(u_texture,a).a;f=smoothstep(u_buffer-d,u_buffer+d,e)*b;gl_FragColor=u_color*f;}"},collisionbox:{vertex:"precision mediump float;attribute vec2 a_pos,a_extrude,a_data;uniform mat4 u_matrix;uniform float u_scale;varying float a,b;void main(){gl_Position=u_matrix*vec4(a_pos+a_extrude/u_scale,0,1);a=a_data.x;b=a_data.y;}",fragment:"precision mediump float;uniform float u_zoom,u_maxzoom;varying float a,b;void main(){float c=.5;gl_FragColor=vec4(0,1,0,1)*c;if(b>u_zoom)gl_FragColor=vec4(1,0,0,1)*c;if(u_zoom>=a)gl_FragColor=vec4(0,0,0,1)*c*.25;if(b>=u_maxzoom)gl_FragColor=vec4(0,0,1,1)*c*.2;}"}}},{}],39:[function(t,e,i){function n(t){t=t||{},this._data=t.data,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),this.geojsonVtOptions={maxZoom:this.maxzoom},void 0!==t.buffer&&(this.geojsonVtOptions.buffer=t.buffer),void 0!==t.tolerance&&(this.geojsonVtOptions.tolerance=t.tolerance),this._pyramid=new a({tileSize:512,minzoom:this.minzoom,maxzoom:this.maxzoom,cacheSize:20,load:this._loadTile.bind(this),abort:this._abortTile.bind(this),unload:this._unloadTile.bind(this),add:this._addTile.bind(this),remove:this._removeTile.bind(this)})}var r=t("../util/util"),o=t("../util/evented"),a=t("./tile_pyramid"),s=t("./source"),l=t("resolve-url");(e.exports=n).prototype=r.inherit(o,{minzoom:0,maxzoom:14,_dirty:!0,setData:function(t){return this._data=t,this._dirty=!0,this.fire("change"),this.map&&this.update(this.map.transform),this},onAdd:function(t){this.map=t},loaded:function(){return this._loaded&&this._pyramid.loaded()},update:function(t){this._dirty&&this._updateData(),this._loaded&&this._pyramid.update(this.used,t)},reload:function(){this._loaded&&this._pyramid.reload()},render:s._renderTiles,featuresAt:s._vectorFeaturesAt,featuresIn:s._vectorFeaturesIn,_updateData:function(){this._dirty=!1;var t=this._data;"string"==typeof t&&(t=l(window.location.href,t)),this.workerID=this.dispatcher.send("parse geojson",{data:t,tileSize:512,source:this.id,geojsonVtOptions:this.geojsonVtOptions},function(t){return t?void this.fire("error",{error:t}):(this._loaded=!0,this._pyramid.reload(),void this.fire("change"))}.bind(this))},_loadTile:function(i){var t=i.coord.z>this.maxzoom?Math.pow(2,i.coord.z-this.maxzoom):1,e={uid:i.uid,coord:i.coord,zoom:i.coord.z,maxZoom:this.maxzoom,tileSize:512,source:this.id,overscaling:t,angle:this.map.transform.angle,pitch:this.map.transform.pitch,collisionDebug:this.map.collisionDebug};i.workerID=this.dispatcher.send("load geojson tile",e,function(t,e){if(i.unloadVectorData(this.map.painter),!i.aborted){if(t)return void this.fire("tile.error",{tile:i});i.loadVectorData(e),this.fire("tile.load",{tile:i})}}.bind(this),this.workerID)},_abortTile:function(t){t.aborted=!0},_addTile:function(t){this.fire("tile.add",{tile:t})},_removeTile:function(t){this.fire("tile.remove",{tile:t})},_unloadTile:function(t){t.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(t.uid),this.dispatcher.send("remove tile",{uid:t.uid,source:this.id},null,t.workerID)}})},{"../util/evented":100,"../util/util":106,"./source":43,"./tile_pyramid":46,"resolve-url":140}],40:[function(t,e,i){function n(t){this.features=t,this.length=t.length}function r(t){this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=4096}var o=t("point-geometry"),a=t("vector-tile").VectorTileFeature;(e.exports=n).prototype.feature=function(t){return new r(this.features[t])},r.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new o(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},r.prototype.toGeoJSON=a.prototype.toGeoJSON},{"point-geometry":137,"vector-tile":144}],41:[function(t,e,i){function n(t){this.coordinates=t.coordinates,o.getImage(t.url,function(t,e){t||(this.image=e,this.image.addEventListener("load",function(){this.map._rerender()}.bind(this)),this._loaded=!0,this.map&&(this.createTile(),this.fire("change")))}.bind(this))}var a=t("../util/util"),s=t("./tile"),l=t("../geo/lng_lat"),u=t("point-geometry"),r=t("../util/evented"),o=t("../util/ajax");(e.exports=n).prototype=a.inherit(r,{onAdd:function(t){this.map=t,this.image&&this.createTile()},createTile:function(){var i=this.map,t=this.coordinates.map(function(t){var e=l.convert(t);return i.transform.locationCoordinate(e).zoomTo(0)}),n=a.getCoordinatesCenter(t),e=t.map(function(t){var e=t.zoomTo(n.zoom);return new u(Math.round(4096*(e.column-n.column)),Math.round(4096*(e.row-n.row)))}),r=i.painter.gl,o=new Int16Array([e[0].x,e[0].y,0,0,e[1].x,e[1].y,32767,0,e[3].x,e[3].y,0,32767,e[2].x,e[2].y,32767,32767]);this.tile=new s,this.tile.buckets={},this.tile.boundsBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.tile.boundsBuffer),r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW),this.center=n},loaded:function(){return this.image&&this.image.complete},update:function(){},reload:function(){},render:function(t,e){if(this._loaded&&this.loaded()){var i=this.center;this.tile.calculateMatrices(i.zoom,i.column,i.row,this.map.transform,e);var n=e.gl;this.tile.texture?(n.bindTexture(n.TEXTURE_2D,this.tile.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.image)):(this.tile.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.tile.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.image)),e.drawLayers(t,this.tile.posMatrix,this.tile)}},featuresAt:function(t,e,i){return i(null,[])}})},{"../geo/lng_lat":20,"../util/ajax":94,"../util/evented":100,"../util/util":106,"./tile":44,"point-geometry":137}],42:[function(t,e,i){function n(t){r.extend(this,r.pick(t,["url","tileSize"])),s._loadTileJSON.call(this,t)}var r=t("../util/util"),o=t("../util/ajax"),a=t("../util/evented"),s=t("./source"),l=t("../util/mapbox").normalizeTileURL;(e.exports=n).prototype=r.inherit(a,{minzoom:0,maxzoom:22,roundZoom:!0,tileSize:512,_loaded:!1,onAdd:function(t){this.map=t},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(t){this._pyramid&&this._pyramid.update(this.used,t,this.map.style.rasterFadeDuration)},reload:function(){},render:s._renderTiles,_loadTile:function(n){var t=l(n.coord.url(this.tiles),this.url);n.request=o.getImage(t,function(t,e){if(delete n.request,!n.aborted){if(t)return void this.fire("tile.error",{tile:n});var i=this.map.painter.gl;n.texture=this.map.painter.getTexture(e.width),n.texture?(i.bindTexture(i.TEXTURE_2D,n.texture),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,e)):(n.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,n.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),n.texture.size=e.width),i.generateMipmap(i.TEXTURE_2D),n.timeAdded=(new Date).getTime(),this.map.animationLoop.set(this.style.rasterFadeDuration),n.source=this,n.loaded=!0,this.fire("tile.load",{tile:n})}}.bind(this))},_abortTile:function(t){t.aborted=!0,t.request&&(t.request.abort(),delete t.request)},_addTile:function(t){this.fire("tile.add",{tile:t})},_removeTile:function(t){this.fire("tile.remove",{tile:t})},_unloadTile:function(t){t.texture&&this.map.painter.saveTexture(t.texture)},featuresAt:function(t,e,i){i(null,[])},featuresIn:function(t,e,i){i(null,[])}})},{"../util/ajax":94,"../util/evented":100,"../util/mapbox":103,"../util/util":106,"./source":43}],43:[function(n,t,e){var r=n("../util/util"),o=n("../util/ajax"),a=n("../util/browser"),s=n("./tile_pyramid"),c=n("./tile_coord"),l=n("../util/mapbox").normalizeSourceURL;e._loadTileJSON=function(t){var i=function(t){this._pyramid=new s({index:t,tileSize:this.tileSize,cacheSize:20,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom,reparseOverscaled:this.reparseOverscaled,load:this._loadTile.bind(this),abort:this._abortTile.bind(this),unload:this._unloadTile.bind(this),add:this._addTile.bind(this),remove:this._removeTile.bind(this),redoPlacement:this._redoTilePlacement?this._redoTilePlacement.bind(this):void 0})}.bind(this),e=function(t,e){return t?void this.fire("error",{error:t}):(r.extend(this,r.pick(e,["tiles","minzoom","maxzoom","attribution"])),void(e.index?o.getJSON(l(e.index),function(t,e){return t?void this.fire("error",{error:t}):(i(e.index),void this.fire("load"))}.bind(this)):(i(),this.fire("load"))))}.bind(this);t.url?o.getJSON(l(t.url),e):a.frame(e.bind(this,null,t))},e._renderTiles=function(t,e){if(this._pyramid)for(var i=this._pyramid.renderedIDs(),n=0;n<i.length;n++){var r=this._pyramid.getTile(i[n]),o=c.fromID(i[n]),a=o.z,s=o.x,l=o.y,u=o.w;a=Math.min(a,this.maxzoom),(4096<r.tileExtent||r.parentId)&&(r.tileExtent=4096),s+=u*(1<<a),r.calculateMatrices(a,s,l,e.transform,e),e.drawTile(r,t)}},e._vectorFeaturesAt=function(t,e,i){if(!this._pyramid)return i(null,[]);var n=this._pyramid.tileAt(t);return n?void this.dispatcher.send("query features",{uid:n.tile.uid,x:n.x,y:n.y,tileExtent:n.tile.tileExtent,scale:n.scale,source:this.id,params:e},i,n.tile.workerID):i(null,[])},e._vectorFeaturesIn=function(t,i,n){if(!this._pyramid)return n(null,[]);var e=this._pyramid.tilesIn(t);return e?void r.asyncAll(e,function(t,e){this.dispatcher.send("query features",{uid:t.tile.uid,source:this.id,minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,params:i},e,t.tile.workerID)}.bind(this),function(t,e){n(t,Array.prototype.concat.apply([],e))}):n(null,[])},e.create=function(t){var e={vector:n("./vector_tile_source"),raster:n("./raster_tile_source"),geojson:n("./geojson_source"),video:n("./video_source"),image:n("./image_source")};for(var i in e)if(t instanceof e[i])return t;return new e[t.type](t)}},{"../util/ajax":94,"../util/browser":95,"../util/mapbox":103,"../util/util":106,"./geojson_source":39,"./image_source":41,"./raster_tile_source":42,"./tile_coord":45,"./tile_pyramid":46,"./vector_tile_source":47,"./video_source":48}],44:[function(t,e,i){function n(t,e){this.coord=t,this.uid=o.uniqueId(),this.loaded=!1,this.uses=0,this.tileSize=e}var r=t("gl-matrix"),a=r.mat2,s=r.mat4,o=t("../util/util"),l=t("../data/buffer/buffer_set");(e.exports=n).prototype={tileExtent:4096,calculateMatrices:function(t,e,i,n){var r=Math.pow(2,t),o=n.worldSize/r;this.scale=o,this.posMatrix=new Float64Array(16),s.identity(this.posMatrix),s.translate(this.posMatrix,this.posMatrix,[e*o,i*o,0]),s.scale(this.posMatrix,this.posMatrix,[o/this.tileExtent,o/this.tileExtent,1]),s.multiply(this.posMatrix,n.getProjMatrix(),this.posMatrix),this.exMatrix=s.create(),s.ortho(this.exMatrix,0,n.width,n.height,0,0,-1),this.rotationMatrix=a.create(),a.rotate(this.rotationMatrix,this.rotationMatrix,n.angle),this.posMatrix=new Float32Array(this.posMatrix)},positionAt:function(t,e){return{x:((t=t.zoomTo(Math.min(this.coord.z,e))).column-this.coord.x)*this.tileExtent,y:(t.row-this.coord.y)*this.tileExtent,scale:this.scale}},loadVectorData:function(t){this.loaded=!0,t&&(this.buffers=new l(t.buffers),this.elementGroups=t.elementGroups,this.tileExtent=t.extent)},reloadSymbolData:function(t,e){if(this.buffers){this.buffers.glyphVertex.destroy(e.gl),this.buffers.glyphElement.destroy(e.gl),this.buffers.iconVertex.destroy(e.gl),this.buffers.iconElement.destroy(e.gl),this.buffers.collisionBoxVertex.destroy(e.gl);var i=new l(t.buffers);for(var n in this.buffers.glyphVertex=i.glyphVertex,this.buffers.glyphElement=i.glyphElement,this.buffers.iconVertex=i.iconVertex,this.buffers.iconElement=i.iconElement,this.buffers.collisionBoxVertex=i.collisionBoxVertex,t.elementGroups)this.elementGroups[n]=t.elementGroups[n]}},unloadVectorData:function(t){for(var e in this.buffers)this.buffers[e].destroy(t.gl);this.buffers=null}}},{"../data/buffer/buffer_set":2,"../util/util":106,"gl-matrix":116}],45:[function(t,e,i){function l(t,e,i,n){isNaN(n)&&(n=0),this.z=+t,this.x=+e,this.y=+i,this.w=+n,(n*=2)<0&&(n=-1*n-1);var r=1<<this.z;this.id=32*(r*r*n+r*this.y+this.x)+this.z}function c(t,e){if(t.row>e.row){var i=t;t=e,e=i}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function h(t,e,i,n,r){var o=Math.max(i,Math.floor(e.y0)),a=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,u=e.dx/e.dy,c=0<t.dx,h=e.dx<0,p=o;p<a;p++){var f=l*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,d=u*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;r(Math.floor(d),Math.ceil(f),p)}}function n(t,e,i,n,r,o){var a,s=c(t,e),l=c(e,i),u=c(i,t);s.dy>l.dy&&(a=s,s=l,l=a),s.dy>u.dy&&(a=s,s=u,u=a),l.dy>u.dy&&(a=l,l=u,u=a),s.dy&&h(u,s,n,r,o),l.dy&&h(u,l,n,r,o)}(e.exports=l).prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},l.fromID=function(t){var e=t%32,i=1<<e,n=(t-e)/32,r=n%i,o=(n-r)/i%i,a=Math.floor(n/(i*i));return a%2!=0&&(a=-1*a-1),new l(e,r,o,a/=2)},l.prototype.url=function(t,e){return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,e||this.z)).replace("{x}",this.x).replace("{y}",this.y)},l.prototype.parent=function(t){return 0===this.z?null:this.z>t?new l(this.z-1,this.x,this.y,this.w):new l(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},l.prototype.wrapped=function(){return new l(this.z,this.x,this.y,0)},l.prototype.children=function(t){if(this.z>=t)return[new l(this.z+1,this.x,this.y,this.w)];var e=this.z+1,i=2*this.x,n=2*this.y;return[new l(e,i,n,this.w),new l(e,i+1,n,this.w),new l(e,i,n+1,this.w),new l(e,i+1,n+1,this.w)]},l.cover=function(t,e,o){function i(t,e,i){var n,r;if(0<=i&&i<=a)for(n=t;n<e;n++)r=new l(o,(n%a+a)%a,i,Math.floor(n/a)),s[r.id]=r}var a=1<<t,s={};return n(e[0],e[1],e[2],0,a,i),n(e[2],e[3],e[0],0,a,i),Object.keys(s).map(function(t){return s[t]})}},{}],46:[function(t,e,i){function n(t){this.tileSize=t.tileSize,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.roundZoom=t.roundZoom,this.reparseOverscaled=t.reparseOverscaled,this.index=t.index,this._load=t.load,this._abort=t.abort,this._unload=t.unload,this._add=t.add,this._remove=t.remove,this._redoPlacement=t.redoPlacement,this._tiles={},this._cache=new r(t.cacheSize,function(t){return this._unload(t)}.bind(this))}var o=t("./tile"),d=t("./tile_coord"),a=t("point-geometry"),r=t("../util/mru_cache"),m=t("../util/util");(e.exports=n).prototype={loaded:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0},orderedIDs:function(){return Object.keys(this._tiles).sort(function(t,e){return e%32-t%32}).map(function(t){return+t})},renderedIDs:function(){return this.orderedIDs().filter(function(t){return this._tiles[t].loaded&&!this._coveredTiles[t]}.bind(this))},reload:function(){for(var t in this._cache.reset(),this._tiles)this._load(this._tiles[t])},getTile:function(t){return this._tiles[t]},getZoom:function(t){return t.zoom+Math.log(t.tileSize/this.tileSize)/Math.LN2},coveringZoomLevel:function(t){return(this.roundZoom?Math.round:Math.floor)(this.getZoom(t))},coveringTiles:function(t){var e=this.coveringZoomLevel(t),i=e;if(e<this.minzoom)return[];e>this.maxzoom&&(e=this.maxzoom);var n=t,r=n.locationCoordinate(n.center)._zoomTo(e),o=new a(r.column-.5,r.row-.5);return d.cover(e,[n.pointCoordinate(new a(0,0))._zoomTo(e),n.pointCoordinate(new a(n.width,0))._zoomTo(e),n.pointCoordinate(new a(n.width,n.height))._zoomTo(e),n.pointCoordinate(new a(0,n.height))._zoomTo(e)],this.reparseOverscaled?i:e).sort(function(t,e){return o.dist(t)-o.dist(e)})},findLoadedChildren:function(t,e,i){for(var n=!0,r=t.z,o=t.children(this.maxzoom),a=0;a<o.length;a++){var s=o[a].id;this._tiles[s]&&this._tiles[s].loaded?i[s]=!0:(n=!1,r<e&&this.findLoadedChildren(o[a],e,i))}return n},findLoadedParent:function(t,e,i){for(var n=t.z-1;e<=n;n--){t=t.parent(this.maxzoom);var r=this._tiles[t.id];if(r&&r.loaded)return i[t.id]=!0,r}},update:function(t,e,i){var n,r,o,a=(this.roundZoom?Math.round:Math.floor)(this.getZoom(e)),s=m.clamp(a-10,this.minzoom,this.maxzoom),l=m.clamp(a+1,this.minzoom,this.maxzoom),u={},c=(new Date).getTime();this._coveredTiles={};var h=t?this.coveringTiles(e):[];for(n=0;n<h.length;n++)r=h[n],o=this.addTile(r),u[r.id]=!0,o.loaded||this.findLoadedChildren(r,l,u)||this.findLoadedParent(r,s,u);for(var p in u)r=d.fromID(p),(o=this._tiles[p])&&o.timeAdded>c-(i||0)&&(this.findLoadedChildren(r,l,u)?(this._coveredTiles[p]=!0,u[p]=!0):this.findLoadedParent(r,s,u));var f=m.keysDifference(this._tiles,u);for(n=0;n<f.length;n++)this.removeTile(+f[n])},addTile:function(t){var e=this._tiles[t.id];if(e)return e;var i=t.wrapped();if((e=this._tiles[i.id])||(e=this._cache.get(i.id))&&this._redoPlacement&&this._redoPlacement(e),!e){var n=t.z,r=n>this.maxzoom?Math.pow(2,n-this.maxzoom):1;e=new o(i,this.tileSize*r),this.index&&(e.parentId=this.indexSearch(t.id)),this._load(e)}return e.uses++,this._tiles[t.id]=e,this._add(e,t),e},removeTile:function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._remove(e),0<e.uses||(e.loaded?this._cache.add(e.coord.wrapped().id,e):(this._abort(e),this._unload(e))))},clearTiles:function(){for(var t in this._tiles)this.removeTile(t);this._cache.reset()},tileAt:function(t){for(var e=this.orderedIDs(),i=0;i<e.length;i++){var n=this._tiles[e[i]],r=n.positionAt(t,this.maxzoom);if(r&&0<=r.x&&r.x<n.tileExtent&&0<=r.y&&r.y<n.tileExtent)return{tile:n,x:r.x,y:r.y,scale:r.scale}}},tilesIn:function(t){for(var e=[],i=this.orderedIDs(),n=0;n<i.length;n++){var r=this._tiles[i[n]],o=[r.positionAt(t[0],this.maxzoom),r.positionAt(t[1],this.maxzoom)];o[0].x<r.tileExtent&&o[0].y<r.tileExtent&&0<=o[1].x&&0<=o[1].y&&e.push({tile:r,minX:o[0].x,maxX:o[1].x,minY:o[0].y,maxY:o[1].y})}return e},indexSearch:function(t){for(var e=d.fromID(t),i=[t],n=e;0!==n.z;)n=n.parent(),i.push(n.id);for(var r,o=this.index,a=i.pop(),s=function(t){return t.id};i.length;)if(t=i.pop(),r=(e=d.fromID(a)).children(this.maxzoom).map(s).indexOf(t),o){if(0===o[r]){a=t;break}if(1===o[r]){a=t;break}a=t,o=o[r]}return 0===i.length?null:a}}},{"../util/mru_cache":104,"../util/util":106,"./tile":44,"./tile_coord":45,"point-geometry":137}],47:[function(t,e,i){function n(t){if(r.extend(this,r.pick(t,["url","tileSize"])),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");a._loadTileJSON.call(this,t)}var r=t("../util/util"),o=t("../util/evented"),a=t("./source"),s=t("./tile_coord");(e.exports=n).prototype=r.inherit(o,{minzoom:0,maxzoom:22,tileSize:512,reparseOverscaled:!0,_loaded:!1,onAdd:function(t){this.map=t},loaded:function(){return this._pyramid&&this._pyramid.loaded()},update:function(t){this._pyramid&&this._pyramid.update(this.used,t)},reload:function(){this._pyramid&&this._pyramid.reload()},redoPlacement:function(){if(this._pyramid)for(var t=this._pyramid.orderedIDs(),e=0;e<t.length;e++){var i=this._pyramid.getTile(t[e]);this._redoTilePlacement(i)}},render:a._renderTiles,featuresAt:a._vectorFeaturesAt,featuresIn:a._vectorFeaturesIn,_loadTile:function(t){var e=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,i={url:t.coord.url(this.tiles,this.maxzoom),uid:t.uid,coord:t.coord,zoom:t.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize*e,source:this.id,overscaling:e,angle:this.map.transform.angle,pitch:this.map.transform.pitch,collisionDebug:this.map.collisionDebug,parentId:t.parentId};t.parentId&&(i.url=s.fromID(t.parentId).url(this.tiles,this.maxzoom)),t.workerID?this.dispatcher.send("reload tile",i,this._tileLoaded.bind(this,t),t.workerID):t.workerID=this.dispatcher.send("load tile",i,this._tileLoaded.bind(this,t))},_tileLoaded:function(t,e,i){if(!t.aborted){if(e)return void this.fire("tile.error",{tile:t});t.loadVectorData(i),t.redoWhenDone&&(t.redoWhenDone=!1,this._redoTilePlacement(t)),this.fire("tile.load",{tile:t}),this.fire("tile.stats",i.bucketStats)}},_abortTile:function(t){t.aborted=!0,this.dispatcher.send("abort tile",{uid:t.uid,source:this.id},null,t.workerID)},_addTile:function(t){this.fire("tile.add",{tile:t})},_removeTile:function(t){this.fire("tile.remove",{tile:t})},_unloadTile:function(t){t.unloadVectorData(this.map.painter),this.glyphAtlas.removeGlyphs(t.uid),this.dispatcher.send("remove tile",{uid:t.uid,source:this.id},null,t.workerID)},_redoTilePlacement:function(i){return!i.loaded||i.redoingPlacement?void(i.redoWhenDone=!0):(i.redoingPlacement=!0,void this.dispatcher.send("redo placement",{uid:i.uid,source:this.id,angle:this.map.transform.angle,pitch:this.map.transform.pitch,collisionDebug:this.map.collisionDebug},function(t,e){i.reloadSymbolData(e,this.map.painter),this.fire("tile.load",{tile:i}),i.redoingPlacement=!1,i.redoWhenDone&&(this._redoTilePlacement(i),i.redoWhenDone=!1)}.bind(this),i.workerID))}})},{"../util/evented":100,"../util/util":106,"./source":43,"./tile_coord":45}],48:[function(t,e,i){function n(t){this.coordinates=t.coordinates,o.getVideo(t.urls,function(t,e){var i;t||(this.video=e,this.video.loop=!0,this.video.addEventListener("playing",function(){i=this.map.style.animationLoop.set(1/0),this.map._rerender()}.bind(this)),this.video.addEventListener("pause",function(){this.map.style.animationLoop.cancel(i)}.bind(this)),this._loaded=!0,this.map&&(this.video.play(),this.createTile(),this.fire("change")))}.bind(this))}var a=t("../util/util"),s=t("./tile"),l=t("../geo/lng_lat"),u=t("point-geometry"),r=t("../util/evented"),o=t("../util/ajax");(e.exports=n).prototype=a.inherit(r,{roundZoom:!0,getVideo:function(){return this.video},onAdd:function(t){this.map=t,this.video&&(this.video.play(),this.createTile())},createTile:function(){var i=this.map,t=this.coordinates.map(function(t){var e=l.convert(t);return i.transform.locationCoordinate(e).zoomTo(0)}),n=a.getCoordinatesCenter(t),e=t.map(function(t){var e=t.zoomTo(n.zoom);return new u(Math.round(4096*(e.column-n.column)),Math.round(4096*(e.row-n.row)))}),r=i.painter.gl,o=new Int16Array([e[0].x,e[0].y,0,0,e[1].x,e[1].y,32767,0,e[3].x,e[3].y,0,32767,e[2].x,e[2].y,32767,32767]);this.tile=new s,this.tile.buckets={},this.tile.boundsBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.tile.boundsBuffer),r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW),this.center=n},loaded:function(){return this.video&&2<=this.video.readyState},update:function(){},reload:function(){},render:function(t,e){if(this._loaded&&!(this.video.readyState<2)){var i=this.center;this.tile.calculateMatrices(i.zoom,i.column,i.row,this.map.transform,e);var n=e.gl;this.tile.texture?(n.bindTexture(n.TEXTURE_2D,this.tile.texture),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.tile.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.tile.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.video)),e.drawLayers(t,this.tile.posMatrix,this.tile)}},featuresAt:function(t,e,i){return i(null,[])},featuresIn:function(t,e,i){return i(null,[])}})},{"../geo/lng_lat":20,"../util/ajax":94,"../util/evented":100,"../util/util":106,"./tile":44,"point-geometry":137}],49:[function(t,e,i){function n(t){this.self=t,this.actor=new r(t,this),this.loading={},this.loaded={},this.layers=[],this.geoJSONIndexes={}}var r=t("../util/actor"),l=t("./worker_tile"),o=t("../util/util"),u=t("../util/ajax"),c=t("vector-tile"),h=t("pbf"),a=t("./tile_coord"),s=t("geojson-vt"),p=t("./geojson_wrapper");e.exports=function(t){return new n(t)},o.extend(n.prototype,{"set layers":function(t){this.layers=t},"load tile":function(n,r){var o=n.source,a=n.uid;this.loading[o]||(this.loading[o]={});var s=this.loading[o][a]=new l(n);s.xhr=u.getArrayBuffer(n.url,function(t,e){if(delete this.loading[o][a],t)return r(t);if(s.data=new c.VectorTile(new h(new Uint8Array(e))),n.parentId&&s.data.layers){var i=this.getChildPosition(n.coord.id,n.parentId);s.parse(s.data,this.layers,this.actor,r,i.dz,i.xPos,i.yPos)}else s.parse(s.data,this.layers,this.actor,r);this.loaded[o]=this.loaded[o]||{},this.loaded[o][a]=s}.bind(this))},"reload tile":function(t,e){var i=this.loaded[t.source],n=t.uid;if(i&&i[n]){var r=i[n];r.parse(r.data,this.layers,this.actor,e)}},"abort tile":function(t){var e=this.loading[t.source],i=t.uid;e&&e[i]&&(e[i].xhr.abort(),delete e[i])},"remove tile":function(t){var e=this.loaded[t.source],i=t.uid;e&&e[i]&&delete e[i]},"redo placement":function(t,e){var i=this.loaded[t.source],n=this.loading[t.source],r=t.uid;if(i&&i[r]){var o=i[r].redoPlacement(t.angle,t.pitch,t.collisionDebug);o.result&&e(null,o.result,o.transferables)}else n&&n[r]&&(n[r].angle=t.angle)},"parse geojson":function(i,n){var t=function(t,e){return t?n(t):(this.geoJSONIndexes[i.source]=s(e,i.geojsonVtOptions),void n(null))}.bind(this);"string"==typeof i.data?u.getJSON(i.data,t):t(null,i.data)},"load geojson tile":function(t,e){var i=t.source,n=t.coord,r=this.geoJSONIndexes[i].getTile(n.z,n.x,n.y);if(!r)return e(null,null);var o=new l(t);o.parse(new p(r.features),this.layers,this.actor,e),this.loaded[i]=this.loaded[i]||{},this.loaded[i][t.uid]=o},"query features":function(t,e){var i=this.loaded[t.source]&&this.loaded[t.source][t.uid];i?i.featureTree.query(t,e):e(null,[])},getChildPosition:function(t,e){var i=a.fromID(t),n=a.fromID(e),r=i.z-n.z;return{dz:r,xPos:i.x&(1<<r)-1,yPos:i.y&(1<<r)-1}}})},{"../util/actor":93,"../util/ajax":94,"../util/util":106,"./geojson_wrapper":40,"./tile_coord":45,"./worker_tile":50,"geojson-vt":111,pbf:136,"vector-tile":144}],50:[function(t,e,i){function n(t){this.coord=t.coord,this.uid=t.uid,this.zoom=t.zoom,this.maxZoom=t.maxZoom,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=t.overscaling,this.angle=t.angle,this.pitch=t.pitch,this.collisionDebug=t.collisionDebug,this.stacks={}}var A=t("../data/feature_tree"),M=t("../symbol/collision_tile"),E=t("../data/buffer/buffer_set"),L=t("../data/create_bucket");(e.exports=n).prototype.parse=function(t,e,i,s,n,r,o){function a(t,e,i,n,r){for(var o=0;o<t.length;o++){var a=t.feature(o);for(var s in a.dz=i,a.xPos=n,a.yPos=r,e){var l=e[s];l.filter(a)&&l.features.push(a)}}}function l(t,e,i){if((!e.getDependencies||e.dependenciesLoaded)&&(!e.needsPlacement||e.previousPlaced)){if(!i){var n=Date.now();e.features.length&&e.addFeatures(m);var r=Date.now()-n;if(e.interactive)for(var o=0;o<e.features.length;o++){var a=e.features[o];t.featureTree.insert(a.bbox(),e.layers,a)}"undefined"!=typeof self&&(self.bucketStats=self.bucketStats||{_total:0},self.bucketStats._total+=r,self.bucketStats[e.id]=(self.bucketStats[e.id]||0)+r),e.features=null}return--S?void(e.next&&(e.next.previousPlaced=!0,l(t,e.next))):void function(){if(f.status="done",f.redoPlacementAfterDone){var t=f.redoPlacement(f.angle,f.pitch).result;d.glyphVertex=t.buffers.glyphVertex,d.iconVertex=t.buffers.iconVertex,d.collisionBoxVertex=t.buffers.collisionBoxVertex}var e=[],i={};for(c in d)e.push(d[c].array);for(c in y)i[c]=y[c].elementGroups;s(null,{elementGroups:i,buffers:d,extent:w,bucketStats:"undefined"!=typeof self?self.bucketStats:null},e)}()}}this.status="parsing",this.featureTree=new A(this.coord,this.overscaling);var u,c,h,p,f=this,d=new E,m=new M(this.angle,this.pitch),y={},_=this.bucketsInOrder=[],g={};for(u=0;u<e.length;u++)if((h=e[u]).source===this.source&&!h.ref){var v=h.minzoom;if(!(v&&this.zoom<v&&v<this.maxZoom)){var x=h.maxzoom;if(!(x&&this.zoom>=x))if("none"!==h.layout.visibility)if((p=L(h,d,this.zoom,this.overscaling,this.collisionDebug)).layers=[h.id],y[p.id]=p,_.push(p),t.layers){var b=h["source-layer"];g[b]||(g[b]={}),g[b][p.id]=p}else g[p.id]=p}}for(u=0;u<e.length;u++)(h=e[u]).source===this.source&&h.ref&&(p=y[h.ref])&&p.layers.push(h.id);var w=4096;if(t.layers)for(c in g)(h=t.layers[c])&&(h.extent&&(w=h.extent),a(h,g[c],n,r,o));else a(t,g);var T,S=_.length;for(u=_.length-1;0<=u;u--)(p=_[u]).needsPlacement&&(T?T.next=p:p.previousPlaced=!0,T=p),p.getDependencies&&p.getDependencies(this,i,function(e){return function(t){e.dependenciesLoaded=!0,l(f,e,t)}}(p)),p.needsPlacement||p.getDependencies||l(f,p)},n.prototype.redoPlacement=function(t,e,i){if("done"!==this.status)return this.redoPlacementAfterDone=!0,this.angle=t,{};for(var n=new E,r=[],o={},a=new M(t,e),s=this.bucketsInOrder,l=s.length-1;0<=l;l--){var u=s[l];"symbol"===u.type&&(u.placeFeatures(a,n,i),o[u.id]=u.elementGroups)}for(var c in n)r.push(n[c].array);return{result:{elementGroups:o,buffers:n},transferables:r}}},{"../data/buffer/buffer_set":2,"../data/create_bucket":13,"../data/feature_tree":15,"../symbol/collision_tile":68}],51:[function(t,e,i){function n(){this.n=0,this.times=[]}(e.exports=n).prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},n.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},n.prototype.cancel=function(e){this.times=this.times.filter(function(t){return t.id!==e})}},{}],52:[function(t,e,i){function n(t){this.base=t,this.retina=1<s.devicePixelRatio;var e=this.retina?"@2x":"";a.getJSON(l(t,e,".json"),function(t,e){return t?void this.fire("error",{error:t}):(this.data=e,void(this.img&&this.fire("load")))}.bind(this)),a.getImage(l(t,e,".png"),function(t,e){if(t)this.fire("error",{error:t});else{for(var i=e.getData(),n=e.data=new Uint8Array(i.length),r=0;r<i.length;r+=4){var o=i[r+3]/255;n[r+0]=i[r+0]*o,n[r+1]=i[r+1]*o,n[r+2]=i[r+2]*o,n[r+3]=i[r+3]}this.img=e,this.data&&this.fire("load")}}.bind(this))}function r(){}var o=t("../util/evented"),a=t("../util/ajax"),s=t("../util/browser"),l=t("../util/mapbox").normalizeSpriteURL;((e.exports=n).prototype=Object.create(o)).toJSON=function(){return this.base},n.prototype.loaded=function(){return!(!this.data||!this.img)},r.prototype={x:0,y:0,width:0,height:0,pixelRatio:1,sdf:!(n.prototype.resize=function(){if(1<s.devicePixelRatio!==this.retina){var t=new n(this.base);t.on("load",function(){this.img=t.img,this.data=t.data,this.retina=t.retina}.bind(this))}})},n.prototype.getSpritePosition=function(t){if(!this.loaded())return new r;var e=this.data&&this.data[t];return e&&this.img?e:new r}},{"../util/ajax":94,"../util/browser":95,"../util/evented":100,"../util/mapbox":103}],53:[function(t,r,e){var o=t("./reference");r.exports={},o.layout.forEach(function(t){var e=function(t){for(var e in t)this[e]=t[e]},i=o[t];for(var n in i)void 0!==i[n].default&&(e.prototype[n]=i[n].default);r.exports[t.replace("layout_","")]=e})},{"./reference":55}],54:[function(t,a,e){var s=t("./reference"),l=t("csscolorparser").parseCSSColor;a.exports={},s.paint.forEach(function(t){var e=function(){},i=s[t];for(var n in i){var r=i[n],o=r.default;void 0!==o&&("color"===r.type&&(o=l(o)),e.prototype[n]=o)}e.prototype.hidden=!1,a.exports[t.replace("paint_","")]=e})},{"./reference":55,csscolorparser:107}],55:[function(t,e,i){e.exports=t("mapbox-gl-style-spec/reference/latest")},{"mapbox-gl-style-spec/reference/latest":131}],56:[function(t,e,i){function n(t,e){this.animationLoop=e||new _,this.dispatcher=new y(Math.max(m.hardwareConcurrency-1,1),this),this.glyphAtlas=new u(1024,1024),this.spriteAtlas=new c(512,512),this.spriteAtlas.resize(m.devicePixelRatio),this.lineAtlas=new h(256,512),this._layers={},this._order=[],this._groups=[],this.sources={},this.zoomHistory={},p.bindAll(["_forwardSourceEvent","_forwardTileEvent","_redoPlacement"],this);var i=function(t,e){if(t)this.fire("error",{error:t});else{var i=g(e);if(i.length)for(var n=0;n<i.length;n++)this.fire("error",{error:new Error(i[n].message)});else{this._loaded=!0;var r=(this.stylesheet=e).sources;for(var o in r)this.addSource(o,r[o]);e.sprite&&(this.sprite=new s(e.sprite),this.sprite.on("load",this.fire.bind(this,"change"))),this.glyphSource=new l(e.glyphs,this.glyphAtlas),this._resolve(),this.fire("load")}}}.bind(this);"string"==typeof t?f.getJSON(d(t),i):m.frame(i.bind(this,null,t))}var r=t("../util/evented"),o=t("./style_batch"),a=t("./style_layer"),s=t("./image_sprite"),l=t("../symbol/glyph_source"),u=t("../symbol/glyph_atlas"),c=t("../symbol/sprite_atlas"),h=t("../render/line_atlas"),p=t("../util/util"),f=t("../util/ajax"),d=t("../util/mapbox").normalizeStyleURL,m=t("../util/browser"),y=t("../util/dispatcher"),_=t("./animation_loop"),g=t("mapbox-gl-style-spec/lib/validate/latest");(e.exports=n).prototype=p.inherit(r,{_loaded:!1,loaded:function(){if(!this._loaded)return!1;for(var t in this.sources)if(!this.sources[t].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},_resolve:function(){var t,e;this._layers={},this._order=[];for(var i=0;i<this.stylesheet.layers.length;i++)e=new a(this.stylesheet.layers[i]),this._layers[e.id]=e,this._order.push(e.id);for(t in this._layers)this._layers[t].resolveLayout();for(t in this._layers)this._layers[t].resolveReference(this._layers),this._layers[t].resolvePaint();this._groupLayers(),this._broadcastLayers()},_groupLayers:function(){var t;this._groups=[];for(var e=0;e<this._order.length;++e){var i=this._layers[this._order[e]];t&&i.source===t.source||((t=[]).source=i.source,this._groups.push(t)),t.push(i)}},_broadcastLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e].json());this.dispatcher.broadcast("set layers",t)},_cascade:function(t,e){if(this._loaded){for(var i in e=e||{transition:!0},this._layers)this._layers[i].cascade(t,e,this.stylesheet.transition||{},this.animationLoop);this.fire("change")}},_recalculate:function(t){for(var e in this.sources)this.sources[e].used=!1;for(e in this._updateZoomHistory(t),this.rasterFadeDuration=300,this._layers){var i=this._layers[e];i.recalculate(t,this.zoomHistory)&&i.source&&(this.sources[i.source].used=!0)}Math.floor(this.z)!==Math.floor(t)&&this.animationLoop.set(300),this.z=t,this.fire("zoom")},_updateZoomHistory:function(t){var e=this.zoomHistory;void 0===e.lastIntegerZoom&&(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=0,e.lastZoom=t),Math.floor(e.lastZoom)<Math.floor(t)?(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=Date.now()):Math.floor(e.lastZoom)>Math.floor(t)&&(e.lastIntegerZoom=Math.floor(t+1),e.lastIntegerZoomTime=Date.now()),e.lastZoom=t},batch:function(t){o(this,t)},addSource:function(e,i){return this.batch(function(t){t.addSource(e,i)}),this},removeSource:function(e){return this.batch(function(t){t.removeSource(e)}),this},getSource:function(t){return this.sources[t]},addLayer:function(e,i){return this.batch(function(t){t.addLayer(e,i)}),this},removeLayer:function(e){return this.batch(function(t){t.removeLayer(e)}),this},getLayer:function(t){return this._layers[t]},getReferentLayer:function(t){var e=this.getLayer(t);return e.ref&&(e=this.getLayer(e.ref)),e},setFilter:function(e,i){return this.batch(function(t){t.setFilter(e,i)}),this},setLayerZoomRange:function(e,i,n){return this.batch(function(t){t.setLayerZoomRange(e,i,n)}),this},getFilter:function(t){return this.getReferentLayer(t).filter},getLayoutProperty:function(t,e){return this.getReferentLayer(t).getLayoutProperty(e)},getPaintProperty:function(t,e,i){return this.getLayer(t).getPaintProperty(e,i)},featuresAt:function(e,n,t){var r=[],o=null;n.layer&&(n.layerIds=Array.isArray(n.layer)?n.layer:[n.layer]),p.asyncEach(Object.keys(this.sources),function(t,i){this.sources[t].featuresAt(e,n,function(t,e){e&&(r=r.concat(e)),t&&(o=t),i()})}.bind(this),function(){return o?t(o):void t(null,r.filter(function(t){return void 0!==this._layers[t.layer]}.bind(this)).map(function(t){return t.layer=this._layers[t.layer].json(),t}.bind(this)))}.bind(this))},featuresIn:function(e,n,t){var r=[],o=null;n.layer&&(n.layer={id:n.layer}),p.asyncEach(Object.keys(this.sources),function(t,i){this.sources[t].featuresIn(e,n,function(t,e){e&&(r=r.concat(e)),t&&(o=t),i()})}.bind(this),function(){return o?t(o):void t(null,r.filter(function(t){return void 0!==this._layers[t.layer]}.bind(this)).map(function(t){return t.layer=this._layers[t.layer].json(),t}.bind(this)))}.bind(this))},_remove:function(){this.dispatcher.remove()},_reloadSource:function(t){this.sources[t].reload()},_updateSources:function(t){for(var e in this.sources)this.sources[e].update(t)},_redoPlacement:function(){for(var t in this.sources)this.sources[t].redoPlacement&&this.sources[t].redoPlacement()},_forwardSourceEvent:function(t){this.fire("source."+t.type,p.extend({source:t.target},t))},_forwardTileEvent:function(t){this.fire(t.type,p.extend({source:t.target},t))},"get sprite json":function(t,e){var i=this.sprite;i.loaded()?e(null,{sprite:i.data,retina:i.retina}):i.on("load",function(){e(null,{sprite:i.data,retina:i.retina})})},"get icons":function(t,e){var i=this.sprite,n=this.spriteAtlas;i.loaded()?(n.setSprite(i),n.addIcons(t.icons,e)):i.on("load",function(){n.setSprite(i),n.addIcons(t.icons,e)})},"get glyphs":function(t,e){this.glyphSource.getSimpleGlyphs(t.fontstack,t.codepoints,t.uid,e)}})},{"../render/line_atlas":36,"../symbol/glyph_atlas":70,"../symbol/glyph_source":71,"../symbol/sprite_atlas":77,"../util/ajax":94,"../util/browser":95,"../util/dispatcher":97,"../util/evented":100,"../util/mapbox":103,"../util/util":106,"./animation_loop":51,"./image_sprite":52,"./style_batch":57,"./style_layer":60,"mapbox-gl-style-spec/lib/validate/latest":129}],57:[function(t,e,i){function n(t,e){if(!t._loaded)throw new Error("Style is not done loading");var i=Object.create(n.prototype);i._style=t,i._groupLayers=!1,i._broadcastLayers=!1,i._reloadSources={},i._events=[],i._change=!1,e(i),i._groupLayers&&i._style._groupLayers(),i._broadcastLayers&&i._style._broadcastLayers(),Object.keys(i._reloadSources).forEach(function(t){i._style._reloadSource(t)}),i._events.forEach(function(t){i._style.fire.apply(i._style,t)}),i._change&&i._style.fire("change")}var r=t("../source/source"),o=t("./style_layer");n.prototype={addLayer:function(t,e){if(void 0!==this._style._layers[t.id])throw new Error("There is already a layer with this ID");return t instanceof o||(t=new o(t)),this._style._layers[t.id]=t,this._style._order.splice(e?this._style._order.indexOf(e):1/0,0,t.id),t.resolveLayout(),t.resolveReference(this._style._layers),t.resolvePaint(),this._groupLayers=!0,this._broadcastLayers=!0,t.source&&(this._reloadSources[t.source]=!0),this._events.push(["layer.add",{layer:t}]),this._change=!0,this},removeLayer:function(t){var e=this._style._layers[t];if(void 0===e)throw new Error("There is no layer with this ID");for(var i in this._style._layers)this._style._layers[i].ref===t&&this.removeLayer(i);return delete this._style._layers[t],this._style._order.splice(this._style._order.indexOf(t),1),this._groupLayers=!0,this._broadcastLayers=!0,this._events.push(["layer.remove",{layer:e}]),this._change=!0,this},setPaintProperty:function(t,e,i,n){return this._style.getLayer(t).setPaintProperty(e,i,n),this._change=!0,this},setLayoutProperty:function(t,e,i){return(t=this._style.getReferentLayer(t)).setLayoutProperty(e,i),this._broadcastLayers=!0,t.source&&(this._reloadSources[t.source]=!0),this._change=!0,this},setFilter:function(t,e){return(t=this._style.getReferentLayer(t)).filter=e,this._broadcastLayers=!0,t.source&&(this._reloadSources[t.source]=!0),this._change=!0,this},setLayerZoomRange:function(t,e,i){var n=this._style.getReferentLayer(t);return null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._broadcastLayers=!0,n.source&&(this._reloadSources[n.source]=!0),this._change=!0,this},addSource:function(t,e){if(!this._style._loaded)throw new Error("Style is not done loading");if(void 0!==this._style.sources[t])throw new Error("There is already a source with this ID");return e=r.create(e),(this._style.sources[t]=e).id=t,e.style=this._style,e.dispatcher=this._style.dispatcher,e.glyphAtlas=this._style.glyphAtlas,e.on("load",this._style._forwardSourceEvent).on("error",this._style._forwardSourceEvent).on("change",this._style._forwardSourceEvent).on("tile.add",this._style._forwardTileEvent).on("tile.load",this._style._forwardTileEvent).on("tile.error",this._style._forwardTileEvent).on("tile.remove",this._style._forwardTileEvent).on("tile.stats",this._style._forwardTileEvent),this._events.push(["source.add",{source:e}]),this._change=!0,this},removeSource:function(t){if(void 0===this._style.sources[t])throw new Error("There is no source with this ID");var e=this._style.sources[t];return delete this._style.sources[t],e.off("load",this._style._forwardSourceEvent).off("error",this._style._forwardSourceEvent).off("change",this._style._forwardSourceEvent).off("tile.add",this._style._forwardTileEvent).off("tile.load",this._style._forwardTileEvent).off("tile.error",this._style._forwardTileEvent).off("tile.remove",this._style._forwardTileEvent).off("tile.stats",this._style._forwardTileEvent),this._events.push(["source.remove",{source:e}]),this._change=!0,this}},e.exports=n},{"../source/source":43,"./style_layer":60}],58:[function(t,e,i){var r=t("csscolorparser").parseCSSColor,n=t("mapbox-gl-function"),o=t("../util/util");e.exports=function(t,e){var u;this.type=t.type,this.transitionable=t.transition,null==e&&(e=t.default),this.json=JSON.stringify(e),"color"===this.type?this.value=function e(t){if(a[t])return a[t];if(Array.isArray(t))return t;if(t.stops)return o.extend({},t,{stops:t.stops.map(function(t){return[t[0],e(t[1])]})});if("string"!=typeof t)throw new Error("Invalid color "+t);var i,n=[(i=r(t))[0]/255,i[1]/255,i[2]/255,i[3]/1];return a[t]=n}(e):this.value=e,"interpolated"===t.function?this.calculate=n.interpolated(this.value):(this.calculate=n["piecewise-constant"](this.value),t.transition&&(this.calculate=(u=this.calculate,function(t,e,i){var n,r,o,a=t%1,s=Math.min((Date.now()-e.lastIntegerZoomTime)/i,1),l=1;return t>e.lastIntegerZoom?(n=a+(1-a)*s,l*=2,r=u(t-1),o=u(t)):(n=1-(1-s)*a,o=u(t),r=u(t+1),l/=2),{from:r,fromScale:l,to:o,toScale:1,t:n}})))};var a={}},{"../util/util":106,csscolorparser:107,"mapbox-gl-function":128}],59:[function(t,e,i){function n(t){function n(t){for(var e in this._values={},this._transitions={},t)this[e]=t[e]}return Object.keys(t).forEach(function(e){var i=t[e];Object.defineProperty(n.prototype,e,{set:function(t){this._values[e]=new a(i,t)},get:function(){return this._values[e].value}}),i.transition&&Object.defineProperty(n.prototype,e+"-transition",{set:function(t){this._transitions[e]=t},get:function(){return this._transitions[e]}})}),n.prototype.values=function(){return this._values},n.prototype.transition=function(t,e){var i=this._transitions[t]||{};return{duration:r.coalesce(i.duration,e.duration,300),delay:r.coalesce(i.delay,e.delay,0)}},n.prototype.json=function(){var t={};for(var e in this._values)t[e]=this._values[e].value;for(var i in this._transitions)t[i+"-transition"]=this._transitions[e];return t},n}var r=t("../util/util"),o=t("./reference"),a=t("./style_declaration"),s={paint:{},layout:{}};o.layer.type.values.forEach(function(t){s.paint[t]=n(o["paint_"+t]),s.layout[t]=n(o["layout_"+t])}),e.exports=function(t,e,i){return new s[t][e](i)}},{"../util/util":106,"./reference":55,"./style_declaration":58}],60:[function(t,e,i){function n(t){this._layer=t,this.id=t.id,this.ref=t.ref,this._resolved={},this._cascaded={},this.assign(t)}function s(t,e){var i=e+"-color",n=e+"-halo-color",r=e+"-outline-color",o=t[i],a=t[n],s=t[r],l=t[e+"-opacity"],u=o&&l*o[3],c=a&&l*a[3],h=s&&l*s[3];void 0!==u&&u<1&&(t[i]=p.premultiply([o[0],o[1],o[2],u])),void 0!==c&&c<1&&(t[n]=p.premultiply([a[0],a[1],a[2],c])),void 0!==h&&h<1&&(t[r]=p.premultiply([s[0],s[1],s[2],h]))}var p=t("../util/util"),f=t("./style_transition"),d=t("./style_declaration_set"),r=t("./layout_properties"),l=t("./paint_properties");(e.exports=n).prototype={resolveLayout:function(){this.ref||(this.layout=new r[this.type](this._layer.layout),"line"===this.layout["symbol-placement"]&&(this.layout.hasOwnProperty("text-rotation-alignment")||(this.layout["text-rotation-alignment"]="map"),this.layout.hasOwnProperty("icon-rotation-alignment")||(this.layout["icon-rotation-alignment"]="map"),this.layout["symbol-avoid-edges"]=!0))},setLayoutProperty:function(t,e){null==e?delete this.layout[t]:this.layout[t]=e},getLayoutProperty:function(t){return this.layout[t]},resolveReference:function(t){this.ref&&this.assign(t[this.ref])},resolvePaint:function(){for(var t in this._layer){var e=t.match(/^paint(?:\.(.*))?$/);e&&(this._resolved[e[1]||""]=new d("paint",this.type,this._layer[t]))}},setPaintProperty:function(t,e,i){var n=this._resolved[i||""];n||(n=this._resolved[i||""]=new d("paint",this.type,{})),n[t]=e},getPaintProperty:function(t,e){var i=this._resolved[e||""];if(i)return i[t]},cascade:function(t,e,i,n){for(var r in this._resolved)if(""===r||t[r]){var o=this._resolved[r],a=o.values();for(var s in a){var l=a[s],u=e.transition?this._cascaded[s]:void 0;if(!u||u.declaration.json!==l.json){var c=o.transition(s,i),h=this._cascaded[s]=new f(l,u,c);h.instant()||(h.loopID=n.set(h.endTime-(new Date).getTime())),u&&n.cancel(u.loopID)}}}if("symbol"===this.type){var p=new d("layout",this.type,this.layout);this._cascaded["text-size"]=new f(p.values()["text-size"],void 0,i),this._cascaded["icon-size"]=new f(p.values()["icon-size"],void 0,i)}},recalculate:function(t,e){var i=this.type,n=this.paint=new l[i];for(var r in this._cascaded)n[r]=this._cascaded[r].at(t,e);if(this.hidden=this.minzoom&&t<this.minzoom||this.maxzoom&&t>=this.maxzoom||"none"===this.layout.visibility,"symbol"===i?0!==n["text-opacity"]&&this.layout["text-field"]||0!==n["icon-opacity"]&&this.layout["icon-image"]?(s(n,"text"),s(n,"icon")):this.hidden=!0:0===n[i+"-opacity"]?this.hidden=!0:s(n,i),this._cascaded["line-dasharray"]){var o=n["line-dasharray"],a=this._cascaded["line-width"]?this._cascaded["line-width"].at(Math.floor(t),1/0):n["line-width"];o.fromScale*=a,o.toScale*=a}return!this.hidden},assign:function(t){p.extend(this,p.pick(t,["type","source","source-layer","minzoom","maxzoom","filter","layout"]))},json:function(){return p.extend({},this._layer,p.pick(this,["type","source","source-layer","minzoom","maxzoom","filter","layout","paint"]))}}},{"../util/util":106,"./layout_properties":53,"./paint_properties":54,"./style_declaration_set":59,"./style_transition":61}],61:[function(t,e,i){function n(t,e,i){this.declaration=t,this.startTime=this.endTime=(new Date).getTime();var n=t.type;"string"!==n&&"array"!==n||!t.transitionable?this.interp=a[n]:this.interp=r,this.oldTransition=e,this.duration=i.duration||0,this.delay=i.delay||0,this.instant()||(this.endTime=this.startTime+this.duration+this.delay,this.ease=o.easeCubicInOut),e&&e.endTime<=this.startTime&&delete e.oldTransition}function r(t,e,i){return{from:t.to,fromScale:t.toScale,to:e.to,toScale:e.toScale,t:i}}var o=t("../util/util"),a=t("../util/interpolate");(e.exports=n).prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},n.prototype.at=function(t,e,i){var n=this.declaration.calculate(t,e,this.duration);if(this.instant())return n;if((i=i||Date.now())<this.endTime){var r=this.oldTransition.at(t,e,this.startTime),o=this.ease((i-this.startTime-this.delay)/this.duration);n=this.interp(r,n,o)}return n}},{"../util/interpolate":102,"../util/util":106}],62:[function(t,e,i){function n(t,e,i,n){this.x=t,this.y=e,this.angle=i,void 0!==n&&(this.segment=n)}var r=t("point-geometry");((e.exports=n).prototype=Object.create(r.prototype)).clone=function(){return new n(this.x,this.y,this.angle,this.segment)}},{"point-geometry":137}],63:[function(t,e,i){function n(t,e){this.width=t,this.height=e,this.free=[{x:0,y:0,w:t,h:e}]}(e.exports=n).prototype.release=function(t){for(var e=0;e<this.free.length;e++){var i=this.free[e];if(i.y===t.y&&i.h===t.h&&i.x+i.w===t.x)i.w+=t.w;else if(i.x===t.x&&i.w===t.w&&i.y+i.h===t.y)i.h+=t.h;else if(t.y===i.y&&t.h===i.h&&t.x+t.w===i.x)i.x=t.x,i.w+=t.w;else{if(t.x!==i.x||t.w!==i.w||t.y+t.h!==i.y)continue;i.y=t.y,i.h+=t.h}return this.free.splice(e,1),void this.release(i)}this.free.push(t)},n.prototype.allocate=function(t,e){for(var i={x:1/0,y:1/0,w:1/0,h:1/0},n=-1,r=0;r<this.free.length;r++){var o=this.free[r];t<=o.w&&e<=o.h&&o.y<=i.y&&o.x<=i.x&&(i=o,n=r)}return n<0?{x:-1,y:-1}:(this.free.splice(n,1),i.w<i.h?(i.w>t&&this.free.push({x:i.x+t,y:i.y,w:i.w-t,h:e}),i.h>e&&this.free.push({x:i.x,y:i.y+e,w:i.w,h:i.h-e})):(i.w>t&&this.free.push({x:i.x+t,y:i.y,w:i.w-t,h:i.h}),i.h>e&&this.free.push({x:i.x,y:i.y+e,w:t,h:i.h-e})),{x:i.x,y:i.y,w:t,h:e})}},{}],64:[function(t,e,i){e.exports=function(t,e,i,n,r){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;-i/2<s;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<i/2;){var c=t[a-1],h=t[a],p=t[a+1];if(!p)return!1;var f=c.angleTo(h)-h.angleTo(p);for(f=(f+3*Math.PI)%(2*Math.PI)-Math.PI,l.push({distance:s,angleDelta:f}),u+=f;s-l[0].distance>n;)u-=l.shift().angleDelta;if(Math.abs(u)>r)return!1;a++,s+=h.dist(p)}return!0}},{}],65:[function(t,e,i){var p=t("point-geometry");e.exports=function(t,e,i,n,r){for(var o=[],a=0;a<t.length;a++)for(var s,l=t[a],u=0;u<l.length-1;u++){var c=l[u],h=l[u+1];c.x<e&&h.x<e||(c.x<e?c=new p(e,c.y+(h.y-c.y)*((e-c.x)/(h.x-c.x))):h.x<e&&(h=new p(e,c.y+(h.y-c.y)*((e-c.x)/(h.x-c.x)))),c.y<i&&h.y<i||(c.y<i?c=new p(c.x+(h.x-c.x)*((i-c.y)/(h.y-c.y)),i):h.y<i&&(h=new p(c.x+(h.x-c.x)*((i-c.y)/(h.y-c.y)),i)),c.x>=n&&h.x>=n||(c.x>=n?c=new p(n,c.y+(h.y-c.y)*((n-c.x)/(h.x-c.x))):h.x>=n&&(h=new p(n,c.y+(h.y-c.y)*((n-c.x)/(h.x-c.x)))),c.y>=r&&h.y>=r||(c.y>=r?c=new p(c.x+(h.x-c.x)*((r-c.y)/(h.y-c.y)),r):h.y>=r&&(h=new p(c.x+(h.x-c.x)*((r-c.y)/(h.y-c.y)),r)),s&&c.equals(s[s.length-1])||(s=[c],o.push(s)),s.push(h)))))}return o}},{"point-geometry":137}],66:[function(t,e,i){e.exports=function(t,e,i,n,r,o){this.anchorPoint=t,this.x1=e,this.y1=i,this.x2=n,this.y2=r,this.maxScale=o,this.placementScale=0,this[0]=this[1]=this[2]=this[3]=0}},{}],67:[function(t,e,i){function n(t,e,i,n,r,o){var a=i.top*n-r,s=i.bottom*n+r,l=i.left*n-r,u=i.right*n+r;if(this.boxes=[],o){var c=s-a,h=u-l;if(c<=0)return;c=Math.max(10*n,c),this._addLineCollisionBoxes(t,e,h,c)}else this.boxes.push(new g(new p(e.x,e.y),l,a,u,s,1/0))}var g=t("./collision_box"),p=t("point-geometry");(e.exports=n).prototype._addLineCollisionBoxes=function(t,e,i,n){var r=n/2,o=Math.floor(i/r),a=-n/2,s=this.boxes,l=e,u=e.segment+1,c=a;do{if(--u<0)return s;c-=t[u].dist(l),l=t[u]}while(-i/2<c);for(var h=t[u].dist(t[u+1]),p=0;p<o;p++){for(var f=-i/2+p*r;c+h<f;){if(c+=h,++u+1>=t.length)return s;h=t[u].dist(t[u+1])}var d=f-c,m=t[u],y=t[u+1].sub(m)._unit()._mult(d)._add(m),_=i/2/Math.max(Math.abs(f-a)-r/2,0);s.push(new g(y,-n/2,-n/2,n/2,n/2,_))}return s}},{"./collision_box":66,"point-geometry":137}],68:[function(t,e,i){function n(t,e){this.tree=r(),this.angle=t;var i=Math.sin(t),n=Math.cos(t);this.rotationMatrix=[n,-i,i,n],this.yStretch=1/Math.cos(e/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3)}var r=t("rbush");(e.exports=n).prototype.minScale=.25,n.prototype.maxScale=2,n.prototype.placeCollisionFeature=function(t){for(var e=this.minScale,i=this.rotationMatrix,n=this.yStretch,r=0;r<t.boxes.length;r++){var o=t.boxes[r],a=o.anchorPoint.matMult(i),s=a.x,l=a.y;o[0]=s+o.x1,o[1]=l+o.y1*n,o[2]=s+o.x2,o[3]=l+o.y2*n;for(var u=this.tree.search(o),c=0;c<u.length;c++){var h=u[c],p=h.anchorPoint.matMult(i),f=(h.x1-o.x2)/(s-p.x),d=(h.x2-o.x1)/(s-p.x),m=(h.y1-o.y2)*n/(l-p.y),y=(h.y2-o.y1)*n/(l-p.y);(isNaN(f)||isNaN(d))&&(f=d=1),(isNaN(m)||isNaN(y))&&(m=y=1);var _=Math.min(Math.max(f,d),Math.max(m,y));if(_>h.maxScale&&(_=h.maxScale),_>o.maxScale&&(_=o.maxScale),e<_&&_>=h.placementScale&&(e=_),e>=this.maxScale)return e}}return e},n.prototype.insertCollisionFeature=function(t,e){for(var i=t.boxes,n=0;n<i.length;n++)i[n].placementScale=e;e<this.maxScale&&this.tree.load(i)}},{rbush:139}],69:[function(t,e,i){var b=t("../util/interpolate"),w=t("../symbol/anchor"),T=t("./check_max_angle");e.exports=function(t,e,i,n,r,o,a,s){var l=n?.6*o*a:0,u=Math.max(n?n.right-n.left:0,r?r.right-r.left:0);if(0===t[0].x||4096===t[0].x||0===t[0].y||4096===t[0].y)var c=!0;return e-u*a<e/4&&(e=u*a+e/4),function t(e,i,n,r,o,a,s,l){for(var u=0,c=i-n,h=[],p=0;p<e.length-1;p++){for(var f=e[p],d=e[p+1],m=f.dist(d),y=d.angleTo(f);c+n<u+m;){var _=((c+=n)-u)/m,g=b(f.x,d.x,_),v=b(f.y,d.y,_);if(0<=g&&g<4096&&0<=v&&v<4096){g=Math.round(g),v=Math.round(v);var x=new w(g,v,y,p);(!r||T(e,x,a,r,o))&&h.push(x)}}u+=m}return l||h.length||s||(h=t(e,u/2,n,r,o,a,s,!0)),h}(t,c?e/2*s%e:(u/2+2*o)*a*s%e,e,l,i,u*a,c,!1)}},{"../symbol/anchor":62,"../util/interpolate":102,"./check_max_angle":64}],70:[function(t,e,i){function n(t,e){this.width=t,this.height=e,this.bin=new r(t,e),this.index={},this.ids={},this.data=new Uint8Array(t*e)}var r=t("./bin_pack");((e.exports=n).prototype={get debug(){return"canvas"in this},set debug(t){t&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!t&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}}).getGlyphs=function(){var t,e,i,n={};for(var r in this.ids)e=(t=r.split("#"))[0],i=t[1],n[e]||(n[e]=[]),n[e].push(i);return n},n.prototype.getRects=function(){var t,e,i,n={};for(var r in this.ids)e=(t=r.split("#"))[0],i=t[1],n[e]||(n[e]={}),n[e][i]=this.index[r];return n},n.prototype.removeGlyphs=function(t){for(var e in this.ids){var i=this.ids[e],n=i.indexOf(t);if(0<=n&&i.splice(n,1),!(this.ids[e]=i).length){for(var r=this.index[e],o=this.data,a=0;a<r.h;a++)for(var s=this.width*(r.y+a)+r.x,l=0;l<r.w;l++)o[s+l]=0;this.dirty=!0,this.bin.release(r),delete this.index[e],delete this.ids[e]}}this.updateTexture(this.gl)},n.prototype.addGlyph=function(t,e,i,n){if(!i)return null;var r=e+"#"+i.id;if(this.index[r])return this.ids[r].indexOf(t)<0&&this.ids[r].push(t),this.index[r];if(!i.bitmap)return null;var o=i.width+2*n,a=i.height+2*n,s=o+2,l=a+2;s+=4-s%4,l+=4-l%4;var u=this.bin.allocate(s,l);if(u.x<0)return console.warn("glyph bitmap overflow"),{glyph:i,rect:null};this.index[r]=u,this.ids[r]=[t];for(var c=this.data,h=i.bitmap,p=0;p<a;p++)for(var f=this.width*(u.y+p+1)+u.x+1,d=o*p,m=0;m<o;m++)c[f+m]=h[d+m];return this.dirty=!0,u},n.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},n.prototype.updateTexture=function(t){if(this.bind(t),this.dirty){if(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.ctx){for(var e=this.ctx.getImageData(0,0,this.width,this.height),i=0,n=0;i<this.data.length;i++,n+=4)e.data[n]=this.data[i],e.data[n+1]=this.data[i],e.data[n+2]=this.data[i],e.data[n+3]=255;this.ctx.putImageData(e,0,0),this.ctx.strokeStyle="red";for(var r=0;r<this.bin.free.length;r++){var o=this.bin.free[r];this.ctx.strokeRect(o.x,o.y,o.w,o.h)}}this.dirty=!1}}},{"./bin_pack":63}],71:[function(t,e,i){function n(t,e){this.url=t&&r(t),this.glyphAtlas=e,this.stacks=[],this.loading={}}function y(t,e,i){this.advance=t.advance,this.left=t.left-i-1,this.top=t.top+i+1,this.rect=e}var r=t("../util/mapbox").normalizeGlyphsURL,u=t("../util/ajax").getArrayBuffer,c=t("../util/glyphs"),h=t("pbf");(e.exports=n).prototype.getSimpleGlyphs=function(l,t,u,c){void 0===this.stacks[l]&&(this.stacks[l]={});for(var e,h={},i=this.stacks[l],p=this.glyphAtlas,f={},d=0,n=0;n<t.length;n++){var r=t[n];if(i[e=Math.floor(r/256)]){var o=i[e].glyphs[r],a=p.addGlyph(u,l,o,3);o&&(h[r]=new y(o,a,3))}else void 0===f[e]&&(f[e]=[],d++),f[e].push(r)}d||c(void 0,h);var s=function(t,e,i){if(!t)for(var n=this.stacks[l][e]=i.stacks[0],r=0;r<f[e].length;r++){var o=f[e][r],a=n.glyphs[o],s=p.addGlyph(u,l,a,3);a&&(h[o]=new y(a,s,3))}--d||c(void 0,h)}.bind(this);for(var m in f)this.loadRange(l,m,s)},n.prototype.loadRange=function(t,r,e){if(65535<256*r)return e("gyphs > 65535 not supported");void 0===this.loading[t]&&(this.loading[t]={});var i,n,o,a,s=this.loading[t];if(s[r])s[r].push(e);else{s[r]=[e];var l=(i=t,n=256*r+"-"+(256*r+255),o=this.url,a=a||"abc",o.replace("{s}",a[i.length%a.length]).replace("{fontstack}",i).replace("{range}",n));u(l,function(t,e){for(var i=!t&&new c(new h(new Uint8Array(e))),n=0;n<s[r].length;n++)s[r][n](t,r,i);delete s[r]})}}},{"../util/ajax":94,"../util/glyphs":101,"../util/mapbox":103,pbf:136}],72:[function(t,e,i){e.exports=function(e,i,n){function t(t){c.push(e[t]),h.push(n[t]),p.push(i[t]),f++}function r(t,e,i){var n=u[t];return delete u[t],u[e]=n,h[n][0].pop(),h[n][0]=h[n][0].concat(i[0]),n}function o(t,e,i){var n=l[e];return delete l[e],l[t]=n,h[n][0].shift(),h[n][0]=i[0].concat(h[n][0]),n}function a(t,e,i){var n=i?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}var s,l={},u={},c=[],h=[],p=[],f=0;for(s=0;s<e.length;s++){var d=n[s],m=i[s];if(d)if(m){var y=a(m,d),_=a(m,d,!0);if(y in u&&_ in l&&u[y]!==l[_]){var g=o(y,_,d),v=r(y,_,h[g]);delete l[y],delete u[_],u[a(m,h[v],!0)]=v,h[g]=null}else y in u?r(y,_,d):_ in l?o(y,_,d):(t(s),l[y]=f-1,u[_]=f-1)}else t(s)}return{features:c,textFeatures:p,geometries:h}}},{}],73:[function(t,e,i){function O(t,e,i,n,r,o,a,s,l){this.anchorPoint=t,this.tl=e,this.tr=i,this.bl=n,this.br=r,this.tex=o,this.angle=a,this.minScale=s,this.maxScale=l}function F(t,e,i,n,r,o){var a=!o;i<0&&(o=!o),o&&r++;var s=new N(e.x,e.y),l=n[r],u=1/0;i=Math.abs(i);for(var c=j;;){var h=s.dist(l),p=i/h,f=Math.atan2(l.y-s.y,l.x-s.x);if(o||(f+=Math.PI),a&&(f+=Math.PI),t.push({anchorPoint:s,offset:a?Math.PI:0,minScale:p,maxScale:u,angle:(f+2*Math.PI)%(2*Math.PI)}),p<=c)break;for(s=l;s.equals(l);)if(!(l=n[r+=o?1:-1]))return p;var d=l.sub(s)._unit();s=s.sub(d._mult(h)),u=p}return c}var N=t("point-geometry");e.exports={getIconQuads:function(t,e,i,n,r,o){var a=e.image.rect,s=e.left-1,l=s+a.w,u=e.top-1,c=u+a.h,h=new N(s,u),p=new N(l,u),f=new N(l,c),d=new N(s,c),m=r["icon-rotate"]*Math.PI/180;if(o){var y=n[t.segment];m+=Math.atan2(t.y-y.y,t.x-y.x)}if(m){var _=Math.sin(m),g=Math.cos(m),v=[g,-_,_,g];h=h.matMult(v),p=p.matMult(v),d=d.matMult(v),f=f.matMult(v)}return[new O(new N(t.x,t.y),h,p,d,f,e.image.rect,0,j,1/0)]},getGlyphQuads:function(t,e,i,n,r,o){for(var a=r["text-rotate"]*Math.PI/180,s=r["text-keep-upright"],l=e.positionedGlyphs,u=[],c=0;c<l.length;c++){var h=l[c],p=h.glyph,f=p.rect;if(f){var d,m=(h.x+p.advance/2)*i,y=j;o?(y=F(d=[],t,m,n,t.segment,!0),s&&(y=Math.min(y,F(d,t,m,n,t.segment,!1)))):d=[{anchorPoint:new N(t.x,t.y),offset:0,angle:0,maxScale:1/0,minScale:j}];for(var _=h.x+p.left,g=h.y-p.top,v=_+f.w,x=g+f.h,b=new N(_,g),w=new N(v,g),T=new N(_,x),S=new N(v,x),A=0;A<d.length;A++){var M=d[A],E=b,L=w,z=T,P=S,C=M.angle+a;if(C){var I=Math.sin(C),k=Math.cos(C),R=[k,-I,I,k];E=E.matMult(R),L=L.matMult(R),z=z.matMult(R),P=P.matMult(R)}var D=Math.max(M.minScale,y),B=(t.angle+a+M.offset+2*Math.PI)%(2*Math.PI);u.push(new O(M.anchorPoint,E,L,z,P,f,B,D,M.maxScale))}}}return u}};var j=.5},{"point-geometry":137}],74:[function(t,e,i){var a=t("../util/token");e.exports=function(t,e){for(var i=[],n=0,r=t.length;n<r;n++){var o=a(t[n].properties,e["icon-image"]);o&&i.indexOf(o)<0&&i.push(o)}return i}},{"../util/token":105}],75:[function(t,e,i){function h(t,e){return t-e}var p=t("../util/token");e.exports=function(t,e,i){for(var n=[],r=[],o=0,a=t.length;o<a;o++){var s=p(t[o].properties,e["text-field"]);if(s){s=s.toString();var l=e["text-transform"];"uppercase"===l?s=s.toLocaleUpperCase():"lowercase"===l&&(s=s.toLocaleLowerCase());for(var u=0,c=s.length;u<c;u++)r.push(s.charCodeAt(u));n[o]=s}else n[o]=null}return{textFeatures:n,codepoints:r=function(t,e){var i,n=[];t.sort(h);for(var r=0;r<t.length;r++)t[r]!==i&&(i=t[r],e[i]||n.push(t[r]));return n}(r,i)}}},{"../util/token":105}],76:[function(t,e,i){function y(t,e,i,n){this.codePoint=t,this.x=e,this.y=i,this.glyph=n}function _(t,e,i,n,r,o){this.positionedGlyphs=t,this.text=e,this.top=i,this.bottom=n,this.left=r,this.right=o}function x(t,e,i,n,r){for(var o=e[t[n].codePoint].advance,a=(t[n].x+o)*r,s=i;s<=n;s++)t[s].x-=a}function s(t,e,i,n,r){this.image=t,this.top=e,this.bottom=i,this.left=n,this.right=r}e.exports={shapeText:function(t,e,i,n,r,o,a,s,l){for(var u=[],c=new _(u,t,l[1],l[1],l[0],l[0]),h=l[0],p=l[1]+-17,f=0;f<t.length;f++){var d=t.charCodeAt(f),m=e[d];m&&(u.push(new y(d,h,p,m)),h+=m.advance+s)}return!!u.length&&(function(t,e,i,n,r,o,a){var s=null,l=0,u=0,c=0,h=0,p=t.positionedGlyphs;if(n)for(var f=0;f<p.length;f++){var d=p[f];if(d.x-=l,d.y+=i*c,d.x>n&&null!==s){var m=p[s+1].x;h=Math.max(m,h);for(var y=s+1;y<=f;y++)p[y].y+=i,p[y].x-=m;a&&x(p,e,u,s-1,a),u=s+1,s=null,l+=m,c++}b[d.codePoint]&&(s=f)}var _=p[p.length-1],g=_.x+e[_.codePoint].advance;h=Math.max(h,g);var v=(c+1)*i;x(p,e,u,p.length-1,a),function(t,e,i,n,r,o,a){for(var s=(e-i)*r,l=(-n*(a+1)+.5)*o,u=0;u<t.length;u++)t[u].x+=s,t[u].y+=l}(p,a,r,o,h,i,c),t.top+=-o*v,t.bottom=t.top+v,t.left+=-r*h,t.right=t.left+h}(c,e,n,i,r,o,a),c)},shapeIcon:function(t,e){if(!t||!t.rect)return null;var i=e["icon-offset"][0],n=e["icon-offset"][1],r=i-t.width/2,o=r+t.width,a=n-t.height/2;return new s(t,a,a+t.height,r,o)}};var b={32:!0}},{}],77:[function(t,e,i){function n(t,e){this.width=t,this.height=e,this.bin=new r(t,e),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0}function s(t,e,i,n){this.rect=t,this.width=e,this.height=i,this.sdf=n}var r=t("./bin_pack");((e.exports=n).prototype={get debug(){return"canvas"in this},set debug(t){t&&!this.canvas?(this.canvas=document.createElement("canvas"),this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.canvas.style.width=this.width+"px",this.canvas.style.width=this.width+"px",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")):!t&&this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),delete this.ctx,delete this.canvas)}}).resize=function(t){if(this.pixelRatio===t)return!1;var e=this.pixelRatio;if(this.pixelRatio=t,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio),this.data){var i=this.data;this.data=!1,this.allocate(),this.texture=!1;for(var n=this.width*e,r=this.height*e,o=this.width*t,a=this.height*t,s=this.data,l=i,u=0;u<a;u++)for(var c=Math.floor(u*r/a)*n,h=u*o,p=0;p<o;p++){var f=Math.floor(p*n/o);s[h+p]=l[c+f]}i=null,this.dirty=!0}return this.dirty},n.prototype.allocateImage=function(t,e){var i=t+2+(4-(t+2)%4),n=e+2+(4-(e+2)%4),r=this.bin.allocate(i,n);return 0===r.w||(r.originalWidth=t,r.originalHeight=e),r},n.prototype.getImage=function(t,e){if(this.images[t])return this.images[t];if(!this.sprite)return null;var i=this.sprite.getSpritePosition(t);if(!i.width||!i.height)return null;var n=i.width/i.pixelRatio,r=i.height/i.pixelRatio,o=this.allocateImage(n,r);if(0===o.w)return o;var a=new s(o,n,r,i.sdf);return this.images[t]=a,this.copy(o,i,e),a},n.prototype.getPosition=function(t,e){var i=this.getImage(t,e),n=i&&i.rect;if(!n)return null;var r=e?i.width:n.w,o=e?i.height:n.h;return{size:[r,o],tl:[(n.x+1)/this.width,(n.y+1)/this.height],br:[(n.x+1+r)/this.width,(n.y+1+o)/this.height]}},n.prototype.allocate=function(){if(!this.data){var t=Math.floor(this.width*this.pixelRatio),e=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(t*e);for(var i=0;i<this.data.length;i++)this.data[i]=0}},n.prototype.copy=function(t,e,i){if(this.sprite.img.data){var n=new Uint32Array(this.sprite.img.data.buffer);this.allocate();var r=this.data;(function(t,e,i,n,r,o,a,s,l,u,c){var h,p,f=n*e+i,d=s*o+a;if(c)for(d-=o,p=-1;p<=u;f=((++p+u)%u+n)*e+i,d+=o)for(h=-1;h<=l;h++)r[d+h]=t[f+(h+l)%l];else for(p=0;p<u;p++,f+=e,d+=o)for(h=0;h<l;h++)r[d+h]=t[f+h]})(n,this.sprite.img.width,e.x,e.y,r,this.width*this.pixelRatio,(t.x+1)*this.pixelRatio,(t.y+1)*this.pixelRatio,e.width,e.height,i),this.dirty=!0}},n.prototype.setSprite=function(t){this.sprite=t},n.prototype.addIcons=function(t,e){for(var i=0;i<t.length;i++)this.getImage(t[i]);e(null,this.images)},n.prototype.bind=function(t,e){var i=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i=!0);var n=e?t.LINEAR:t.NEAREST;if(n!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),this.filter=n),this.dirty&&(this.allocate(),i?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1,this.ctx)){var r=this.ctx.getImageData(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio);r.data.set(new Uint8ClampedArray(this.data.buffer)),this.ctx.putImageData(r,0,0),this.ctx.strokeStyle="red";for(var o=0;o<this.bin.free.length;o++){var a=this.bin.free[o];this.ctx.strokeRect(a.x*this.pixelRatio,a.y*this.pixelRatio,a.w*this.pixelRatio,a.h*this.pixelRatio)}}}},{"./bin_pack":63}],78:[function(t,e,i){var M=t("../util/util"),E=t("../util/interpolate"),n=t("../util/browser"),L=t("../geo/lng_lat"),u=t("../geo/lng_lat_bounds"),z=t("point-geometry"),r=e.exports=function(){};M.extend(r.prototype,{getCenter:function(){return this.transform.center},setCenter:function(t){return this.jumpTo({center:t}),this},panBy:function(t,e){return this.panTo(this.transform.center,M.extend({offset:z.convert(t).mult(-1)},e)),this},panTo:function(t,e){this.stop(),t=L.convert(t),e=M.extend({duration:500,easing:M.ease,offset:[0,0]},e);var i=this.transform,n=z.convert(e.offset).rotate(-i.angle),r=i.point,o=i.project(t).sub(n);return e.noMoveStart||this.fire("movestart"),this._ease(function(t){i.center=i.unproject(r.add(o.sub(r).mult(t))),this.fire("move")},function(){this.fire("moveend")},e),this},getZoom:function(){return this.transform.zoom},setZoom:function(t){return this.jumpTo({zoom:t}),this},zoomTo:function(e,t){this.stop(),(t=M.extend({duration:500},t)).easing=this._updateEasing(t.duration,e,t.easing);var i=this.transform,n=i.center,r=i.zoom;return t.around?n=L.convert(t.around):t.offset&&(n=i.pointLocation(i.centerPoint.add(z.convert(t.offset)))),!1===t.animate&&(t.duration=0),this.zooming||(this.zooming=!0,this.fire("movestart")),this._ease(function(t){i.setZoomAround(E(r,e,t),n),this.fire("move").fire("zoom")},function(){this.ease=null,200<=t.duration&&(this.zooming=!1,this.fire("moveend"))},t),t.duration<200&&(clearTimeout(this._onZoomEnd),this._onZoomEnd=setTimeout(function(){this.zooming=!1,this.fire("moveend")}.bind(this),200)),this},zoomIn:function(t){return this.zoomTo(this.getZoom()+1,t),this},zoomOut:function(t){return this.zoomTo(this.getZoom()-1,t),this},getBearing:function(){return this.transform.bearing},setBearing:function(t){return this.jumpTo({bearing:t}),this},rotateTo:function(e,t){this.stop(),t=M.extend({duration:500,easing:M.ease},t);var i=this.transform,n=this.getBearing(),r=i.center;return t.around?r=L.convert(t.around):t.offset&&(r=i.pointLocation(i.centerPoint.add(z.convert(t.offset)))),e=this._normalizeBearing(e,n),this.rotating=!0,this.fire("movestart"),this._ease(function(t){i.setBearingAround(E(n,e,t),r),this.fire("move").fire("rotate")},function(){this.rotating=!1,this.fire("moveend")},t),this},resetNorth:function(t){return this.rotateTo(0,M.extend({duration:1e3},t)),this},snapToNorth:function(t){return Math.abs(this.getBearing())<this.options.bearingSnap?this.resetNorth(t):this},getPitch:function(){return this.transform.pitch},setPitch:function(t){return this.jumpTo({pitch:t}),this},fitBounds:function(t,e){e=M.extend({padding:0,offset:[0,0],maxZoom:1/0},e),t=u.convert(t);var i=z.convert(e.offset),n=this.transform,r=n.project(t.getNorthWest()),o=n.project(t.getSouthEast()),a=o.sub(r),s=(n.width-2*e.padding-2*Math.abs(i.x))/a.x,l=(n.height-2*e.padding-2*Math.abs(i.y))/a.y;return e.center=n.unproject(r.add(o).div(2)),e.zoom=Math.min(n.scaleZoom(n.scale*Math.min(s,l)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e):this.flyTo(e)},jumpTo:function(t){this.stop();var e=this.transform,i=!1,n=!1,r=!1;return"center"in t&&(e.center=L.convert(t.center)),"zoom"in t&&e.zoom!==+t.zoom&&(i=!0,e.zoom=+t.zoom),"bearing"in t&&e.bearing!==+t.bearing&&(n=!0,e.bearing=+t.bearing),"pitch"in t&&e.pitch!==+t.pitch&&(r=!0,e.pitch=+t.pitch),this.fire("movestart").fire("move"),i&&this.fire("zoom"),n&&this.fire("rotate"),r&&this.fire("pitch"),this.fire("moveend")},easeTo:function(t){this.stop(),t=M.extend({offset:[0,0],duration:500,easing:M.ease},t);var e=this.transform,i=z.convert(t.offset).rotate(-e.angle),n=e.point,r=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s="zoom"in t?+t.zoom:r,l="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,c=e.zoomScale(s-r),h="center"in t?e.project(L.convert(t.center)).sub(i.div(c)):n,p=L.convert(t.around);return s!==r&&(this.zooming=!0),o!==l&&(this.rotating=!0),this.zooming&&!p&&(p=e.pointLocation(e.centerPoint.add(h.sub(n).div(1-1/c)))),this.fire("movestart"),this._ease(function(t){this.zooming?e.setZoomAround(E(r,s,t),p):e.center=e.unproject(n.add(h.sub(n).mult(t))),this.rotating&&(e.bearing=E(o,l,t)),u!==a&&(e.pitch=E(a,u,t)),this.fire("move"),this.zooming&&this.fire("zoom"),this.rotating&&this.fire("rotate")},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},t),this},flyTo:function(t){function e(t){var e=(g*g-_*_+(t?-1:1)*x*x*v*v)/(2*(t?g:_)*x*v);return Math.log(Math.sqrt(e*e+1)-e)}function i(t){return(Math.exp(t)-Math.exp(-t))/2}function n(t){return(Math.exp(t)+Math.exp(-t))/2}this.stop(),t=M.extend({offset:[0,0],speed:1.2,curve:1.42,easing:M.ease},t);var r=this.transform,o=z.convert(t.offset),a=this.getZoom(),s=this.getBearing(),l="center"in t?L.convert(t.center):this.getCenter(),u="zoom"in t?+t.zoom:a,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,h=r.zoomScale(u-a),p=r.point,f=r.project(l).sub(o.div(h)),d=r.worldSize,m=t.curve,y=t.speed,_=Math.max(r.width,r.height),g=_/h,v=f.sub(p).mag(),x=m*m,b=e(0),w=function(t){return n(b)/n(b+m*t)},T=function(t){return _*((n(b)*(i(e=b+m*t)/n(e))-i(b))/x)/v;var e},S=(e(1)-b)/m;if(Math.abs(v)<1e-6){if(Math.abs(_-g)<1e-6)return this;var A=g<_?-1:1;S=Math.abs(Math.log(g/_))/m,T=function(){return 0},w=function(t){return Math.exp(A*m*t)}}return t.duration=1e3*S/y,this.zooming=!0,s!==c&&(this.rotating=!0),this.fire("movestart"),this._ease(function(t){var e=t*S,i=T(e);r.zoom=a+r.scaleZoom(1/w(e)),r.center=r.unproject(p.add(f.sub(p).mult(i)),d),c!==s&&(r.bearing=E(s,c,t)),this.fire("move").fire("zoom"),c!==s&&this.fire("rotate")},function(){this.zooming=!1,this.rotating=!1,this.fire("moveend")},t),this},isEasing:function(){return!!this._abortFn},stop:function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},_ease:function(e,t,i){this._finishFn=t,this._abortFn=n.timed(function(t){e.call(this,i.easing(t)),1===t&&this._finishEase()},!1===i.animate?0:i.duration,this)},_finishEase:function(){delete this._abortFn;var t=this._finishFn;delete this._finishFn,t.call(this)},_normalizeBearing:function(t,e){t=M.wrap(t,-180,180);var i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t},_updateEasing:function(t,e,i){var n;if(this.ease){var r=this.ease,o=(Date.now()-r.start)/r.duration,a=r.easing(o+.01)-r.easing(o),s=.27/Math.sqrt(a*a+1e-4)*.01,l=Math.sqrt(.0729-s*s);n=M.bezier(s,l,.25,1)}else n=i?M.bezier.apply(M,i):M.ease;return this.ease={start:(new Date).getTime(),to:Math.pow(2,e),duration:t,easing:n},n}})},{"../geo/lng_lat":20,"../geo/lng_lat_bounds":21,"../util/browser":95,"../util/interpolate":102,"../util/util":106,"point-geometry":137}],79:[function(t,e,i){function n(){}var r=t("./control"),o=t("../../util/dom"),a=t("../../util/util");(e.exports=n).prototype=a.inherit(r,{options:{position:"bottom-right"},onAdd:function(t){var e=this._container=o.create("div","mapboxgl-ctrl-attrib",t.getContainer());return this._update(),t.on("source.load",this._update.bind(this)),t.on("source.change",this._update.bind(this)),t.on("source.remove",this._update.bind(this)),t.on("moveend",this._updateEditLink.bind(this)),e},_update:function(){var t=[];if(this._map.style)for(var e in this._map.style.sources){var i=this._map.style.sources[e];i.attribution&&t.indexOf(i.attribution)<0&&t.push(i.attribution)}this._container.innerHTML=t.join(" | "),this._editLink=this._container.getElementsByClassName("mapbox-improve-map")[0],this._updateEditLink()},_updateEditLink:function(){if(this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}}})},{"../../util/dom":98,"../../util/util":106,"./control":80}],80:[function(t,e,i){function n(){}(e.exports=n).prototype={addTo:function(t){this._map=t;var e=this._container=this.onAdd(t);if(this.options&&this.options.position){var i=this.options.position,n=t._controlCorners[i];e.className+=" mapboxgl-ctrl",-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e)}return this},remove:function(){return this._container.parentNode.removeChild(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this}}},{}],81:[function(t,e,i){function n(t){a.setOptions(this,t)}var r=t("./control"),o=t("../../util/dom"),a=t("../../util/util");(e.exports=n).prototype=a.inherit(r,{options:{position:"top-right"},onAdd:function(t){var e="mapboxgl-ctrl",i=this._container=o.create("div",e+"-group",t.getContainer());this._zoomInButton=this._createButton(e+"-icon "+e+"-zoom-in",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(e+"-icon "+e+"-zoom-out",t.zoomOut.bind(t)),this._compass=this._createButton(e+"-compass",t.resetNorth.bind(t));var n=this._compassCanvas=o.create("canvas",e+"-compass-canvas",this._compass);return n.style.cssText="width:30px; height:30px;",n.width=52,n.height=52,this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._compassCtx=n.getContext("2d"),t.on("rotate",this._drawNorth.bind(this)),this._drawNorth(),i},_onCompassDown:function(t){o.disableDrag(),document.addEventListener("mousemove",this._onCompassMove),document.addEventListener("mouseup",this._onCompassUp),this._prevX=t.screenX,t.stopPropagation()},_onCompassMove:function(t){var e=t.screenX,i=e<2?-5:e>window.screen.width-2?5:(e-this._prevX)/4;this._map.setBearing(this._map.getBearing()-i),this._prevX=t.screenX,this._moved=!0,t.preventDefault()},_onCompassUp:function(){document.removeEventListener("mousemove",this._onCompassMove),document.removeEventListener("mouseup",this._onCompassUp),o.enableDrag(),this._moved&&(this._moved=!1,o.suppressClick()),this._map.snapToNorth()},_createButton:function(t,e){var i=o.create("button",t,this._container);return i.addEventListener("click",function(){e()}),i},_drawNorth:function(){var t=this._map.transform.angle+Math.PI/2,e=this._compassCtx;this._compassCanvas.width=this._compassCanvas.width,e.translate(26,26),e.rotate(t),e.beginPath(),e.fillStyle="#000",e.lineTo(0,-8),e.lineTo(-20,0),e.lineTo(0,8),e.fill(),e.beginPath(),e.fillStyle="#bbb",e.moveTo(0,0),e.lineTo(0,8),e.lineTo(20,0),e.lineTo(0,-8),e.fill(),e.beginPath(),e.strokeStyle="#fff",e.lineWidth=4,e.moveTo(0,-8),e.lineTo(0,8),e.stroke()}})},{"../../util/dom":98,"../../util/util":106,"./control":80}],82:[function(t,e,i){function n(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),o.bindHandlers(this)}var s=t("../../util/dom"),r=t("../../geo/lng_lat_bounds"),o=t("../../util/util");(e.exports=n).prototype={enable:function(){this._el.addEventListener("mousedown",this._onMouseDown,!1)},disable:function(){this._el.removeEventListener("mousedown",this._onMouseDown)},_onMouseDown:function(t){(t.shiftKey||1===t.which&&1===t.button)&&(document.addEventListener("mousemove",this._onMouseMove,!1),document.addEventListener("keydown",this._onKeyDown,!1),document.addEventListener("mouseup",this._onMouseUp,!1),this._startPos=s.mousePos(this._el,t),this.active=!0)},_onMouseMove:function(t){var e=this._startPos,i=s.mousePos(this._el,t);this._box||(this._box=s.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),s.disableDrag(),this._map.fire("boxzoomstart"));var n=Math.min(e.x,i.x),r=Math.max(e.x,i.x),o=Math.min(e.y,i.y),a=Math.max(e.y,i.y);s.setTransform(this._box,"translate("+n+"px,"+o+"px)"),this._box.style.width=r-n+"px",this._box.style.height=a-o+"px"},_onMouseUp:function(t){var e=this._startPos,i=s.mousePos(this._el,t),n=new r(this._map.unproject(e),this._map.unproject(i));this._finish(),this._map.fitBounds(n,{linear:!0}).fire("boxzoomend",{boxZoomBounds:n})},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._map.fire("boxzoomcancel"))},_finish:function(){this._box&&(this.active=!1,document.removeEventListener("mousemove",this._onMouseMove,!1),document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box.parentNode.removeChild(this._box),this._box=null,s.enableDrag())}}},{"../../geo/lng_lat_bounds":21,"../../util/dom":98,"../../util/util":106}],83:[function(t,e,i){function n(t){this._map=t,this._onDblClick=this._onDblClick.bind(this)}(e.exports=n).prototype={enable:function(){this._map.on("dblclick",this._onDblClick)},disable:function(){this._map.off("dblclick",this._onDblClick)},_onDblClick:function(t){this._map.zoomTo(Math.round(this._map.getZoom())+1,{around:t.lngLat})}}},{}],84:[function(t,e,i){function n(t){this._map=t,this._el=t.getCanvasContainer(),r.bindHandlers(this)}var o=t("../../util/dom"),r=t("../../util/util");e.exports=n;var u=r.bezier(0,0,.25,1);n.prototype={enable:function(){this._el.addEventListener("mousedown",this._onDown,!1),this._el.addEventListener("touchstart",this._onDown,!1)},disable:function(){this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown)},_onDown:function(t){this._startPos=this._pos=o.mousePos(this._el,t),this._inertia=[[Date.now(),this._pos]],t.touches?1===t.touches.length&&(document.addEventListener("touchmove",this._onMove,!1),document.addEventListener("touchend",this._onTouchEnd,!1)):(document.addEventListener("mousemove",this._onMove,!1),document.addEventListener("mouseup",this._onMouseUp,!1))},_onMove:function(t){var e=this._map;if(!(e.boxZoom.active||e.dragRotate.active||t.touches&&1<t.touches.length)){this.active=!0;var i=o.mousePos(this._el,t),n=this._inertia,r=Date.now();for(n.push([r,i]);2<n.length&&50<r-n[0][0];)n.shift();e.stop(),e.transform.setLocationAtPoint(e.transform.pointLocation(this._pos),i),e.fire("move"),this._pos=i,t.preventDefault()}},_onUp:function(){var t=this._inertia;if(t.length<2)this._map.fire("moveend");else{var e=t[t.length-1],i=t[0],n=e[1].sub(i[1]),r=(e[0]-i[0])/1e3,o=n.mult(.25/r),a=o.mag();3e3<a&&(a=3e3,o._unit()._mult(a));var s=a/1e3,l=o.mult(-s/2);this._map.panBy(l,{duration:1e3*s,easing:u,noMoveStart:!0}),this.active=!1}},_onMouseUp:function(){this._onUp(),document.removeEventListener("mousemove",this._onMove,!1),document.removeEventListener("mouseup",this._onMouseUp,!1)},_onTouchEnd:function(){this._onUp(),document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd)}}},{"../../util/dom":98,"../../util/util":106}],85:[function(t,e,i){function n(t){this._map=t,this._el=t.getCanvasContainer(),r.bindHandlers(this)}var u=t("../../util/dom"),c=t("point-geometry"),r=t("../../util/util");(e.exports=n).prototype={enable:function(){this._el.addEventListener("contextmenu",this._onContextMenu,!1)},disable:function(){this._el.removeEventListener("contextmenu",this._onContextMenu)},_onContextMenu:function(t){this._map.stop(),this._startPos=this._pos=u.mousePos(this._el,t),document.addEventListener("mousemove",this._onMouseMove,!1),document.addEventListener("mouseup",this._onMouseUp,!1),t.preventDefault()},_onMouseMove:function(t){var e=this._startPos,i=this._pos,n=u.mousePos(this._el,t),r=this._map,o=r.transform.centerPoint,a=e.sub(o),s=a.mag();this.active=!0,r.rotating||(r.fire("movestart"),r.rotating=!0),s<200&&(o=e.add(new c(-200,0)._rotate(a.angle())));var l=i.sub(o).angleWith(n.sub(o))/Math.PI*180;r.transform.bearing=r.getBearing()-l,r.fire("move").fire("rotate"),clearTimeout(this._timeout),this._timeout=setTimeout(this._onTimeout,200),this._pos=n},_onTimeout:function(){var t=this._map;t.rotating=!1,t.snapToNorth(),t.rotating||(t._rerender(),t.fire("moveend"))},_onMouseUp:function(){this.active=!1,document.removeEventListener("mousemove",this._onMouseMove,!1),document.removeEventListener("mouseup",this._onMouseUp,!1)}}},{"../../util/dom":98,"../../util/util":106,"point-geometry":137}],86:[function(t,e,i){function n(t){this._map=t,this._el=t.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)}(e.exports=n).prototype={enable:function(){this._el.addEventListener("keydown",this._onKeyDown,!1)},disable:function(){this._el.removeEventListener("keydown",this._onKeyDown)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=this._map;switch(t.keyCode){case 61:case 107:case 171:case 187:e.zoomTo(Math.round(e.getZoom())+(t.shiftKey?2:1));break;case 189:case 109:case 173:e.zoomTo(Math.round(e.getZoom())-(t.shiftKey?2:1));break;case 37:t.shiftKey?e.setBearing(e.getBearing()-2):e.panBy([-80,0]);break;case 39:t.shiftKey?e.setBearing(e.getBearing()+2):e.panBy([80,0]);break;case 38:e.panBy([0,-80]);break;case 40:e.panBy([0,80])}}}}},{}],87:[function(t,e,i){function n(t){this._map=t,this._el=t.getCanvasContainer(),r.bindHandlers(this)}var l=t("../../util/dom"),r=t("../../util/util");(e.exports=n).prototype={enable:function(){this._el.addEventListener("touchstart",this._onStart,!1)},disable:function(){this._el.removeEventListener("touchstart",this._onStart)},_onStart:function(t){if(2===t.touches.length){var e=l.mousePos(this._el,t.touches[0]),i=l.mousePos(this._el,t.touches[1]);this._startVec=e.sub(i),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,document.addEventListener("touchmove",this._onMove,!1),document.addEventListener("touchend",this._onEnd,!1)}},_onMove:function(t){if(2===t.touches.length){var e=l.mousePos(this._el,t.touches[0]),i=l.mousePos(this._el,t.touches[1]),n=e.add(i).div(2),r=e.sub(i),o=r.mag()/this._startVec.mag(),a=180*r.angleWith(this._startVec)/Math.PI,s=this._map;s.easeTo({zoom:s.transform.scaleZoom(this._startScale*o),bearing:this._startBearing+a,duration:0,around:s.unproject(n)}),t.preventDefault()}},_onEnd:function(){this._map.snapToNorth(),document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onEnd)}}},{"../../util/dom":98,"../../util/util":106}],88:[function(t,e,i){function n(t){this._map=t,this._el=t.getCanvasContainer(),a.bindHandlers(this)}var r=t("../../util/dom"),o=t("../../util/browser"),a=t("../../util/util");e.exports=n;var s="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",l=-1!==s.indexOf("firefox"),u=-1!==s.indexOf("safari")&&-1===s.indexOf("chrom");n.prototype={enable:function(){this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1)},disable:function(){this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel)},_onWheel:function(t){var e;"wheel"===t.type?(e=t.deltaY,l&&t.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL&&(e/=o.devicePixelRatio),t.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(e*=40)):"mousewheel"===t.type&&(e=-t.wheelDeltaY,u&&(e/=3));var i=(window.performance||Date).now(),n=i-(this._time||0);this._pos=r.mousePos(this._el,t),this._time=i,0!==e&&e%4.000244140625==0?(this._type="wheel",e=Math.floor(e/4)):0!==e&&Math.abs(e)<4?this._type="trackpad":400<n?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&this._zoom(-e),t.preventDefault()},_onTimeout:function(){this._type="wheel",this._zoom(-this._lastValue)},_zoom:function(t){var e=this._map,i=2/(1+Math.exp(-Math.abs(t/100)));t<0&&0!==i&&(i=1/i);var n=e.ease?e.ease.to:e.transform.scale,r=e.transform.scaleZoom(n*i);e.zoomTo(r,{duration:0,around:e.unproject(this._pos)})}}},{"../../util/browser":95,"../../util/dom":98,"../../util/util":106}],89:[function(t,e,i){function n(){r.bindAll(["_onHashChange","_updateHash"],this)}e.exports=n;var r=t("../util/util");n.prototype={addTo:function(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},remove:function(){return window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},_onHashChange:function(){var t=location.hash.replace("#","").split("/");return 3<=t.length&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0)}),!0)},_updateHash:function(){var t=this._map.getCenter(),e=this._map.getZoom(),i=this._map.getBearing(),n=Math.max(0,Math.ceil(Math.log(e)/Math.LN2)),r="#"+Math.round(100*e)/100+"/"+t.lat.toFixed(n)+"/"+t.lng.toFixed(n)+(i?"/"+Math.round(10*i)/10:"");window.history.replaceState("","",r)}}},{"../util/util":106}],90:[function(t,e,i){function n(t){for(var e in this._map=t,this._el=t.getCanvasContainer(),r)t[e]=new r[e](t);a.bindHandlers(this)}var r={scrollZoom:t("./handler/scroll_zoom"),boxZoom:t("./handler/box_zoom"),dragRotate:t("./handler/drag_rotate"),dragPan:t("./handler/drag_pan"),keyboard:t("./handler/keyboard"),doubleClickZoom:t("./handler/dblclick_zoom"),pinch:t("./handler/pinch")},o=t("../util/dom"),a=t("../util/util");(e.exports=n).prototype={enable:function(){var t=this._map.options,e=this._el;for(var i in r)t[i]&&this._map[i].enable();e.addEventListener("mousedown",this._onMouseDown,!1),e.addEventListener("mouseup",this._onMouseUp,!1),e.addEventListener("touchstart",this._onTouchStart,!1),e.addEventListener("click",this._onClick,!1),e.addEventListener("mousemove",this._onMouseMove,!1),e.addEventListener("dblclick",this._onDblClick,!1),e.addEventListener("contextmenu",this._onContextMenu,!1)},disable:function(){var t=this._map.options,e=this._el;for(var i in r)t[i]&&this._map[i].disable();e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp),e.removeEventListener("touchstart",this._onTouchStart),e.removeEventListener("click",this._onClick),e.removeEventListener("mousemove",this._onMouseMove),e.removeEventListener("dblclick",this._onDblClick),e.removeEventListener("contextmenu",this._onContextMenu)},_onMouseDown:function(t){this._startPos=o.mousePos(this._el,t)},_onMouseUp:function(t){!this._contextMenuFired||this._map.dragRotate.active||this._map.dragPan.active||this._fireEvent("contextmenu",t),this._contextMenuFired=null},_onTouchStart:function(t){!t.touches||1<t.touches.length||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._fireEvent("dblclick",t)):this._tapped=setTimeout(this._onTimeout,300))},_onTimeout:function(){this._tapped=null},_onMouseMove:function(t){var e=this._map,i=this._el;if(!e.dragPan.active&&!e.dragRotate.active){for(var n=t.toElement||t.target;n&&n!==i;)n=n.parentNode;n===i&&this._fireEvent("mousemove",t)}},_onClick:function(t){o.mousePos(this._el,t).equals(this._startPos)&&this._fireEvent("click",t)},_onDblClick:function(t){this._fireEvent("dblclick",t),t.preventDefault()},_onContextMenu:function(){this._contextMenuFired=!0},_fireEvent:function(t,e){var i=o.mousePos(this._el,e);this._map.fire(t,{lngLat:this._map.unproject(i),point:i,originalEvent:e})}}},{"../util/dom":98,"../util/util":106,"./handler/box_zoom":82,"./handler/dblclick_zoom":83,"./handler/drag_pan":84,"./handler/drag_rotate":85,"./handler/keyboard":86,"./handler/pinch":87,"./handler/scroll_zoom":88}],91:[function(t,e,i){var o=t("../util/canvas"),n=t("../util/util"),r=t("../util/browser"),a=t("../util/evented"),s=t("../util/dom"),l=t("../style/style"),u=t("../style/animation_loop"),c=t("../render/painter"),h=t("../geo/transform"),p=t("./hash"),f=t("./interaction"),d=t("./camera"),m=t("../geo/lng_lat"),y=t("../geo/lng_lat_bounds"),_=t("point-geometry"),g=t("./control/attribution"),v=e.exports=function(t){if(t=this.options=n.inherit(this.options,t),this.animationLoop=new u,this.transform=new h(t.minZoom,t.maxZoom),t.maxBounds){var e=y.convert(t.maxBounds);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()]}n.bindAll(["_forwardStyleEvent","_forwardSourceEvent","_forwardLayerEvent","_forwardTileEvent","_onStyleLoad","_onStyleChange","_onSourceAdd","_onSourceRemove","_onSourceUpdate","_onWindowResize","onError","update","render"],this),this._setupContainer(),this._setupPainter(),this.on("move",this.update),this.on("zoom",this.update.bind(this,!0)),this.on("moveend",function(){this.animationLoop.set(300),this._rerender()}.bind(this)),"undefined"!=typeof window&&window.addEventListener("resize",this._onWindowResize,!1),this.interaction=new f(this),t.interactive&&this.interaction.enable(),this._hash=t.hash&&(new p).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo(t),this.sources={},this.stacks={},this._classes={},this.resize(),t.classes&&this.setClasses(t.classes),t.style&&this.setStyle(t.style),t.attributionControl&&this.addControl(new g),this.on("style.error",this.onError),this.on("source.error",this.onError),this.on("tile.error",this.onError)};n.extend(v.prototype,a),n.extend(v.prototype,d.prototype),n.extend(v.prototype,{options:{center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:20,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,pinch:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1},addControl:function(t){return t.addTo(this),this},addClass:function(t,e){this._classes[t]||(this._classes[t]=!0,this.style&&this.style._cascade(this._classes,e))},removeClass:function(t,e){this._classes[t]&&(delete this._classes[t],this.style&&this.style._cascade(this._classes,e))},setClasses:function(t,e){this._classes={};for(var i=0;i<t.length;i++)this._classes[t[i]]=!0;this.style&&this.style._cascade(this._classes,e)},hasClass:function(t){return!!this._classes[t]},getClasses:function(){return Object.keys(this._classes)},resize:function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),this._canvas.resize(t,e),this.transform.width=t,this.transform.height=e,this.transform._constrain(),this.painter.resize(t,e),this.fire("movestart").fire("move").fire("resize").fire("moveend")},getBounds:function(){return new y(this.transform.pointLocation(new _(0,0)),this.transform.pointLocation(this.transform.size))},project:function(t){return this.transform.locationPoint(m.convert(t))},unproject:function(t){return this.transform.pointLocation(_.convert(t))},featuresAt:function(t,e,i){var n=this.unproject(t).wrap(),r=this.transform.locationCoordinate(n);return this.style.featuresAt(r,e,i),this},featuresIn:function(t,e,i){return void 0===i&&(i=e,e=t,t=[_.convert([0,0]),_.convert([this.transform.width,this.transform.height])]),t=t.map(_.convert.bind(_)),t=[new _(Math.min(t[0].x,t[1].x),Math.min(t[0].y,t[1].y)),new _(Math.max(t[0].x,t[1].x),Math.max(t[0].y,t[1].y))].map(this.transform.pointCoordinate.bind(this.transform)),this.style.featuresIn(t,e,i),this},batch:function(t){this.style.batch(t),this.style._cascade(this._classes),this.update(!0)},setStyle:function(t){return this.style&&(this.style.off("load",this._onStyleLoad).off("error",this._forwardStyleEvent).off("change",this._onStyleChange).off("source.add",this._onSourceAdd).off("source.remove",this._onSourceRemove).off("source.load",this._onSourceUpdate).off("source.error",this._forwardSourceEvent).off("source.change",this._onSourceUpdate).off("layer.add",this._forwardLayerEvent).off("layer.remove",this._forwardLayerEvent).off("tile.add",this._forwardTileEvent).off("tile.remove",this._forwardTileEvent).off("tile.load",this.update).off("tile.error",this._forwardTileEvent).off("tile.stats",this._forwardTileEvent)._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),t?(this.style=t instanceof l?t:new l(t,this.animationLoop),this.style.on("load",this._onStyleLoad).on("error",this._forwardStyleEvent).on("change",this._onStyleChange).on("source.add",this._onSourceAdd).on("source.remove",this._onSourceRemove).on("source.load",this._onSourceUpdate).on("source.error",this._forwardSourceEvent).on("source.change",this._onSourceUpdate).on("layer.add",this._forwardLayerEvent).on("layer.remove",this._forwardLayerEvent).on("tile.add",this._forwardTileEvent).on("tile.remove",this._forwardTileEvent).on("tile.load",this.update).on("tile.error",this._forwardTileEvent).on("tile.stats",this._forwardTileEvent),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement)):this.style=null,this},addSource:function(t,e){return this.style.addSource(t,e),this},removeSource:function(t){return this.style.removeSource(t),this},getSource:function(t){return this.style.getSource(t)},addLayer:function(t,e){return this.style.addLayer(t,e),this.style._cascade(this._classes),this},removeLayer:function(t){return this.style.removeLayer(t),this.style._cascade(this._classes),this},setFilter:function(t,e){return this.style.setFilter(t,e),this},setLayerZoomRange:function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this},getFilter:function(t){return this.style.getFilter(t)},setPaintProperty:function(e,i,n,r){return this.batch(function(t){t.setPaintProperty(e,i,n,r)}),this},getPaintProperty:function(t,e,i){return this.style.getPaintProperty(t,e,i)},setLayoutProperty:function(e,i,n){return this.batch(function(t){t.setLayoutProperty(e,i,n)}),this},getLayoutProperty:function(t,e){return this.style.getLayoutProperty(t,e)},getContainer:function(){return this._container},getCanvasContainer:function(){return this._canvasContainer},getCanvas:function(){return this._canvas.getElement()},_setupContainer:function(){var t=this.options.container,e=this._container="string"==typeof t?document.getElementById(t):t;e.classList.add("mapboxgl-map");var i=this._canvasContainer=s.create("div","mapboxgl-canvas-container",e);this.options.interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=new o(this,i);var n=s.create("div","mapboxgl-control-container",e),r=this._controlCorners={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){r[t]=s.create("div","mapboxgl-ctrl-"+t,n)})},_setupPainter:function(){var t=this._canvas.getWebGLContext({failIfMajorPerformanceCaveat:this.options.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.options.preserveDrawingBuffer});return t?void(this.painter=new c(t,this.transform)):void console.error("Failed to initialize WebGL")},_contextLost:function(t){t.preventDefault(),this._frameId&&r.cancelFrame(this._frameId)},_contextRestored:function(){this._setupPainter(),this.resize(),this.update()},loaded:function(){return!(this._styleDirty||this._sourcesDirty||this.style&&!this.style.loaded())},update:function(t){return this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender()),this},render:function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&!this._sourcesDirtyTimeout&&(this._sourcesDirty=!1,this._sourcesDirtyTimeout=setTimeout(function(){this._sourcesDirtyTimeout=null}.bind(this),50),this.style._updateSources(this.transform)),this.painter.render(this.style,{debug:this.debug,vertices:this.vertices,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||!this.animationLoop.stopped())&&this._rerender(),this},remove:function(){return this._hash&&this._hash.remove(),r.cancelFrame(this._frameId),clearTimeout(this._sourcesDirtyTimeout),this.setStyle(null),"undefined"!=typeof window&&window.removeEventListener("resize",this._onWindowResize,!1),this},onError:function(t){console.error(t.error)},_rerender:function(){this.style&&!this._frameId&&(this._frameId=r.frame(this.render))},_forwardStyleEvent:function(t){this.fire("style."+t.type,n.extend({style:t.target},t))},_forwardSourceEvent:function(t){this.fire(t.type,n.extend({style:t.target},t))},_forwardLayerEvent:function(t){this.fire(t.type,n.extend({style:t.target},t))},_forwardTileEvent:function(t){this.fire(t.type,n.extend({style:t.target},t))},_onStyleLoad:function(t){var e=new h,i=this.transform;i.center.lng===e.center.lng&&i.center.lat===e.center.lat&&i.zoom===e.zoom&&i.bearing===e.bearing&&i.pitch===e.pitch&&this.jumpTo(this.style.stylesheet),this.style._cascade(this._classes,{transition:!1}),this._forwardStyleEvent(t)},_onStyleChange:function(t){this.update(!0),this._forwardStyleEvent(t)},_onSourceAdd:function(t){var e=t.source;e.onAdd&&e.onAdd(this),this._forwardSourceEvent(t)},_onSourceRemove:function(t){var e=t.source;e.onRemove&&e.onRemove(this),this._forwardSourceEvent(t)},_onSourceUpdate:function(t){this.update(),this._forwardSourceEvent(t)},_onWindowResize:function(){this.stop().resize().update()}}),n.extendAll(v.prototype,{_debug:!1,get debug(){return this._debug},set debug(t){this._debug=t,this.update()},_collisionDebug:!1,get collisionDebug(){return this._collisionDebug},set collisionDebug(t){this._collisionDebug=t,this.style._redoPlacement()},_repaint:!1,get repaint(){return this._repaint},set repaint(t){this._repaint=t,this.update()},_vertices:!1,get vertices(){return this._vertices},set vertices(t){this._vertices=t,this.update()}})},{"../geo/lng_lat":20,"../geo/lng_lat_bounds":21,"../geo/transform":22,"../render/painter":37,"../style/animation_loop":51,"../style/style":56,"../util/browser":95,"../util/canvas":96,"../util/dom":98,"../util/evented":100,"../util/util":106,"./camera":78,"./control/attribution":79,"./hash":89,"./interaction":90,"point-geometry":137}],92:[function(t,e,i){function n(t){r.setOptions(this,t),r.bindAll(["_updatePosition","_onClickClose"],this)}e.exports=n;var r=t("../util/util"),o=t("../util/evented"),s=t("../util/dom"),a=t("../geo/lng_lat");n.prototype=r.inherit(o,{options:{closeButton:!0,closeOnClick:!0},addTo:function(t){return this._map=t,this._map.on("move",this._updatePosition),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},remove:function(){return this._container&&this._container.parentNode.removeChild(this._container),this._map&&(this._map.off("move",this._updatePosition),this._map.off("click",this._onClickClose),delete this._map),this},getLngLat:function(){return this._lngLat},setLngLat:function(t){return this._lngLat=a.convert(t),this._update(),this},setText:function(t){return this._content=document.createTextNode(t),this._updateContent(),this},setHTML:function(t){this._content=document.createDocumentFragment();var e,i=document.createElement("body");for(i.innerHTML=t;e=i.firstChild;)this._content.appendChild(e);return this._updateContent(),this},_update:function(){this._map&&(this._container||(this._container=s.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=s.create("div","mapboxgl-popup-tip",this._container),this._wrapper=s.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=s.create("button","mapboxgl-popup-close-button",this._wrapper),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))),this._updateContent(),this._updatePosition())},_updateContent:function(){if(this._content&&this._container){for(var t=this._wrapper;t.hasChildNodes();)t.removeChild(t.firstChild);this.options.closeButton&&t.appendChild(this._closeButton),t.appendChild(this._content)}},_updatePosition:function(){if(this._lngLat&&this._container){var t=this._map.project(this._lngLat).round(),e=this.options.anchor;if(!e){var i=this._container.offsetWidth,n=this._container.offsetHeight;e=t.y<n?["top"]:t.y>this._map.transform.height-n?["bottom"]:[],t.x<i/2?e.push("left"):t.x>this._map.transform.width-i/2&&e.push("right"),e=0===e.length?"bottom":e.join("-"),this.options.anchor=e}var r={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},o=this._container.classList;for(var a in r)o.remove("mapboxgl-popup-anchor-"+a);o.add("mapboxgl-popup-anchor-"+e),s.setTransform(this._container,r[e]+" translate("+t.x+"px,"+t.y+"px)")}},_onClickClose:function(){this.remove()}})},{"../geo/lng_lat":20,"../util/dom":98,"../util/evented":100,"../util/util":106}],93:[function(t,e,i){function n(t,e){this.target=t,this.parent=e,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)}(e.exports=n).prototype.receive=function(t){var e,i=t.data;if("<response>"===i.type)e=this.callbacks[i.id],delete this.callbacks[i.id],e(i.error||null,i.data);else if(void 0!==i.id){var n=i.id;this.parent[i.type](i.data,function(t,e,i){this.postMessage({type:"<response>",id:String(n),error:t?String(t):null,data:e},i)}.bind(this))}else this.parent[i.type](i.data)},n.prototype.send=function(t,e,i,n){var r=null;i&&(this.callbacks[r=this.callbackID++]=i),this.postMessage({type:t,id:String(r),data:e},n)},n.prototype.postMessage=function(t,e){try{this.target.postMessage(t,e)}catch(e){this.target.postMessage(t)}}},{}],94:[function(t,e,i){i.getJSON=function(t,e){var i=new XMLHttpRequest;return i.open("GET",t,!0),i.setRequestHeader("Accept","application/json"),i.onerror=function(t){e(t)},i.onload=function(){if(200<=i.status&&i.status<300&&i.response){var t;try{t=JSON.parse(i.response)}catch(t){return e(t)}e(null,t)}else e(new Error(i.statusText))},i.send(),i},i.getArrayBuffer=function(t,e){var i=new XMLHttpRequest;return i.open("GET",t,!0),i.responseType="arraybuffer",i.onerror=function(t){e(t)},i.onload=function(){200<=i.status&&i.status<300&&i.response?e(null,i.response):e(new Error(i.statusText))},i.send(),i},i.getImage=function(t,r){return i.getArrayBuffer(t,function(t,e){t&&r(t);var i=new Image;i.onload=function(){r(null,i),(window.URL||window.webkitURL).revokeObjectURL(i.src)};var n=new Blob([new Uint8Array(e)],{type:"image/png"});return i.src=(window.URL||window.webkitURL).createObjectURL(n),i.getData=function(){var t=document.createElement("canvas"),e=t.getContext("2d");return t.width=i.width,t.height=i.height,e.drawImage(i,0,0),e.getImageData(0,0,i.width,i.height).data},i})},i.getVideo=function(t,e){var i,n,r=document.createElement("video");r.onloadstart=function(){e(null,r)};for(var o=0;o<t.length;o++){var a=document.createElement("source");i=t[o],n=void 0,(n=document.createElement("a")).href=i,n.protocol===document.location.protocol&&n.host===document.location.host||(r.crossOrigin="Anonymous"),a.src=t[o],r.appendChild(a)}return r.getData=function(){return r},r}},{}],95:[function(t,e,s){var n=t("./canvas"),i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;s.frame=function(t){return i(t)};var r=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;s.cancelFrame=function(t){r(t)},s.timed=function(i,n,r){if(!n)return i.call(r,1),null;var o=!1,a=window.performance?window.performance.now():Date.now();return s.frame(function t(e){o||(window.performance||(e=Date.now()),a+n<=e?i.call(r,1):(i.call(r,(e-a)/n),s.frame(t)))}),function(){o=!0}},s.supported=function(t){for(var e=[function(){return"undefined"!=typeof window},function(){return"undefined"!=typeof document},function(){return!!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)},function(){return!(!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions))},function(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON},function(){return(new n).supportsWebGLContext(t&&t.failIfMajorPerformanceCaveat||!1)},function(){return"Worker"in window}],i=0;i<e.length;i++)if(!e[i]())return!1;return!0},s.hardwareConcurrency=navigator.hardwareConcurrency||8,Object.defineProperty(s,"devicePixelRatio",{get:function(){return window.devicePixelRatio}})},{"./canvas":96}],96:[function(t,e,i){function n(t,e){this.canvas=document.createElement("canvas"),t&&e&&(this.canvas.style.position="absolute",this.canvas.classList.add("mapboxgl-canvas"),this.canvas.addEventListener("webglcontextlost",t._contextLost.bind(t),!1),this.canvas.addEventListener("webglcontextrestored",t._contextRestored.bind(t),!1),this.canvas.setAttribute("tabindex",0),e.appendChild(this.canvas))}var r=t("../util"),o={antialias:!((e.exports=n).prototype.resize=function(t,e){var i=window.devicePixelRatio||1;this.canvas.width=i*t,this.canvas.height=i*e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"}),alpha:!0,stencil:!0,depth:!1};n.prototype.getWebGLContext=function(t){return t=r.extend({},t,o),this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t)},n.prototype.supportsWebGLContext=function(t){var e=r.extend({failIfMajorPerformanceCaveat:t},o);return"probablySupportsContext"in this.canvas?this.canvas.probablySupportsContext("webgl",e)||this.canvas.probablySupportsContext("experimental-webgl",e):"supportsContext"in this.canvas?this.canvas.supportsContext("webgl",e)||this.canvas.supportsContext("experimental-webgl",e):!!window.WebGLRenderingContext&&!!this.getWebGLContext(t)},n.prototype.getElement=function(){return this.canvas}},{"../util":106}],97:[function(o,t,e){function i(t,e){this.actors=[];for(var i=this.currentActor=0;i<t;i++){var n=new s(o("../../source/worker")),r=new a(n,e);r.name="Worker "+i,this.actors.push(r)}}var a=o("../actor"),s=o("webworkify");(t.exports=i).prototype={broadcast:function(t,e){for(var i=0;i<this.actors.length;i++)this.actors[i].send(t,e)},send:function(t,e,i,n,r){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[n].send(t,e,i,r),n},remove:function(){for(var t=0;t<this.actors.length;t++)this.actors[t].target.terminate();this.actors=[]}}},{"../../source/worker":49,"../actor":93,webworkify:149}],98:[function(t,e,i){function n(t){for(var e=0;e<t.length;e++)if(t[e]in s)return t[e]}function r(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",r,!0)}var o=t("point-geometry");i.create=function(t,e,i){var n=document.createElement(t);return e&&(n.className=e),i&&i.appendChild(n),n};var a,s=document.documentElement.style,l=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){l&&(a=s[l],s[l]="none")},i.enableDrag=function(){l&&(s[l]=a)};var u=n(["transform","WebkitTransform"]);i.setTransform=function(t,e){t.style[u]=e},i.suppressClick=function(){window.addEventListener("click",r,!0),window.setTimeout(function(){window.removeEventListener("click",r,!0)},0)},i.mousePos=function(t,e){var i=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new o(e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop)}},{"point-geometry":137}],99:[function(t,e,i){e.exports={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0}},{}],100:[function(t,e,i){var r=t("./util"),n={on:function(t,e){return this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e),this},off:function(t,e){if(!t)return delete this._events,this;if(!this.listens(t))return this;if(e){var i=this._events[t].indexOf(e);0<=i&&this._events[t].splice(i,1),this._events[t].length||delete this._events[t]}else delete this._events[t];return this},once:function(e,i){var n=function(t){this.off(e,n),i.call(this,t)}.bind(this);return this.on(e,n),this},fire:function(t,e){if(!this.listens(t))return this;e=r.extend({},e),r.extend(e,{type:t,target:this});for(var i=this._events[t].slice(),n=0;n<i.length;n++)i[n].call(this,e);return this},listens:function(t){return!(!this._events||!this._events[t])}};e.exports=n},{"./util":106}],101:[function(t,e,i){function n(t,e,i){if(1===t){var n=i.readMessage(r,{glyphs:{}});e.push(n)}}function r(t,e,i){if(1===t)e.name=i.readString();else if(2===t)e.range=i.readString();else if(3===t){var n=i.readMessage(o,{});e.glyphs[n.id]=n}}function o(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}e.exports=function(t,e){this.stacks=t.readFields(n,[],e)}},{}],102:[function(t,e,i){function r(t,e,i){return t*(1-i)+e*i}((e.exports=r).number=r).vec2=function(t,e,i){return[r(t[0],e[0],i),r(t[1],e[1],i)]},r.color=function(t,e,i){return[r(t[0],e[0],i),r(t[1],e[1],i),r(t[2],e[2],i),r(t[3],e[3],i)]},r.array=function(t,i,n){return t.map(function(t,e){return r(t,i[e],n)})}},{}],103:[function(t,e,i){function o(t,e,i){if(!(i=i||n.ACCESS_TOKEN)&&n.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox GL. See https://www.mapbox.com/developers/api/#access-tokens");if(t=t.replace(/^mapbox:\/\//,n.API_URL+e),t+=-1!==t.indexOf("?")?"&access_token=":"?access_token=",n.REQUIRE_ACCESS_TOKEN){if("s"===i[0])throw new Error("Use a public access token (pk.*) with Mapbox GL JS, not a secret access token (sk.*). See https://www.mapbox.com/developers/api/#access-tokens");t+=i}return t}var n=t("./config"),r=t("./browser");e.exports.normalizeStyleURL=function(t,e){if(!t.match(/^mapbox:\/\/styles\//))return t;var i=t.split("/");return o("mapbox://"+i[3]+"/"+i[4]+(i[5]?"/draft":""),"/styles/v1/",e)},e.exports.normalizeSourceURL=function(t,e){return t.match(/^mapbox:\/\//)?o(t+".json","/v4/",e)+"&secure":t},e.exports.normalizeGlyphsURL=function(t,e){return t.match(/^mapbox:\/\//)?o("mapbox://"+t.split("/")[3]+"/{fontstack}/{range}.pbf","/fonts/v1/",e):t},e.exports.normalizeSpriteURL=function(t,e,i,n){if(!t.match(/^mapbox:\/\/sprites\//))return t+e+i;var r=t.split("/");return o("mapbox://"+r[3]+"/"+r[4]+(r[5]?"/draft":"")+"/sprite"+e+i,"/styles/v1/",n)},e.exports.normalizeTileURL=function(t,e){return e&&e.match(/^mapbox:\/\//)?t.replace(/\.((?:png|jpg)\d*)(?=$|\?)/,2<=r.devicePixelRatio?"@2x.$1":".$1"):t}},{"./browser":95,"./config":99}],104:[function(t,e,i){function n(t,e){this.max=t,this.onRemove=e,this.reset()}(e.exports=n).prototype.reset=function(){for(var t in this.list)this.onRemove(this.list[t]);return this.list={},this.order=[],this},n.prototype.add=function(t,e){if(this.list[t]=e,this.order.push(t),this.order.length>this.max){var i=this.get(this.order[0]);i&&this.onRemove(i)}return this},n.prototype.has=function(t){return t in this.list},n.prototype.keys=function(){return this.order},n.prototype.get=function(t){if(!this.has(t))return null;var e=this.list[t];return delete this.list[t],this.order.splice(this.order.indexOf(t),1),e}},{}],105:[function(t,e,i){e.exports=function(i,t){return t.replace(/{([^{}()\[\]<>$=:;.,^]+)}/g,function(t,e){return e in i?i[e]:""})}},{}],106:[function(t,e,r){var o=t("unitbezier"),u=t("../geo/coordinate");r.easeCubicInOut=function(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},r.bezier=function(t,e,i,n){var r=new o(t,e,i,n);return function(t){return r.solve(t)}},r.ease=r.bezier(.25,.1,.25,1),r.premultiply=function(t){return t[0]*=t[3],t[1]*=t[3],t[2]*=t[3],t},r.clamp=function(t,e,i){return Math.min(i,Math.max(e,t))},r.wrap=function(t,e,i){var n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r},r.coalesce=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(null!=e)return e}},r.asyncEach=function(t,e,i){function n(){0==--r&&i()}var r=t.length;if(0===r)return i();for(var o=0;o<t.length;o++)e(t[o],n)},r.asyncAll=function(t,e,n){var r=t.length,o=new Array(t.length),a=null;t.forEach(function(t,i){e(t,function(t,e){t&&(a=t),o[i]=e,0==--r&&n(a,o)})})},r.keysDifference=function(t,e){var i=[];for(var n in t)n in e||i.push(n);return i},r.extend=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t},r.extendAll=function(t,e){for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i));return t},r.inherit=function(t,e){var i="function"==typeof t?t.prototype:t,n=Object.create(i);return r.extendAll(n,e),n},r.pick=function(t,e){for(var i={},n=0;n<e.length;n++){var r=e[n];r in t&&(i[r]=t[r])}return i};var i=1;r.uniqueId=function(){return i++},r.throttle=function(t,e,i){var n,r,o,a;return a=function(){n=!1,r&&(o.apply(i,r),r=!1)},o=function(){n?r=arguments:(t.apply(i,arguments),setTimeout(a,e),n=!0)}},r.debounce=function(t,e){var i,n;return function(){n=arguments,clearTimeout(i),i=setTimeout(function(){t.apply(null,n)},e)}},r.bindAll=function(t,e){t.forEach(function(t){e[t]=e[t].bind(e)})},r.bindHandlers=function(t){for(var e in t)"function"==typeof t[e]&&0===e.indexOf("_on")&&(t[e]=t[e].bind(t))},r.setOptions=function(t,e){for(var i in t.hasOwnProperty("options")||(t.options=t.options?Object.create(t.options):{}),e)t.options[i]=e[i];return t.options},r.getCoordinatesCenter=function(t){for(var e=1/0,i=1/0,n=-1/0,r=-1/0,o=0;o<t.length;o++)e=Math.min(e,t[o].column),i=Math.min(i,t[o].row),n=Math.max(n,t[o].column),r=Math.max(r,t[o].row);var a=n-e,s=r-i,l=Math.max(a,s);return new u((e+n)/2,(i+r)/2,0).zoomTo(Math.floor(-Math.log(l)/Math.LN2))}},{"../geo/coordinate":19,unitbezier:141}],107:[function(t,e,i){function f(t){return(t=Math.round(t))<0?0:255<t?255:t}function d(t){return f("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function m(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:1<e?1:e;var e}function y(t,e,i){return i<0?i+=1:1<i&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}var _={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{i.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in _)return _[i].slice();if("#"===i[0])return 4===i.length?0<=(e=parseInt(i.substr(1),16))&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7!==i.length?null:0<=(e=parseInt(i.substr(1),16))&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(-1!==n&&r+1===i.length){var o=i.substr(0,n),a=i.substr(n+1,r-(n+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=m(a.pop());case"rgb":return 3!==a.length?null:[d(a[0]),d(a[1]),d(a[2]),s];case"hsla":if(4!==a.length)return null;s=m(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=m(a[1]),c=m(a[2]),h=c<=.5?c*(u+1):c+u-c*u,p=2*c-h;return[f(255*y(p,h,l+1/3)),f(255*y(p,h,l)),f(255*y(p,h,l-1/3)),s];default:return null}}return null}}catch(t){}},{}],108:[function(t,e,i){function r(n){return function(t,e,i){return"$type"===e?"t"+n+s.indexOf(i):"p["+JSON.stringify(e)+"]"+n+JSON.stringify(i)}}function n(t){var n=r(t);return function(t,e,i){return"$type"===e?n(t,e,i):"typeof(p["+JSON.stringify(e)+"]) === typeof("+JSON.stringify(i)+") && "+n(t,e,i)}}function o(t){return l[t[0]].apply(t,t)}function a(){return!0}var s=["Unknown","Point","LineString","Polygon"],l={"==":r("==="),"!=":r("!=="),">":n(">"),"<":n("<"),"<=":n("<="),">=":n(">="),in:function(e,i){return"(function(){"+Array.prototype.slice.call(arguments,2).map(function(t){return"if ("+l["=="](e,i,t)+") return true;"}).join("")+"return false;})()"},"!in":function(){return"!("+l.in.apply(this,arguments)+")"},any:function(){return Array.prototype.slice.call(arguments,1).map(function(t){return"("+o(t)+")"}).join("||")||"false"},all:function(){return Array.prototype.slice.call(arguments,1).map(function(t){return"("+o(t)+")"}).join("&&")||"true"},none:function(){return"!("+l.any.apply(this,arguments)+")"}};e.exports=function(t){if(!t)return a;var e="var p = f.properties || f.tags || {}, t = f.type; return "+o(t)+";";return new Function("f",e)}},{}],109:[function(t,e,i){function y(t,e,i,n){for(var r=[],o=0;o<t.length;o++){var a=t[o],s=a[n];e<=s&&s<=i&&r.push(a)}return r}function _(t,e,i,n,r,o){for(var a=[],s=0;s<t.length;s++){var l,u,c,h=0,p=0,f=null,d=t[s],m=d.area,y=d.dist,_=d.length,g=[];for(u=0;u<_-1;u++)l=f||d[u],f=d[u+1],h=p||l[n],p=f[n],h<e?i<p?(g.push(r(l,f,e),r(l,f,i)),o||(g=v(a,g,m,y))):e<=p&&g.push(r(l,f,e)):i<h?p<e?(g.push(r(l,f,i),r(l,f,e)),o||(g=v(a,g,m,y))):p<=i&&g.push(r(l,f,i)):(g.push(l),p<e?(g.push(r(l,f,e)),o||(g=v(a,g,m,y))):i<p&&(g.push(r(l,f,i)),o||(g=v(a,g,m,y))));e<=(h=(l=d[_-1])[n])&&h<=i&&g.push(l),c=g[g.length-1],o&&c&&(g[0][0]!==c[0]||g[0][1]!==c[1])&&g.push(g[0]),v(a,g,m,y)}return a}function v(t,e,i,n){return e.length&&(e.area=i,e.dist=n,t.push(e)),[]}e.exports=function(t,e,i,n,r,o,a,s){if(n/=e,(i/=e)<=a&&s<=n)return t;if(n<a||s<i)return null;for(var l=[],u=0;u<t.length;u++){var c,h,p=t[u],f=p.geometry,d=p.type;if(c=p.min[r],h=p.max[r],i<=c&&h<=n)l.push(p);else if(!(n<c||h<i)){var m=1===d?y(f,i,n,r):_(f,i,n,r,o,3===d);m.length&&l.push({geometry:m,type:d,tags:t[u].tags||null,min:p.min,max:p.max})}}return l.length?l:null}},{}],110:[function(t,e,i){function c(t,e,i){var n,r,o,a=e.geometry,s=a.type,l=a.coordinates,u=e.properties;if("Point"===s)t.push(h(u,1,[f(l)]));else if("MultiPoint"===s)t.push(h(u,1,p(l)));else if("LineString"===s)t.push(h(u,2,[p(l,i)]));else if("MultiLineString"===s||"Polygon"===s){for(o=[],n=0;n<l.length;n++)o.push(p(l[n],i));t.push(h(u,"Polygon"===s?3:2,o))}else if("MultiPolygon"===s){for(o=[],n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)o.push(p(l[n][r],i));t.push(h(u,3,o))}else{if("GeometryCollection"!==s)throw new Error("Input data is not a valid GeoJSON object.");for(n=0;n<a.geometries.length;n++)c(t,{geometry:a.geometries[n],properties:u},i)}}function h(t,e,i){var n={geometry:i,type:e,tags:t||null,min:[2,1],max:[-1,0]};return function(t){var e=t.geometry,i=t.min,n=t.max;if(1===t.type)o(i,n,e);else for(var r=0;r<e.length;r++)o(i,n,e[r])}(n),n}function p(t,e){for(var i=[],n=0;n<t.length;n++)i.push(f(t[n]));return e&&(r(i,e),function(t){for(var e,i,n=0,r=0,o=0;o<t.length-1;o++)e=i||t[o],i=t[o+1],n+=e[0]*i[1]-i[0]*e[1],r+=Math.abs(i[0]-e[0])+Math.abs(i[1]-e[1]);t.area=Math.abs(n/2),t.dist=r}(i)),i}function f(t){var e=Math.sin(t[1]*Math.PI/180),i=t[0]/360+.5,n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return[i,n=n<-1?-1:1<n?1:n,0]}function o(t,e,i){for(var n,r=0;r<i.length;r++)n=i[r],t[0]=Math.min(n[0],t[0]),e[0]=Math.max(n[0],e[0]),t[1]=Math.min(n[1],t[1]),e[1]=Math.max(n[1],e[1])}e.exports=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)c(i,t.features[n],e);else"Feature"===t.type?c(i,t,e):c(i,{geometry:t},e);return i};var r=t("./simplify")},{"./simplify":112}],111:[function(t,e,i){function n(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;i&&console.time("preprocess data");var n=1<<e.maxZoom,r=o(t,e.tolerance/(n*e.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=a(r,e.buffer/e.extent,L)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function E(t,e,i){return 32*((1<<t)*i+e)+t}function L(t,e,i){return[i,(i-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1],1]}function z(t,e,i){return[(i-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],i,1]}function P(t,e,i){var n=t.source;if(1!==n.length)return!1;var r=n[0];if(3!==r.type||1<r.geometry.length)return!1;var o=r.geometry[0].length;if(5!==o)return!1;for(var a=0;a<o;a++){var s=d.point(r.geometry[0][a],e,t.z2,t.x,t.y);if(s[0]!==-i&&s[0]!==e+i||s[1]!==-i&&s[1]!==e+i)return!1}return!0}e.exports=function(t,e){return new n(t,e)};var o=t("./convert"),d=t("./transform"),C=t("./clip"),a=t("./wrap"),I=t("./tile");n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},n.prototype.splitTile=function(t,e,i,n,r,o,a){for(var s=[t,e,i,n],l=this.options,u=l.debug,c=null;s.length;){n=s.pop(),i=s.pop(),e=s.pop(),t=s.pop();var h=1<<e,p=E(e,i,n),f=this.tiles[p],d=e===l.maxZoom?0:l.tolerance/(h*l.extent);if(!f&&(1<u&&console.time("creation"),f=this.tiles[p]=I(t,h,i,n,d,e===l.maxZoom),this.tileCoords.push({z:e,x:i,y:n}),u)){1<u&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var m="z"+e;this.stats[m]=(this.stats[m]||0)+1,this.total++}if(f.source=t,r){if(e===l.maxZoom||e===r)continue;var y=1<<r-e;if(i!==Math.floor(o/y)||n!==Math.floor(a/y))continue}else if(e===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(l.solidChildren||!P(f,l.extent,l.buffer)){f.source=null,1<u&&console.time("clipping");var _,g,v,x,b,w,T=.5*l.buffer/l.extent,S=.5-T,A=.5+T,M=1+T;_=g=v=x=null,b=C(t,h,i-T,i+A,0,L,f.min[0],f.max[0]),w=C(t,h,i+S,i+M,0,L,f.min[0],f.max[0]),b&&(_=C(b,h,n-T,n+A,1,z,f.min[1],f.max[1]),g=C(b,h,n+S,n+M,1,z,f.min[1],f.max[1])),w&&(v=C(w,h,n-T,n+A,1,z,f.min[1],f.max[1]),x=C(w,h,n+S,n+M,1,z,f.min[1],f.max[1])),1<u&&console.timeEnd("clipping"),_&&s.push(_,e+1,2*i,2*n),g&&s.push(g,e+1,2*i,2*n+1),v&&s.push(v,e+1,2*i+1,2*n),x&&s.push(x,e+1,2*i+1,2*n+1)}else r&&(c=e)}return c},n.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,o=n.debug,a=1<<t,s=E(t,e=(e%a+a)%a,i);if(this.tiles[s])return d.tile(this.tiles[s],r);1<o&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,u=t,c=e,h=i;!l&&0<u;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[E(u,c,h)];if(!l||!l.source)return null;if(1<o&&console.log("found parent tile z%d-%d-%d",u,c,h),P(l,r,n.buffer))return d.tile(l,r);1<o&&console.time("drilling down");var p=this.splitTile(l.source,u,c,h,t,e,i);if(1<o&&console.timeEnd("drilling down"),null!==p){var f=1<<t-p;s=E(p,Math.floor(e/f),Math.floor(i/f))}return this.tiles[s]?d.tile(this.tiles[s],r):null}},{"./clip":109,"./convert":110,"./tile":113,"./transform":114,"./wrap":115}],112:[function(t,e,i){function c(t,e,i){var n=e[0],r=e[1],o=i[0],a=i[1],s=t[0],l=t[1],u=o-n,c=a-r;if(0!==u||0!==c){var h=((s-n)*u+(l-r)*c)/(u*u+c*c);1<h?(n=o,r=a):0<h&&(n+=u*h,r+=c*h)}return(u=s-n)*u+(c=l-r)*c}e.exports=function(t,e){var i,n,r,o,a=e*e,s=0,l=t.length-1,u=[];for(t[s][2]=1,t[l][2]=1;l;){for(n=0,i=s+1;i<l;i++)(r=c(t[i],t[s],t[l]))>n&&(o=i,n=r);s=a<n?(t[o][2]=n,u.push(s),u.push(o),o):(l=u.pop(),u.pop())}}},{}],113:[function(t,e,i){function c(t,e,i,n){var r,o,a,s,l=e.geometry,u=e.type,c=[],h=i*i;if(1===u)for(r=0;r<l.length;r++)c.push(l[r]),t.numPoints++,t.numSimplified++;else for(r=0;r<l.length;r++)if(a=l[r],n||!(2===u&&a.dist<i||3===u&&a.area<h)){var p=[];for(o=0;o<a.length;o++)s=a[o],(n||s[2]>h)&&(p.push(s),t.numSimplified++),t.numPoints++;c.push(p)}else t.numPoints+=a.length;c.length&&t.features.push({geometry:c,type:u,tags:e.tags||null})}e.exports=function(t,e,i,n,r,o){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z2:e,transformed:!1,min:[2,1],max:[-1,0]},s=0;s<t.length;s++){a.numFeatures++,c(a,t[s],r,o);var l=t[s].min,u=t[s].max;l[0]<a.min[0]&&(a.min[0]=l[0]),l[1]<a.min[1]&&(a.min[1]=l[1]),u[0]>a.max[0]&&(a.max[0]=u[0]),u[1]>a.max[1]&&(a.max[1]=u[1])}return a}},{}],114:[function(t,e,i){function h(t,e,i,n,r){return[Math.round(e*(t[0]*i-n)),Math.round(e*(t[1]*i-r))]}i.tile=function(t,e){if(t.transformed)return t;var i,n,r,o=t.z2,a=t.x,s=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],u=l.geometry;if(1===l.type)for(n=0;n<u.length;n++)u[n]=h(u[n],e,o,a,s);else for(n=0;n<u.length;n++){var c=u[n];for(r=0;r<c.length;r++)c[r]=h(c[r],e,o,a,s)}}return t.transformed=!0,t},i.point=h},{}],115:[function(t,e,i){function a(t,e){for(var i=[],n=0;n<t.length;n++){var r,o=t[n],a=o.type;if(1===a)r=l(o.geometry,e);else{r=[];for(var s=0;s<o.geometry.length;s++)r.push(l(o.geometry[s],e))}i.push({geometry:r,type:a,tags:o.tags,min:[o.min[0]+e,o.min[1]],max:[o.max[0]+e,o.max[1]]})}return i}function l(t,e){var i=[];i.area=t.area,i.dist=t.dist;for(var n=0;n<t.length;n++)i.push([t[n][0]+e,t[n][1],t[n][2]]);return i}var s=t("./clip");e.exports=function(t,e,i){var n=t,r=s(t,1,-1-e,e,0,i,-1,2),o=s(t,1,1-e,2+e,0,i,-1,2);return(r||o)&&(n=s(t,1,-e,1+e,0,i,-1,2),r&&(n=a(r,1).concat(n)),o&&(n=n.concat(a(o,-1)))),n}},{"./clip":109}],116:[function(t,e,i){i.glMatrix=t("./gl-matrix/common.js"),i.mat2=t("./gl-matrix/mat2.js"),i.mat2d=t("./gl-matrix/mat2d.js"),i.mat3=t("./gl-matrix/mat3.js"),i.mat4=t("./gl-matrix/mat4.js"),i.quat=t("./gl-matrix/quat.js"),i.vec2=t("./gl-matrix/vec2.js"),i.vec3=t("./gl-matrix/vec3.js"),i.vec4=t("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":117,"./gl-matrix/mat2.js":118,"./gl-matrix/mat2d.js":119,"./gl-matrix/mat3.js":120,"./gl-matrix/mat4.js":121,"./gl-matrix/quat.js":122,"./gl-matrix/vec2.js":123,"./gl-matrix/vec3.js":124,"./gl-matrix/vec4.js":125}],117:[function(t,e,i){var n={EPSILON:1e-6};n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.setMatrixArrayType=function(t){GLMAT_ARRAY_TYPE=t};var r=Math.PI/180;n.toRadian=function(t){return t*r},e.exports=n},{}],118:[function(t,e,i){var n=t("./common.js"),r={create:function(){var t=new n.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},transpose:function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i*o-r*n;return a?(a=1/a,t[0]=o*a,t[1]=-n*a,t[2]=-r*a,t[3]=i*a,t):null},adjoint:function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[0],l=i[1],u=i[2],c=i[3];return t[0]=n*s+o*l,t[1]=r*s+a*l,t[2]=n*u+o*c,t[3]=r*u+a*c,t}};r.mul=r.multiply,r.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*s,t[1]=r*l+a*s,t[2]=n*-s+o*l,t[3]=r*-s+a*l,t},r.scale=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[0],l=i[1];return t[0]=n*s,t[1]=r*s,t[2]=o*l,t[3]=a*l,t},r.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},r.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},r.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},e.exports=r},{"./common.js":117}],119:[function(t,e,i){var n=t("./common.js"),r={create:function(){var t=new n.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},clone:function(t){var e=new n.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=i*o-n*r;return l?(l=1/l,t[0]=o*l,t[1]=-n*l,t[2]=-r*l,t[3]=i*l,t[4]=(r*s-o*a)*l,t[5]=(n*a-i*s)*l,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=i[0],c=i[1],h=i[2],p=i[3],f=i[4],d=i[5];return t[0]=n*u+o*c,t[1]=r*u+a*c,t[2]=n*h+o*p,t[3]=r*h+a*p,t[4]=n*f+o*d+s,t[5]=r*f+a*d+l,t}};r.mul=r.multiply,r.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=Math.sin(i),c=Math.cos(i);return t[0]=n*c+o*u,t[1]=r*c+a*u,t[2]=n*-u+o*c,t[3]=r*-u+a*c,t[4]=s,t[5]=l,t},r.scale=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=i[0],c=i[1];return t[0]=n*u,t[1]=r*u,t[2]=o*c,t[3]=a*c,t[4]=s,t[5]=l,t},r.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=i[0],c=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=n*u+o*c+s,t[5]=r*u+a*c+l,t},r.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},r.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},e.exports=r},{"./common.js":117}],120:[function(t,e,i){var n=t("./common.js"),r={create:function(){var t=new n.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new n.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=c*a-s*u,p=-c*o+s*l,f=u*o-a*l,d=i*h+n*p+r*f;return d?(d=1/d,t[0]=h*d,t[1]=(-c*n+r*u)*d,t[2]=(s*n-r*a)*d,t[3]=p*d,t[4]=(c*i-r*l)*d,t[5]=(-s*i+r*o)*d,t[6]=f*d,t[7]=(-u*i+n*l)*d,t[8]=(a*i-n*o)*d,t):null},adjoint:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8];return t[0]=a*c-s*u,t[1]=r*u-n*c,t[2]=n*s-r*a,t[3]=s*l-o*c,t[4]=i*c-r*l,t[5]=r*o-i*s,t[6]=o*u-a*l,t[7]=n*l-i*u,t[8]=i*a-n*o,t},determinant:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8];return e*(u*o-a*l)+i*(-u*r+a*s)+n*(l*r-o*s)},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=i[0],f=i[1],d=i[2],m=i[3],y=i[4],_=i[5],g=i[6],v=i[7],x=i[8];return t[0]=p*n+f*a+d*u,t[1]=p*r+f*s+d*c,t[2]=p*o+f*l+d*h,t[3]=m*n+y*a+_*u,t[4]=m*r+y*s+_*c,t[5]=m*o+y*l+_*h,t[6]=g*n+v*a+x*u,t[7]=g*r+v*s+x*c,t[8]=g*o+v*l+x*h,t}};r.mul=r.multiply,r.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=i[0],f=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=p*n+f*a+u,t[7]=p*r+f*s+c,t[8]=p*o+f*l+h,t},r.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=Math.sin(i),f=Math.cos(i);return t[0]=f*n+p*a,t[1]=f*r+p*s,t[2]=f*o+p*l,t[3]=f*a-p*n,t[4]=f*s-p*r,t[5]=f*l-p*o,t[6]=u,t[7]=c,t[8]=h,t},r.scale=function(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},r.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},r.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i+i,s=n+n,l=r+r,u=i*a,c=n*a,h=n*s,p=r*a,f=r*s,d=r*l,m=o*a,y=o*s,_=o*l;return t[0]=1-h-d,t[3]=c-_,t[6]=p+y,t[1]=c+_,t[4]=1-u-d,t[7]=f-m,t[2]=p-y,t[5]=f+m,t[8]=1-u-h,t},r.normalFromMat4=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=i*s-n*a,v=i*l-r*a,x=i*u-o*a,b=n*l-r*s,w=n*u-o*s,T=r*u-o*l,S=c*m-h*d,A=c*y-p*d,M=c*_-f*d,E=h*y-p*m,L=h*_-f*m,z=p*_-f*y,P=g*z-v*L+x*E+b*M-w*A+T*S;return P?(P=1/P,t[0]=(s*z-l*L+u*E)*P,t[1]=(l*M-a*z-u*A)*P,t[2]=(a*L-s*M+u*S)*P,t[3]=(r*L-n*z-o*E)*P,t[4]=(i*z-r*M+o*A)*P,t[5]=(n*M-i*L-o*S)*P,t[6]=(m*T-y*w+_*b)*P,t[7]=(y*x-d*T-_*v)*P,t[8]=(d*w-m*x+_*g)*P,t):null},r.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.exports=r},{"./common.js":117}],121:[function(t,e,i){var I=t("./common.js"),T={create:function(){var t=new I.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},clone:function(t){var e=new I.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=i*s-n*a,v=i*l-r*a,x=i*u-o*a,b=n*l-r*s,w=n*u-o*s,T=r*u-o*l,S=c*m-h*d,A=c*y-p*d,M=c*_-f*d,E=h*y-p*m,L=h*_-f*m,z=p*_-f*y,P=g*z-v*L+x*E+b*M-w*A+T*S;return P?(P=1/P,t[0]=(s*z-l*L+u*E)*P,t[1]=(r*L-n*z-o*E)*P,t[2]=(m*T-y*w+_*b)*P,t[3]=(p*w-h*T-f*b)*P,t[4]=(l*M-a*z-u*A)*P,t[5]=(i*z-r*M+o*A)*P,t[6]=(y*x-d*T-_*v)*P,t[7]=(c*T-p*x+f*v)*P,t[8]=(a*L-s*M+u*S)*P,t[9]=(n*M-i*L-o*S)*P,t[10]=(d*w-m*x+_*g)*P,t[11]=(h*x-c*w-f*g)*P,t[12]=(s*A-a*E-l*S)*P,t[13]=(i*E-n*A+r*S)*P,t[14]=(m*v-d*b-y*g)*P,t[15]=(c*b-h*v+p*g)*P,t):null},adjoint:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15];return t[0]=s*(p*_-f*y)-h*(l*_-u*y)+m*(l*f-u*p),t[1]=-(n*(p*_-f*y)-h*(r*_-o*y)+m*(r*f-o*p)),t[2]=n*(l*_-u*y)-s*(r*_-o*y)+m*(r*u-o*l),t[3]=-(n*(l*f-u*p)-s*(r*f-o*p)+h*(r*u-o*l)),t[4]=-(a*(p*_-f*y)-c*(l*_-u*y)+d*(l*f-u*p)),t[5]=i*(p*_-f*y)-c*(r*_-o*y)+d*(r*f-o*p),t[6]=-(i*(l*_-u*y)-a*(r*_-o*y)+d*(r*u-o*l)),t[7]=i*(l*f-u*p)-a*(r*f-o*p)+c*(r*u-o*l),t[8]=a*(h*_-f*m)-c*(s*_-u*m)+d*(s*f-u*h),t[9]=-(i*(h*_-f*m)-c*(n*_-o*m)+d*(n*f-o*h)),t[10]=i*(s*_-u*m)-a*(n*_-o*m)+d*(n*u-o*s),t[11]=-(i*(s*f-u*h)-a*(n*f-o*h)+c*(n*u-o*s)),t[12]=-(a*(h*y-p*m)-c*(s*y-l*m)+d*(s*p-l*h)),t[13]=i*(h*y-p*m)-c*(n*y-r*m)+d*(n*p-r*h),t[14]=-(i*(s*y-l*m)-a*(n*y-r*m)+d*(n*l-r*s)),t[15]=i*(s*p-l*h)-a*(n*p-r*h)+c*(n*l-r*s),t},determinant:function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],m=t[14],y=t[15];return(e*a-i*o)*(h*y-p*m)-(e*s-n*o)*(c*y-p*d)+(e*l-r*o)*(c*m-h*d)+(i*s-n*a)*(u*y-p*f)-(i*l-r*a)*(u*m-h*f)+(n*l-r*s)*(u*d-c*f)},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],_=e[14],g=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*n+x*s+b*h+w*m,t[1]=v*r+x*l+b*p+w*y,t[2]=v*o+x*u+b*f+w*_,t[3]=v*a+x*c+b*d+w*g,v=i[4],x=i[5],b=i[6],w=i[7],t[4]=v*n+x*s+b*h+w*m,t[5]=v*r+x*l+b*p+w*y,t[6]=v*o+x*u+b*f+w*_,t[7]=v*a+x*c+b*d+w*g,v=i[8],x=i[9],b=i[10],w=i[11],t[8]=v*n+x*s+b*h+w*m,t[9]=v*r+x*l+b*p+w*y,t[10]=v*o+x*u+b*f+w*_,t[11]=v*a+x*c+b*d+w*g,v=i[12],x=i[13],b=i[14],w=i[15],t[12]=v*n+x*s+b*h+w*m,t[13]=v*r+x*l+b*p+w*y,t[14]=v*o+x*u+b*f+w*_,t[15]=v*a+x*c+b*d+w*g,t}};T.mul=T.multiply,T.translate=function(t,e,i){var n,r,o,a,s,l,u,c,h,p,f,d,m=i[0],y=i[1],_=i[2];return t[15]=e===t?(t[12]=e[0]*m+e[4]*y+e[8]*_+e[12],t[13]=e[1]*m+e[5]*y+e[9]*_+e[13],t[14]=e[2]*m+e[6]*y+e[10]*_+e[14],e[3]*m+e[7]*y+e[11]*_+e[15]):(n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+s*y+h*_+e[12],t[13]=r*m+l*y+p*_+e[13],t[14]=o*m+u*y+f*_+e[14],a*m+c*y+d*_+e[15]),t},T.scale=function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},T.rotate=function(t,e,i,n){var r,o,a,s,l,u,c,h,p,f,d,m,y,_,g,v,x,b,w,T,S,A,M,E,L=n[0],z=n[1],P=n[2],C=Math.sqrt(L*L+z*z+P*P);return Math.abs(C)<I.EPSILON?null:(L*=C=1/C,z*=C,P*=C,r=Math.sin(i),a=1-(o=Math.cos(i)),s=e[0],l=e[1],u=e[2],c=e[3],h=e[4],p=e[5],f=e[6],d=e[7],m=e[8],y=e[9],_=e[10],g=e[11],v=L*L*a+o,x=z*L*a+P*r,b=P*L*a-z*r,w=L*z*a-P*r,T=z*z*a+o,S=P*z*a+L*r,A=L*P*a+z*r,M=z*P*a-L*r,E=P*P*a+o,t[0]=s*v+h*x+m*b,t[1]=l*v+p*x+y*b,t[2]=u*v+f*x+_*b,t[3]=c*v+d*x+g*b,t[4]=s*w+h*T+m*S,t[5]=l*w+p*T+y*S,t[6]=u*w+f*T+_*S,t[7]=c*w+d*T+g*S,t[8]=s*A+h*M+m*E,t[9]=l*A+p*M+y*E,t[10]=u*A+f*M+_*E,t[11]=c*A+d*M+g*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},T.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*n,t[5]=a*r+c*n,t[6]=s*r+h*n,t[7]=l*r+p*n,t[8]=u*r-o*n,t[9]=c*r-a*n,t[10]=h*r-s*n,t[11]=p*r-l*n,t},T.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-u*n,t[1]=a*r-c*n,t[2]=s*r-h*n,t[3]=l*r-p*n,t[8]=o*n+u*r,t[9]=a*n+c*r,t[10]=s*n+h*r,t[11]=l*n+p*r,t},T.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*n,t[1]=a*r+c*n,t[2]=s*r+h*n,t[3]=l*r+p*n,t[4]=u*r-o*n,t[5]=c*r-a*n,t[6]=h*r-s*n,t[7]=p*r-l*n,t},T.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},T.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},T.fromRotation=function(t,e,i){var n,r,o,a=i[0],s=i[1],l=i[2],u=Math.sqrt(a*a+s*s+l*l);return Math.abs(u)<I.EPSILON?null:(a*=u=1/u,s*=u,l*=u,n=Math.sin(e),o=1-(r=Math.cos(e)),t[0]=a*a*o+r,t[1]=s*a*o+l*n,t[2]=l*a*o-s*n,t[3]=0,t[4]=a*s*o-l*n,t[5]=s*s*o+r,t[6]=l*s*o+a*n,t[7]=0,t[8]=a*l*o+s*n,t[9]=s*l*o-a*n,t[10]=l*l*o+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},T.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},T.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},T.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},T.fromRotationTranslation=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=n+n,l=r+r,u=o+o,c=n*s,h=n*l,p=n*u,f=r*l,d=r*u,m=o*u,y=a*s,_=a*l,g=a*u;return t[0]=1-(f+m),t[1]=h+g,t[2]=p-_,t[3]=0,t[4]=h-g,t[5]=1-(c+m),t[6]=d+y,t[7]=0,t[8]=p+_,t[9]=d-y,t[10]=1-(c+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},T.fromRotationTranslationScale=function(t,e,i,n){var r=e[0],o=e[1],a=e[2],s=e[3],l=r+r,u=o+o,c=a+a,h=r*l,p=r*u,f=r*c,d=o*u,m=o*c,y=a*c,_=s*l,g=s*u,v=s*c,x=n[0],b=n[1],w=n[2];return t[0]=(1-(d+y))*x,t[1]=(p+v)*x,t[2]=(f-g)*x,t[3]=0,t[4]=(p-v)*b,t[5]=(1-(h+y))*b,t[6]=(m+_)*b,t[7]=0,t[8]=(f+g)*w,t[9]=(m-_)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},T.fromRotationTranslationScaleOrigin=function(t,e,i,n,r){var o=e[0],a=e[1],s=e[2],l=e[3],u=o+o,c=a+a,h=s+s,p=o*u,f=o*c,d=o*h,m=a*c,y=a*h,_=s*h,g=l*u,v=l*c,x=l*h,b=n[0],w=n[1],T=n[2],S=r[0],A=r[1],M=r[2];return t[0]=(1-(m+_))*b,t[1]=(f+x)*b,t[2]=(d-v)*b,t[3]=0,t[4]=(f-x)*w,t[5]=(1-(p+_))*w,t[6]=(y+g)*w,t[7]=0,t[8]=(d+v)*T,t[9]=(y-g)*T,t[10]=(1-(p+m))*T,t[11]=0,t[12]=i[0]+S-(t[0]*S+t[4]*A+t[8]*M),t[13]=i[1]+A-(t[1]*S+t[5]*A+t[9]*M),t[14]=i[2]+M-(t[2]*S+t[6]*A+t[10]*M),t[15]=1,t},T.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i+i,s=n+n,l=r+r,u=i*a,c=n*a,h=n*s,p=r*a,f=r*s,d=r*l,m=o*a,y=o*s,_=o*l;return t[0]=1-h-d,t[1]=c+_,t[2]=p-y,t[3]=0,t[4]=c-_,t[5]=1-u-d,t[6]=f+m,t[7]=0,t[8]=p+y,t[9]=f-m,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},T.frustum=function(t,e,i,n,r,o,a){var s=1/(i-e),l=1/(r-n),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(r+n)*l,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*u,t[15]=0,t},T.perspective=function(t,e,i,n,r){var o=1/Math.tan(e/2),a=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*a,t[15]=0,t},T.perspectiveFromFieldOfView=function(t,e,i,n){var r=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(a+s),u=2/(r+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-s)*l*.5,t[9]=(r-o)*u*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},T.ortho=function(t,e,i,n,r,o,a){var s=1/(e-i),l=1/(n-r),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*l,t[14]=(a+o)*u,t[15]=1,t},T.lookAt=function(t,e,i,n){var r,o,a,s,l,u,c,h,p,f,d=e[0],m=e[1],y=e[2],_=n[0],g=n[1],v=n[2],x=i[0],b=i[1],w=i[2];return Math.abs(d-x)<I.EPSILON&&Math.abs(m-b)<I.EPSILON&&Math.abs(y-w)<I.EPSILON?T.identity(t):(c=d-x,h=m-b,p=y-w,r=g*(p*=f=1/Math.sqrt(c*c+h*h+p*p))-v*(h*=f),o=v*(c*=f)-_*p,a=_*h-g*c,(f=Math.sqrt(r*r+o*o+a*a))?(r*=f=1/f,o*=f,a*=f):a=o=r=0,s=h*a-p*o,l=p*r-c*a,u=c*o-h*r,(f=Math.sqrt(s*s+l*l+u*u))?(s*=f=1/f,l*=f,u*=f):u=l=s=0,t[0]=r,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=p,t[11]=0,t[12]=-(r*d+o*m+a*y),t[13]=-(s*d+l*m+u*y),t[14]=-(c*d+h*m+p*y),t[15]=1,t)},T.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},T.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},e.exports=T},{"./common.js":117}],122:[function(t,e,i){var a,s,r,o,l,u,n=t("./common.js"),c=t("./mat3.js"),h=t("./vec3.js"),p=t("./vec4.js"),f={};f.create=function(){var t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.rotationTo=(o=h.create(),l=h.fromValues(1,0,0),u=h.fromValues(0,1,0),function(t,e,i){var n=h.dot(e,i);return n<-.999999?(h.cross(o,l,e),h.length(o)<1e-6&&h.cross(o,u,e),h.normalize(o,o),f.setAxisAngle(t,o,Math.PI),t):.999999<n?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(h.cross(o,e,i),t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=1+n,f.normalize(t,t))}),f.setAxes=(r=c.create(),function(t,e,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],f.normalize(t,f.fromMat3(t,r))}),f.clone=p.clone,f.fromValues=p.fromValues,f.copy=p.copy,f.set=p.set,f.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.setAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},f.add=p.add,f.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[0],l=i[1],u=i[2],c=i[3];return t[0]=n*c+a*s+r*u-o*l,t[1]=r*c+a*l+o*s-n*u,t[2]=o*c+a*u+n*l-r*s,t[3]=a*c-n*s-r*l-o*u,t},f.mul=f.multiply,f.scale=p.scale,f.rotateX=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+a*s,t[1]=r*l+o*s,t[2]=o*l-r*s,t[3]=a*l-n*s,t},f.rotateY=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l-o*s,t[1]=r*l+a*s,t[2]=o*l+n*s,t[3]=a*l-r*s,t},f.rotateZ=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+r*s,t[1]=r*l-n*s,t[2]=o*l+a*s,t[3]=a*l-o*s,t},f.calculateW=function(t,e){var i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t},f.dot=p.dot,f.lerp=p.lerp,f.slerp=function(t,e,i,n){var r,o,a,s,l,u=e[0],c=e[1],h=e[2],p=e[3],f=i[0],d=i[1],m=i[2],y=i[3];return(o=u*f+c*d+h*m+p*y)<0&&(o=-o,f=-f,d=-d,m=-m,y=-y),l=1e-6<1-o?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-n)*r)/a,Math.sin(n*r)/a):(s=1-n,n),t[0]=s*u+l*f,t[1]=s*c+l*d,t[2]=s*h+l*m,t[3]=s*p+l*y,t},f.sqlerp=(a=f.create(),s=f.create(),function(t,e,i,n,r,o){return f.slerp(a,e,r,o),f.slerp(s,i,n,o),f.slerp(t,a,s,2*o*(1-o)),t}),f.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i*i+n*n+r*r+o*o,s=a?1/a:0;return t[0]=-i*s,t[1]=-n*s,t[2]=-r*s,t[3]=o*s,t},f.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},f.length=p.length,f.len=f.length,f.squaredLength=p.squaredLength,f.sqrLen=f.squaredLength,f.normalize=p.normalize,f.fromMat3=function(t,e){var i,n=e[0]+e[4]+e[8];if(0<n)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,a=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*a+a]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*o+a]-e[3*a+o])*i,t[o]=(e[3*o+r]+e[3*r+o])*i,t[a]=(e[3*a+r]+e[3*r+a])*i}return t},f.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exports=f},{"./common.js":117,"./mat3.js":120,"./vec3.js":124,"./vec4.js":125}],123:[function(t,e,i){var l,n=t("./common.js"),r={};r.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,i){return t[0]=e,t[1]=i,t},r.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},r.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},r.sub=r.subtract,r.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},r.mul=r.multiply,r.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},r.div=r.divide,r.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},r.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},r.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},r.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},r.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},r.dist=r.distance,r.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},r.len=r.length,r.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},r.normalize=function(t,e){var i=e[0],n=e[1],r=i*i+n*n;return 0<r&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},r.lerp=function(t,e,i,n){var r=e[0],o=e[1];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t},r.random=function(t,e){e=e||1;var i=2*n.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},r.transformMat2=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t},r.transformMat2d=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t},r.transformMat3=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t},r.transformMat4=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t},r.forEach=(l=r.create(),function(t,e,i,n,r,o){var a,s;for(e||(e=2),i||(i=0),s=n?Math.min(n*e+i,t.length):t.length,a=i;a<s;a+=e)l[0]=t[a],l[1]=t[a+1],r(l,l,o),t[a]=l[0],t[a+1]=l[1];return t}),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exports=r},{"./common.js":117}],124:[function(t,e,i){var l,o=t("./common.js"),a={};a.create=function(){var t=new o.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},a.clone=function(t){var e=new o.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.fromValues=function(t,e,i){var n=new o.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},a.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},a.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},a.sub=a.subtract,a.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},a.mul=a.multiply,a.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},a.div=a.divide,a.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},a.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},a.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},a.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},a.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(i*i+n*n+r*r)},a.dist=a.distance,a.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},a.len=a.length,a.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},a.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},a.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return 0<o&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},a.cross=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[0],s=i[1],l=i[2];return t[0]=r*l-o*s,t[1]=o*a-n*l,t[2]=n*s-r*a,t},a.lerp=function(t,e,i,n){var r=e[0],o=e[1],a=e[2];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=a+n*(i[2]-a),t},a.hermite=function(t,e,i,n,r,o){var a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,u=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+i[0]*l+n[0]*u+r[0]*c,t[1]=e[1]*s+i[1]*l+n[1]*u+r[1]*c,t[2]=e[2]*s+i[2]*l+n[2]*u+r[2]*c,t},a.bezier=function(t,e,i,n,r,o){var a=1-o,s=a*a,l=o*o,u=s*a,c=3*o*s,h=3*l*a,p=l*o;return t[0]=e[0]*u+i[0]*c+n[0]*h+r[0]*p,t[1]=e[1]*u+i[1]*c+n[1]*h+r[1]*p,t[2]=e[2]*u+i[2]*c+n[2]*h+r[2]*p,t},a.random=function(t,e){e=e||1;var i=2*o.RANDOM()*Math.PI,n=2*o.RANDOM()-1,r=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=n*e,t},a.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[3]*n+i[7]*r+i[11]*o+i[15];return a=a||1,t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/a,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/a,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/a,t},a.transformMat3=function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t},a.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[0],s=i[1],l=i[2],u=i[3],c=u*n+s*o-l*r,h=u*r+l*n-a*o,p=u*o+a*r-s*n,f=-a*n-s*r-l*o;return t[0]=c*u+f*-a+h*-l-p*-s,t[1]=h*u+f*-s+p*-a-c*-l,t[2]=p*u+f*-l+c*-s-h*-a,t},a.rotateX=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},a.rotateY=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},a.rotateZ=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},a.forEach=(l=a.create(),function(t,e,i,n,r,o){var a,s;for(e||(e=3),i||(i=0),s=n?Math.min(n*e+i,t.length):t.length,a=i;a<s;a+=e)l[0]=t[a],l[1]=t[a+1],l[2]=t[a+2],r(l,l,o),t[a]=l[0],t[a+1]=l[1],t[a+2]=l[2];return t}),a.angle=function(t,e){var i=a.fromValues(t[0],t[1],t[2]),n=a.fromValues(e[0],e[1],e[2]);a.normalize(i,i),a.normalize(n,n);var r=a.dot(i,n);return 1<r?0:Math.acos(r)},a.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exports=a},{"./common.js":117}],125:[function(t,e,i){var l,o=t("./common.js"),n={};n.create=function(){var t=new o.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},n.clone=function(t){var e=new o.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,i,n){var r=new o.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.div=n.divide,n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(i*i+n*n+r*r+o*o)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return i*i+n*n+r*r+o*o},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},n.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i*i+n*n+r*r+o*o;return 0<a&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=n*a,t[2]=r*a,t[3]=o*a),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,n){var r=e[0],o=e[1],a=e[2],s=e[3];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=a+n*(i[2]-a),t[3]=s+n*(i[3]-s),t},n.random=function(t,e){return e=e||1,t[0]=o.RANDOM(),t[1]=o.RANDOM(),t[2]=o.RANDOM(),t[3]=o.RANDOM(),n.normalize(t,t),n.scale(t,t,e),t},n.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*a,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*a,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*a,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*a,t},n.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[0],s=i[1],l=i[2],u=i[3],c=u*n+s*o-l*r,h=u*r+l*n-a*o,p=u*o+a*r-s*n,f=-a*n-s*r-l*o;return t[0]=c*u+f*-a+h*-l-p*-s,t[1]=h*u+f*-s+p*-a-c*-l,t[2]=p*u+f*-l+c*-s-h*-a,t[3]=e[3],t},n.forEach=(l=n.create(),function(t,e,i,n,r,o){var a,s;for(e||(e=4),i||(i=0),s=n?Math.min(n*e+i,t.length):t.length,a=i;a<s;a+=e)l[0]=t[a],l[1]=t[a+1],l[2]=t[a+2],l[3]=t[a+3],r(l,l,o),t[a]=l[0],t[a+1]=l[1],t[a+2]=l[2],t[a+3]=l[3];return t}),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exports=n},{"./common.js":117}],126:[function(t,e,i){i.read=function(t,e,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?r-1:0,p=i?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;0<c;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;0<c;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=u}return(f?-1:1)*a*Math.pow(2,o-n)},i.write=function(t,e,i,n,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),2<=(e+=1<=a+h?p/l:p*Math.pow(2,1-h))*l&&(a++,l/=2),c<=a+h?(s=0,a=c):1<=a+h?(s=(e*l-1)*Math.pow(2,r),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),a=0));8<=r;t[i+f]=255&s,f+=d,s/=256,r-=8);for(a=a<<r|s,u+=r;0<u;t[i+f]=255&a,f+=d,a/=256,u-=8);t[i+f-d]|=128*m}},{}],127:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],128:[function(t,e,i){function n(t){return function(){return t}}function o(t,e,i){return t*(1-i)+e*i}function r(t,e,i){for(var n=[],r=0;r<t.length;r++)n[r]=o(t[r],e[r],i);return n}i.interpolated=function(t){if(!t.stops)return n(t);var l=t.stops,u=t.base||1,c=Array.isArray(l[0][1])?r:o;return function(t){for(var e,i,n=0;n<l.length;n++){var r=l[n];if(r[0]<=t&&(e=r),r[0]>t){i=r;break}}if(e&&i){var o=i[0]-e[0],a=t-e[0],s=1===u?a/o:(Math.pow(u,a)-1)/(Math.pow(u,o)-1);return c(e[1],i[1],s)}return e?e[1]:i?i[1]:void 0}},i["piecewise-constant"]=function(t){if(!t.stops)return n(t);var i=t.stops;return function(t){for(var e=0;e<i.length;e++)if(i[e][0]>t)return i[0===e?0:e-1][1];return i[i.length-1][1]}}},{}],129:[function(t,e,i){var n=t("../../reference/latest.min.js"),r=t("./parsed");e.exports=function(t){return r(t,n)}},{"../../reference/latest.min.js":132,"./parsed":130}],130:[function(t,e,i){function f(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function l(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}var r=t("csscolorparser").parseCSSColor,u=t("util").format;e.exports=function(a,c){function h(t,e){var i={message:(t?t+": ":"")+u.apply(u,Array.prototype.slice.call(arguments,2))};null!=e&&e.__line__&&(i.line=e.__line__),n.push(i)}function p(t,e,i){var n=f(e);if("string"===n&&"@"===e[0]){if(7<c.$version)return h(t,e,"constants have been deprecated as of v8");if(!(e in o))return h(t,e,'constant "%s" not found',e);n=f(e=o[e])}if(i.function&&"object"===n)return p.function(t,e,i);if(i.type){var r=p[i.type];if(r)return r(t,e,i);i=c[i.type]}p.object(t,e,i)}function t(r){return function(t,e,i){var n=f(e);n!==r&&h(t,e,"%s expected, %s found",r,n),"minimum"in i&&e<i.minimum&&h(t,e,"%s is less than the minimum value %s",e,i.minimum),"maximum"in i&&e>i.maximum&&h(t,e,"%s is greater than the maximum value %s",e,i.maximum)}}var o=a.constants||{},s={},n=[];return p.constants=function(t,e){if(7<c.$version){if(e)return h(t,e,"constants have been deprecated as of v8")}else{var i=f(e);if("object"!==i)return h(t,e,"object expected, %s found",i);for(var n in e)"@"!==n[0]&&h(t+"."+n,e[n],'constants must start with "@"')}},p.source=function(t,e){if(e.type)switch(l(e.type)){case"vector":case"raster":if(p.object(t,e,c.source_tile),"url"in e)for(var i in e)["type","url","tileSize"].indexOf(i)<0&&h(t+"."+i,e[i],'a source with a "url" property may not include a "%s" property',i);break;case"geojson":p.object(t,e,c.source_geojson);break;case"video":p.object(t,e,c.source_video);break;case"image":p.object(t,e,c.source_image);break;default:p.enum(t+".type",e.type,{values:["vector","raster","geojson","video","image"]})}else h(t,e,'"type" is required')},p.layer=function(e,i){i.type||i.ref||h(e,i,'either "type" or "ref" is required');var n,r=l(i.type),o=l(i.ref);if(i.id&&(s[i.id]?h(e,i.id,'duplicate layer id "%s", previously used at line %d',i.id,s[i.id]):s[i.id]=i.id.__line__),"ref"in i)["type","source","source-layer","filter","layout"].forEach(function(t){t in i&&h(e,i[t],'"%s" is prohibited for ref layers',t)}),a.layers.forEach(function(t){t.id==o&&(n=t)}),n?n.ref?h(e,i.ref,"ref cannot reference another ref layer"):r=n.type:h(e,i.ref,'ref layer "%s" not found',o);else if("background"!==r)if(i.source){var t=a.sources[i.source];t?"vector"==t.type&&"raster"==r?h(e,i.source,'layer "%s" requires a raster source',i.id):"raster"==t.type&&"raster"!=r?h(e,i.source,'layer "%s" requires a vector source',i.id):"vector"!=t.type||i["source-layer"]||h(e,i,'layer "%s" must specify a "source-layer"',i.id):h(e,i.source,'source "%s" not found',i.source)}else h(e,i,'missing required property "source"');p.object(e,i,c.layer,{filter:p.filter,layout:function(t,e){var i=c["layout_"+r];return r&&i&&p(t,e,i)},paint:function(t,e){var i=c["paint_"+r];return r&&i&&p(t,e,i)}})},p.object=function(t,e,i,n){n=n||{};var r=f(e);if("object"!==r)return h(t,e,"object expected, %s found",r);for(var o in e){var a=o.split(".")[0],s=i[a]||i["*"],l=a.match(/^(.*)-transition$/);s?(n[a]||p)((t?t+".":t)+o,e[o],s):l&&i[l[1]]&&i[l[1]].transition?p((t?t+".":t)+o,e[o],c.transition):""!==t&&1!==t.split(".").length&&h(t,e[o],'unknown property "%s"',o)}for(var u in i)i[u].required&&void 0===i[u].default&&void 0===e[u]&&h(t,e,'missing required property "%s"',u)},p.array=function(t,e,i,n){if("array"!==f(e))return h(t,e,"array expected, %s found",f(e));if(i.length&&e.length!==i.length)return h(t,e,"array length %d expected, length %d found",i.length,e.length);if(i["min-length"]&&e.length<i["min-length"])return h(t,e,"array length at least %d expected, length %d found",i["min-length"],e.length);var r={type:i.value};a.version<7&&(r.function=i.function),"object"===f(i.value)&&(r=i.value);for(var o=0;o<e.length;o++)(n||p)(t+"["+o+"]",e[o],r)},p.filter=function(t,e){var i;if("array"!==f(e))return h(t,e,"array expected, %s found",f(e));if(e.length<1)return h(t,e,"filter array must have at least 1 element");switch(p.enum(t+"[0]",e[0],c.filter_operator),l(e[0])){case"<":case"<=":case">":case">=":2<=e.length&&"$type"==e[1]&&h(t,e,'"$type" cannot be use with operator "%s"',e[0]);case"==":case"!=":3!=e.length&&h(t,e,'filter array for operator "%s" must have 3 elements',e[0]);case"in":case"!in":2<=e.length&&("string"!==(i=f(e[1]))?h(t+"[1]",e[1],"string expected, %s found",i):"@"===e[1][0]&&h(t+"[1]",e[1],"filter key cannot be a constant"));for(var n=2;n<e.length;n++)i=f(e[n]),"$type"==e[1]?p.enum(t+"["+n+"]",e[n],c.geometry_type):"string"===i&&"@"===e[n][0]?h(t+"["+n+"]",e[n],"filter value cannot be a constant"):"string"!==i&&"number"!==i&&"boolean"!==i&&h(t+"["+n+"]",e[n],"string, number, or boolean expected, %s found",i);break;case"any":case"all":case"none":for(n=1;n<e.length;n++)p.filter(t+"["+n+"]",e[n])}},p.function=function(t,e,r){p.object(t,e,c.function,{stops:function(t,e,i){var n=-1/0;p.array(t,e,i,function(t,e){return"array"!==f(e)?h(t,e,"array expected, %s found",f(e)):2!==e.length?h(t,e,"array length %d expected, length %d found",2,e.length):(p(t+"[0]",e[0],{type:"number"}),p(t+"[1]",e[1],r),void("number"===f(e[0])&&("piecewise-constant"===r.function&&e[0]%1!=0&&h(t+"[0]",e[0],"zoom level for piecewise-constant functions must be an integer"),e[0]<=n&&h(t+"[0]",e[0],"array stops must appear in ascending order and have no duplicates"),n=e[0])))}),"array"===f(e)&&0===e.length&&h(t,e,"array must have at least one stop")}})},p.enum=function(t,e,i){-1===i.values.indexOf(l(e))&&h(t,e,"expected one of [%s], %s found",i.values.join(", "),e)},p.color=function(t,e){var i=f(e);return"string"!==i?h(t,e,"color expected, %s found",i):null===r(e)?h(t,e,'color expected, "%s" found',e):void 0},p.number=t("number"),p.string=t("string"),p.boolean=t("boolean"),p["*"]=function(){},p("",a,c.$root),7<c.$version&&a.constants&&p.constants("constants",a.constants),n.sort(function(t,e){return t.line-e.line}),n}},{csscolorparser:107,util:143}],131:[function(t,e,i){e.exports=t("./v8.json")},{"./v8.json":133}],132:[function(t,e,i){e.exports=t("./v8.min.json")},{"./v8.min.json":134}],133:[function(t,e,i){e.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Stylesheet version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:"Default bearing, in degrees.  The style bearing will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface.  The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended.",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. Valid tokens are {fontstack} and {range}.",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties.",example:{duration:300,delay:0}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For GeoJSON and video sources, a URL must be provided."}},source:["source_tile","source_geojson","source_video","source_image"],source_tile:{type:{required:!0,type:"enum",values:["vector","raster"],doc:"The data type of the tile source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<mapid>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:["geojson"],doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:14,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},buffer:{type:"number",default:64,doc:"Tile buffer size on each side (higher means fewer rendering artifacts near tile edges but slower performance)."},tolerance:{type:"number",default:3,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups."},clusterRadius:{type:"number",default:400,doc:"Radius of each cluster when clustering points, relative to 4096 tile."},clusterMaxZoom:{type:"number",doc:"Max zoom to cluster points on. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered)."}},source_video:{type:{required:!0,type:"enum",values:["video"],doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:["image"],doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image"},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:["fill","line","symbol","circle","raster","background"],doc:"Rendering type of this layer."},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},ref:{type:"string",doc:"References another layer to copy `type`, `source`, `source-layer`, `minzoom`, `maxzoom`, `filter`, and `layout` properties from. This allows the layers to share processing and be more efficient."},source:{type:"string",doc:"Name of a source description to be used for this layer."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required if the source supports multiple layers."},minzoom:{type:"number",minimum:0,maximum:22,doc:"The minimum zoom level on which the layer gets parsed and appears on."},maxzoom:{type:"number",minimum:0,maximum:22,doc:"The maximum zoom level on which the layer gets parsed and appears on."},interactive:{type:"boolean",doc:"Enable querying of feature data from this layer for interactivity.",default:!1},filter:{type:"filter",doc:"A expression specifying conditions on source features. Only features that match the filter are displayed."},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."},"paint.*":{type:"paint",doc:"Class-specific paint properties for this layer. The class name is the part after the first dot."}},layout:["layout_fill","layout_line","layout_circle","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible",doc:"The display of this layer. `none` hides this layer."}},layout_fill:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible",doc:"The display of this layer. `none` hides this layer."}},layout_circle:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible",doc:"The display of this layer. `none` hides this layer."}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant",values:["butt","round","square"],default:"butt",doc:"The display of line endings."},"line-join":{type:"enum",function:"piecewise-constant",values:["bevel","round","miter"],default:"miter",doc:"The display of lines when joining."},"line-miter-limit":{type:"number",default:2,function:"interpolated",doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated",doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}]},visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible",doc:"The display of this layer. `none` hides this layer."}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant",values:["point","line"],default:"point",doc:"Label placement relative to its geometry. `line` can only be used on LineStrings and Polygons."},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated",units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer."},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"viewport",doc:"Orientation of icon when map is rotated.",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated",doc:"Scale factor for icon. 1 is original size, 3 triples the size.",requires:["icon-image"]},"icon-image":{type:"string",function:"piecewise-constant",doc:"A string with {tokens} replaced, referencing the data property to pull from.",tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated",units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated",units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"viewport",doc:"Orientation of text when map is rotated.",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant",default:"",tokens:!0,doc:"Value to use for a text label. Feature properties are specified using tokens like {field_name}."},"text-font":{type:"array",value:"string",function:"piecewise-constant",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated",doc:"Font size.",requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"em",function:"interpolated",doc:"The maximum line width for text wrapping.",requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"em",function:"interpolated",doc:"Text leading value for multi-line text.",requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"em",function:"interpolated",doc:"Text tracking amount.",requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant",values:["left","center","right"],default:"center",doc:"Text justification options.",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated",doc:"Rotates the text clockwise.",requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant",values:["none","uppercase","lowercase"],default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"]},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up.",value:"number",units:"ems",function:"interpolated",length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"]},visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible",doc:"The display of this layer. `none` hides this layer."}},layout_raster:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible",doc:"The display of this layer. `none` hides this layer."}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_operator:{type:"enum",values:["==","!=",">",">=","<","<=","in","!in","all","any","none"],doc:"The filter operator."},geometry_type:{type:"enum",values:["Point","LineString","Polygon"],doc:"The geometry type for the filter to select."},color_operation:{type:"enum",values:["lighten","saturate","spin","fade","mix"],doc:"A color operation to apply."},function:{stops:{type:"array",required:!0,doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2,doc:"Zoom level and value pair."},paint:["paint_fill","paint_line","paint_circle","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant",default:!0,doc:"Whether or not the fill should be antialiased."},"fill-opacity":{type:"number",function:"interpolated",default:1,minimum:0,maximum:1,doc:"The opacity given to the fill color.",transition:!0},"fill-color":{type:"color",default:"#000000",doc:"The color of the fill.",function:"interpolated",transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",function:"interpolated",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"fill-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)",default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512)."}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",function:"interpolated",default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",function:"interpolated",transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"line-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)",default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels",doc:"Stroke thickness."},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",function:"interpolated",transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,doc:'The line\'s offset perpendicular to its direction. Values may be positive or negative, where positive indicates "rightwards" (if you were moving in the direction of the line) and negative indicates "leftwards."',function:"interpolated",transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels."},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512)."}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated",transition:!0,units:"pixels",doc:"Circle radius."},"circle-color":{type:"color",default:"#000000",doc:"The color of the circle.",function:"interpolated",transition:!0},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",function:"interpolated",transition:!0},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively."},"circle-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen)",default:"map",requires:["circle-translate"]}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated",transition:!0,doc:"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with sdf icons.",requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen).",default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0,requires:["text-field"]},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",function:"interpolated",transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],doc:"Control whether the translation is relative to the map (north) or viewport (screen).",default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated",transition:!0,units:"degrees",doc:"Rotates hues around the color wheel."},"raster-brightness-min":{type:"number",function:"interpolated",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,function:"interpolated",transition:!0},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,function:"interpolated",transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated",transition:!0,units:"milliseconds",doc:"Fade duration when a new tile is added."}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",function:"interpolated",transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512)."},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",function:"interpolated",transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}}}},{}],134:[function(t,e,i){e.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image"],source_tile:{type:{required:!0,type:"enum",values:["vector","raster"]},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:["geojson"]},data:{type:"*"},maxzoom:{type:"number",default:14},buffer:{type:"number",default:64},tolerance:{type:"number",default:3},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:400},clusterMaxZoom:{type:"number"}},source_video:{type:{required:!0,type:"enum",values:["video"]},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:["image"]},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:["fill","line","symbol","circle","raster","background"]},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:22},maxzoom:{type:"number",minimum:0,maximum:22},interactive:{type:"boolean",default:!1},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible"}},layout_fill:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible"}},layout_circle:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",function:"piecewise-constant",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated",requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated",requires:[{"line-join":"round"}]},visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated",units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant",default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant",default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant",default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant",default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"viewport",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated",requires:["icon-image"]},"icon-image":{type:"string",function:"piecewise-constant",tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated",units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated",units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",requires:["icon-image"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"viewport",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant",default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated",requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"em",function:"interpolated",requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"em",function:"interpolated",requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"em",function:"interpolated",requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant",values:["left","center","right"],default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated",requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated",requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated",requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant",values:["none","uppercase","lowercase"],default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated",length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant",default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant",default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant",default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible"}},layout_raster:{visibility:{type:"enum",function:"piecewise-constant",values:["visible","none"],default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:["==","!=",">",">=","<","<=","in","!in","all","any","none"]},geometry_type:{type:"enum",values:["Point","LineString","Polygon"]},color_operation:{type:"enum",values:["lighten","saturate","spin","fade","mix"]},function:{stops:{type:"array",required:!0,value:"function_stop"},base:{type:"number",default:1,minimum:0}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},paint:["paint_fill","paint_line","paint_circle","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant",default:!0},"fill-opacity":{type:"number",function:"interpolated",default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated",transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant",transition:!0}},paint_line:{"line-opacity":{type:"number",function:"interpolated",default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated",transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated",transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant",transition:!0}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated",transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated",transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated",transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"map",requires:["circle-translate"]}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated",transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated",transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated",transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated",transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated",transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant",values:["map","viewport"],default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated",transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated",default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated",default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated",transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated",transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated",transition:!0,units:"milliseconds"}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated",transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant",transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated",transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}}}},{}],135:[function(t,e,i){function n(t){var e;t&&t.length&&(t=(e=t).length);var i=new Uint8Array(t||0);return e&&i.set(e),i.readUInt32LE=o.readUInt32LE,i.writeUInt32LE=o.writeUInt32LE,i.readInt32LE=o.readInt32LE,i.writeInt32LE=o.writeInt32LE,i.readFloatLE=o.readFloatLE,i.writeFloatLE=o.writeFloatLE,i.readDoubleLE=o.readDoubleLE,i.writeDoubleLE=o.writeDoubleLE,i.toString=o.toString,i.write=o.write,i.slice=o.slice,i.copy=o.copy,i._isBuffer=!0,i}function r(t){for(var e,i,n=t.length,r=[],o=0;o<n;o++){if(55295<(e=t.charCodeAt(o))&&e<57344){if(!i){56319<e||o+1===n?r.push(239,191,189):i=e;continue}if(e<56320){r.push(239,191,189),i=e;continue}e=i-55296<<10|e-56320|65536,i=null}else i&&(r.push(239,191,189),i=null);e<128?r.push(e):e<2048?r.push(e>>6|192,63&e|128):e<65536?r.push(e>>12|224,e>>6&63|128,63&e|128):r.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return r}e.exports=n;var o,a,s,l=t("ieee754");(o={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return l.read(this,t,!0,23,4)},readDoubleLE:function(t){return l.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return l.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return l.write(this,t,e,!0,52,8)},toString:function(t,e,i){var n="",r="";e=e||0,i=Math.min(this.length,i||this.length);for(var o=e;o<i;o++){var a=this[o];a<=127?(n+=decodeURIComponent(r)+String.fromCharCode(a),r=""):r+="%"+a.toString(16)}return n+decodeURIComponent(r)},write:function(t,e){for(var i=t===a?s:r(t),n=0;n<i.length;n++)this[e+n]=i[n]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var i=0;i<this.length;i++)t[e+i]=this[i]}}).writeInt32LE=o.writeUInt32LE,n.byteLength=function(t){return(s=r(a=t)).length},n.isBuffer=function(t){return!(!t||!t._isBuffer)}},{ieee754:126}],136:[function(e,d,t){(function(t){function n(t){this.buf=p.isBuffer(t)?t:new p(t||0),this.pos=0,this.length=this.buf.length}function i(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function r(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function o(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function a(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function s(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}d.exports=n;var p=t.Buffer||e("./buffer");n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var f=Math.pow(2,63);n.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readUInt32LE(this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+4294967296*this.buf.readInt32LE(this.pos+4);return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,e,i,n,r,o,a=this.buf;if((i=a[this.pos++])<128)return i;if(i&=127,(n=a[this.pos++])<128)return i|n<<7;if(n=(127&n)<<7,(r=a[this.pos++])<128)return i|n|r<<14;if(r=(127&r)<<14,(o=a[this.pos++])<128)return i|n|r|o<<21;if(t=i|n|r|(127&o)<<21,t+=268435456*(127&(e=a[this.pos++])),e<128)return t;if(t+=34359738368*(127&(e=a[this.pos++])),e<128)return t;if(t+=4398046511104*(127&(e=a[this.pos++])),e<128)return t;if(t+=562949953421312*(127&(e=a[this.pos++])),e<128)return t;if(t+=72057594037927940*(127&(e=a[this.pos++])),e<128)return t;if(t+=0x8000000000000000*(127&(e=a[this.pos++])),e<128)return t;throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){var t=this.pos,e=this.readVarint();if(e<f)return e;for(var i=this.pos-2;255===this.buf[i];)i--;i<t&&(i=t);for(var n=e=0;n<i-t+1;n++){var r=127&~this.buf[t+n];e+=n<4?r<<7*n:r*Math.pow(2,7*n)}return-e-1},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.buf.toString("utf8",this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.slice(this.pos,t);return this.pos=t,e},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readVarint());return e},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(t){var e=7&t;if(e===n.Varint)for(;127<this.buf[this.pos++];);else if(e===n.Bytes)this.pos=this.readVarint()+this.pos;else if(e===n.Fixed32)this.pos+=4;else{if(e!==n.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new p(e);this.buf.copy(i),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeUInt32LE(Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(-1&t,this.pos),this.buf.writeInt32LE(Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t)<=127)this.realloc(1),this.buf[this.pos++]=t;else if(t<=16383)this.realloc(2),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127;else if(t<=2097151)this.realloc(3),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127|128,this.buf[this.pos++]=t>>>14&127;else if(t<=268435455)this.realloc(4),this.buf[this.pos++]=t>>>0&127|128,this.buf[this.pos++]=t>>>7&127|128,this.buf[this.pos++]=t>>>14&127|128,this.buf[this.pos++]=t>>>21&127;else{for(var e=this.pos;128<=t;)this.realloc(1),this.buf[this.pos++]=255&t|128,t/=128;if(this.realloc(1),this.buf[this.pos++]=0|t,10<this.pos-e)throw new Error("Given varint doesn't fit into 10 bytes")}},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var e=p.byteLength(t);this.writeVarint(e),this.realloc(e),this.buf.write(t,this.pos),this.pos+=e},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i,r=n<=127?1:n<=16383?2:n<=2097151?3:n<=268435455?4:Math.ceil(Math.log(n)/(7*Math.LN2));if(1<r){this.realloc(r-1);for(var o=this.pos-1;i<=o;o--)this.buf[o+r-1]=this.buf[o]}this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,n.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,i,e)},writePackedSVarint:function(t,e){this.writeMessage(t,r,e)},writePackedBoolean:function(t,e){this.writeMessage(t,s,e)},writePackedFloat:function(t,e){this.writeMessage(t,o,e)},writePackedDouble:function(t,e){this.writeMessage(t,a,e)},writePackedFixed32:function(t,e){this.writeMessage(t,l,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,u,e)},writePackedFixed64:function(t,e){this.writeMessage(t,c,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,h,e)},writeBytesField:function(t,e){this.writeTag(t,n.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,n.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,n.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,n.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":135}],137:[function(t,e,i){function n(t,e){this.x=t,this.y=e}(e.exports=n).prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},{}],138:[function(t,e,i){function n(){c=!1,s.length?u=s.concat(u):h=-1,u.length&&r()}function r(){if(!c){var t=setTimeout(n);c=!0;for(var e=u.length;e;){for(s=u,u=[];++h<e;)s&&s[h].run();h=-1,e=u.length}s=null,c=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function a(){}var s,l=e.exports={},u=[],c=!1,h=-1;l.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new o(t,e)),1!==u.length||c||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=a,l.addListener=a,l.once=a,l.off=a,l.removeListener=a,l.removeAllListeners=a,l.emit=a,l.binding=function(t){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(t){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],139:[function(t,e,i){!function(){function i(t,e){return this instanceof i?(this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),void this.clear()):new i(t,e)}function f(t,e){t.bbox=_(t,0,t.children.length,e)}function _(t,e,i,n){for(var r,o=[1/0,1/0,-1/0,-1/0],a=e;a<i;a++)r=t.children[a],c(o,t.leaf?n(r):r.bbox);return o}function c(t,e){return t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t}function a(t,e){return t.bbox[0]-e.bbox[0]}function s(t,e){return t.bbox[1]-e.bbox[1]}function g(t){return(t[2]-t[0])*(t[3]-t[1])}function h(t){return t[2]-t[0]+(t[3]-t[1])}function u(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&e[2]<=t[2]&&e[3]<=t[3]}function p(t,e){return e[0]<=t[2]&&e[1]<=t[3]&&e[2]>=t[0]&&e[3]>=t[1]}function d(t,e,i,n,r){for(var o,a=[e,i];a.length;)(i=a.pop())-(e=a.pop())<=n||(m(t,e,i,o=e+Math.ceil((i-e)/n/2)*n,r),a.push(e,o,o,i))}function m(t,e,i,n,r){for(var o,a,s,l,u,c,h;e<i;){for(600<i-e&&(o=i-e+1,a=n-e+1,s=Math.log(o),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1),m(t,Math.max(e,Math.floor(n-a*l/o+u)),Math.min(i,Math.floor(n+(o-a)*l/o+u)),n,r)),c=t[n],h=i,y(t,a=e,n),0<r(t[i],c)&&y(t,e,i);a<h;){for(y(t,a,h),a++,h--;r(t[a],c)<0;)a++;for(;0<r(t[h],c);)h--}0===r(t[e],c)?y(t,e,h):y(t,++h,i),h<=n&&(e=h+1),n<=h&&(i=h-1)}}function y(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!p(t,e.bbox))return i;for(var r,o,a,s,l=[];e;){for(r=0,o=e.children.length;r<o;r++)a=e.children[r],p(t,s=e.leaf?n(a):a.bbox)&&(e.leaf?i.push(a):u(t,s)?this._all(a,i):l.push(a));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!p(t,e.bbox))return!1;for(var n,r,o,a,s=[];e;){for(n=0,r=e.children.length;n<r;n++)if(o=e.children[n],p(t,a=e.leaf?i(o):o.bbox)){if(e.leaf||u(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:[1/0,1/0,-1/0,-1/0],leaf:!0},this},remove:function(t){if(!t)return this;for(var e,i,n,r,o=this.data,a=this.toBBox(t),s=[],l=[];o||s.length;){if(o||(o=s.pop(),i=s[s.length-1],e=l.pop(),r=!0),o.leaf&&-1!==(n=o.children.indexOf(t)))return o.children.splice(n,1),s.push(o),this._condense(s),this;r||o.leaf||!u(o.bbox,a)?i?(e++,o=i.children[e],r=!1):o=null:(s.push(o),l.push(e),e=0,o=(i=o).children[0])}return this},toBBox:function(t){return t},compareMinX:function(t,e){return t[0]-e[0]},compareMinY:function(t,e){return t[1]-e[1]},toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,n){var r,o=i-e+1,a=this._maxEntries;if(o<=a)return f(r={children:t.slice(e,i+1),height:1,bbox:null,leaf:!0},this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),r={children:[],height:n,bbox:null,leaf:!1};var s,l,u,c,h=Math.ceil(o/a),p=h*Math.ceil(Math.sqrt(a));for(d(t,e,i,p,this.compareMinX),s=e;s<=i;s+=p)for(d(t,s,u=Math.min(s+p-1,i),h,this.compareMinY),l=s;l<=u;l+=h)c=Math.min(l+h-1,u),r.children.push(this._build(t,l,c,n-1));return f(r,this.toBBox),r},_chooseSubtree:function(t,e,i,n){for(var r,o,a,s,l,u,c,h;n.push(e),!e.leaf&&n.length-1!==i;){for(c=h=1/0,r=0,o=e.children.length;r<o;r++)l=g((a=e.children[r]).bbox),p=t,f=a.bbox,(u=(Math.max(f[2],p[2])-Math.min(f[0],p[0]))*(Math.max(f[3],p[3])-Math.min(f[1],p[1]))-l)<h?(h=u,c=l<c?l:c,s=a):u===h&&l<c&&(c=l,s=a);e=s}var p,f;return e},_insert:function(t,e,i){var n=this.toBBox,r=i?t.bbox:n(t),o=[],a=this._chooseSubtree(r,this.data,e,o);for(a.children.push(t),c(a.bbox,r);0<=e&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)},_split:function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var o=this._chooseSplitIndex(i,r,n),a={children:i.children.splice(o,i.children.length-o),height:i.height,bbox:null,leaf:!1};i.leaf&&(a.leaf=!0),f(i,this.toBBox),f(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(t,e){this.data={children:[t,e],height:t.height+1,bbox:null,leaf:!1},f(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,r,o,a,s,l,u,c,h,p,f,d,m,y;for(l=u=1/0,n=e;n<=i-e;n++)r=_(t,0,n,this.toBBox),o=_(t,n,i,this.toBBox),h=r,p=o,void 0,f=Math.max(h[0],p[0]),d=Math.max(h[1],p[1]),m=Math.min(h[2],p[2]),y=Math.min(h[3],p[3]),a=Math.max(0,m-f)*Math.max(0,y-d),s=g(r)+g(o),a<l?(l=a,c=n,u=s<u?s:u):a===l&&s<u&&(u=s,c=n);return c},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:a,r=t.leaf?this.compareMinY:s,o=this._allDistMargin(t,e,i,n);this._allDistMargin(t,e,i,r)>o&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var r,o,a=this.toBBox,s=_(t,0,e,a),l=_(t,i-e,i,a),u=h(s)+h(l);for(r=e;r<i-e;r++)o=t.children[r],c(s,t.leaf?a(o):o.bbox),u+=h(s);for(r=i-e-1;e<=r;r--)o=t.children[r],c(l,t.leaf?a(o):o.bbox),u+=h(l);return u},_adjustParentBBoxes:function(t,e,i){for(var n=i;0<=n;n--)c(e[n].bbox,t)},_condense:function(t){for(var e,i=t.length-1;0<=i;i--)0===t[i].children.length?0<i?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():f(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return [a"+t.join(", a")+"];")}},void 0!==e?e.exports=i:"undefined"!=typeof self?self.rbush=i:window.rbush=i}()},{}],140:[function(t,e,i){var n,r;n=this,r=function(){return function(){var t=arguments.length;if(0===t)throw new Error("resolveUrl requires at least one argument; got none.");var e=document.createElement("base");if(e.href=arguments[0],1===t)return e.href;var i=document.getElementsByTagName("head")[0];i.insertBefore(e,i.firstChild);for(var n,r=document.createElement("a"),o=1;o<t;o++)r.href=arguments[o],n=r.href,e.href=n;return i.removeChild(e),n}},"object"==typeof i?e.exports=r():n.resolveUrl=r()},{}],141:[function(t,e,i){function n(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}(e.exports=n).prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var i,n,r,o,a;for(void 0===e&&(e=1e-6),r=t,a=0;a<8;a++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s}if((r=t)<(i=0))return i;if((n=1)<r)return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;o<t?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},{}],142:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],143:[function(h,t,P){(function(n,r){function s(t,e){var i={seen:[],stylize:a};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),x(e)?i.showHidden=e:e&&P._extend(i,e),S(i.showHidden)&&(i.showHidden=!1),S(i.depth)&&(i.depth=2),S(i.colors)&&(i.colors=!1),S(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),y(i,t,i.depth)}function o(t,e){var i=s.styles[e];return i?"["+s.colors[i][0]+"m"+t+"["+s.colors[i][1]+"m":t}function a(t,e){return t}function y(e,i,n){if(e.customInspect&&i&&L(i.inspect)&&i.inspect!==P.inspect&&(!i.constructor||i.constructor.prototype!==i)){var t=i.inspect(n,e);return T(t)||(t=y(e,t,n)),t}var r=function(t,e){if(S(e))return t.stylize("undefined","undefined");if(T(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return w(e)?t.stylize(""+e,"number"):x(e)?t.stylize(""+e,"boolean"):b(e)?t.stylize("null","null"):void 0}(e,i);if(r)return r;var o,a=Object.keys(i),s=(o={},a.forEach(function(t,e){o[t]=!0}),o);if(e.showHidden&&(a=Object.getOwnPropertyNames(i)),E(i)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return _(i);if(0===a.length){if(L(i)){var l=i.name?": "+i.name:"";return e.stylize("[Function"+l+"]","special")}if(A(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(M(i))return e.stylize(Date.prototype.toString.call(i),"date");if(E(i))return _(i)}var u,c,h,p,f="",d=!1,m=["{","}"];return v(i)&&(d=!0,m=["[","]"]),L(i)&&(f=" [Function"+(i.name?": "+i.name:"")+"]"),A(i)&&(f=" "+RegExp.prototype.toString.call(i)),M(i)&&(f=" "+Date.prototype.toUTCString.call(i)),E(i)&&(f=" "+_(i)),0!==a.length||d&&0!=i.length?n<0?A(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),u=d?function(e,i,n,r,t){for(var o=[],a=0,s=i.length;a<s;++a)z(i,String(a))?o.push(g(e,i,n,r,String(a),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(g(e,i,n,r,t,!0))}),o}(e,i,n,s,a):a.map(function(t){return g(e,i,n,s,t,d)}),e.seen.pop(),h=f,p=m,60<(c=u).reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?p[0]+(""===h?"":h+"\n ")+" "+c.join(",\n  ")+" "+p[1]:p[0]+h+" "+c.join(", ")+" "+p[1]):m[0]+f+m[1]}function _(t){return"["+Error.prototype.toString.call(t)+"]"}function g(t,e,i,n,r,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?s=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),z(n,r)||(a="["+r+"]"),s||(t.seen.indexOf(l.value)<0?-1<(s=b(i)?y(t,l.value,null):y(t,l.value,i-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),S(a)){if(o&&r.match(/^\d+$/))return s;a=(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(a,"string"))}return a+": "+s}function v(t){return Array.isArray(t)}function x(t){return"boolean"==typeof t}function b(t){return null===t}function w(t){return"number"==typeof t}function T(t){return"string"==typeof t}function S(t){return void 0===t}function A(t){return l(t)&&"[object RegExp]"===e(t)}function l(t){return"object"==typeof t&&null!==t}function M(t){return l(t)&&"[object Date]"===e(t)}function E(t){return l(t)&&("[object Error]"===e(t)||t instanceof Error)}function L(t){return"function"==typeof t}function e(t){return Object.prototype.toString.call(t)}function i(t){return t<10?"0"+t.toString(10):t.toString(10)}function z(t,e){return Object.prototype.hasOwnProperty.call(t,e)}P.format=function(t){if(!T(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(s(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,r=n.length,o=String(t).replace(/%[sdj%]/g,function(t){if("%%"===t)return"%";if(r<=i)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),a=n[i];i<r;a=n[++i])o+=b(a)||!l(a)?" "+a:" "+s(a);return o},P.deprecate=function(t,e){if(S(r.process))return function(){return P.deprecate(t,e).apply(this,arguments)};if(!0===n.noDeprecation)return t;var i=!1;return function(){if(!i){if(n.throwDeprecation)throw new Error(e);n.traceDeprecation?console.trace(e):console.error(e),i=!0}return t.apply(this,arguments)}};var t,u={};P.debuglog=function(e){if(S(t)&&(t=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!u[e])if(new RegExp("\\b"+e+"\\b","i").test(t)){var i=n.pid;u[e]=function(){var t=P.format.apply(P,arguments);console.error("%s %d: %s",e,i,t)}}else u[e]=function(){};return u[e]},(P.inspect=s).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},P.isArray=v,P.isBoolean=x,P.isNull=b,P.isNullOrUndefined=function(t){return null==t},P.isNumber=w,P.isString=T,P.isSymbol=function(t){return"symbol"==typeof t},P.isUndefined=S,P.isRegExp=A,P.isObject=l,P.isDate=M,P.isError=E,P.isFunction=L,P.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},P.isBuffer=h("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];P.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[i(t.getHours()),i(t.getMinutes()),i(t.getSeconds())].join(":"),[t.getDate(),c[t.getMonth()],e].join(" ")),P.format.apply(P,arguments))},P.inherits=h("inherits"),P._extend=function(t,e){if(!e||!l(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(this,h("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":142,_process:138,inherits:127}],144:[function(t,e,i){e.exports.VectorTile=t("./lib/vectortile.js"),e.exports.VectorTileFeature=t("./lib/vectortilefeature.js"),e.exports.VectorTileLayer=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":145,"./lib/vectortilefeature.js":147,"./lib/vectortilelayer.js":148}],145:[function(t,e,i){function n(t,e,i){if(3===t){var n=new r(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var r=t("./vectortilelayer");e.exports=function(t,e){this.layers=t.readFields(n,{},e)}},{"./vectortilelayer":148}],146:[function(t,e,i){function n(t){this.feature=t,this.finalRatio=4096/t.extent*Math.pow(2,t.dz);var e=64;e/=this.finalRatio;var i=t.extent>>t.dz;i<e&&(e=i),this.dz=t.dz,this.margin=e,this.xmin=i*t.xPos-e,this.ymin=i*t.yPos-e,this.xmax=this.xmin+i+2*e,this.ymax=this.ymin+i+2*e,this.lines=[],this._prevIsIn=!1,this.type=t.type}var y=t("point-geometry");(e.exports=n).prototype.loadGeometry=function(){var t=this.feature._pbf;t.pos=this.feature._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0;t.pos<e;){if(!n){var a=t.readVarint();i=7&a,n=a>>3}if(n--,1===i||2===i)r+=t.readSVarint(),o+=t.readSVarint(),1===i?this.moveTo(r,o):this.lineTo(r,o);else{if(7!==i)throw new Error("unknown command "+i);this.closePolygon()}}return this.result()},n.prototype.moveTo=function(t,e){this._push_line(),this._prevIsIn=this._isIn(t,e),this._moveTo(t,e,this._prevIsIn),this._prevPt=new y(t,e),this._firstPt=new y(t,e)},n.prototype.lineTo=function(t,e){var i,n,r,o,a,s,l,u,c,h,p,f,d=this._isIn(t,e);if(d)this._prevIsIn?this._lineTo(t,e,!0):(i=this._prevPt,n=new y(t,e),r=this._intersect(n,i),this._lineTo(r.x,r.y,!0),this._lineTo(n.x,n.y,!0));else if(this._prevIsIn)n=this._prevPt,i=new y(t,e),r=this._intersect(n,i),this._lineTo(r.x,r.y,!0),this._lineTo(i.x,i.y,!1);else if(o=this._prevPt,a=new y(t,e),o.x<=this.xmin&&a.x<=this.xmin||o.x>=this.xmax&&a.x>=this.xmax||o.y<=this.ymin&&a.y<=this.ymin||o.y>=this.ymax&&a.y>=this.ymax)this._lineTo(a.x,a.y,!1);else{if(u=[],(o.x<this.xmin&&a.x>this.xmin||o.x>this.xmin&&a.x<this.xmin)&&(s=(this.xmin-o.x)/(a.x-o.x),(f=o.y+s*(a.y-o.y))<=this.ymin?h=!1:f>=this.ymax?h=!0:((l={}).ratio=s,l.x=this.xmin,l.y=f,u.push(l))),(o.x<this.xmax&&a.x>this.xmax||o.x>this.xmax&&a.x<this.xmax)&&(s=(this.xmax-o.x)/(a.x-o.x),(f=o.y+s*(a.y-o.y))<=this.ymin?h=!1:f>=this.ymax?h=!0:((l={}).ratio=s,l.x=this.xmax,l.y=f,u.push(l))),(o.y<this.ymin&&a.y>this.ymin||o.y>this.ymin&&a.y<this.ymin)&&(s=(this.ymin-o.y)/(a.y-o.y),(p=o.x+s*(a.x-o.x))<=this.xmin?c=!1:p>=this.xmax?c=!0:((l={}).ratio=s,l.x=p,l.y=this.ymin,u.push(l))),(o.y<this.ymax&&a.y>this.ymax||o.y>this.ymax&&a.y<this.ymax)&&(s=(this.ymax-o.y)/(a.y-o.y),(p=o.x+s*(a.x-o.x))<=this.xmin?c=!1:p>=this.xmax?c=!0:((l={}).ratio=s,l.x=p,l.y=this.ymax,u.push(l))),0===u.length)c?h?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):h?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<u.length&&u[0].ratio>u[1].ratio)this._lineTo(u[1].x,u[1].y,!0),this._lineTo(u[0].x,u[0].y,!0);else for(var m=0;m<u.length;m++)this._lineTo(u[m].x,u[m].y,!0);this._lineTo(a.x,a.y,!1)}this._prevIsIn=d,this._prevPt=new y(t,e)},n.prototype.closePolygon=function(){var t,e;0<this.line.length&&(t=this._firstPt,e=this._prevPt,(t.x!==e.x||t.y!==e.y)&&this.lineTo(t.x,t.y))},n.prototype.result=function(){return this._push_line(),0===this.lines.length?null:this.lines},n.prototype._isIn=function(t,e){return t>=this.xmin&&t<=this.xmax&&e>=this.ymin&&e<=this.ymax},n.prototype._intersect=function(t,e){var i,n,r,o;return e.x>=this.xmin&&e.x<=this.xmax?(n=e.y<=this.ymin?this.ymin:this.ymax,i=t.x+(n-t.y)/(e.y-t.y)*(e.x-t.x)):e.y>=this.ymin&&e.y<=this.ymax?(i=e.x<=this.xmin?this.xmin:this.xmax,n=t.y+(i-t.x)/(e.x-t.x)*(e.y-t.y)):(n=e.y<=this.ymin?this.ymin:this.ymax,(r=((i=e.x<=this.xmin?this.xmin:this.xmax)-t.x)/(e.x-t.x))<(o=(n-t.y)/(e.y-t.y))?n=t.y+r*(e.y-t.y):i=t.x+o*(e.x-t.x)),new y(i,n)},n.prototype._push_line=function(){this.line&&(1===this.type?0<this.line.length&&this.lines.push(this.line):2===this.type?1<this.line.length&&this.lines.push(this.line):3===this.type&&3<this.line.length&&this.lines.push(this.line)),this.line=[]},n.prototype._moveTo=function(t,e,i){3!==this.type?i&&(t=(t-(this.xmin+this.margin))*this.finalRatio,e=(e-(this.ymin+this.margin))*this.finalRatio,this.line.push(new y(t,e))):(i||(t<this.xmin&&(t=this.xmin),t>this.xmax&&(t=this.xmax),e<this.ymin&&(e=this.ymin),e>this.ymax&&(e=this.ymax)),t=(t-(this.xmin+this.margin))*this.finalRatio,e=(e-(this.ymin+this.margin))*this.finalRatio,this.line.push(new y(t,e)),this._is_h=!1,this._is_v=!1)},n.prototype._lineTo=function(t,e,i){var n,r;if(3!==this.type)if(i){if(t=(t-(this.xmin+this.margin))*this.finalRatio,e=(e-(this.ymin+this.margin))*this.finalRatio,0<this.line.length&&((n=this.line[this.line.length-1]).x===t&&n.y===e))return;this.line.push(new y(t,e))}else this.line&&0<this.line.length&&this._push_line();else if(i||(t<this.xmin&&(t=this.xmin),t>this.xmax&&(t=this.xmax),e<this.ymin&&(e=this.ymin),e>this.ymax&&(e=this.ymax)),t=(t-(this.xmin+this.margin))*this.finalRatio,e=(e-(this.ymin+this.margin))*this.finalRatio,this.line&&0<this.line.length){var o=(n=this.line[this.line.length-1]).x===t,a=n.y===e;if(o&&a)return;this._is_h&&o?(n.x=t,n.y=e,r=this.line[this.line.length-2],this._is_h=r.x===t,this._is_v=r.y===e):this._is_v&&a?(n.x=t,n.y=e,r=this.line[this.line.length-2],this._is_h=r.x===t,this._is_v=r.y===e):(this.line.push(new y(t,e)),this._is_h=o,this._is_v=a)}else this.line.push(new y(t,e))}},{"point-geometry":137}],147:[function(t,e,i){function f(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(o,this,e)}function o(t,e,i){1==t?e._id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}var h=t("point-geometry"),p=t("./vectortileclipper");(e.exports=f).types=["Unknown","Point","LineString","Polygon"],f.prototype.loadGeometry=function(){var t;if(this.dz)t=new p(this).loadGeometry();else{for(var e=0,i=this.extent;4096<i;)e+=1,i>>=1;var n=this._pbf;n.pos=this._geometry;var r,o=n.readVarint()+n.pos,a=1,s=0,l=0,u=0;for(t=[];n.pos<o;){if(!s){var c=n.readVarint();a=7&c,s=c>>3}if(s--,1===a||2===a)l+=n.readSVarint(),u+=n.readSVarint(),1===a&&(r&&t.push(r),r=[]),r.push(new h(l>>e,u>>e));else{if(7!==a)throw new Error("unknown command "+a);r&&r.push(r[0].clone())}}r&&t.push(r)}return t},f.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!n){var c=t.readVarint();i=7&c,n=c>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<a&&(a=r),s<r&&(s=r),(o+=t.readSVarint())<l&&(l=o),u<o&&(u=o);else if(7!==i)throw new Error("unknown command "+i)}return[a,l,s,u]},f.prototype.toGeoJSON=function(t,e,i){for(var n=this.extent*Math.pow(2,i),r=this.extent*t,o=this.extent*e,a=this.loadGeometry(),s=f.types[this.type],l=0;l<a.length;l++)for(var u=a[l],c=0;c<u.length;c++){var h=u[c],p=180-360*(h.y+o)/n;u[c]=[360*(h.x+r)/n-180,360/Math.PI*Math.atan(Math.exp(p*Math.PI/180))-90]}return"Point"===s&&1===a.length?a=a[0][0]:"Point"===s?(a=a[0],s="MultiPoint"):"LineString"===s&&1===a.length?a=a[0]:"LineString"===s&&(s="MultiLineString"),{type:"Feature",geometry:{type:s,coordinates:a},properties:this.properties}}},{"./vectortileclipper":146,"point-geometry":137}],148:[function(t,e,i){function n(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(r,this,e),this.length=this._features.length}function r(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}var o=t("./vectortilefeature.js");(e.exports=n).prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,e,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":147}],149:[function(t,e,i){var p=arguments[3],f=arguments[4],d=arguments[5],m=JSON.stringify;e.exports=function(t){for(var e,i=Object.keys(d),n=0,r=i.length;n<r;n++){var o=i[n],a=d[o].exports;if(a===t||a.default===t){e=o;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var s={};for(n=0,r=i.length;n<r;n++){s[o=i[n]]=o}f[e]=[Function(["require","module","exports"],"("+t+")(self)"),s]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),u={};u[e]=e,f[l]=[Function(["require"],"var f = require("+m(e)+");(f.default ? f.default : f)(self);"),u];var c="("+p+")({"+Object.keys(f).map(function(t){return m(t)+":["+f[t][0]+","+m(f[t][1])+"]"}).join(",")+"},{},["+m(l)+"])",h=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(h.createObjectURL(new Blob([c],{type:"text/javascript"})))}},{}]},{},[24])(24)}),L.MapboxGL=L.Layer.extend({options:{updateInterval:32},initialize:function(t){if(L.setOptions(this,t),!t.accessToken)throw new Error("You should provide a Mapbox GL access token as a token option.");var e,i,n,r,o,a;mapboxgl.accessToken=t.accessToken,this._throttledUpdate=(e=L.Util.bind(this._update,this),i=this.options.updateInterval,a=function(){n=!1,r&&(o.apply(void 0,r),r=!1)},o=function(){n?r=arguments:(e.apply(void 0,arguments),setTimeout(a,i),n=!0)})},onAdd:function(t){this._glContainer||this._initContainer(),t._panes.tilePane.appendChild(this._glContainer),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&L.DomEvent.on(t._proxy,L.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(t){this._map.options.zoomAnimation&&L.DomEvent.off(this._map._proxy,L.DomUtil.TRANSITION_END,this._transitionEnd,this),t.getPanes().tilePane.removeChild(this._glContainer),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd}},_initContainer:function(){var t=this._glContainer=L.DomUtil.create("div","leaflet-gl-layer"),e=this._map.getSize();t.style.width=e.x+"px",t.style.height=e.y+"px"},_initGL:function(){var t=this._map.getCenter(),e=L.extend({},this.options,{container:this._glContainer,interactive:!1,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new mapboxgl.Map(e),this._glMap.transform.latRange=null,this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas,L.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-image-layer"),L.DomUtil.addClass(this._glMap._actualCanvas,"leaflet-zoom-animated")},_update:function(t){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var e=this._map.getSize(),i=this._glContainer,n=this._glMap,r=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(i,r);var o=this._map.getCenter(),a=n.transform;a.center=mapboxgl.LngLat.convert([o.lng,o.lat]),a.zoom=this._map.getZoom()-1,n.transform.width!==e.x||n.transform.height!==e.y?(i.style.width=e.x+"px",i.style.height=e.y+"px",null!==n._resize&&void 0!==n._resize?n._resize():n.resize()):null!==n._update&&void 0!==n._update?n._update():n.update()}},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center);L.DomUtil.setTransform(this._glMap._actualCanvas,i.subtract(this._offset),e)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var t=this._map.getZoomScale(this._map.getZoom()),e=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),this._map.getZoom(),this._map.getCenter());L.DomUtil.setTransform(this._glMap._actualCanvas,e.subtract(this._offset),t),this._zooming=!1},_transitionEnd:function(t){L.Util.requestAnimFrame(function(){var t=this._map.getZoom(),e=this._map.getCenter(),i=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());L.DomUtil.setTransform(this._glMap._actualCanvas,i,1),this._glMap.once("moveend",L.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:e,zoom:t-1})},this)}}),L.mapboxGL=function(t){return new L.MapboxGL(t)};var i=o.Layer.extend({statics:{URLPREFIX:"https://www.arcgis.com/sharing/rest/content/items/",URLSUFFIX:"/resources/styles/root.json",STYLES:{DarkGray:"57436c01bc754dbb87dfb636b6484022",Gray:"1e47168d181248e491541ffd5a91c0de",Hybrid:"af6063d6906c4eb589dfe03819610660",Navigation:"e19e9330bf08490ca8353d76b5e2e658",Streets:"a60a37a27cc140ddad15f919cd5a69f2",StreetsNight:"92c551c9f07b4147846aae273e822714",StreetsRelief:"78c0a9ab4fbf4198a8b951848aab19d8",Topographic:"86d5ed4b6dc741de9dad5f0fbe09ae95",Spring:"763884983d3544c0a418a97992881fce",Newspaper:"4f4843d99c34436f82920932317893ae",MidCentury:"267f44f08a844c7abee2b62b00600540",ModernAntique:"996d9e7a3aac4514bb692ce7a990f1c1",BlackAndWhite:"3161443179244702a5e0449010013b54"}},initialize:function(t){if("string"!=typeof(t={key:t}).key||!i.STYLES[t.key])throw new Error('L.esri.Vector.Basemap: Invalid parameter. Use one of "DarkGray", "Gray", "Hybrid", "Navigation", "Streets", "StreetsNight", "StreetsRelief", "Topographic"');s(i.URLPREFIX+i.STYLES[t.key]+i.URLSUFFIX,this)},onAdd:function(t){this._map=t,a.Util.setEsriAttribution(t),t.attributionControl&&(a.Util._getAttributionData("https://static.arcgis.com/attribution/World_Street_Map",t),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">USGS, NOAA</span>')),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(t){if(t.off("moveend",a.Util._updateMapAttribution),t.removeLayer(this._mapboxGL),t.attributionControl){var e=document.getElementsByClassName("esri-dynamic-attribution")[0].outerHTML;t.attributionControl.removeAttribution(e)}},_asyncAdd:function(){var t=this._map;t.getContainer().style.background=this._mapboxGL.options.style.layers[0].paint["background-color"],t.on("moveend",a.Util._updateMapAttribution),this._mapboxGL.addTo(t,this)}}),u=o.Layer.extend({statics:{URLPREFIX:"https://www.arcgis.com/sharing/rest/content/items/"},initialize:function(t){if("string"!=typeof(t={id:t}).id)throw new Error("L.esri.Vector.Layer: Invalid parameter. Use the id of an ArcGIS Online vector tile item");var n,r,i=u.URLPREFIX+t.id;a.request(i,{},function(t,e){t||(-1===(n=e.url).indexOf("basemaps.arcgis.com")?(this._customTileset=!0,e.accessInformation&&(this._copyrightText=e.accessInformation),a.request(n,{},function(t,i){t||("/"!==i.defaultStyles.charAt(0)&&(i.defaultStyles="/"+i.defaultStyles),r=n+i.defaultStyles+"/root.json",a.request(r,{},function(t,e){t||(l(e,i,r),this._mapboxGL=o.mapboxGL({accessToken:"ezree",style:e}),this._ready=!0,this.fire("ready",{},!0))},this))},this)):s(i+"/resources/styles/root.json",this))},this)},onAdd:function(t){this._map=t,a.Util.setEsriAttribution(t),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(t){if(t.off("moveend",a.Util._updateMapAttribution),t.removeLayer(this._mapboxGL),t.attributionControl){var e=document.getElementsByClassName("esri-dynamic-attribution")[0].outerHTML;t.attributionControl.removeAttribution(e)}},_asyncAdd:function(){var t=this._map;t.attributionControl&&(this._customTileset?this._copyrightText&&t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">'+this._copyrightText+"</span>"):(a.Util._getAttributionData("https://static.arcgis.com/attribution/World_Street_Map",t),t.attributionControl.addAttribution('<span class="esri-dynamic-attribution">USGS, NOAA</span>'),t.on("moveend",a.Util._updateMapAttribution))),t.getContainer().style.background=this._mapboxGL.options.style.layers[0].paint["background-color"],this._mapboxGL.addTo(t,this)}});e.VERSION="1.0.7",e.Basemap=i,e.basemap=function(t){return new i(t)},e.Layer=u,e.layer=function(t){return new u(t)}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t.leaflet=t.leaflet||{},t.leaflet["extra-markers"]={}))}(this,function(t){"use strict";var e=L.ExtraMarkers={};e.version=L.ExtraMarkers.version="1.0.8",e.Icon=L.ExtraMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"",prefix:"",extraClasses:"",shape:"circle",icon:"",innerHTML:"",markerColor:"red",svgBorderColor:"#fff",svgOpacity:1,iconColor:"#fff",number:"",svg:!1},initialize:function(t){t=L.Util.setOptions(this,t)},createIcon:function(){var t=document.createElement("div"),e=this.options;return e.icon&&(t.innerHTML=this._createInner()),e.innerHTML&&(t.innerHTML=e.innerHTML),e.bgPos&&(t.style.backgroundPosition=-e.bgPos.x+"px "+-e.bgPos.y+"px"),e.svg?this._setIconStyles(t,"svg"):this._setIconStyles(t,e.shape+"-"+e.markerColor),t},_createInner:function(){var t="",e="",i=this.options;if(i.iconColor&&(t="style='color: "+i.iconColor+"' "),i.number&&(e="number='"+i.number+"' "),i.svg){var n='<svg xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 69.529271 95.44922" style="fill:'+i.markerColor+";stroke:"+i.svgBorderColor+";fill-opacity:"+i.svgOpacity+';" height="100%" width="100%" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><g transform="translate(-139.52 -173.21)"><path d="m174.28 173.21c-19.199 0.00035-34.764 15.355-34.764 34.297 0.007 6.7035 1.5591 12.813 5.7461 18.854l0.0234 0.0371 28.979 42.262 28.754-42.107c3.1982-5.8558 5.9163-11.544 6.0275-19.045-0.0001-18.942-15.565-34.298-34.766-34.297z"/></g></svg>';return"square"===i.shape&&(n='<svg xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 69.457038 96.523441" style="fill:'+i.markerColor+";stroke:"+i.svgBorderColor+";fill-opacity:"+i.svgOpacity+';" height="100%" width="100%" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><g transform="translate(-545.27 -658.39)"><path d="m545.27 658.39v65.301h22.248l12.48 31.223 12.676-31.223h22.053v-65.301h-69.457z"/></g></svg>'),"star"===i.shape&&(n='<svg style="top:0; fill:'+i.markerColor+";stroke:"+i.svgBorderColor+";fill-opacity:"+i.svgOpacity+';" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="100%" width="100%" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 77.690999 101.4702"><g transform="translate(-101.15 -162.97)"><g transform="matrix(1 0 0 1.0165 -65.712 -150.28)"><path d="m205.97 308.16-11.561 11.561h-16.346v16.346l-11.197 11.197 11.197 11.197v15.83h15.744l11.615 33.693 11.467-33.568 0.125-0.125h16.346v-16.346l11.197-11.197-11.197-11.197v-15.83h-15.83l-11.561-11.561z"/></g></g></svg>'),"penta"===i.shape&&(n='<svg style="fill:'+i.markerColor+";stroke:"+i.svgBorderColor+";fill-opacity:"+i.svgOpacity+';"   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71.550368 96.362438" height="100%" width="100%" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><g transform="translate(-367.08 -289.9)"><path d="m367.08 322.5 17.236-32.604h36.151l18.164 32.25-35.665 64.112z"/></g></svg>'),n+"<i "+e+t+"class='"+i.extraClasses+" "+i.prefix+" "+i.icon+"'></i>"}return"<i "+e+t+"class='"+i.extraClasses+" "+i.prefix+" "+i.icon+"'></i>"},_setIconStyles:function(t,e){var i,n,r=this.options,o=L.point(r["shadow"===e?"shadowSize":"iconSize"]);n="shadow"===e?(i=L.point(r.shadowAnchor||r.iconAnchor),"shadow"):(i=L.point(r.iconAnchor),"icon"),!i&&o&&(i=o.divideBy(2,!0)),t.className="leaflet-marker-"+n+" extra-marker extra-marker-"+e+" "+r.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},createShadow:function(){var t=document.createElement("div");return this._setIconStyles(t,"shadow"),t}}),e.icon=L.ExtraMarkers.icon=function(t){return new L.ExtraMarkers.Icon(t)},t.ExtraMarkers=e,Object.defineProperty(t,"__esModule",{value:!0})}),function(){function o(t,e){this.title=t.title,this.stateName=t.stateName?t.stateName:"unnamed-state",this.icon=L.DomUtil.create("span",""),L.DomUtil.addClass(this.icon,"button-state state-"+this.stateName.replace(/(^\s*|\s*$)/g,"")),this.icon.innerHTML=function(t){var e;e=t.match(/[&;=<>"']/)?t:(t=t.replace(/(^\s*|\s*$)/g,""),e=L.DomUtil.create("span",""),0===t.indexOf("fa-")?L.DomUtil.addClass(e,"fa "+t):0===t.indexOf("glyphicon-")?L.DomUtil.addClass(e,"glyphicon "+t):L.DomUtil.addClass(e,t),e.outerHTML);return e}(t.icon),this.onClick=L.Util.bind(t.onClick?t.onClick:function(){},e)}L.Control.EasyBar=L.Control.extend({options:{position:"topleft",id:null,leafletClasses:!0},initialize:function(t,e){e&&L.Util.setOptions(this,e),this._buildContainer(),this._buttons=[];for(var i=0;i<t.length;i++)t[i]._bar=this,t[i]._container=t[i].button,this._buttons.push(t[i]),this.container.appendChild(t[i].button)},_buildContainer:function(){this._container=this.container=L.DomUtil.create("div",""),this.options.leafletClasses&&L.DomUtil.addClass(this.container,"leaflet-bar easy-button-container leaflet-control"),this.options.id&&(this.container.id=this.options.id)},enable:function(){return L.DomUtil.addClass(this.container,"enabled"),L.DomUtil.removeClass(this.container,"disabled"),this.container.setAttribute("aria-hidden","false"),this},disable:function(){return L.DomUtil.addClass(this.container,"disabled"),L.DomUtil.removeClass(this.container,"enabled"),this.container.setAttribute("aria-hidden","true"),this},onAdd:function(){return this.container},addTo:function(t){this._map=t;for(var e=0;e<this._buttons.length;e++)this._buttons[e]._map=t;var i=this._container=this.onAdd(t),n=this.getPosition(),r=t._controlCorners[n];return L.DomUtil.addClass(i,"leaflet-control"),-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}}),L.easyBar=function(){for(var t=[L.Control.EasyBar],e=0;e<arguments.length;e++)t.push(arguments[e]);return new(Function.prototype.bind.apply(L.Control.EasyBar,t))},L.Control.EasyButton=L.Control.extend({options:{position:"topleft",id:null,type:"replace",states:[],leafletClasses:!0,tagName:"button"},initialize:function(t,e,i,n){this.options.states=[],null!=n&&(this.options.id=n),this.storage={},"object"==typeof arguments[arguments.length-1]&&L.Util.setOptions(this,arguments[arguments.length-1]),0===this.options.states.length&&"string"==typeof t&&"function"==typeof e&&this.options.states.push({icon:t,onClick:e,title:"string"==typeof i?i:""}),this._states=[];for(var r=0;r<this.options.states.length;r++)this._states.push(new o(this.options.states[r],this));this._buildButton(),this._activateState(this._states[0])},_buildButton:function(){if(this.button=L.DomUtil.create(this.options.tagName,""),"button"===this.tagName&&(this.button.type="button"),this.options.id&&(this.button.id=this.options.id),this.options.leafletClasses&&L.DomUtil.addClass(this.button,"easy-button-button leaflet-bar-part leaflet-interactive"),L.DomEvent.addListener(this.button,"dblclick",L.DomEvent.stop),L.DomEvent.addListener(this.button,"mousedown",L.DomEvent.stop),L.DomEvent.addListener(this.button,"click",function(t){L.DomEvent.stop(t),this._currentState.onClick(this,this._map?this._map:null),this._map.getContainer().focus()},this),"replace"==this.options.type)this.button.appendChild(this._currentState.icon);else for(var t=0;t<this._states.length;t++)this.button.appendChild(this._states[t].icon)},_currentState:{stateName:"unnamed",icon:document.createElement("span")},_states:null,state:function(t){return"string"==typeof t?this._activateStateNamed(t):"number"==typeof t&&this._activateState(this._states[t]),this},_activateStateNamed:function(t){for(var e=0;e<this._states.length;e++)this._states[e].stateName==t&&this._activateState(this._states[e])},_activateState:function(t){if(t!==this._currentState){"replace"==this.options.type&&(this.button.appendChild(t.icon),this.button.removeChild(this._currentState.icon)),t.title?this.button.title=t.title:this.button.removeAttribute("title");for(var e=0;e<this._states.length;e++)L.DomUtil.removeClass(this._states[e].icon,this._currentState.stateName+"-active"),L.DomUtil.addClass(this._states[e].icon,t.stateName+"-active");L.DomUtil.removeClass(this.button,this._currentState.stateName+"-active"),L.DomUtil.addClass(this.button,t.stateName+"-active"),this._currentState=t}},enable:function(){return L.DomUtil.addClass(this.button,"enabled"),L.DomUtil.removeClass(this.button,"disabled"),this.button.setAttribute("aria-hidden","false"),this},disable:function(){return L.DomUtil.addClass(this.button,"disabled"),L.DomUtil.removeClass(this.button,"enabled"),this.button.setAttribute("aria-hidden","true"),this},removeFrom:function(t){return this._container.parentNode.removeChild(this._container),this._map=null,this},onAdd:function(){var t=L.easyBar([this],{position:this.options.position,leafletClasses:this.options.leafletClasses});return this._container=t.container,this._container}}),L.easyButton=function(){var t=Array.prototype.concat.apply([L.Control.EasyButton],arguments);return new(Function.prototype.bind.apply(L.Control.EasyButton,t))}}(),Details.prototype=Object.create(Record.prototype),(Details.prototype.constructor=Details).prototype._searchMedia=function(e){return $.grep(this._media,function(t){return-1<t.getTags().search(e)}).shift()},Details.prototype.getBody=function(){return this._json.body},Details.prototype.getSky=function(){return this._searchMedia(/sky/i)},Details.prototype.getEarth=function(){return this._searchMedia(/earth|feet/i)},Details.prototype.getEncounter=function(){return this._searchMedia(/encounter/i)},Details.prototype.getVideo=function(){return this._searchMedia(/glances/i)},Details.prototype.getSound=function(){return this._searchMedia(/sound/i)},Details.prototype.getPano=function(){return this._searchMedia(/pano/i)},DetailsContentDisplay.prototype.load=function(t,e,i){$("<section>").attr("id","stats").append($("<div>").append($("<span>").html("DAY")).append($("<span>").html(t.getDays().toLocaleString()))).append($("<div>").append($("<span>").html("MILE")).append($("<span>").html(t.getMile()?t.getMile().toLocaleString():""))).append($("<div>").append($("<span>").html("ELEVATION (ft)")).append($("<span>").html(t.getElevation().toLocaleString()))).appendTo($("#details #content")),$("<section>").attr("id","remarks").addClass("narrative").html(e.getBody()).appendTo($("#details #content")),$("<section>").attr("id","panorama").append($("<h6>").html("PANORAMA")).append($("<div>").attr("id","pano-container").css("background-image","url('"+t.getPreviewImage(Record.PREVIEW_IMAGE_SIZE_LARGE)+"')").append($("<a>").attr("id","button-activate").html("Click to interact").click(function(){$("#pano-container").hasClass("activated")||(50<t.getMileStone()?($("<div>").attr("id","vrview").appendTo($("section#panorama div#pano-container")),setTimeout(function(){new VRView.Player("#vrview",{image:e.getPano().getFile(),is_stereo:!1})},1e3)):($("<div>").attr("id","strip").append($("<img>").attr("src",e.getPano().getFile())).appendTo($("section#panorama div#pano-container")),$("#strip img").on("load",function(t){$("#strip").animate({scrollLeft:$(this).width()/2},2e3)}),i||new PanoMatic($("div#strip"))),$("#pano-container").addClass("activated"))}))).appendTo($("#details #content")),$("<section>").attr("id","encounters").append($("<h6>").html("ENCOUNTERS")).append($("<img>").attr("src",e.getEncounter().getPreviewImage(Record.PREVIEW_IMAGE_SIZE_LARGE))).append($("<div>").addClass("narrative").html(e.getEncounter().getBody())).appendTo($("#details #content")),$("<section>").attr("id","earth-sky").append($("<h6>").html("EARTH AND SKY")).append($("<div>").attr("id","side-by-side").append($("<div>").css("background-image","url('"+e.getEarth().getPreviewImage(Record.PREVIEW_IMAGE_SIZE_LARGE)+"')")).append($("<div>").css("background-image","url('"+e.getSky().getPreviewImage(Record.PREVIEW_IMAGE_SIZE_LARGE)+"')"))).appendTo($("#details #content")),$("<section>").attr("id","glances").append($("<h6>").html("GLANCES")).append($("<div>").addClass("video-container").append($("<iframe>").attr("src","https://player.vimeo.com/video/"+e.getVideo().getVimeoID()).attr("frameborder",0).attr("allowfullscreen",""))).appendTo($("#details #content"))},Media.prototype=Object.create(Record.prototype),(Media.prototype.constructor=Media).prototype.getBody=function(){return this._json.body},Media.prototype.getSource=function(){return this._json.source},Media.prototype.getVimeoID=function(){return this._json.metadata.vimeo_id},Media.prototype.getFile=function(){return this._json.file},Milestone.prototype=Object.create(Record.prototype),(Milestone.prototype.constructor=Milestone).prototype.getLabel=function(){return this._json.label},PanoMatic.prototype.foo="foo",Record.prototype.getID=function(){return this._json.uid},Record.prototype.getMile=function(){return this._json.custom_fields.mile?parseInt(this._json.custom_fields.mile):null},Record.prototype.getMileStone=function(){return this._json.custom_fields.milestone},Record.prototype.getTitle=function(){return this._json.title},Record.prototype.getLatLng=function(){return L.latLng(this._json.location.latitude,this._json.location.longitude)},Record.prototype.getElevation=function(){return parseInt(this._json.custom_fields.elevation.replace(",",""))},Record.prototype.getExcerpt=function(){return this._json.excerpt},Record.prototype.getPreviewImage=function(t){var e;return this._json.preview_images&&(e=t&&t!==Record.PREVIEW_IMAGE_SIZE_SMALL?this._json.preview_images.large.url:this._json.preview_images.small.url),e},Record.prototype.getDate=function(){return new Date(this._json.custom_fields.date)},Record.prototype.getDays=function(){var t=new Date(2013,0,21);return Math.round((this.getDate().getTime()-t.getTime())/864e5)+12},Record.prototype.getDisplayName=function(){return this._json.location.display_name},Record.prototype.getURL=function(){return this._json.href},Record.prototype.getTags=function(){return this._json.tags},Record.PREVIEW_IMAGE_SIZE_SMALL="small",Record.PREVIEW_IMAGE_SIZE_LARGE="large",Table.prototype.foo="foo",function(){"use strict";var n,r,o,a,s,i,l=768,e=400,u=5,c="table-up",h="state-details",p="touch";function f(t){g("arrow-right"===$(t.currentTarget).attr("id"))}function t(t){a.clearActive(),i=null,$("html body").removeClass(h),$("#details #content").empty(),I()}function d(e){$(".leaflet-tooltip").remove(),i=$.grep(s,function(t){return t.getID()===e.layer.key}).shift(),C(),a.activateItem(i.getID()),$(window).width()>=l?E(n.getZoom()<6?P:z):$("html body").hasClass(h)?E(n.getZoom()<6?P:z):z()}function m(t,e){i=$.grep(s,function(t){return t.getID()===e}).shift(),$(".leaflet-tooltip").remove(),C(),$(window).width()>=l?E(n.getZoom()<6?P:z):n.getZoom()<6?P():z()}function y(t){27===t.which?($(window).width()>=l&&(a.clearActive(),i=null,n.closePopup()),$("html body").removeClass(h),$("#details #content").empty(),I()):39!==t.which&&37!==t.which||$("html body").hasClass(h)&&g(39===t.which)}function _(){$(window).width()>=l&&(a.clearActive(),i=null,n.closePopup()),$("html body").removeClass(h),$("#details #content").empty(),I()}function g(t){var e=s.indexOf(i);t?e--:e++,e<0&&(e=0),e>s.length-1&&(e=s.length-1),i=s[e],a.activateItem(i.getID()),C(),E(z)}function v(){$("label.switch input").prop("checked")?a.load($.grep(s,function(t){return n.getBounds().contains(t.getLatLng())}),i):a.load(s,i)}function x(){$("label.switch input").prop("checked")&&a.load($.grep(s,function(t){return n.getBounds().contains(t.getLatLng())}),i)}function b(){n.getZoom()<u?(n.removeLayer(r),n.addLayer(o)):(n.addLayer(r),n.removeLayer(o)),i&&C()}function w(){a.setSortOrder(parseInt($("#filterWidgets select#sort").val()))}function T(t,e){var i=n.getZoom()<u?o:r;$.grep(i.getLayers(),function(t){return t.key===e}).shift().openTooltip()}function S(t,e){var i=n.getZoom()<u?o:r;$.grep(i.getLayers(),function(t){return t.key===e}).shift().closeTooltip()}function A(t,e){E(z)}function M(){$("#list-container").toggleClass(c),I()}function E(t){!function(){$("#details #details-header h3").text(i.getTitle()),$("#details #details-header h5").text("PUBLISHED "+i.getDate().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}).toUpperCase()+" / "+i.getDisplayName().toUpperCase()),$("#details #content").empty();var e=i;$.getJSON(i.getURL(),function(t){i===e&&new Details(t,function(t){i===e&&(new DetailsContentDisplay).load(i,t,$("html body").hasClass(p))})})}(),$("html body").hasClass(h)?t():($("html body").addClass(h),$("#list-container").addClass(c),I(t))}function z(){n.panTo(i.getLatLng(),{animate:!0,duration:1})}function P(){n.flyToBounds(i.getLatLng().toBounds(5e5))}function C(){n.openPopup(i.getTitle(),i.getLatLng(),{closeButton:!1,offset:n.getZoom()<u?[0,0]:[0,-28]})}function I(t){setTimeout(function(){n.invalidateSize(!0),t&&t()},e)}$(document).ready(function(){n=new L.Map("map",{zoomControl:!L.Browser.mobile,attributionControl:!1,maxZoom:12,minZoom:2,worldCopyJump:!0}).addLayer(L.esri.tiledMapLayer({url:"https://services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/",opacity:.2})).addLayer(L.esri.Vector.layer("fc3fec26b9ef44ae95674eed0a4a92ff")).addControl(L.control.attribution({position:"bottomleft"})).on("click",t).on("zoomend",b).on("moveend",x),$("<img>").attr("id","map-logo").attr("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXgAAADCCAYAAABDu9kBAAABN2lDQ1BBZG9iZSBSR0IgKDE5OTgpAAAokZWPv0rDUBSHvxtFxaFWCOLgcCdRUGzVwYxJW4ogWKtDkq1JQ5ViEm6uf/oQjm4dXNx9AidHwUHxCXwDxamDQ4QMBYvf9J3fORzOAaNi152GUYbzWKt205Gu58vZF2aYAoBOmKV2q3UAECdxxBjf7wiA10277jTG+38yH6ZKAyNguxtlIYgK0L/SqQYxBMygn2oQD4CpTto1EE9AqZf7G1AKcv8ASsr1fBBfgNlzPR+MOcAMcl8BTB1da4Bakg7UWe9Uy6plWdLuJkEkjweZjs4zuR+HiUoT1dFRF8jvA2AxH2w3HblWtay99X/+PRHX82Vun0cIQCw9F1lBeKEuf1UYO5PrYsdwGQ7vYXpUZLs3cLcBC7dFtlqF8hY8Dn8AwMZP/fNTP8gAAAAJcEhZcwAACxMAAAsTAQCanBgAAAX/aVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0NSA3OS4xNjM0OTksIDIwMTgvMDgvMTMtMTY6NDA6MjIgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxNy0wMi0xNVQwOTo1OTozMy0wNTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTgtMTEtMDFUMTE6MzY6NTgtMDQ6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTEtMDFUMTE6MzY6NTgtMDQ6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0iQWRvYmUgUkdCICgxOTk4KSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNDg0ZDEzMi03ZGFlLTQ2NzAtYjJmZC1lNjVlMWExMmI3MWIiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo5OGQyZjg4NC1iZTFjLWQ4NGYtYjc4ZC1mOWMwZDdmNmFjM2EiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo2MDJmODJjMS1iYmExLTQ3MjItYmQ5Ni0wYWU2M2I1NmY2ODQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjYwMmY4MmMxLWJiYTEtNDcyMi1iZDk2LTBhZTYzYjU2ZjY4NCIgc3RFdnQ6d2hlbj0iMjAxNy0wMi0xNVQwOTo1OTozMy0wNTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjE0ODRkMTMyLTdkYWUtNDY3MC1iMmZkLWU2NWUxYTEyYjcxYiIgc3RFdnQ6d2hlbj0iMjAxOC0xMS0wMVQxMTozNjo1OC0wNDowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+2FXzVAAATmpJREFUeJztXXt8Tcf2Xyc58UEepCIi9NKKBPUIGs9Q0TZRqlrFvX1Qr1CKuihtqV+vR72qFI1GWurZh9arrtvQK1TQSIlcfZDQoki0XnmQ4pyc3x+yY86cNbNnn3P2Picx389nPnv2PvvsvWbNzHfWrJk9Y7LZbCAhISEhUfng42kBJCQkJCT0gZn1g8lkMlIOCQkJCQk3gPTKSAteQkJCopJCEryEhIREJQXTRSMhISFRQSHiX74nZpdIgpeQkKiIUCNx3u82gd8rBSTBS0hIVARghMwjadZvPHJXiN2EXKuQkAQvISHhzaDJWO2cdY3+jSZujPjpaxWO7CXBS0hIeCN4RI7FRYhfAUbcJrAncPIe2rKvMEQvCV5CQsLbIErm5JH1H+Ucs9iVowlwkid/J/+D3eeVkAQvISHhLRAhdpE49gwFtJWuHOm4mkVfIax5SfASEhLeADVLnY6bONfp59HACJ11Tv9PeXaFsOYlwUtISHgaPOsbI3S1QD+LBkbmaoH+f4UgeUnwEhISngSL3Emy9gFHEmddA+q/GHhEXoqc0//FfPZeSfKS4CUkJDwFNXJnEboPcY4RPcuSZ7liSFI3Udfoe+lneDXJS4KXkJDwBFjz11nETpM6i+TVrHie1V4K9tZ5KXHErHkAR5L3KkiCl5CQ8CR4vnaM0HmBZcWTwMi9lIqXEv9XSL207B1qJO9VZC8JXkJCwmiwZsnQ5M4KvpzfaEteeT7PNVNKBSvgDQRG8hi5ew3JS4KXkJDwJDCSZ5G6L9gTPIvoRSx4ktytZXEr3LXereAoG4AjyXsdqZOQBC8hIWEk1KZEYm4ZX0bAyJ72yZNguWd84S6hk+4ZK3EkQZK88g56oNUrCF8SvISEhNHgWe08cjcDh+jnzp3bpFevXnH16tVrExwc3AZ7cVFRUe7Vq1dzTp06dXjGjBlpe/bsKYC7hO0D9u4ZjNwV0iYbAux3r4CJ3L/P7ge5J6uEhIR7gfneWQOpNImbwZHkzQDgk5aW1ufhhx9+LiAgIFKrQOfOnds+Z86cFUlJSefgDpkrwUIdlbji0iGPtNsHiGuGg+R0SfASEhJGgTWoig2gYqRuJuPz589vOnz48Eksa10Lzp07t33QoEHvpqWlXQNHcreAPdErgR6cZc2VNxSS4CUkJDwB+gMk2nonXS40qduFtLS0PrGxsRPNZnOAu4T766+/8pYuXTpx8uTJv8BdUqcDj+S9woqXBC8hIWE01Kx3luVOB7+0tLQ+3bp1+z89hLRarUX79u17Ly4ubgsA3IY7JH4btJE8bx0b3UFyug/nPgkJCQm9IDr33c4Prye5AwD4+voGduvW7f/mz5/fFPiDurzlEUh41FKWBC8hIWEUaLJT+3rVjtznz5/fVE9yJzFhwoTkuLi4mmBP6qJf0HoNpItGQkLCCKhZ6/SAql9Z3E8JRUVFnzozU8ZZXLx4cW9YWNg/4Y6LRnHT8Nw1tC8ewANuGumikZCQ8BbQHyahg65paWlPGUnuAAB16tR5ZOXKle0IOTBZWW4ar7CQpQUvISFhBNSmRZIWvB8dSkpKtletWrWu0UJfvXr1yH333Tcc7ljut8DekqfnyZPLHtADroZBWvASEhLeBOxr1vLzLVu2dPcEuQMABAcHtxk9enR9cPS5s3zvXmUZS4KXkJDQG9i6M0qcHph0WLagbdu2j+guIQcvvfRSHPDdM14LSfASEhJGACN2+py2hE0AYAoJCWlriIQMNGjQoA04fpSl1lB5BSTBS0hIGAXWNEky7hA85Z5RUKVKlUDACZx1DZDrHoEkeAkJCW9DOUnOnTs3yqOSwB0/fFmU5ZphkTzr3DBIgpeQkPAEhL76DA0NDTRAFhGwSNqrLHYakuAlJCQ8Aa9aN10AFU1eAJAELyEh4T1wINEffvjhgicEIWGxWIo5P2PLAtPp8FjjID90kpCQ0Bu8ZQqwlSOVD5yqAICfzWY77AGZy8H42Im1ZAHrYyfDID90kpCQ8AQwosOW17ULV69ePWKYhAguXbqUg8gFSBw7ehSS4CUkJIwATYoYIWKbYtsuXLjgUQv+559/PkzKQ8UBOXoNJMFLSEjoDRbx8ci9nEiTkpK+1l1CBqxWa9HTTz+9G9ibeXjEDSMKSfASEhKeBIs0y0NSUtI5T7lpjh8//hktD7BJ3WO7OLEgCV5CQsJoMK11sF9PvTxs27Yt2WghrVZr0dixY9fTsjDk9hpSJyEJXkJCwhPABisxC94KANbBgwdnnjp16lMjBczKykpJS0srAPb+q0rA0uAVhC8JXkJCwkjQ5KdK7mXBkpiYmFxcXJxjhJAXL17cGxMTsw74xK7mh/c4yUuCl5CQMAqixE4HKwBY09LSrk2ZMmWS1Wot0lPI4uLinOeee+7/wL6BoUmeNWXSq0heEryEhIQR0DIHnrbey634pKSks++9997Iv/76K08PIYuLi3OeeuqpEWlpaVeBv+8qa7DVa9wzAPJLVgkJCeNALw9Mr7HO2sKPDL4AYI6Li6v51VdfvUes9OgyTp069WlERMS7YE/s9Neq2Fer5MAwa56/YSA5XRK8hISEUWCt/U5uouGLBDPj6JuWltanS5cuE3x9fZ1edfLq1atHtmzZsmLo0KGHwJHIMWKnrXnSxQQgCV5CQuIeBL20Lr0NHm3FYyTvcB4XF1fjrbfe6h4TE/OPgICASBFBLBZLcX5+/p5du3ZtHzp0aCYwXEJUnHQd8aZOAnjQVSMJXjucUYbX+OEqAaT+KxbU8guz5HnuGsyiJ6+X3zt69Oh6/fr1e7h27drhtWvXbly2GxMA3FlT5ubNm8WHDh06PGzYsExwHMgtBUcix4idtt4VCx7Aw9Y7gCR4GqKFUSvUMlcS0B2I6Fcvgpd5oA2i+aAlTzF3jZo1T5M7eR/dKyCh5Df6MRU4kjiL1GnXDMvv7nGCN3tCAA9CbVcWrb85CxvjuZWdcJzRv8jvzgDLg8quf60Q2nVJ4B4b4zp9jwkcXRylyH2+xG8KsZeCPcEr7zNR/1WbmokRugi5YzBxfjMElZ3gRQuoK9dIkJlpQq6p/ZcujJUBovtTiuhbhFxoMmFNz8NIyEjC19poqZGjMxAhXnfUDdHfSHkwclfuIUneBvaDtKT1juWnmhWPkT3P185Kk4huFZl0Q2UkeK0b4IpunitaIek5sbwCzLuvIpO9s3ngjs2L1T40oS1F3nPcmQfO9l603qcGzAhRewdWD9yRN/T/sUaZRfTKb8rvogRP/0+N5HmDqDyI6kPXnnxlIXhnSJy+Jko6osAKAnmNZWFWVLJ3JQ9YecJ6lggwvZNxXkV1Zx6IEKE7yZ8nG4tQeM8TqS+sNKo1tiIQcdn4UEdSPsxFo8RpV4sosdPpUAwGrUagmivL5bpekQleK6GokYq7SEaEWOjrNPFjDQF97i1EL1LRRY5qetdC8rzGVYmziF5Lg6tmkYqe89KoNd0s0tACXv6I1heWDKw4C2SdUCx1kuRJORSSxww28nl0oAkeI3SWW0YruZP/IWUi0+I2oq+IBC9SUZQ4q4CKEIxawRW1UlitP+say4VAE4uniV6kIXQ2D0TIg2e1qlnsInnAei6WB+S9osTuTgODR5o8Y4Elp1reqNUflnyijSoPZP3A/l/KkBFr4LGlf7FAg9Xg07+x5GfJRT+PvNepel6RCF7UAuLFRX/DjpgMNLQQC6vrxzonn+tJohe1tFk6x8555IE9mwee9a4lDzAiIZ/HsrZIOFNGef/lQc1Kpq/x5FWrJ2r5xZOPpXdaRlom+lkm6igCrBxg5yxg9U4t31kykHGynNHvcInkKwLBO0vsaoQiQvr0O0Sghdjpgs5bW5rOYKOJXoTYRchAJA9YZOcMwYs0oKz8ULPkaKLEiJNOB50+bEofi/TJ57DkoY9qZM+SE5NXpO5gUNM7do+aTM5Ca/3A8pcmXtb9ajLQOqCJ3mWS93aCFyUVUSIhKxNdsdQKLSsOwK9EoqSidC3VSAd7r8stvQp4ZKuFxBW9k+TGIjv62Sw5APjWK6sylRJHGxUXIX8SapVdTUesskg/EyMPtbKnHFmkz5IVyxN6hgqrUcLkEdUxnSbymWTZUdMpLQt5jhEneV15F2v2Dv1s0bxS3qEceWXLLSTvrQSvldhFCEW0UmmtYCREyIUmdSXuA46Fn1cZ6PdihdRVonc1H2jdq51jlZYnBw0W2WGkTn4sQ1tNIvonn8+TyZmyKUKerDSrGRb0f0g5XZUXA61/H8D1Sza0LPm0ykSmi3yuks+KLEq5oEldOSfLBSYXfVQro2qNHflO5T+aiF2BNxI8r1I7Q+jY/FiRiuUugqfJhVWwycKvXDMh97MKAYBjQXCqUBD/peNaSYCne2fyQE3/AGzrlRewLxPJGRtayB7TGUtPImUTqDgrzWrppq/RYMkrmnfkMzDZWOWdLus8+bSSPCkTbfiQwQSODQwpI3mNlomUjY7T76ffTddvsqHByJ0+qsKbCJ5FpKzCrkbkakcRkgFgZxgNNUuKRyis+bh0hmJTuMh3YgXAGZLXQu48AqBJzNXGlpaNhlZyZxE7ST68PKC78JhsPF2RwRUCJdOqlm76XlJGNXlFZMTkY+kYK+ssklcrLyI6Y+lIeT8pBytOykPri8UZPH2Q7wbimhKny6EmeAvBayEUXsETJRYe0QCwB7545AIgXsnUPrBQ5MGInmVpmKjrJiouWjiwisEjXp7OsXORvOBVVHcQvFrDSpO8SB6Q7yX1BuBYznhBRBesNGMESY81YLKy6ppafSLvI59DykbrHSN3kaUARDmAvpcGpicTdaQbdKz+sBpFVrml84Qk7lLqPuwe2mATqtPeQPBqhAKAFyitZCJqTdLvpwsKr2Wmj2rkwivoWFBkIQsGi1ycKRCi5M6y1EWDWsOLVRK1PLBRcZalxsoH0bxg5QGmWx5Z+gC11C1DJ7yyKGpQsMifJStPZhbJY4TKIncsWMGeYFmEyutV0HEAXF8iDT5GrnSjqBbI95PPoMuasuYNEL+R7ychaqgBgGcJHquwrBYRs4B4xOIrcB+XWGbMmBFZp06dwObNm0f6+/sH2Gw2U506dSKqVKkSwErQpUuXcv/6669iAICMjIwjFy9eLJo+fXoOiFvudIEn4z5wtxIoxAJwtzDaiGskMAsFA5YHypGXDyy9866p5YFP586dAwcNGhTZsGHDunXq1KkLAFCjRo26gYGBYQz5oaioKL+goCAPACAnJyf36tWrRWvWrMnZv39/EbDJnZUP9EJTvDzgkRIAXg6x5W9FrHkaIo0ZfR3AkayUI0bsWH6bAMAnNjY2aNCgQZFKPalRo0bdoKAghzy6cuXKiZs3bxYdOXIk8+jRo78vXLjwHKFXUp+sBpNH7Cx9kWmj9SNicPmAox7V9MV6N/1+Mu2YnKQxoVwD4l4hovfUevAi5M6y2kVIXROxJCcnt23evHlkeHh441q1akUEBgY2dmdii4qKcq9cuZJ7/vz5k2lpaT9MmzYtB9itOCvOW5earhis7jjL2lcjdy3EThMWLx98AMAnMTExPD4+PrJFixZtQkJCGteoUaOx2WxmNqRaYbFYigsKCnLPnTuXlZubm/P+++8fTk9PV0hftIFVywMeCZDljrWJBb2+OW0l+1DPxEhdOWeVBWcJ3u78q6++6ta8efM2devWbeNsXbl58+aFK1euZB44cGBzv379MgDfRIOUT0vDg1nSSpqdMbZ4PQquoUj9h34fuckItuEI1vhg+W3/Eg9v+MEjdx/iyCpoIqTCJZbhw4fXGzJkyCMPPPBA67p163bRIY1clJSU5P/xxx9HMjMzv+vfv/8ewIkF22xAbQMC2grhkTwNNXJXa1gxa5Rpoc6YMSNqwIABvcLDw1u7u0EVQVFRUW5eXt6Rzz//fMf06dNPwF2d2kBc93QeiBCTw+5EW7du7Xj79m1fi8XiY7VafaxWq09paalJOdpsNpPNZjMBAJSWltpVTB8fHxsAgMlksplMJpty7uvrW0rGX3jhhUxQJ3iWleyzYsWKh+Pj43vVq1evqzsb39zc3OWRkZEfgCDB9+7du8ZLL73UzGKx+NhsNhN9JPUloitFT/SxX79+34N93mI6Q3uhPXr0qDF37tyn69ev/7DZbA4CALBYLIW5ubm7Z8yY8d///Oc/BWBfpnh7vmre1NuTBM8idzqIELvo0QcAfBVSb9GixROeIBQWLBZL8a+//vrvd9999/OUlJTzwCYUXuZjRINVFi0WPC8fWETO23XHNzExsd6kSZP+fv/99z9SrVo1pqvFaJSUlOTn5OTs+OCDD7Yz8oDUOW9vTsyKp3s+5LZzZgDwtdlsJ/ROo8lkepiST82f7AMAPqmpqU927NhxgF515vjx48lNmzZNAnWC9wEAny+++KJd//79V+khCwmTydQc7MmVKRMQ9eT48eOjIyIiXmBtAm61Wot+/PHH5dHR0avBkeAxksc296Z7b3bwFME7S+4sS51JJGQ8NTX1ybZt2/asVatWa3cnyN24fPly1qZNmz4aMWLED4ATClkAsO4ca6d3botPQKSRJfVL741Jb4zsAwC+ycnJMc8+++ywipAHeXl5+7Zv3/4ZkQe8gHWnMTcNrT8zcTTbbLaf9U6XyWTqCBoIfvny5W1feOGFcXobQz/99FNK8+bNl8NdndK9DLsGZ/369e2ef/75j/SUCQDAZDK1An7vzKF+nD9/fkZ4ePhTVqu16PDhwx+tXLlyb3Jych4AwMiRI+uOHTu2V5MmTf7h6+sbmJeXtzU8PHwq3CV2kuBpomcZEV5D8CLkLmItYkTuYDnGxsbWWLZs2XORkZE9vclSFAVF9KxWXY3stZC8iOXO2wAZywfzihUrHh44cOC0qlWr1nWHXowEkQeZ4KhzVneaa32CY2PoB3cI/pje6TGZTF1BgOA7dOgQ+Omnn45t2LDhE3rLBADw448/ftSiRYsPASd4Uj4fAPBZs2ZNu4EDB67QWy6TydQG7N12TJkAwOfUqVOvPfjgg88XFxfnvP/++7N69+79CACA4lrLyMg4snbt2hMmk8m2Y8eOpICAgMgzZ86sa9iw4Ry4U55ugyPR0711zE3DJXgf+kcd4Ay5YyRCBj8sxMbGBh89evTltLS0za1atRpaEckdAKBWrVqtExMTPzh9+vT/xcbG3gf26SR1UN7NB9x6pgekWPrHrrHcY1h+2OXLrFmzHrp06dKHiYmJH1REcge4mwdXrlz5cOTIkfeDY1pZLinWWAWrwTSiDgI4lh0lVFHib775ZpPdu3evNIrcAQCuX79eDLhOsHLna7FYjNIXb+DbTtY1a9bEKOT+xBNPvFK7du2gli1bDmvZsuWwVq1aDW3VqtXQESNGLEtLS9v8+OOP1+vZs+fomzdvXmjQoMGLS5YsaQZ4OcHqp2YYpSwAMXKnKwuXSMiQmpraRyF2dw4CeRINGjTomZaWtjk1NfVpuFtByYrKIhy6wGADQiQwVxmrwSUbFFImPwDwy87Ofnnq1KlrKoI7RgTBwcFtli1btu7YsWMvgzrJ0w0qq9LSZd4IkPnkEN+6dWvP2bNnpxhtFGVnZ58Edll1MDSsVquRBM9qkO3yt0ePHs8DAGzYsGFJenp6iSJjYWHhyWXLlo1ftmzZ+Ly8vH1mszlg+PDhw/ft23d9/fr1MwEA+vXr9yLgfEjzJRDnwtBbWazBOzoxPNcLRu7l8RkzZjQrLCxcGx8fP7WyEDsJs9kcEB8fPzUvL29BmTWPkTzLVYIVSAB2geL53B18x2R8xIgRfyssLFzXsmXLYbopw0Mwm80BzZs3H37lypUVo0ePvh/YOmY1rqweEdbY6pYMVsjJyZn81FNPvWaQHHYoI0PhUFpaahTBs3pgDnlZu3btbkVFRbkjR47MAoDy2Tu3bt0qHjt2bPbYsWOzv/zyy00AAGXf0fgMGzYs6+bNmxdCQ0O7g6O1DgLnQtDzQydRcmeRCUYq5cfY2NiaH330UWJUVNQAHdPgNQgLC+u6a9euNQsXLpwybdq0XwAvFGoohTt6Zs3pRQsw8Btc84oVK9oNGTJkXmVsYEkEBwe3WbJkyfqGDRuOnDx58k/A9oWWgn2+sKx3I100ZkDGYY4fP/7Pxo0bP2qQDA4oI0OWyxDAXm8+9NRHHaHUEyWQ9aZcztGjR9cFAMjLyzuiXFf87v7+/mE//PDDYACAxo0bdwa4Q/rKfX/++eeR+vXrPwl4ut2WCD2AZZJypEmeN2iKWu8zZsxotmPHjqR7hdwVVK1ate6UKVOSylw2LDcNacmzLEaWRanW4Dq8c9euXX0SExM/qOzkrsDX1zfwtdde27B3795ngK9blssLc0EYAYdy8ssvv0yIioryGLkDlA9C0mWS6TI00EWjlp8AAKa2bdvWAwBQvmAnUa1atbC2bdu+1LZt25eCgoIiSkpK8pcvX/6J8rvy1bWeMEJZijIwctHslklNTe3zxhtvfOBNc9mNhOKySU1N7QN8X7wPOBK9WiXC3A2s2TLmXbt29Xnsscem6Z9q70PXrl3fTk9Px0gec81gPlWjCd4u79avX/94kyZNuhv0biYogleAWe921rEBYPWQ7YzW1atX5wAA1KxZs3zswmQy2QDu+ODXrVs3HeDO9y7dunUbPnPmzFwo6xWEhoYqHMabuuwS9ChcWFeDvMbr/pPkTvuZ/U6fPv1/ldXXrhUMkkenjSIBsyax+5i9qnuZ3BV07tx5xsGDB58BtsUp6qY0AuV5+Pbbb7d4/vnnXzHovVzk5+crLgsAdR16iuAxorcBAHz33XeFf/31V15oaGgboFx1t27dKh44cOC+n3/++Uuz2RywevXql4h7bPfdd1/bmzdvXiCfhxxdgrsJnlegWW4Akkwwd4M5NjY2+NKlS8sbNGjQ083yVmioWPLoR0egng8ski9/5qxZs5rd6+SuoEOHDrPS0tIeoy7zyB2o60bBBwB8mzZtGjhx4sTRBr+biXfeeeck4ydaVxjJ6g3W++y+JD1//vyeqlWr1k1NTe0JAOVLRJShdOjQoatKSkrymzRp0j85ObkVANgyMjL+4evrG3j27NmtwF9eRPXDJh707B7yrBaMPDBL0S82NjZ4x44dSZVl2p27QZA8S4+8udki1rudJd+lS5fgKVOmJBmVvoqATp06vQHq3XmelWoEfADAZ9u2baMCAgJqG/ROEYh8ZV2uOwMHWVGLHRDCfe+99z61Wq1Fjz766LhZs2Y18vX1LQUod9WUZmRkFG7fvv19AIDnnnvu1dmzZ0e0bdt2uNVqLXr11VfXYM8EL7TgMdcM5o8UHcDzi42Nrbljx46ke9XfLoru3bu/OmvWrKbgnLtGxC1THrZu3Tpfusjuwmq1Fq1cuXKsC48wjODffPPNZhEREW0Nep8oaEJzK8G5CZhs5csHJCUlndu/f/9CX1/fwNdff/0Ds9lsNZlMHUNCQkZD2deoAwYM2GMymTps3LjxvSlTpiT5+voGZmRkzCcWHmMtQ8Bdd0YN7p4mybJYWERCE0o5QUlyF4fZbA6YMGHC/G+++WZgenr6FVC3Bkxg/+k1z11Tnj+7du3qExwc3EbXxFQgWK3WoqSkpKHjxo37BRz1TE6pU7NMjYDp9ddfTzTwfaIQsVw9RfZ0fpJuFABiAskjjzyyde/evdC1a9e3hw4durxv376Hs7Ky/v3bb7/lAQA8+OCDYdHR0U/WrFmzLQDAgQMH3urcufMmUF96GitXwvpwF8HzRsCxmTOsD2fKfe6S3LWhWrVqYV988cX08PDwSeBYGOmCoszTVs5pV42D5d6lS5ea3bp1G29MarwfVqu1aMmSJcMnTJhAk7u3kRQAAHz88cddAgMDQzwpAwOqa6sQMFKHPKud/F0xlkyPPPLIpsWLF/88ePDgyTVr1nw4Li6ubVxcnN1DCwoKflizZs28cePG/QTsdaV4K5RqgrsWG8N8jAppkK4BmtSxtVX8Lly4sMAT67RXBhw8ePD9Tp06rYc7ixexFjAirRAA+zyj88cPAMzZ2dmjKuNXqs7AYrEUL1q0aETZx060fumBMqzhtFsHxmazpest861bt25UqVKlut7v0QqTydQJHFfkLP8ZKO5YvHjxw6+++up7BsjVDezrD03ADn8BggNfe+21en379o2pVatWPQCAy5cvn9+0aVPmggULzhHP4K0Hz9tvgDtuQXK6Oyx41mg3NgWPN+/dFwDMJ06c+Kcnyd1isRRfvHgxOy8v71ROTk7u5cuXi9etW5d76NAhuw8ZBg0aFBYTExN23333BUZFRUWEhYVFBAcHR1SvXr2Op2QHAIiJiRmWmJi4NyUl5Szw17KmXTRYY+wDAD5dunSp2axZs78bIb+3w2KxFL/77rsvv/HGG8fB9W61YRapN5L75cuXswDvaZKwO6dmqOgJOi9ZlrUCuzHIBQsWnFmwYMEZ4jrrWWob9/DIXFUXerloMKLnfbHqCwDmjRs3xkVGRhpOJDdu3Lj422+/pW/YsOGbd955JxcEuo1r1qw5u2bNmt/hTvr2lB19Bg4cWHfYsGFdoqOjE2rUqNHIuFTcgdlsDpgzZ85bKSkpL4P99CsfcLQsMSuTziuf6dOnd/PkwKrFYim+evXqqd9+++1/169fL/7f//6XS/4eHR0d4e/vH1C3bt1GejayFouleN68eaPLlopQ274P4K6OmdbWvYwysqb1R4LWnyfAInre+BYWJ5+l/J9MO927FrbYeXCV4DFiJ+OsqXgO1ntiYmL9p59+2tC51QUFBaf27dv3Ve/evXcAu+WkfW4KUJfU2rVrf1+7du1nAPDFG2+8ETls2LBnGzVqlKB3WkjUqlWrdXJycszIkSMzwD4NCuiKg81yKs+r9u3bG97o3r59+/rp06cPfP311zsnTpyYBfxG94eyowkATC+++GL48OHDY93ZyCLkzupK05XRh4gDEb/nyV6ZRgi47pQySlvARgHrkalZ8SIg/8ez4kmSB3AsP0Jw1QePzZbhDag6+NuVUFhYuNaoQVWLxVL8zTffJBHErnUkGwBPN2oJv/jii/Xmzp37Sr169TrrmjACJSUl+dWrV38acD+isnkARvB2XxMnJib+bcWKFZuMkhsA4Pvvv1//yiuvfHXkyJFCQlbMQsbGEezyYcmSJa3/8Y9/DK5du3YrZ+VByF10bAPAsS6QZb8KAFQxwgfvjbh27drh4ODg4eBosWITM8wAYF6yZMnDY8eOXaS3bGUbpNwGgFvAz2tmLx8B1mBgDYeoFY++010bfohY75hV6OCqOXr06AijyP38+fP7O3fu/Fzv3r23w92dVLBwiwrY7/S96LPWrVv3e/369aeuW7duusVicViUSA9Uq1YtLDU1tTewv2jF5sU7+OCHDBnyiBHyAtxxlU2aNOmVjh07rj5y5EgB3K1QrPzB8svu2rhx4zJDQ0PHLlu2bHxJSUm+VpkQchcZDON14+95y11BmQXP2hGLFYwCTag06dKDpPTeqqzA2wJSdD48eeTCnfPgWb530jJ0IPfExMT6Dz30kCGrQu7duzepW7duXwBbubS1yPN/8XouSiiFO+m0AYBt4MCBe1NTU08uW7ZsphH++S5dugwDgO2kDGXx8qldxO00yZsAwKdhw4aGzHu/du3ar927d5+SlZVVAPzCT1YwAPtuPNO4GDt2bOaGDRuGbNiwYZzojkUMcsf2z2T53wE0Vkhvx40bNy5evXr1ZH5+/skDBw4cNZlMtrFjxx4F+3pSCgC24cOHh7Vr1y7swQcfDAsLCwurV69em8DAwEhlQ2qC4GnyJjnE7jdlIS8DQdd/rDeJuWt45cBOT8gzWM/UDFdcNCxCJ0kCmxJptxPThQsX3jVi1sz27dvnl7lk6H016QEONQuMBCv9WE+l3JKOiYmpuWvXrkVGkHxqauo7PXr02Aq45Ummi3YlmAHAfPv27V16D7Devn37+pQpU15ftGhRLojtLs8q/DS50wP8PgBg+uabb55MSEh4kyeTxWIpnj9//qipU6fSljtvY2SMpBx0Cne3yasQLpqCgoJTR48eTd25c2cWZxICTWAsN4Rt8uTJdZ999tmY8+fPn+vbt28GsPPRwWW4dOnSh8eMGbNYv9SWCWAyxYJ975C3XyptcJBHGlhjgRE+z2rnkr47pkli7K9mvTvMoElOTo4xgty3bdu2oE+fPhi50yQv0jKT4BG8nfVedr8NACAzM7Pg8ccf/6cRJN+pU6f+cMeKpwsOPVXSYRxh6NCh9YyYPZOZmblt0aJFp8Bx+pioFa+AZcGXktd69Oix9dtvv7U++uijb2HyWK3WokWLFo2cOnXqcUQGtQ23SVnomUsVCqdOnUrdvn176vjx44+ANv8wi+RtAFA6f/78M/Pnzz8NOGHRevOUi0YBy02DuWxE5MQsebe5ZGi42wfPIzwHf++zzz6r+4czaWlpy8vIna6gFsY1loXGCvRzWP+zu56ZmVn42GOPTdDbJx8YGNj47bffjgLHBtbBsqXippiYGEM2zB49evQWYFceNdLHdIz5PsmB0duPPfbYlj179vyLluX69esnyj5i+pn6j5oPVcT3XiHcNX/++Wf2+++/PyEiImLO+PHjM8FxPAoL9LgVNk6CDU5r+YrT5gEXDdAyEIE3SIoF1liNmksYc/0IwRWCB3CC1OGu9f6w3itEnjt37kD37t03gmMBol0zvApLx2mfPebiUXueFQCsP/zwQ+HSpUvf1lEFAADw0ksvDQB+vpChPA8bNmwYrrds+fn5P2ZnZ18vOyW7uWqVB8vDUsAbXJTo4+LiNu/fv3+6Isv169dP9O3bd+hrr732I3EfRvKipORJy9Mp7N27Nyk0NPRVgtjVBrhpcmcNgvNInteL9rT1jjXSNMmzyifPCMDKDY/k6bgQnCF42j1DD3CxiN5u1obe1rvFYil++umnFwCudJHWFLMkeRkr0pI7vHPChAlZx44d26yfJgDq16/fpWPHjjVAG8mbQkNDdbfgT548+SOoF2gWabLygs5nzDVnAQBLbGzsposXL24pKSk5PmDAgJd27tx5FdjkzuqR0eWDdNdUCKvdYrEUv/nmmyO6dev2OTg2iLyZZrzfMULXMsZC6tHTUCuDWix5HqmzCN0pPbjLB8+axYASfXJycoze1vu6desWHj58uBBwJYoqWq1bbSKul8Jdf6/yWync1YHyu0ODMXjw4LXff/99vJ+fn7870k7DbDYHTJs27ZFevXp9DY5pItNFN9KeglrB5uWRkieKzsnZGCbqmgkAIDEx8R0AgB07dhQAu7Fm9erIckO+m5Sdlx6PE1hBQcGp+Pj48YcOHSKnpqpZn1hDJhInj5hxqJyzLGdPQK0M0o077z9ar7mUZlemSbL87jxXjS8A+CQkJOi6M9Mff/zxvyFDhuwHnNRZ3S4Ax0Kp1fpSKjn9LJL8aaK3HTlypOjw4cNbOnTo8IJoGrUiOjo6FgD+DfbpKiVuwfLQU6DHd0RAN1Q0kWNpMwEAfP3111cBr7Dc3hcR6PezyMjjZE6DQe6ikxB4hhCrTtHAjEKMOL1Fd2oNmTO8gd3rlvS6wwevHIVIPjY2NkjvrfdWr169HtgFg9UdAuBbFDySMFH/V4NDwRg9evRmwf86hdDQ0GjAfe3MtBmx/+X999/fkCODSFBAnmOVDiNrkUF0Nf8p3SDQ7+VVVI+SlsViKR4zZsxbBLnTLhl63OI2OLqvWC4YEbeMmjsUwMM6IsAjYKyxY8mtdq9bGzOtBI9VeMw9Y+fLJa/Nmzevt3OiiuHatWu/Tp48ObvsVE3pIgRCp4V1HbsHANeZgnJ5srKyinNycr7VnGBBmM3mgA0bNnQBR3mdkdttaNCgQYdWrVoFIDLQMrJm+7Dyh4Qo4Yta7CwrlnyX1+ODDz6Yvm7dunPA/oALG5y2ItdYM2PUZh158yA1rwfGs+CBOlcjcl3T6cogq5p1i1bEFi1aCH1F6Cy+/fbbbQyZeVY3q9dBf7rP2/5OrTHgyQMAAPv27ftee4rF0bJly9YcGZly6Y2tW7eOB1z/TDcfI/B6WQpYFYtnTYoQkIibwmvw008/fTV+/PjDwJ9xxCN9tamqvF4STe6YO0ZXy1YQor0vrda6Yelw1kUjQvIOFTAxMTFc7zVnZs2adZCSk+7GC03jBPXljbGA3c/rCdhh6dKlx1xLPR/3339/K8DzynBSJ9GgQYMOGzdujAecyEX1ziN/Xhp5hC9C5Lyuu1fixo0bF4cOHfoJ4KTMI3uWVe6Mpe5Mw2nkevDOwpO9Dge44oMX9ZGWV7TBgwd3c0VYNZw+fTojOzv7BuC+WcxlxCMNehNwXrBbigBwy1/N0jRlZ2dfz8/P/9G9WrmLoKCgiHbt2gWCI+Gh5HfixImTeslCo1+/fuOzsrJGgb3OzOCYH3Te0L8J67vs1Sx3jhJnEbhXVGBnsHv37tVlfnd06ijwCVvt+w5RVxfdc/K0S6ZSwtVBVgDciqf9uz4AYHrggQdau+F9TGRkZByiZGFZ6Bi5Y8RdvmUdJ5D3+DGexfuC1I6ALly48Jub1WKH559/vjHgROeAy5cvG7LypYLo6Og+169fX7Nw4cLWoJ4vWBzTtxrpA7CJH9MPt1GkrnmsV8TCjRs3LpatyaTmRiFJ31nrXM1yx3pDvAZUEr9GaCF4rODyXDW05eSj97ozn3322Y9g36jQcTXr3I8RqgheFyUcphvh4sWLf7pfM3fRuXPnaHAkMho2ALCNGzcuS09ZMFSvXr3OhAkTFly7di1569atPWNiYmqC4xrqWMOKLWbHInstPnxemQbkHgBHnXoN0e/evXs12BOwmrXOs85ddbvw3GEA0pp3GVoteKwQC7lokpOT27osLQfFxcV/btmy5RL5ThCz1DGixgi9ChJY96iRPpNsDh8+fNrtyiFQt27dRqDuk1aOtsLCQsPcNCRq1KjR6KmnnnrtwIEDG06ePPnG119/3btdu3bBwNc3GWfpXUuDq7UBANBG5oYSv8ViKZ45c+Z3wHavOOM/FxmvUCN2AEci9/QAa6WAHlv2oaF58+aRLr6Liz/++OM03K2UdIFQ5BCxMBQ4U6B4jR5rNogdweg99zwgICBM4LbySnf58uWTQUFBEXrKxIPZbA5o1KhRQqNGjRKefPLJyYWFhSfPnTt3NDs7++jSpUsPHzx4sBBwS5CVv6VgX0ZK4U7+2MAxz0qBDfo5AHyrHsBgQqdx5syZ/YcOHSoEnNRFLXJyrj8gcS1Q9FHhxzW8Fa4sVSBqwZsAwFSvXj1dSeLs2bNn4G6PhC4oNMFjJADgSPLOQM1dxZ36l5mZecnF93PBWZ6YTncpAJi+//779AceeKCHnjJpQVBQUESzZs0imjVr1u+5556DwsLCk1euXMk9fvz40YyMjJy33347B9jdf2xwz4eIK/ljBTZJkyAJD8Ax7+nrdBw71w0ZGRnpwJ8GqjYvnSZ3Z4hZS3ql5e4itGz4gVmjCjHRG3s4dKP13nO1uLj4z8LCwj+V5UTVjuWJ0nn5UdoiV855x/Dw8GZ6yvTmm2+OmDNnjrLWOV2RHfL49u3bO4xYF94dsFgsxdeuXTt57ty5rIMHD2atXbs2h7DyaZcCTXY0wdFuDJ5lqwCrI3abVgDl8jNqww+TydQN2Ev5YtMhyXSzfOSaxaACNumBHkQv11VSUlL7UaNGLXHivdqENJk6A75SJv3RF9YD8mjD5I4NP0iwrBbymknv+e8BAQG1AwICauv5jsqCOnXqKF+OKsAqrWLRlp47d26f6DZ3nobZbA4ICQmJDgkJiY6Ojh4yatQoKCwsPHnhwoWsY8eOHVm8ePGRAwcOkIRPBsWatxLnStxE/Eb3YFkuQbUegGH4888/s0G9gRMdIAVwH4FJC11HuDoPnowzXTbDhw/XfV1xCXG0bt2adNOQFRbzt5bOmDFjpbESuhdBQUERTZo06d+/f/85+/fvT7106VJSenr6C//617+aAXvmlOisKLUZOQqcHYh1C86ePXsU8F6M2niFu8anJDwAZwhezb/oEIzaGUhCDP7+/gGAz1KgK7cVAEpXrVp1/vTp0/8xXFCdUKtWrdadO3ceO3369E9u3Lix+fjx4xOHDx/+N2BPtWSRPBlXm22jwCPWfH5+fj44EreatU5DEnsFg6sfOvEGjMoLdnBwcKCL75HQB6yK7eCHnj179kd6by/oCVSrVi0sKipqQEpKyleFhYVrU1NTnwbnLHnW+kRe4ar57bff8oBvtWP+Y4zoJclXIGj90EnNckfvi4yM1NX/LqENDRo0aEVdYpF7Ocl/9NFH5zMzMz82VFCDERgY2Dg+Pn7q7du3v83Ozh4ZGxt7H7BdN5o/YgN+PdEVP/zwQ15ZVMRax/ztckZLBYQ7lipgweMDSxJCYPngHT586dSp04azZ8/+2yNSGgiz2RzQsmXLYWlpaZuzs7NfBkdiFyV5lgVveN1YvXp1HvAHTlmDqJLUKzBECZ5VINWsEK+YQSCBAhtMQ613Mrz44ouLioqKcj0iscFQiL6kpGTLihUr2oOYywZba0ghe0CORkLNYqfjEhUc7rTgmWRuxM5AEpqBkTvPircAgHXfvn1Xe/XqNepeIXkAgKpVq9ZNTEz84MSJE5NAbGEz0ZUsjYSaGwa7R6KCw1mC1/Q1Xs2aNUU+j5cwCP7+/mHAt9y5mzns27fv6pNPPvnyvUTyAACRkZF/LywsXN+lS5f7wIUF5cBDfnjQPpddEn4Fh54++HIEBgZKgvciVKtWLQz4ljtN9g6bP3z33XdXg4KCns/Jyfnc+BR4DoGBgY137969Zfbs2c1A3Jr3Bj88azYMz23DO5eoAHAXwXMz/9KlS/eUpVdBoMU9w9zpJyoq6t1NmzZNqYxTKFkwm80BkydPXk6RvOjqlJ604AH4dVXOf69kcJbgNRWCv/76656p/BUIwgOrgO/8U74ux7PPPvtt9+7dn76XrHmF5EeOHHk/iO0qxbLkjYQzM2MkuVdguGrBy25cxQXLJaPFii9fpGrfvn1XoqKi3h05cuQzZ86c2WFwWjwCs9kcsGDBggWg7oNnDbR66+QDWY8rCUQJXq1bx/tNFhbvhNoKifRuPvRKgyTJl4cVK1acbdiw4dsjRozom5OT83lld90EBgY2PnHixATQtk2gR+fEl0FOjbwHoMWC502pkl+9VTywyB3bzYfrhweE7FNSUs5ERUUt9PPze3znzp2z8/Ly9hmYNkMRGRn59xUrVsSANh+8N1vwEpUE7p5Fg5G+LSMj44ib3yPhOlhbtPEIn1wDGyN3kuSV+K2EhIQt4eHhr8XGxsYrZF/ZLPu+ffsOB21r0wBIkpfQGa4OsorMo5WWvHcCI3TeBhekNc8ccAXEbVMWbu3fv/9KQkLC1vDw8Nf8/PziV6xYMebo0aOrLl++nGVMkvVDrVq1WpftO6y2v6u03iUMgys7OtE7sdA71pCbIFex2WwH3S++hLMwmUyRYE/WtBXPcrXR2w+SlirLPUHOB8csWh8AMC1fvrxtixYtIh988MHomjVrNi6br19hcPny5ayQkJAxYK9LUodKeu3qjM1mS9NbtrIdisjdiTy1QxHtoqJ3c5I7OrkId+3oxEoAukqdxWIp1nPbtz179nwZFxf3BbAtUtZuNaWU3BhEM0uLVeasBSeqd2xeOzYzhnbDqBG8De5WTOzdGMGXgqM1S/ukfUaNGpUBAJkAsAEATEOGDKnXo0ePxi1btmwdEhLSOCQkJFpcTcajVq1arYcMGRK+atWq83BXb6XELZgf3kjI3vQ9Ble37GONxDsQTUFBQW6tWrVau/g+JmrXrh0C9sSGDRRic7/piqh1xpBaJeUt1CZyn8hUVFL3rHW+WTqxAN4AYpYIKSPdMLKCQu4YsTtY8eT5qlWrzqxatep3AEhTri1btqxtx44dW4eFhUWEhoZGe9tesUOGDHlk1apVnwF/jRfWstsSEm6FO/ZkBVCv5HDp0iVdCb5u3boNgT+Pm2XRo/K6Ebw19Hn3inxMRo+FYOSq9jETphe6Z0O/U7HeFfIm7yfvU6x95ajcXwrseeEORE8cfcaMGaNY+T4A4LN06dI2cXFxXR588MHO3uDSadWqVQ8A+ALs9UbqRvrhJQyDK4OsIpZ7OdH873//03Ug7b777msIOJnRM0C40/uIcMuFQD+HfjY92wQL9CAm/T/sPZjPkH4v+XyWa4a23lkNCRnHegxYQ6umf5b+0PSNHTv2UPPmzRdXr17971OnTk386aefvvLkDJ2goKCI9u3bBwK70VLg6XnwEvcAnCF4uuupRgKlAGDbtWvXCack1IDly5e3A5xoePO5eTM/RAkfu5cmZR6Js8hP7XdWw4E1DPTHSrwpkiwi513D7mGRvNqcepY+aX3b6f6dd9453rx586V+fn59tm3btuDGjRsXwQN44YUXIkHsC1ZJ7hK6wtkPnWh3Bs81YAOA0pSUlAslJSX57hCahW7dupEEz3NRqBENRvpCH/gwflcjV4xoaRcKRvTcr0oFZBFxV2H+Yx5BYeWilIqLLIGgNdj9t0+fPju6du368rFjxzYjMuqKTp06RYMkdwkvgDs+dBIZZLMBgO3s2bPfueF9TDRq1Ki9ikxqRE8TjgjxsMiTJmSRMQGejCINk1og0yVK7BghYR/rqH2hKdKr0mLVY24rMj+shw8fvtayZcukVatWzbh9+/Z1RCZdULVq1QBgf9RUUdajkagEcOdywTxyLwWA0mPHjh1x0/tQ+Pn5+aekpHRgyMYbcORZ9lhc7R6awGzEOW3RCjWOgvKKBKzhoOWhwfInq32CzyMvZ3pWdA8Lc385pHno0KHpixYtmsmRxa0IDQ2NAD6JS1KXMASuEDxm7dFkZEes/fv336v3AFjv3r2fEryV2xiBI/GoNQys3zCiVt4PVBwjWZFBTGcInyZ20veuAJvhoiWwSI5On5a0YGMTamksnTJlytGDBw9uAGPB6vVISBgCdyxVwPO3OpDn+fPndXXT1KlTp8W8efNagbivkzeWIGr5Y+MOmC5YwLrxLFmVIy0Xy+XhQHYMGTGZeATPWj2R/sKZt+EFnTaenjHXFpZGZmPbqVOndUa4aqpUqaK4aADYs2ckJHSHK7NoeFYms6JmZmbqSvAAAIMHD36+LMqqZCQwy1LEfcLzW7MIE5NJNGBgNa6ivQxMdlo2bBkCHrkrn+DTRE8vV8AieTI9dFqwBk0klD/vp59++pahS7ehRo0ajTTcLglfQjdoJXiauER8yHYVsn///nv0nk0TGhracvPmzQmAuwowkmEdWeBZ4wp4A2zYuixqrg4yTsui5rfn9a5YcmNy0iQuEmhLXmSNdBqKnLT8rHMsnTYAsB0+fPgY4x16QJK3hEeh1ywazOIqDzk5Obrv+NOrV6+Xn3/++TBwJFKMuDD3AWsWBHCu8dwaaoTuCwA+TzzxRI0nnniiBuAuDmygk+fuYJE+RvJ0OkRInb7ml5KS0iI5ObkF5z7Sshf12StpIo+stPJ6YXDp0iXDZtOAo6wSEobC1S9ZMTcNZkHaWfFjxoz5VO/BVj8/P/+kpKR/gXNWssiAIT2bRO15LDdGeXjssceCN27c+MnGjRs/efzxx2si/8MaJAA2ydPnaoTDSg9LdnLlUL8PPvig+ZAhQ9YOGzZszdKlS5tTv7Mse7WVJkXdVV6DP//8M5s4xfKBdy4h4Ta424IXGZC0pqenF546dUp3K75GjRqNcnNzp4CY31htswbW4CHrXpFQTnhxcXHBW7Zs+cjf3z/K398/avPmzR8/+uijwQy5eG4OGrxxAQA2iapZ8H7E0W/x4sXNR44c+Ymvr2+gr69v4KhRo1YtXLiwOeDkjpG8M7shqTUAWK/LKKiNyUhI6A5XBlnpa2oDZHYkv3Dhws+ceLdmRERExJ88efJ1EB8YZJ2LDjRiLgmWz9oXAMxz5sxptmPHjk/9/f2jFLn9/f2jtmzZ8lFcXFww8ky1XgjLnUSDReoscleOJLmbFyxY8NCYMWM+9vX1DVQe7OvrG/jqq6+mzJ079yGw3xtAxF9P65vnzuH1rug0QuvWrR9E9GAEJOFLGA5XLHiemwaz5u2ms6WkpJzPzs5e6cL7hdGoUaMEguQx3zGTfAV+p++jGweSEOng99VXX3WfNGnSh1WrVq1Lyx0QEBC5bdu2FY888kgw8kyW1cvz0fOsW57ljunCDwD85s6d+9A///nPFSS5K/D19Q2cOHFickpKSnv6f0hci4UvavHTjZ1Pq1at6A/h3I4zZ85kA3swmzaEJCR0gztcNADsQT2Wy8YKAFYjfPEKGjVqlHDu3LnZ7dq1qwmOpELvIMMjHvp3+l4/JDhc79SpU/Dx48cn9O3bdx5vTfOAgIDIr7/+Orlr164KyWMESM9W4Q0g08TPGi/wAZzcy9M6e/bsZhMnTkzGyF2B2WwOGD58eFJqamofAd2INrhaXGvlYd68eS3r1KnTgiWru3Dx4sU8YA/6AuCELyHhdrgyyErGhaZIAvVhSnp6esGhQ4cMseIBAOrVq9c5LS3to8WLFz8MONlUYZxXQX7D/luFcW7332XLlrX79ttvV0dFRQ0QkTswMLDx9u3bP4yNjb0PxNwa9ICsmiuDRexMK37WrFnNJk+evFx0w434+Pipv/zyywSO/ljWPXnO61VxCb9169aBI0aMGCEiq6v4/vvvc4E/nRNAEruEAXDVgucRPW3FoyTfuXPnDUZuuly9evU6r7766ns//vjjuHbt2gUDn7BpcmY1ACKNhN9LL710/6+//jrtlVdeeV/r5hSBgYGNd+zYkRQbG8uz5EXcNRjxi1rvCrk3nTJlSpLW3ZSaNGnSv6Cg4JPBgwfXF9CbWi9IzZVm57/fsmXLxJo1a+ruf7dYLMWzZs3KBf4HZZLkJQyBqz54Ms6z4rmfmH/44YeLXJDDKTz00EPP7t+//9PMzMzhCNHTlruW4EBW06ZNa/rrr79O/eSTTz5/4IEHejgrM0HyNUHAagVtM094/vdyN9CMGTOcIncFQUFBESkpKSv37t37HLB7QayGk3Wdacm3adMm6OrVq8v/9re/dXRGXq34/fff04FP7Cyyl5BwO9w1TZKMq82icSD5adOmHT9w4MASN8iiCWazOeDhhx8elJGR8fXJkyenrl+/Pg5wt4xmkh80aNDf9u7d+1xBQcHKmTNnfuQKsZOgSF7Y/wzOfYBl9/xZs2Y1feONNz5wdR9Us9kc0LVr11du3Ljx+fbt23sD3+XFajwxsrcbI9i8eXPP77//fq0RlruCEydOZAF7ooG04iUMhclmw8uXySQ0bZiehQHA7vLT3WkHv+ulS5c+1HPfVhFYLJbiixcvZp86depodnb2yXXr1uUeOnSoCPjzyGHp0qWtH3jggboNGzaMuP/++1sFBQVF6ClnUVFRbq9evUbt27fvCjju3kQvnUsSDSk3ZrVj+WOeNWvWQ65Y7jyUlJTk//e//10zc+bM78p0TctLkiE97dOhodq6dWuPDh06JISGhrZ0t6w8WCyWYj8/vx6Ar7evyGwCqmdks9nS9JbNZDJ1BnxnLHLJZdbidO7saWCGBm2o0JMWyhv5pKSk9qNGjdLdGPQifWkGyemuEjwAPt2OrHCkL5Q3K8UcGxsbvHPnzrXesHkyjYKCglO3bt1ymPFTu3btVp6QB+AOyffu3Xvk3r17rwB7e0Clt0RbjjTBkw2wXQWbM2fOQ5MmTfpQD3Kncf78+f1ZWVn7Dx48mPvOO++Qg5U0ykkiJiYmcOzYsa07duzYuWHDhp2MkBPD8ePHNzZt2nQR4BWeJrXyOiAJXhK8O6EHwdNHbHaG2pxqMwD4OTuAd6+iuLg4p0+fPom7d+/GSJ4sgDwLnjkdcv78+c0nTJjAnQqpJ5TP/svmlpejWrVq/qGhoRH+/v5h1atXr+MJ2WgMGzas38qVK88Bvt4+AEPfNpttj96yeRFhSYLXGSSnm93xPLiTUWT3mZ77Wwr2mWoFx0w2AYDPtGnTjsfExLwfHx8/1Q2yVXooH0P17dt36M6dO68CewCVzB/g3FeeH++9917TcePGeYzcAe72kDzZUxLBmTNndqxcufI8OE4oAHCsG3KAVcIQuOtDJxLYxx0KydMbM6BbsyUkJGzduXPnbB1kq5Tw9/eP2rRp08qePXsGgeOHTIBcUyN6WLp0adNx48Z95ElyryiwWCzFL774IumaYa1V7w2DrLJR0YYKrS93fslKHpU4azYNbzs2heS3SZIXh7+/f9SXX375ydNPP62QPIAj0YPKbwAAkJyc3GzUqFGrJLmLITMz8+P09PQCYO8wRdcDT1vxniQtkXd7G6l6mzzC0MOCB+B/xccieofNlSXJa0O1atWarFix4s2yU+FBFAqmwYMHL5PkLob8/PzvOnXqtB742yPSxE7PDvIkvEEGDKhcJpPJ0/J6+v2a4E6Cp614tTnx2EbKZLgNkuQ14cqVK/99+eWXZ4NrFqJtzZo1r1it1iK3C1jJUFRUlDtgwIAZwC/HPJI30oIXdQl5isB4uvBEb8fb9SUEd1vwaq4anhVPW/AKyd9OSEjY+uWXX75u1MJkFRF5eXlba9WqNWbTpk2FwC90WH7YhcTExF+Sk5MHS5Jnw2KxFC9dunTGvn37rgJO7iwr3pMuGsz4UrvXk6BltPn4+Eh9aYBeLhoFrMFWni9eIXi7+dz9+/ffPW/evNFFRUW5Ostc4XDkyJF3w8PDp4K9Zcj7VJ6GQwP8yiuv/LJs2bJhkuQdYbFYiufNmzd66tSpPwPbcqeJHnNbKr8ZAVY54A34Gt27UOIOxG6gLJgc3qYvYeg1i4Y+sgq2mhVPhtvTpk37pWfPnqPz8vL26SB3hYPVai3avn37xLZt264BeyJRI3dWQ2D3jPHjx//8/vvvJxYXF+cYlyrvhkLu06ZN+wkcy6wWC95oFw32PpG4HhBNt4PhYaAP3pv05TT0HGSljzTJK3HWtEnlSH6Cfzs9Pf1qeHj4pJ07d86+l102xcXFOePGjXuhd+/e/wU2gfCsRwDHCuTQy5o4ceLPffr0Sbx48eJeo9LmrSgqKsodM2bMiwi5s2bP8EieDEZAzTUH4Fmiwqxkh3Lr6+sr9aUBertoAPCuFk1EvLnxJNGXHxMSEraOHj16kJFLDXsLfvzxx48CAwNfSEpK+h34rgGsUQXkGtdttnv37mthYWETDh06tMiYFHofzp49++9evXqNSk5O/h3wHiYrH7CvHD3homH5/zFjzEhgbg4W2RttwXujvjRBT4Jn+adYLhuM5OkuMEnyt1NSUs6GhIS8/OWXX75eUlKSr2NavAKXL1/Omj179qAWLVp8CGyCocmDZZ3zSB4l+vbt26975513Bt5L4yAWi6V406ZNUxo0aPAvYmE3eowIs+Z5rhlPWPDeMtBLQo0sHcqy2Wy+l/WlGUYOstJHFsmr+eNvg73bxtK/f//d8fHxA7Ozs1dWRrdNSUlJ/s6dO2eHhIS8XOYeELEcRWdwYPfQjW35+6ZOnfpzUFDQCxkZGYsro65J5OTkfB4XF/fMs88++1/A1yGhjyL+dyUPyPuMAKsXAeAdxEXLgpVVqwcseG/VlxCMdNHQR8yFgFmP3IFXJaSnp1+Jjo7+MC4u7pnKQvQWi6U4Ozt7ZXx8/MCEhIQt4LhSJM9q5FnxPJJnkjsQBNehQ4f1iq711YLxOHPmzI4RI0b0jYqKWpienq5Y7fRyzLQFT+pflOiVe40Aq6HnlQ+joVY2vcGC9yZ9qcIIggfgk7xa4cemTzJDenr61ejo6OS4uLhnDhw4sKQium5KSkrys7OzV8bFxT0THR39YRnJ0OSCkT09yCdK6hjJq7nKyhvVESNG9K0MjapC7A0bNvxXSkrKWUB6i+Coa960SF65JvVsBHgfXXmaoISNDwMHWb1ZX8Jwx3LBmt7HOdLLDNM7DfkCvvwwto+o3f0bN27sFhMT07VBgwY99UiUu5CXl7fv2LFj3yUkJHwNjkTAIl7MYsQGWQEcCyW2w5PaBtzKWuYO+o6Nja3x1ltvdevYseOAwMDAxm5TjI4oKSnJz8rK+mLKlClfp6enFwJf19hvWOUHsN+QBFsWl1wP/hedkwkmk6kJODZQmFFAN1AA7ic01u5iqsuLb9q0qdMzzzyz2o2y4AJ6l740wd3rwWuFGsnziJ4med6RjvvExsYGvfXWW91atGjRtXbt2q29Yc35oqKi3GPHjv3nk08+2ZOSknIe2JYeTeQsUsf8hqwChy4TDGw98xpSO10nJibWmzRp0t/r1q3bxtvIvqioKPfChQtZX3zxxb+nT59+Ahz1p6Zv+og1otiOU+g+t4WFhettNpvJZrOZAADoY2lpaXllVK4B2K/LonzhqVwjjyaTyRYUFPQC4IPBZMB6dqwBUFfAWqIaK3PkRjS+H3/8cYv+/ftPpfVF6qUS6ksTPE3wAOLL1mKWPL1TFJfUkfPy5yUnJ7dt3759m/r167c2aqvAkpKS/D/++OPIiRMnsmbOnLknPT1d2aJOrSvPu4YFNesdgN+D4vWe1BpWu5CYmBjer1+/tlFRUa1DQ0PbGL1jl0LoZ86cyf3yyy8Pp6SkXAB1nbMaWPpebAAOQMxCxTZOJ3VJ5okSp4H5h3m9PpH1cjDDQA+CV+K8HjupI1pfvPrNWi21IupLE7yB4AHESV7NdcMjc/I6q6EoP86YMSOyffv2kXXq1KkbGhrauEqVKgHOEn9JSUn+jRs38oqLi/OuXbuWn5GRcWTt2rUnyggdG1imLW+MTDAyYvnTRQucs42qpsaUfHZsbGzgwIEDo5o3bx5Zq1atsJCQkMYAAK40shaLpbigoCAXAODcuXNZ+fn5+WfOnLkwcuTIw4BXaJaPXETvrMpN61U5sgiedndh5E6SFVYpMX81RlqlcJeslDirHOk9gKjWa2f1HtU2mafJvbLoSxO8heABHMmdPmoleR75c8mdiANxLC8knTt3Dhw0aFCkWoJGjhx5BOxJlTVwhBUw8lx0FgZGXFhhE7HgWd1mEb1ixMQiKroS0hYdJCcnt2HpmESZvsn0sXTN0j0rD2j3C69LTveSWATGIi8RS5TWkVp6sbTweiRYOSKf726I9thFdIU1hJVNX8LwJoIH0EbyrIKgRkaoJQn2hYJXmYC6xgJNpmoEzyJ5lnUpYq2TZCNa2JxpVEUaWS3kjulbBO7QuQjhY3nEs9rINPH0xSN2zBol9YKlmZcuntGAlSUA8TKkFXSa1IwKpgsQ2OUKoPLoSxju3pPVVdjgbiYocRvyO6tVLoU7mUvGlSOvMcCIjPUerBFipYU+KnEWKfDIRuQai9BIOeg4CUWPtN4VmZXrio5ZOmeRE8+64umap3MsXVgl45G9KOGz7ufpmpTNBPblkv5d0a0aWamVO1aDJmIkaC0z7gJZ98lravqiyyGvTAHgnFIR9aUZ3kDwAHcVY0LiWOYov5uI32lyV8jJhzoXIXjgxEXTooVsaNJgEQpmrbOIjZaHPKetGq2NKkvnLOtTxGpnkTt2jqVJC9HzdMvLB+UaEEda3yzQpKUQO/kMuuyqNXxqaXbGSCCfaxSw96mRPFm/eZZ7ZdSXMLyF4BWQ5MMjHrIC0ERPHknrCbtf1HJnEQ8mP33USvRqRK5GMiKWBXnuSqNKHrEK54rl7mqDSsbdoXNWIN+tgNafAprAlWcovSGsbANyFEk/llbRNGLPNQL0u0h9KbJh9ZtnubPeURn0pQpvI3gAR7Kh48o9PNKgSR0rBD5wx8emWFHuIh0e4dCELFJ4yP+w/k++jxdnyeuORhXTtUgDilVKUXIn08eruPQ5S7cihM4jdlomjOgxAqd1CMg5AK4XOq94aVZLo5GgyRorewB4bwar/wCVW19OwRsGWXmghcAyT4Q8tFiRPFLXQvBkXI1otBCKu4gdAyut7tS1WiPKiyug08bShbM6B8AbU967SPB0B3DXqMCMC2cbPJp01NIl0vvTm8RYelKOovXVWUOsoulLCN42i0YEWoiejKsREet/9HMxGVjQQjb0uQiZixCMKwXNCF2rWVxaC5+rOseuYTrH3sGCKHlh54Cc089kycAjLtY5dsSerQd4DbxWQr8X9KWKikjwCkTJRznyKhTrHuxZ2Lt54BENdk1rHHsPdu4KnCV6LXH6GvZeEfAqrbt1Tp/TvzmjN96R9VyWPOQ576hWnowkK7X6ptUoUCtDFV1fXFRkglcgUomUuEhBESV2EaXwCoJIwXHGctSzcDmja7WGFDvy4jyo6chTOuelxd06YMklog+1/xkFER2oWfvOoKLqi4nKQPAkRCoSGddiObGUQF9nZTCvwChxtXPeezxhZYmc8xpW8l41XWuxWrHrot1qvXSuRWf0uSsV0JX0eJKspL7cgMpG8AqcLRyi1oCzLhryXOR6RShQzlQ8Ef2znqcGTCdautR661xLGt1Z8UQaQbV7PQGpLxdQWQmehEgBUbtHa4HiZbjWrr43kjoLWvVKn/MKmlZfKus3b9K5K+l1BqI68lZIfWnEvUDwNNxpETjjNlD7vUJZCBxotcbdUXmdqZBarxsBPStcRSxLapD6YsDb1qIxAnSGmZBrzj7LHf+t0AWKgFb/tBHWUkXRubfJ4+2Q+hLAvULwNFiFwxXid+W9lRmeTrOn3y8h4THcqwTPgiQD4yB1LSGhM3zUb5GQkJCQqIiQBC8hISFRSSEJXkJCQqKSQhK8hISERCUFcx68hISEhETFxv8DyiHdi+HvGlcAAAAASUVORK5CYII=").appendTo($("#map"));var e=L.geoJSON(null,{color:"#634c4e",dashArray:"4,8",weight:2,opacity:.8}).addTo(n),i=L.geoJSON(null,{color:"#634c4e",weight:2,opacity:.8}).addTo(n);r=L.featureGroup().addTo(n).on("click",d),o=L.featureGroup().addTo(n).on("click",d),$.getJSON("https://media.nationalgeographic.org/ooew/mapobjects/combined_simplified_500m_to_jaipur_walking.geojson",function(t){i.addData(t)}),$.getJSON("https://media.nationalgeographic.org/ooew/mapobjects/combined_simplified_500m_to_jaipur_motorized.geojson",function(t){e.addData(t)}),L.Browser.mobile||L.easyButton({states:[{icon:"<img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNTAgNTAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUwIDUwOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHN0eWxlIHR5cGU9InRleHQvY3NzIj4uc3Qwe2ZpbGw6IzAxMDEwMTt9PC9zdHlsZT48cG9seWdvbiBjbGFzcz0ic3QwIiBwb2ludHM9IjQ5LDI2LjUgMjQuOCwyLjcgMSwyNi41IDkuOSwyNi41IDkuOSw0Ny4zIDIwLjgsNDcuMyAyMC44LDMzLjkgMjkuMiwzMy45IDI5LjIsNDcuMyA0MC4xLDQ3LjMgNDAuMSwyNi41ICIvPjwvc3ZnPg'/>",onClick:function(t,e){n.fitBounds(r.getBounds())},title:"View entire walk"}]}).addTo(n),a=$(new Table($("ul#list").get(0))).on("itemActivate",m).on("itemDetails",A).on("itemHoverIn",T).on("itemHoverOut",S).get(0),$.getJSON("https://www.nationalgeographic.org/projects/out-of-eden-walk/api/v1/list.json/?sections=milestones&limit=100",function(t){s=$.map(t.results,function(t){return new Milestone(t)}),$.each(s,function(t,e){L.marker(e.getLatLng(),{icon:L.ExtraMarkers.icon({tooltipAnchor:[15,-30],icon:"fa-number",markerColor:"yellow",number:e.getMileStone()}),riseOnHover:!0}).bindTooltip(e.getTitle()).addTo(r).key=e.getID(),L.circleMarker(e.getLatLng(),{color:"white",weight:2,fillColor:"#ffd800",fillOpacity:1,radius:7,bubblingMouseEvents:!1}).bindTooltip(e.getTitle()).addTo(o).key=e.getID()}),a.load(s),n.fitBounds(r.getBounds()),$("html body").keydown(y),$("#details a#arrow-left, #details a#arrow-right").click(f),$("#details .x-button").click(_),$("#button-show").click(M),$("#filterWidgets label.switch input").change(v),$("#filterWidgets select#sort").change(w),$(document).one("touchstart",function(){$("html body").addClass(p)})})})}();